(window.webpackJsonpfeffery_utils_components=window.webpackJsonpfeffery_utils_components||[]).push([[0],{554:function(c,e,t){t.r(e),t.d(e,"ACESFilmicToneMapping",function(){return we}),t.d(e,"AddEquation",function(){return ee}),t.d(e,"AddOperation",function(){return U}),t.d(e,"AdditiveAnimationBlendMode",function(){return _r}),t.d(e,"AdditiveBlending",function(){return X}),t.d(e,"AlphaFormat",function(){return ct}),t.d(e,"AlwaysDepth",function(){return ve}),t.d(e,"AlwaysStencilFunc",function(){return Jr}),t.d(e,"AmbientLight",function(){return qd}),t.d(e,"AmbientLightProbe",function(){return dc}),t.d(e,"AnimationClip",function(){return bd}),t.d(e,"AnimationLoader",function(){return Ad}),t.d(e,"AnimationMixer",function(){return Gc}),t.d(e,"AnimationObjectGroup",function(){return Bc}),t.d(e,"AnimationUtils",function(){return x}),t.d(e,"ArcCurve",function(){return Jh}),t.d(e,"ArrayCamera",function(){return wl}),t.d(e,"ArrowHelper",function(){return Af}),t.d(e,"Audio",function(){return Tc}),t.d(e,"AudioAnalyser",function(){return Lc}),t.d(e,"AudioContext",function(){return lc}),t.d(e,"AudioListener",function(){return _c}),t.d(e,"AudioLoader",function(){return hc}),t.d(e,"AxesHelper",function(){return Lf}),t.d(e,"AxisHelper",function(){return ip}),t.d(e,"BackSide",function(){return Ae}),t.d(e,"BasicDepthPacking",function(){return Ir}),t.d(e,"BasicShadowMap",function(){return R}),t.d(e,"BinaryTextureLoader",function(){return lp}),t.d(e,"Bone",function(){return oh}),t.d(e,"BooleanKeyframeTrack",function(){return fd}),t.d(e,"BoundingBoxHelper",function(){return np}),t.d(e,"Box2",function(){return Xc}),t.d(e,"Box3",function(){return Ni}),t.d(e,"Box3Helper",function(){return Tf}),t.d(e,"BoxBufferGeometry",function(){return ka}),t.d(e,"BoxGeometry",function(){return ka}),t.d(e,"BoxHelper",function(){return _f}),t.d(e,"BufferAttribute",function(){return E}),t.d(e,"BufferGeometry",function(){return S}),t.d(e,"BufferGeometryLoader",function(){return tc}),t.d(e,"ByteType",function(){return tt}),t.d(e,"Cache",function(){return _d}),t.d(e,"Camera",function(){return Ua}),t.d(e,"CameraHelper",function(){return xf}),t.d(e,"CanvasRenderer",function(){return up}),t.d(e,"CanvasTexture",function(){return Nh}),t.d(e,"CatmullRomCurve3",function(){return iu}),t.d(e,"CineonToneMapping",function(){return H}),t.d(e,"CircleBufferGeometry",function(){return Uh}),t.d(e,"CircleGeometry",function(){return Uh}),t.d(e,"ClampToEdgeWrapping",function(){return Le}),t.d(e,"Clock",function(){return mc}),t.d(e,"Color",function(){return m}),t.d(e,"ColorKeyframeTrack",function(){return pd}),t.d(e,"CompressedTexture",function(){return Fh}),t.d(e,"CompressedTextureLoader",function(){return Ld}),t.d(e,"ConeBufferGeometry",function(){return zh}),t.d(e,"ConeGeometry",function(){return zh}),t.d(e,"CubeCamera",function(){return Ga}),t.d(e,"CubeReflectionMapping",function(){return Be}),t.d(e,"CubeRefractionMapping",function(){return Ue}),t.d(e,"CubeTexture",function(){return za}),t.d(e,"CubeTextureLoader",function(){return Cd}),t.d(e,"CubeUVReflectionMapping",function(){return He}),t.d(e,"CubeUVRefractionMapping",function(){return Ve}),t.d(e,"CubicBezierCurve",function(){return ou}),t.d(e,"CubicBezierCurve3",function(){return lu}),t.d(e,"CubicInterpolant",function(){return hd}),t.d(e,"CullFaceBack",function(){return Y}),t.d(e,"CullFaceFront",function(){return $}),t.d(e,"CullFaceFrontBack",function(){return L}),t.d(e,"CullFaceNone",function(){return j}),t.d(e,"Curve",function(){return Kh}),t.d(e,"CurvePath",function(){return mu}),t.d(e,"CustomBlending",function(){return Q}),t.d(e,"CustomToneMapping",function(){return Ee}),t.d(e,"CylinderBufferGeometry",function(){return Gh}),t.d(e,"CylinderGeometry",function(){return Gh}),t.d(e,"Cylindrical",function(){return qc}),t.d(e,"DataTexture",function(){return lh}),t.d(e,"DataTexture2DArray",function(){return Ps}),t.d(e,"DataTexture3D",function(){return Us}),t.d(e,"DataTextureLoader",function(){return Dd}),t.d(e,"DataUtils",function(){return If}),t.d(e,"DecrementStencilOp",function(){return Gr}),t.d(e,"DecrementWrapStencilOp",function(){return Hr}),t.d(e,"DefaultLoadingManager",function(){return Sd}),t.d(e,"DepthFormat",function(){return vt}),t.d(e,"DepthStencilFormat",function(){return yt}),t.d(e,"DepthTexture",function(){return Bh}),t.d(e,"DirectionalLight",function(){return $d}),t.d(e,"DirectionalLightHelper",function(){return vf}),t.d(e,"DiscreteInterpolant",function(){return dd}),t.d(e,"DodecahedronBufferGeometry",function(){return Vh}),t.d(e,"DodecahedronGeometry",function(){return Vh}),t.d(e,"DoubleSide",function(){return Fe}),t.d(e,"DstAlphaFactor",function(){return de}),t.d(e,"DstColorFactor",function(){return fe}),t.d(e,"DynamicBufferAttribute",function(){return $f}),t.d(e,"DynamicCopyUsage",function(){return ai}),t.d(e,"DynamicDrawUsage",function(){return Qr}),t.d(e,"DynamicReadUsage",function(){return ri}),t.d(e,"EdgesGeometry",function(){return qh}),t.d(e,"EdgesHelper",function(){return ap}),t.d(e,"EllipseCurve",function(){return Xh}),t.d(e,"EqualDepth",function(){return be}),t.d(e,"EqualStencilFunc",function(){return Yr}),t.d(e,"EquirectangularReflectionMapping",function(){return Ge}),t.d(e,"EquirectangularRefractionMapping",function(){return ze}),t.d(e,"Euler",function(){return _n}),t.d(e,"EventDispatcher",function(){return hi}),t.d(e,"ExtrudeBufferGeometry",function(){return Nu}),t.d(e,"ExtrudeGeometry",function(){return Nu}),t.d(e,"FaceColors",function(){return Ff}),t.d(e,"FileLoader",function(){return Md}),t.d(e,"FlatShading",function(){return P}),t.d(e,"Float16BufferAttribute",function(){return la}),t.d(e,"Float32Attribute",function(){return tp}),t.d(e,"Float32BufferAttribute",function(){return W}),t.d(e,"Float64Attribute",function(){return rp}),t.d(e,"Float64BufferAttribute",function(){return ha}),t.d(e,"FloatType",function(){return st}),t.d(e,"Fog",function(){return Il}),t.d(e,"FogExp2",function(){return Dl}),t.d(e,"Font",function(){return vp}),t.d(e,"FontLoader",function(){return gp}),t.d(e,"FrontSide",function(){return Oe}),t.d(e,"Frustum",function(){return Ka}),t.d(e,"GLBufferAttribute",function(){return Vc}),t.d(e,"GLSL1",function(){return oi}),t.d(e,"GLSL3",function(){return li}),t.d(e,"GammaEncoding",function(){return Mr}),t.d(e,"GreaterDepth",function(){return Te}),t.d(e,"GreaterEqualDepth",function(){return _e}),t.d(e,"GreaterEqualStencilFunc",function(){return Xr}),t.d(e,"GreaterStencilFunc",function(){return qr}),t.d(e,"GridHelper",function(){return cf}),t.d(e,"Group",function(){return El}),t.d(e,"HalfFloatType",function(){return ot}),t.d(e,"HemisphereLight",function(){return kd}),t.d(e,"HemisphereLightHelper",function(){return df}),t.d(e,"HemisphereLightProbe",function(){return uc}),t.d(e,"IcosahedronBufferGeometry",function(){return Uu}),t.d(e,"IcosahedronGeometry",function(){return Uu}),t.d(e,"ImageBitmapLoader",function(){return sc}),t.d(e,"ImageLoader",function(){return Rd}),t.d(e,"ImageUtils",function(){return Li}),t.d(e,"ImmediateRenderObject",function(){return yp}),t.d(e,"IncrementStencilOp",function(){return Ur}),t.d(e,"IncrementWrapStencilOp",function(){return zr}),t.d(e,"InstancedBufferAttribute",function(){return ch}),t.d(e,"InstancedBufferGeometry",function(){return ec}),t.d(e,"InstancedInterleavedBuffer",function(){return Hc}),t.d(e,"InstancedMesh",function(){return vh}),t.d(e,"Int16Attribute",function(){return Jf}),t.d(e,"Int16BufferAttribute",function(){return na}),t.d(e,"Int32Attribute",function(){return Qf}),t.d(e,"Int32BufferAttribute",function(){return sa}),t.d(e,"Int8Attribute",function(){return qf}),t.d(e,"Int8BufferAttribute",function(){return ta}),t.d(e,"IntType",function(){return nt}),t.d(e,"InterleavedBuffer",function(){return kl}),t.d(e,"InterleavedBufferAttribute",function(){return Ol}),t.d(e,"Interpolant",function(){return ld}),t.d(e,"InterpolateDiscrete",function(){return pr}),t.d(e,"InterpolateLinear",function(){return mr}),t.d(e,"InterpolateSmooth",function(){return gr}),t.d(e,"InvertStencilOp",function(){return Vr}),t.d(e,"JSONLoader",function(){return dp}),t.d(e,"KeepStencilOp",function(){return Nr}),t.d(e,"KeyframeTrack",function(){return cd}),t.d(e,"LOD",function(){return eh}),t.d(e,"LatheBufferGeometry",function(){return Gu}),t.d(e,"LatheGeometry",function(){return Gu}),t.d(e,"Layers",function(){return Tn}),t.d(e,"LensFlare",function(){return fp}),t.d(e,"LessDepth",function(){return ye}),t.d(e,"LessEqualDepth",function(){return xe}),t.d(e,"LessEqualStencilFunc",function(){return $r}),t.d(e,"LessStencilFunc",function(){return jr}),t.d(e,"Light",function(){return Pd}),t.d(e,"LightProbe",function(){return Jd}),t.d(e,"Line",function(){return Sh}),t.d(e,"Line3",function(){return Qc}),t.d(e,"LineBasicMaterial",function(){return g}),t.d(e,"LineCurve",function(){return hu}),t.d(e,"LineCurve3",function(){return uu}),t.d(e,"LineDashedMaterial",function(){return sd}),t.d(e,"LineLoop",function(){return Ah}),t.d(e,"LinePieces",function(){return kf}),t.d(e,"LineSegments",function(){return Mh}),t.d(e,"LineStrip",function(){return Pf}),t.d(e,"LinearEncoding",function(){return De}),t.d(e,"LinearFilter",function(){return B}),t.d(e,"LinearInterpolant",function(){return ud}),t.d(e,"LinearMipMapLinearFilter",function(){return Qe}),t.d(e,"LinearMipMapNearestFilter",function(){return Je}),t.d(e,"LinearMipmapLinearFilter",function(){return Ze}),t.d(e,"LinearMipmapNearestFilter",function(){return Xe}),t.d(e,"LinearToneMapping",function(){return G}),t.d(e,"Loader",function(){return wd}),t.d(e,"LoaderUtils",function(){return Qd}),t.d(e,"LoadingManager",function(){return Td}),t.d(e,"LogLuvEncoding",function(){return Lr}),t.d(e,"LoopOnce",function(){return dr}),t.d(e,"LoopPingPong",function(){return fr}),t.d(e,"LoopRepeat",function(){return cr}),t.d(e,"LuminanceAlphaFormat",function(){return mt}),t.d(e,"LuminanceFormat",function(){return pt}),t.d(e,"MOUSE",function(){return T}),t.d(e,"Material",function(){return r}),t.d(e,"MaterialLoader",function(){return Zd}),t.d(e,"Math",function(){return _i}),t.d(e,"MathUtils",function(){return _i}),t.d(e,"Matrix3",function(){return v}),t.d(e,"Matrix4",function(){return ke}),t.d(e,"MaxEquation",function(){return ne}),t.d(e,"Mesh",function(){return w}),t.d(e,"MeshBasicMaterial",function(){return Qn}),t.d(e,"MeshDepthMaterial",function(){return yl}),t.d(e,"MeshDistanceMaterial",function(){return xl}),t.d(e,"MeshFaceMaterial",function(){return Bf}),t.d(e,"MeshLambertMaterial",function(){return nd}),t.d(e,"MeshMatcapMaterial",function(){return ad}),t.d(e,"MeshNormalMaterial",function(){return id}),t.d(e,"MeshPhongMaterial",function(){return td}),t.d(e,"MeshPhysicalMaterial",function(){return ed}),t.d(e,"MeshStandardMaterial",function(){return Qu}),t.d(e,"MeshToonMaterial",function(){return rd}),t.d(e,"MinEquation",function(){return ie}),t.d(e,"MirroredRepeatWrapping",function(){return je}),t.d(e,"MixOperation",function(){return N}),t.d(e,"MultiMaterial",function(){return Uf}),t.d(e,"MultiplyBlending",function(){return Z}),t.d(e,"MultiplyOperation",function(){return O}),t.d(e,"NearestFilter",function(){return Re}),t.d(e,"NearestMipMapLinearFilter",function(){return Ke}),t.d(e,"NearestMipMapNearestFilter",function(){return $e}),t.d(e,"NearestMipmapLinearFilter",function(){return qe}),t.d(e,"NearestMipmapNearestFilter",function(){return Ye}),t.d(e,"NeverDepth",function(){return ge}),t.d(e,"NeverStencilFunc",function(){return Wr}),t.d(e,"NoBlending",function(){return q}),t.d(e,"NoColors",function(){return Of}),t.d(e,"NoToneMapping",function(){return Ne}),t.d(e,"NormalAnimationBlendMode",function(){return br}),t.d(e,"NormalBlending",function(){return K}),t.d(e,"NotEqualDepth",function(){return Se}),t.d(e,"NotEqualStencilFunc",function(){return Kr}),t.d(e,"NumberKeyframeTrack",function(){return md}),t.d(e,"Object3D",function(){return f}),t.d(e,"ObjectLoader",function(){return rc}),t.d(e,"ObjectSpaceNormalMap",function(){return Or}),t.d(e,"OctahedronBufferGeometry",function(){return zu}),t.d(e,"OctahedronGeometry",function(){return zu}),t.d(e,"OneFactor",function(){return se}),t.d(e,"OneMinusDstAlphaFactor",function(){return ce}),t.d(e,"OneMinusDstColorFactor",function(){return pe}),t.d(e,"OneMinusSrcAlphaFactor",function(){return ue}),t.d(e,"OneMinusSrcColorFactor",function(){return le}),t.d(e,"OrthographicCamera",function(){return ss}),t.d(e,"PCFShadowMap",function(){return C}),t.d(e,"PCFSoftShadowMap",function(){return D}),t.d(e,"PMREMGenerator",function(){return _s}),t.d(e,"ParametricGeometry",function(){return pp}),t.d(e,"Particle",function(){return zf}),t.d(e,"ParticleBasicMaterial",function(){return Wf}),t.d(e,"ParticleSystem",function(){return Hf}),t.d(e,"ParticleSystemMaterial",function(){return jf}),t.d(e,"Path",function(){return gu}),t.d(e,"PerspectiveCamera",function(){return F}),t.d(e,"Plane",function(){return Ya}),t.d(e,"PlaneBufferGeometry",function(){return Za}),t.d(e,"PlaneGeometry",function(){return Za}),t.d(e,"PlaneHelper",function(){return Sf}),t.d(e,"PointCloud",function(){return Gf}),t.d(e,"PointCloudMaterial",function(){return Vf}),t.d(e,"PointLight",function(){return jd}),t.d(e,"PointLightHelper",function(){return of}),t.d(e,"Points",function(){return Ph}),t.d(e,"PointsMaterial",function(){return Lh}),t.d(e,"PolarGridHelper",function(){return ff}),t.d(e,"PolyhedronBufferGeometry",function(){return Hh}),t.d(e,"PolyhedronGeometry",function(){return Hh}),t.d(e,"PositionalAudio",function(){return Ac}),t.d(e,"PropertyBinding",function(){return b}),t.d(e,"PropertyMixer",function(){return Rc}),t.d(e,"QuadraticBezierCurve",function(){return du}),t.d(e,"QuadraticBezierCurve3",function(){return cu}),t.d(e,"Quaternion",function(){return ki}),t.d(e,"QuaternionKeyframeTrack",function(){return vd}),t.d(e,"QuaternionLinearInterpolant",function(){return gd}),t.d(e,"REVISION",function(){return _}),t.d(e,"RGBADepthPacking",function(){return Pr}),t.d(e,"RGBAFormat",function(){return Ce}),t.d(e,"RGBAIntegerFormat",function(){return wt}),t.d(e,"RGBA_ASTC_10x10_Format",function(){return $t}),t.d(e,"RGBA_ASTC_10x5_Format",function(){return Wt}),t.d(e,"RGBA_ASTC_10x6_Format",function(){return jt}),t.d(e,"RGBA_ASTC_10x8_Format",function(){return Yt}),t.d(e,"RGBA_ASTC_12x10_Format",function(){return qt}),t.d(e,"RGBA_ASTC_12x12_Format",function(){return Kt}),t.d(e,"RGBA_ASTC_4x4_Format",function(){return Ft}),t.d(e,"RGBA_ASTC_5x4_Format",function(){return Nt}),t.d(e,"RGBA_ASTC_5x5_Format",function(){return Bt}),t.d(e,"RGBA_ASTC_6x5_Format",function(){return Ut}),t.d(e,"RGBA_ASTC_6x6_Format",function(){return Gt}),t.d(e,"RGBA_ASTC_8x5_Format",function(){return zt}),t.d(e,"RGBA_ASTC_8x6_Format",function(){return Ht}),t.d(e,"RGBA_ASTC_8x8_Format",function(){return Vt}),t.d(e,"RGBA_BPTC_Format",function(){return Xt}),t.d(e,"RGBA_ETC2_EAC_Format",function(){return Ot}),t.d(e,"RGBA_PVRTC_2BPPV1_Format",function(){return It}),t.d(e,"RGBA_PVRTC_4BPPV1_Format",function(){return Dt}),t.d(e,"RGBA_S3TC_DXT1_Format",function(){return Mt}),t.d(e,"RGBA_S3TC_DXT3_Format",function(){return At}),t.d(e,"RGBA_S3TC_DXT5_Format",function(){return Lt}),t.d(e,"RGBDEncoding",function(){return Dr}),t.d(e,"RGBEEncoding",function(){return Ar}),t.d(e,"RGBEFormat",function(){return gt}),t.d(e,"RGBFormat",function(){return ft}),t.d(e,"RGBIntegerFormat",function(){return St}),t.d(e,"RGBM16Encoding",function(){return Cr}),t.d(e,"RGBM7Encoding",function(){return Rr}),t.d(e,"RGB_ETC1_Format",function(){return Pt}),t.d(e,"RGB_ETC2_Format",function(){return kt}),t.d(e,"RGB_PVRTC_2BPPV1_Format",function(){return Ct}),t.d(e,"RGB_PVRTC_4BPPV1_Format",function(){return Rt}),t.d(e,"RGB_S3TC_DXT1_Format",function(){return Et}),t.d(e,"RGFormat",function(){return _t}),t.d(e,"RGIntegerFormat",function(){return Tt}),t.d(e,"RawShaderMaterial",function(){return os}),t.d(e,"Ray",function(){return dn}),t.d(e,"Raycaster",function(){return Wc}),t.d(e,"RectAreaLight",function(){return Kd}),t.d(e,"RedFormat",function(){return xt}),t.d(e,"RedIntegerFormat",function(){return bt}),t.d(e,"ReinhardToneMapping",function(){return z}),t.d(e,"RepeatWrapping",function(){return We}),t.d(e,"ReplaceStencilOp",function(){return Br}),t.d(e,"ReverseSubtractEquation",function(){return re}),t.d(e,"RingBufferGeometry",function(){return Hu}),t.d(e,"RingGeometry",function(){return Hu}),t.d(e,"SRGB8_ALPHA8_ASTC_10x10_Format",function(){return lr}),t.d(e,"SRGB8_ALPHA8_ASTC_10x5_Format",function(){return ar}),t.d(e,"SRGB8_ALPHA8_ASTC_10x6_Format",function(){return sr}),t.d(e,"SRGB8_ALPHA8_ASTC_10x8_Format",function(){return or}),t.d(e,"SRGB8_ALPHA8_ASTC_12x10_Format",function(){return hr}),t.d(e,"SRGB8_ALPHA8_ASTC_12x12_Format",function(){return ur}),t.d(e,"SRGB8_ALPHA8_ASTC_4x4_Format",function(){return Jt}),t.d(e,"SRGB8_ALPHA8_ASTC_5x4_Format",function(){return Zt}),t.d(e,"SRGB8_ALPHA8_ASTC_5x5_Format",function(){return Qt}),t.d(e,"SRGB8_ALPHA8_ASTC_6x5_Format",function(){return er}),t.d(e,"SRGB8_ALPHA8_ASTC_6x6_Format",function(){return tr}),t.d(e,"SRGB8_ALPHA8_ASTC_8x5_Format",function(){return rr}),t.d(e,"SRGB8_ALPHA8_ASTC_8x6_Format",function(){return ir}),t.d(e,"SRGB8_ALPHA8_ASTC_8x8_Format",function(){return nr}),t.d(e,"Scene",function(){return Pl}),t.d(e,"SceneUtils",function(){return cp}),t.d(e,"ShaderChunk",function(){return M}),t.d(e,"ShaderLib",function(){return Qa}),t.d(e,"ShaderMaterial",function(){return Ba}),t.d(e,"ShadowMaterial",function(){return Zu}),t.d(e,"Shape",function(){return vu}),t.d(e,"ShapeBufferGeometry",function(){return Vu}),t.d(e,"ShapeGeometry",function(){return Vu}),t.d(e,"ShapePath",function(){return Rf}),t.d(e,"ShapeUtils",function(){return ku}),t.d(e,"ShortType",function(){return rt}),t.d(e,"Skeleton",function(){return dh}),t.d(e,"SkeletonHelper",function(){return sf}),t.d(e,"SkinnedMesh",function(){return sh}),t.d(e,"SmoothShading",function(){return k}),t.d(e,"Sphere",function(){return rn}),t.d(e,"SphereBufferGeometry",function(){return Wu}),t.d(e,"SphereGeometry",function(){return Wu}),t.d(e,"Spherical",function(){return $c}),t.d(e,"SphericalHarmonics3",function(){return Xd}),t.d(e,"SplineCurve",function(){return fu}),t.d(e,"SpotLight",function(){return Gd}),t.d(e,"SpotLightHelper",function(){return tf}),t.d(e,"Sprite",function(){return Xl}),t.d(e,"SpriteMaterial",function(){return Fl}),t.d(e,"SrcAlphaFactor",function(){return he}),t.d(e,"SrcAlphaSaturateFactor",function(){return me}),t.d(e,"SrcColorFactor",function(){return oe}),t.d(e,"StaticCopyUsage",function(){return ni}),t.d(e,"StaticDrawUsage",function(){return Zr}),t.d(e,"StaticReadUsage",function(){return ti}),t.d(e,"StereoCamera",function(){return pc}),t.d(e,"StreamCopyUsage",function(){return si}),t.d(e,"StreamDrawUsage",function(){return ei}),t.d(e,"StreamReadUsage",function(){return ii}),t.d(e,"StringKeyframeTrack",function(){return yd}),t.d(e,"SubtractEquation",function(){return te}),t.d(e,"SubtractiveBlending",function(){return J}),t.d(e,"TOUCH",function(){return A}),t.d(e,"TangentSpaceNormalMap",function(){return kr}),t.d(e,"TetrahedronBufferGeometry",function(){return ju}),t.d(e,"TetrahedronGeometry",function(){return ju}),t.d(e,"TextGeometry",function(){return mp}),t.d(e,"Texture",function(){return u}),t.d(e,"TextureLoader",function(){return Id}),t.d(e,"TorusBufferGeometry",function(){return Yu}),t.d(e,"TorusGeometry",function(){return Yu}),t.d(e,"TorusKnotBufferGeometry",function(){return $u}),t.d(e,"TorusKnotGeometry",function(){return $u}),t.d(e,"Triangle",function(){return p}),t.d(e,"TriangleFanDrawMode",function(){return wr}),t.d(e,"TriangleStripDrawMode",function(){return Sr}),t.d(e,"TrianglesDrawMode",function(){return Tr}),t.d(e,"TubeBufferGeometry",function(){return qu}),t.d(e,"TubeGeometry",function(){return qu}),t.d(e,"UVMapping",function(){return Me}),t.d(e,"Uint16Attribute",function(){return Zf}),t.d(e,"Uint16BufferAttribute",function(){return aa}),t.d(e,"Uint32Attribute",function(){return ep}),t.d(e,"Uint32BufferAttribute",function(){return oa}),t.d(e,"Uint8Attribute",function(){return Kf}),t.d(e,"Uint8BufferAttribute",function(){return ra}),t.d(e,"Uint8ClampedAttribute",function(){return Xf}),t.d(e,"Uint8ClampedBufferAttribute",function(){return ia}),t.d(e,"Uniform",function(){return zc}),t.d(e,"UniformsLib",function(){return a}),t.d(e,"UniformsUtils",function(){return Na}),t.d(e,"UnsignedByteType",function(){return et}),t.d(e,"UnsignedInt248Type",function(){return dt}),t.d(e,"UnsignedIntType",function(){return at}),t.d(e,"UnsignedShort4444Type",function(){return lt}),t.d(e,"UnsignedShort5551Type",function(){return ht}),t.d(e,"UnsignedShort565Type",function(){return ut}),t.d(e,"UnsignedShortType",function(){return it}),t.d(e,"VSMShadowMap",function(){return I}),t.d(e,"Vector2",function(){return V}),t.d(e,"Vector3",function(){return Pe}),t.d(e,"Vector4",function(){return Ie}),t.d(e,"VectorKeyframeTrack",function(){return xd}),t.d(e,"Vertex",function(){return Yf}),t.d(e,"VertexColors",function(){return Nf}),t.d(e,"VideoTexture",function(){return Oh}),t.d(e,"WebGL1Renderer",function(){return Cl}),t.d(e,"WebGLCubeRenderTarget",function(){return Ha}),t.d(e,"WebGLMultipleRenderTargets",function(){return Ii}),t.d(e,"WebGLMultisampleRenderTarget",function(){return Pi}),t.d(e,"WebGLRenderTarget",function(){return Di}),t.d(e,"WebGLRenderTargetCube",function(){return hp}),t.d(e,"WebGLRenderer",function(){return s}),t.d(e,"WebGLUtils",function(){return Sl}),t.d(e,"WireframeGeometry",function(){return Ku}),t.d(e,"WireframeHelper",function(){return sp}),t.d(e,"WrapAroundEnding",function(){return xr}),t.d(e,"XHRLoader",function(){return op}),t.d(e,"ZeroCurvatureEnding",function(){return vr}),t.d(e,"ZeroFactor",function(){return ae}),t.d(e,"ZeroSlopeEnding",function(){return yr}),t.d(e,"ZeroStencilOp",function(){return Fr}),t.d(e,"sRGBEncoding",function(){return Er});let _="134",T={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},A={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},j=0,Y=1,$=2,L=3,R=0,C=1,D=2,I=3,Oe=0,Ae=1,Fe=2,P=1,k=2,q=0,K=1,X=2,J=3,Z=4,Q=5,ee=100,te=101,re=102,ie=103,ne=104,ae=200,se=201,oe=202,le=203,he=204,ue=205,de=206,ce=207,fe=208,pe=209,me=210,ge=0,ve=1,ye=2,xe=3,be=4,_e=5,Te=6,Se=7,O=0,N=1,U=2,Ne=0,G=1,z=2,H=3,we=4,Ee=5,Me=300,Be=301,Ue=302,Ge=303,ze=304,He=306,Ve=307,We=1e3,Le=1001,je=1002,Re=1003,Ye=1004,$e=1004,qe=1005,Ke=1005,B=1006,Xe=1007,Je=1007,Ze=1008,Qe=1008,et=1009,tt=1010,rt=1011,it=1012,nt=1013,at=1014,st=1015,ot=1016,lt=1017,ht=1018,ut=1019,dt=1020,ct=1021,ft=1022,Ce=1023,pt=1024,mt=1025,gt=Ce,vt=1026,yt=1027,xt=1028,bt=1029,_t=1030,Tt=1031,St=1032,wt=1033,Et=33776,Mt=33777,At=33778,Lt=33779,Rt=35840,Ct=35841,Dt=35842,It=35843,Pt=36196,kt=37492,Ot=37496,Ft=37808,Nt=37809,Bt=37810,Ut=37811,Gt=37812,zt=37813,Ht=37814,Vt=37815,Wt=37816,jt=37817,Yt=37818,$t=37819,qt=37820,Kt=37821,Xt=36492,Jt=37840,Zt=37841,Qt=37842,er=37843,tr=37844,rr=37845,ir=37846,nr=37847,ar=37848,sr=37849,or=37850,lr=37851,hr=37852,ur=37853,dr=2200,cr=2201,fr=2202,pr=2300,mr=2301,gr=2302,vr=2400,yr=2401,xr=2402,br=2500,_r=2501,Tr=0,Sr=1,wr=2,De=3e3,Er=3001,Mr=3007,Ar=3002,Lr=3003,Rr=3004,Cr=3005,Dr=3006,Ir=3200,Pr=3201,kr=0,Or=1,Fr=0,Nr=7680,Br=7681,Ur=7682,Gr=7683,zr=34055,Hr=34056,Vr=5386,Wr=512,jr=513,Yr=514,$r=515,qr=516,Kr=517,Xr=518,Jr=519,Zr=35044,Qr=35048,ei=35040,ti=35045,ri=35049,ii=35041,ni=35046,ai=35050,si=35042,oi="100",li="300 es";class hi{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){var r;return void 0!==this._listeners&&void 0!==(r=this._listeners)[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){let e=r.indexOf(t);-1!==e&&r.splice(e,1)}}}dispatchEvent(r){if(void 0!==this._listeners){var e=this._listeners[r.type];if(void 0!==e){r.target=this;var i=e.slice(0);for(let e=0,t=i.length;e<t;e++)i[e].call(this,r);r.target=null}}}}let ui=1234567,di=Math.PI/180,ci=180/Math.PI,n=[];for(let e=0;e<256;e++)n[e]=(e<16?"0":"")+e.toString(16);let fi="undefined"!=typeof crypto&&"randomUUID"in crypto;function pi(){var e,t,r,i;return(fi?crypto.randomUUID():(e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n[255&e]+n[e>>8&255]+n[e>>16&255]+n[e>>24&255]+"-"+n[255&t]+n[t>>8&255]+"-"+n[t>>16&15|64]+n[t>>24&255]+"-"+n[63&r|128]+n[r>>8&255]+"-"+n[r>>16&255]+n[r>>24&255]+n[255&i]+n[i>>8&255]+n[i>>16&255]+n[i>>24&255])).toUpperCase()}function mi(e,t,r){return Math.max(t,Math.min(r,e))}function gi(e,t){return(e%t+t)%t}function vi(e,t,r){return(1-r)*e+r*t}function yi(e){return 0==(e&e-1)&&0!==e}function xi(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function bi(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var _i=Object.freeze({__proto__:null,DEG2RAD:di,RAD2DEG:ci,generateUUID:pi,clamp:mi,euclideanModulo:gi,mapLinear:function(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)},inverseLerp:function(e,t,r){return e!==t?(r-e)/(t-e):0},lerp:vi,damp:function(e,t,r,i){return vi(e,t,1-Math.exp(-r*i))},pingpong:function(e,t=1){return t-Math.abs(gi(e,2*t)-t)},smoothstep:function(e,t,r){return e<=t?0:r<=e?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:r<=e?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return((ui=16807*(ui=void 0!==e?e%2147483647:ui)%2147483647)-1)/2147483646},degToRad:function(e){return e*di},radToDeg:function(e){return e*ci},isPowerOfTwo:yi,ceilPowerOfTwo:xi,floorPowerOfTwo:bi,setQuaternionFromProperEuler:function(e,t,r,i,n){var a=Math.cos,s=Math.sin,o=a(r/2),l=s(r/2),h=a((t+i)/2),u=s((t+i)/2),d=a((t-i)/2),c=s((t-i)/2),f=a((i-t)/2),p=s((i-t)/2);switch(n){case"XYX":e.set(o*u,l*d,l*c,o*h);break;case"YZY":e.set(l*c,o*u,l*d,o*h);break;case"ZXZ":e.set(l*d,l*c,o*u,o*h);break;case"XZX":e.set(o*u,l*p,l*f,o*h);break;case"YXY":e.set(l*f,o*u,l*p,o*h);break;case"ZYZ":e.set(l*p,l*f,o*u,o*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}});class V{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){var t=this.x,r=this.y,e=e.elements;return this.x=e[0]*t+e[3]*r+e[6],this.y=e[1]*t+e[4]*r+e[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){var r=Math.cos(t),t=Math.sin(t),i=this.x-e.x,n=this.y-e.y;return this.x=i*r-n*t+e.x,this.y=i*t+n*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}V.prototype.isVector2=!0;class v{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,r,i,n,a,s,o,l){var h=this.elements;return h[0]=e,h[1]=i,h[2]=s,h[3]=t,h[4]=n,h[5]=o,h[6]=r,h[7]=a,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){var t=this.elements,e=e.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){e=e.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){var e=e.elements,t=t.elements,r=this.elements,i=e[0],n=e[3],a=e[6],s=e[1],o=e[4],l=e[7],h=e[2],u=e[5],e=e[8],d=t[0],c=t[3],f=t[6],p=t[1],m=t[4],g=t[7],v=t[2],y=t[5],t=t[8];return r[0]=i*d+n*p+a*v,r[3]=i*c+n*m+a*y,r[6]=i*f+n*g+a*t,r[1]=s*d+o*p+l*v,r[4]=s*c+o*m+l*y,r[7]=s*f+o*g+l*t,r[2]=h*d+u*p+e*v,r[5]=h*c+u*m+e*y,r[8]=h*f+u*g+e*t,this}multiplyScalar(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){var e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],l=e[7],e=e[8];return t*a*e-t*s*l-r*n*e+r*s*o+i*n*l-i*a*o}invert(){var e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],l=e[7],h=e[8],u=h*a-s*l,d=s*o-h*n,c=l*n-a*o,f=t*u+r*d+i*c;return 0==f?this.set(0,0,0,0,0,0,0,0,0):(e[0]=u*(u=1/f),e[1]=(i*l-h*r)*u,e[2]=(s*r-i*a)*u,e[3]=d*u,e[4]=(h*t-i*o)*u,e[5]=(i*n-s*t)*u,e[6]=c*u,e[7]=(r*o-l*t)*u,e[8]=(a*t-r*n)*u,this)}transpose(){var e=this.elements,t=e[1];return e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,n,a,s){var o=Math.cos(n),n=Math.sin(n);return this.set(r*o,r*n,-r*(o*a+n*s)+a+e,-i*n,i*o,-i*(-n*a+o*s)+s+t,0,0,1),this}scale(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this}rotate(e){var t=Math.cos(e),e=Math.sin(e),r=this.elements,i=r[0],n=r[3],a=r[6],s=r[1],o=r[4],l=r[7];return r[0]=t*i+e*s,r[3]=t*n+e*o,r[6]=t*a+e*l,r[1]=-e*i+t*s,r[4]=-e*n+t*o,r[7]=-e*a+t*l,this}translate(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this}equals(e){var t=this.elements,r=e.elements;for(let e=0;e<9;e++)if(t[e]!==r[e])return!1;return!0}fromArray(t,r=0){for(let e=0;e<9;e++)this.elements[e]=t[e+r];return this}toArray(e=[],t=0){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function Ti(r){if(0===r.length)return-1/0;let i=r[0];for(let e=1,t=r.length;e<t;++e)r[e]>i&&(i=r[e]);return i}v.prototype.isMatrix3=!0;let Si={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function wi(e,t){return new Si[e](t)}function Ei(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Mi(r,e=0){let i=3735928559^e,n=1103547991^e;for(let e,t=0;t<r.length;t++)e=r.charCodeAt(t),i=Math.imul(i^e,2654435761),n=Math.imul(n^e,1597334677);return i=Math.imul(i^i>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),4294967296*(2097151&(n=Math.imul(n^n>>>16,2246822507)^Math.imul(i^i>>>13,3266489909)))+(i>>>0)}let Ai;class Li{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;var r;return 2048<(t=e instanceof HTMLCanvasElement?e:((Ai=void 0===Ai?Ei("canvas"):Ai).width=e.width,Ai.height=e.height,r=Ai.getContext("2d"),e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),Ai)).width||2048<t.height?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let Ri=0;class u extends hi{constructor(e=u.DEFAULT_IMAGE,t=u.DEFAULT_MAPPING,r=Le,i=Le,n=B,a=Ze,s=Ce,o=et,l=1,h=De){super(),Object.defineProperty(this,"id",{value:Ri++}),this.uuid=pi(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=r,this.wrapT=i,this.magFilter=n,this.minFilter=a,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=o,this.offset=new V(0,0),this.repeat=new V(1,1),this.center=new V(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new v,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this}toJSON(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var i=this.image;if(void 0===i.uuid&&(i.uuid=pi()),!t&&void 0===e.images[i.uuid]){let r;if(Array.isArray(i)){r=[];for(let e=0,t=i.length;e<t;e++)i[e].isDataTexture?r.push(Ci(i[e].image)):r.push(Ci(i[e]))}else r=Ci(i);e.images[i.uuid]={uuid:i.uuid,url:r}}r.image=i.uuid}return"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping===Me){if(e.applyMatrix3(this.matrix),e.x<0||1<e.x)switch(this.wrapS){case We:e.x=e.x-Math.floor(e.x);break;case Le:e.x=e.x<0?0:1;break;case je:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||1<e.y)switch(this.wrapT){case We:e.y=e.y-Math.floor(e.y);break;case Le:e.y=e.y<0?0:1;break;case je:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}this.flipY&&(e.y=1-e.y)}return e}set needsUpdate(e){!0===e&&this.version++}}function Ci(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?Li.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}u.DEFAULT_IMAGE=void 0,u.DEFAULT_MAPPING=Me,u.prototype.isTexture=!0;class Ie{constructor(e=0,t=0,r=0,i=1){this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){var t=this.x,r=this.y,i=this.z,n=this.w,e=e.elements;return this.x=e[0]*t+e[4]*r+e[8]*i+e[12]*n,this.y=e[1]*t+e[5]*r+e[9]*i+e[13]*n,this.z=e[2]*t+e[6]*r+e[10]*i+e[14]*n,this.w=e[3]*t+e[7]*r+e[11]*i+e[15]*n,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let s,o,l,h,t=e.elements,u=t[0],d=t[4],c=t[8],f=t[1],p=t[5],m=t[9],g=t[2],v=t[6],y=t[10];if(Math.abs(d-f)<.01&&Math.abs(c-g)<.01&&Math.abs(m-v)<.01)if(Math.abs(d+f)<.1&&Math.abs(c+g)<.1&&Math.abs(m+v)<.1&&Math.abs(u+p+y-3)<.1)this.set(1,0,0,0);else{s=Math.PI;let e=(u+1)/2,t=(p+1)/2,r=(y+1)/2,i=(d+f)/4,n=(c+g)/4,a=(m+v)/4;e>t&&e>r?h=e<.01?(o=0,l=.707106781):(o=Math.sqrt(e),l=i/o,n/o):t>r?h=t<.01?(o=.707106781,l=0,.707106781):(l=Math.sqrt(t),o=i/l,a/l):r<.01?(o=.707106781,l=.707106781,h=0):(h=Math.sqrt(r),o=n/h,l=a/h),this.set(o,l,h,s)}else{let e=Math.sqrt((v-m)*(v-m)+(c-g)*(c-g)+(f-d)*(f-d));Math.abs(e)<.001&&(e=1),this.x=(v-m)/e,this.y=(c-g)/e,this.z=(f-d)/e,this.w=Math.acos((u+p+y-1)/2)}return this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Ie.prototype.isVector4=!0;class Di extends hi{constructor(e,t,r={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new Ie(0,0,e,t),this.scissorTest=!1,this.viewport=new Ie(0,0,e,t),this.texture=new u(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.internalFormat=void 0!==r.internalFormat?r.internalFormat:null,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:B,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0!==r.stencilBuffer&&r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,r=1){this.width===e&&this.height===t&&this.depth===r||(this.width=e,this.height=t,this.depth=r,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}Di.prototype.isWebGLRenderTarget=!0;class Ii extends Di{constructor(e,t,r){super(e,t);var i=this.texture;this.texture=[];for(let e=0;e<r;e++)this.texture[e]=i.clone()}setSize(r,i,n=1){if(this.width!==r||this.height!==i||this.depth!==n){this.width=r,this.height=i,this.depth=n;for(let e=0,t=this.texture.length;e<t;e++)this.texture[e].image.width=r,this.texture[e].image.height=i,this.texture[e].image.depth=n;this.dispose()}return this.viewport.set(0,0,r,i),this.scissor.set(0,0,r,i),this}copy(r){this.dispose(),this.width=r.width,this.height=r.height,this.depth=r.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.depthTexture=r.depthTexture;for(let e=this.texture.length=0,t=r.texture.length;e<t;e++)this.texture[e]=r.texture[e].clone();return this}}Ii.prototype.isWebGLMultipleRenderTargets=!0;class Pi extends Di{constructor(e,t,r){super(e,t,r),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}Pi.prototype.isWebGLMultisampleRenderTarget=!0;class ki{constructor(e=0,t=0,r=0,i=1){this._x=e,this._y=t,this._z=r,this._w=i}static slerp(e,t,r,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),r.slerpQuaternions(e,t,i)}static slerpFlat(e,t,r,i,n,s,o){let l=r[i+0],h=r[i+1],u=r[i+2],d=r[i+3];var c=n[s+0],f=n[s+1],p=n[s+2],s=n[s+3];if(0===o)e[t+0]=l,e[t+1]=h,e[t+2]=u,e[t+3]=d;else if(1===o)e[t+0]=c,e[t+1]=f,e[t+2]=p,e[t+3]=s;else{if(d!==s||l!==c||h!==f||u!==p){let r=1-o,i=l*c+h*f+u*p+d*s,n=0<=i?1:-1,a=1-i*i;if(a>Number.EPSILON){let e=Math.sqrt(a),t=Math.atan2(e,i*n);r=Math.sin(r*t)/e,o=Math.sin(o*t)/e}let e=o*n;if(l=l*r+c*e,h=h*r+f*e,u=u*r+p*e,d=d*r+s*e,r===1-o){let e=1/Math.sqrt(l*l+h*h+u*u+d*d);l*=e,h*=e,u*=e,d*=e}}e[t]=l,e[t+1]=h,e[t+2]=u,e[t+3]=d}}static multiplyQuaternionsFlat(e,t,r,i,n,a){var s=r[i],o=r[i+1],l=r[i+2],r=r[i+3],i=n[a],h=n[a+1],u=n[a+2],n=n[a+3];return e[t]=s*n+r*i+o*u-l*h,e[t+1]=o*n+r*h+l*i-s*u,e[t+2]=l*n+r*u+s*h-o*i,e[t+3]=r*n-s*i-o*h-l*u,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=e._x,i=e._y,n=e._z,a=e._order,e=Math.cos,s=Math.sin,o=e(r/2),l=e(i/2),h=e(n/2),u=s(r/2),d=s(i/2),c=s(n/2);switch(a){case"XYZ":this._x=u*l*h+o*d*c,this._y=o*d*h-u*l*c,this._z=o*l*c+u*d*h,this._w=o*l*h-u*d*c;break;case"YXZ":this._x=u*l*h+o*d*c,this._y=o*d*h-u*l*c,this._z=o*l*c-u*d*h,this._w=o*l*h+u*d*c;break;case"ZXY":this._x=u*l*h-o*d*c,this._y=o*d*h+u*l*c,this._z=o*l*c+u*d*h,this._w=o*l*h-u*d*c;break;case"ZYX":this._x=u*l*h-o*d*c,this._y=o*d*h+u*l*c,this._z=o*l*c-u*d*h,this._w=o*l*h+u*d*c;break;case"YZX":this._x=u*l*h+o*d*c,this._y=o*d*h+u*l*c,this._z=o*l*c-u*d*h,this._w=o*l*h-u*d*c;break;case"XZY":this._x=u*l*h-o*d*c,this._y=o*d*h-u*l*c,this._z=o*l*c+u*d*h,this._w=o*l*h+u*d*c;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){var t=t/2,r=Math.sin(t);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(t),this._onChangeCallback(),this}setFromRotationMatrix(e){var e=e.elements,t=e[0],r=e[4],i=e[8],n=e[1],a=e[5],s=e[9],o=e[2],l=e[6],h=e[10],u=t+a+h;if(0<u){let e=.5/Math.sqrt(u+1);this._w=.25/e,this._x=(l-s)*e,this._y=(i-o)*e,this._z=(n-r)*e}else if(a<t&&h<t){let e=2*Math.sqrt(1+t-a-h);this._w=(l-s)/e,this._x=.25*e,this._y=(r+n)/e,this._z=(i+o)/e}else if(h<a){let e=2*Math.sqrt(1+a-t-h);this._w=(i-o)/e,this._x=(r+n)/e,this._y=.25*e,this._z=(s+l)/e}else{let e=2*Math.sqrt(1+h-t-a);this._w=(n-r)/e,this._x=(i+o)/e,this._y=(s+l)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x),this._w=r,this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(mi(this.dot(e),-1,1)))}rotateTowards(e,t){var r=this.angleTo(e);return 0!==r&&(t=Math.min(1,t/r),this.slerp(e,t)),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(e=1/e),this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){var r=e._x,i=e._y,n=e._z,e=e._w,a=t._x,s=t._y,o=t._z,t=t._w;return this._x=r*t+e*a+i*o-n*s,this._y=i*t+e*s+n*a-r*o,this._z=n*t+e*o+r*s-i*a,this._w=e*t-r*a-i*s-n*o,this._onChangeCallback(),this}slerp(t,r){if(0!==r){if(1===r)return this.copy(t);var i=this._x,n=this._y,a=this._z,s=this._w;let e=s*t._w+i*t._x+n*t._y+a*t._z;if(e<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,e=-e):this.copy(t),1<=e)this._w=s,this._x=i,this._y=n,this._z=a;else{t=1-e*e;if(t<=Number.EPSILON){let e=1-r;this._w=e*s+r*this._w,this._x=e*i+r*this._x,this._y=e*n+r*this._y,this._z=e*a+r*this._z,this.normalize()}else{var t=Math.sqrt(t),o=Math.atan2(t,e),l=Math.sin((1-r)*o)/t,r=Math.sin(r*o)/t;this._w=s*l+this._w*r,this._x=i*l+this._x*r,this._y=n*l+this._y*r,this._z=a*l+this._z*r}this._onChangeCallback()}}return this}slerpQuaternions(e,t,r){this.copy(e).slerp(t,r)}random(){var e=Math.random(),t=Math.sqrt(1-e),e=Math.sqrt(e),r=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(t*Math.cos(r),e*Math.sin(i),e*Math.cos(i),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}ki.prototype.isQuaternion=!0;class Pe{constructor(e=0,t=0,r=0){this.x=e,this.y=t,this.z=r}set(e,t,r){return void 0===r&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Fi.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Fi.setFromAxisAngle(e,t))}applyMatrix3(e){var t=this.x,r=this.y,i=this.z,e=e.elements;return this.x=e[0]*t+e[3]*r+e[6]*i,this.y=e[1]*t+e[4]*r+e[7]*i,this.z=e[2]*t+e[5]*r+e[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){var t=this.x,r=this.y,i=this.z,e=e.elements,n=1/(e[3]*t+e[7]*r+e[11]*i+e[15]);return this.x=(e[0]*t+e[4]*r+e[8]*i+e[12])*n,this.y=(e[1]*t+e[5]*r+e[9]*i+e[13])*n,this.z=(e[2]*t+e[6]*r+e[10]*i+e[14])*n,this}applyQuaternion(e){var t=this.x,r=this.y,i=this.z,n=e.x,a=e.y,s=e.z,e=e.w,o=e*t+a*i-s*r,l=e*r+s*t-n*i,h=e*i+n*r-a*t,t=-n*t-a*r-s*i;return this.x=o*e+t*-n+l*-s-h*-a,this.y=l*e+t*-a+h*-n-o*-s,this.z=h*e+t*-s+o*-a-l*-n,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){var t=this.x,r=this.y,i=this.z,e=e.elements;return this.x=e[0]*t+e[4]*r+e[8]*i,this.y=e[1]*t+e[5]*r+e[9]*i,this.z=e[2]*t+e[6]*r+e[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){var r=e.x,i=e.y,e=e.z,n=t.x,a=t.y,t=t.z;return this.x=i*t-e*a,this.y=e*n-r*t,this.z=r*a-i*n,this}projectOnVector(e){var t=e.lengthSq();return 0===t?this.set(0,0,0):(t=e.dot(this)/t,this.copy(e).multiplyScalar(t))}projectOnPlane(e){return Oi.copy(this).projectOnVector(e),this.sub(Oi)}reflect(e){return this.sub(Oi.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());return 0===t?Math.PI/2:(e=this.dot(e)/t,Math.acos(mi(e,-1,1)))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){var t=this.x-e.x,r=this.y-e.y,e=this.z-e.z;return t*t+r*r+e*e}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){var i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){e=e.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),e=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=e,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){var e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,r=Math.sqrt(1-e**2);return this.x=r*Math.cos(t),this.y=r*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}Pe.prototype.isVector3=!0;let Oi=new Pe,Fi=new ki;class Ni{constructor(e=new Pe(1/0,1/0,1/0),t=new Pe(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(r){let i=1/0,n=1/0,a=1/0,s=-1/0,o=-1/0,l=-1/0;for(let e=0,t=r.length;e<t;e+=3){var h=r[e],u=r[e+1],d=r[e+2];h<i&&(i=h),u<n&&(n=u),d<a&&(a=d),h>s&&(s=h),u>o&&(o=u),d>l&&(l=d)}return this.min.set(i,n,a),this.max.set(s,o,l),this}setFromBufferAttribute(r){let i=1/0,n=1/0,a=1/0,s=-1/0,o=-1/0,l=-1/0;for(let e=0,t=r.count;e<t;e++){var h=r.getX(e),u=r.getY(e),d=r.getZ(e);h<i&&(i=h),u<n&&(n=u),d<a&&(a=d),h>s&&(s=h),u>o&&(o=u),d>l&&(l=d)}return this.min.set(i,n,a),this.max.set(s,o,l),this}setFromPoints(r){this.makeEmpty();for(let e=0,t=r.length;e<t;e++)this.expandByPoint(r[e]);return this}setFromCenterAndSize(e,t){t=Ui.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(t),this.max.copy(e).add(t),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);var t=e.geometry,r=(void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),Gi.copy(t.boundingBox),Gi.applyMatrix4(e.matrixWorld),this.union(Gi)),e.children);for(let e=0,t=r.length;e<t;e++)this.expandByObject(r[e]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ui),Ui.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return r=0<e.normal.x?(t=e.normal.x*this.min.x,e.normal.x*this.max.x):(t=e.normal.x*this.max.x,e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){return!this.isEmpty()&&(this.getCenter($i),qi.subVectors(this.max,$i),zi.subVectors(e.a,$i),Hi.subVectors(e.b,$i),Vi.subVectors(e.c,$i),Wi.subVectors(Hi,zi),ji.subVectors(Vi,Hi),Yi.subVectors(zi,Vi),!!Ji([0,-Wi.z,Wi.y,0,-ji.z,ji.y,0,-Yi.z,Yi.y,Wi.z,0,-Wi.x,ji.z,0,-ji.x,Yi.z,0,-Yi.x,-Wi.y,Wi.x,0,-ji.y,ji.x,0,-Yi.y,Yi.x,0],zi,Hi,Vi,qi))&&!!Ji([1,0,0,0,1,0,0,0,1],zi,Hi,Vi,qi)&&(Ki.crossVectors(Wi,ji),Ji([Ki.x,Ki.y,Ki.z],zi,Hi,Vi,qi))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Ui.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(Ui).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Bi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Bi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Bi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Bi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Bi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Bi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Bi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Bi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Bi)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Ni.prototype.isBox3=!0;let Bi=[new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe],Ui=new Pe,Gi=new Ni,zi=new Pe,Hi=new Pe,Vi=new Pe,Wi=new Pe,ji=new Pe,Yi=new Pe,$i=new Pe,qi=new Pe,Ki=new Pe,Xi=new Pe;function Ji(r,i,n,a,s){for(let e=0,t=r.length-3;e<=t;e+=3){Xi.fromArray(r,e);var o=s.x*Math.abs(Xi.x)+s.y*Math.abs(Xi.y)+s.z*Math.abs(Xi.z),l=i.dot(Xi),h=n.dot(Xi),u=a.dot(Xi);if(Math.max(-Math.max(l,h,u),Math.min(l,h,u))>o)return!1}return!0}let Zi=new Ni,Qi=new Pe,en=new Pe,tn=new Pe;class rn{constructor(e=new Pe,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(r,e){var i=this.center;void 0!==e?i.copy(e):Zi.setFromPoints(r).getCenter(i);let n=0;for(let e=0,t=r.length;e<t;e++)n=Math.max(n,i.distanceToSquared(r[e]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){var r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?e.makeEmpty():(e.set(this.center,this.center),e.expandByScalar(this.radius)),e}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){tn.subVectors(e,this.center);var r=tn.lengthSq();if(r>this.radius*this.radius){let e=Math.sqrt(r),t=.5*(e-this.radius);this.center.add(tn.multiplyScalar(t/e)),this.radius+=t}return this}union(e){return en.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(Qi.copy(e.center).add(en)),this.expandByPoint(Qi.copy(e.center).sub(en)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}let nn=new Pe,an=new Pe,sn=new Pe,on=new Pe,ln=new Pe,hn=new Pe,un=new Pe;class dn{constructor(e=new Pe,t=new Pe(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,nn)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);e=t.dot(this.direction);return e<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(e).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){var t=nn.subVectors(e,this.origin).dot(this.direction);return(t<0?this.origin:(nn.copy(this.direction).multiplyScalar(t).add(this.origin),nn)).distanceToSquared(e)}distanceSqToSegment(e,t,r,i){an.copy(e).add(t).multiplyScalar(.5),sn.copy(t).sub(e).normalize(),on.copy(this.origin).sub(an);var e=.5*e.distanceTo(t),t=-this.direction.dot(sn),n=on.dot(this.direction),a=-on.dot(sn),s=on.lengthSq(),o=Math.abs(1-t*t);let l,h,u,d;if(0<o)if(l=t*a-n,h=t*n-a,d=e*o,0<=l)if(h>=-d)if(h<=d){let e=1/o;l*=e,h*=e,u=l*(l+t*h+2*n)+h*(t*l+h+2*a)+s}else h=e,l=Math.max(0,-(t*h+n)),u=-l*l+h*(h+2*a)+s;else h=-e,l=Math.max(0,-(t*h+n)),u=-l*l+h*(h+2*a)+s;else u=h<=-d?(l=Math.max(0,-(-t*e+n)),h=0<l?-e:Math.min(Math.max(-e,-a),e),-l*l+h*(h+2*a)+s):h<=d?(l=0,(h=Math.min(Math.max(-e,-a),e))*(h+2*a)+s):(l=Math.max(0,-(t*e+n)),h=0<l?e:Math.min(Math.max(-e,-a),e),-l*l+h*(h+2*a)+s);else h=0<t?-e:e,l=Math.max(0,-(t*h+n)),u=-l*l+h*(h+2*a)+s;return r&&r.copy(this.direction).multiplyScalar(l).add(this.origin),i&&i.copy(sn).multiplyScalar(h).add(an),u}intersectSphere(e,t){nn.subVectors(e.center,this.origin);var r=nn.dot(this.direction),i=nn.dot(nn)-r*r,e=e.radius*e.radius;return e<i||(i=r+(e=Math.sqrt(e-i)),(r=r-e)<0&&i<0)?null:r<0?this.at(i,t):this.at(r,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){var t=e.normal.dot(this.direction);return 0===t?0===e.distanceToPoint(this.origin)?0:null:0<=(e=-(this.origin.dot(e.normal)+e.constant)/t)?e:null}intersectPlane(e,t){e=this.distanceToPlane(e);return null===e?null:this.at(e,t)}intersectsPlane(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,n,a,s,o;var l=1/this.direction.x,h=1/this.direction.y,u=1/this.direction.z,d=this.origin;return i=0<=l?(r=(e.min.x-d.x)*l,(e.max.x-d.x)*l):(r=(e.max.x-d.x)*l,(e.min.x-d.x)*l),a=0<=h?(n=(e.min.y-d.y)*h,(e.max.y-d.y)*h):(n=(e.max.y-d.y)*h,(e.min.y-d.y)*h),r>a||n>i||((n>r||r!=r)&&(r=n),(a<i||i!=i)&&(i=a),o=0<=u?(s=(e.min.z-d.z)*u,(e.max.z-d.z)*u):(s=(e.max.z-d.z)*u,(e.min.z-d.z)*u),r>o)||s>i||((s>r||r!=r)&&(r=s),(i=o<i||i!=i?o:i)<0)?null:this.at(0<=r?r:i,t)}intersectsBox(e){return null!==this.intersectBox(e,nn)}intersectTriangle(e,t,r,i,n){ln.subVectors(t,e),hn.subVectors(r,e),un.crossVectors(ln,hn);let a,s=this.direction.dot(un);if(0<s){if(i)return null;a=1}else{if(!(s<0))return null;a=-1,s=-s}on.subVectors(this.origin,e);t=a*this.direction.dot(hn.crossVectors(on,hn));return t<0||(r=a*this.direction.dot(ln.cross(on)))<0||t+r>s||(i=-a*on.dot(un))<0?null:this.at(i/s,n)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class ke{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,r,i,n,a,s,o,l,h,u,d,c,f,p,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=i,g[1]=n,g[5]=a,g[9]=s,g[13]=o,g[2]=l,g[6]=h,g[10]=u,g[14]=d,g[3]=c,g[7]=f,g[11]=p,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ke).fromArray(this.elements)}copy(e){var t=this.elements,e=e.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],this}copyPosition(e){var t=this.elements,e=e.elements;return t[12]=e[12],t[13]=e[13],t[14]=e[14],this}setFromMatrix3(e){e=e.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){var t=this.elements,r=e.elements,i=1/cn.setFromMatrixColumn(e,0).length(),n=1/cn.setFromMatrixColumn(e,1).length(),e=1/cn.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*n,t[5]=r[5]*n,t[6]=r[6]*n,t[7]=0,t[8]=r[8]*e,t[9]=r[9]*e,t[10]=r[10]*e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");let n=this.elements,t=e.x,r=e.y,i=e.z,a=Math.cos(t),s=Math.sin(t),o=Math.cos(r),l=Math.sin(r),h=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){let e=a*h,t=a*u,r=s*h,i=s*u;n[0]=o*h,n[4]=-o*u,n[8]=l,n[1]=t+r*l,n[5]=e-i*l,n[9]=-s*o,n[2]=i-e*l,n[6]=r+t*l,n[10]=a*o}else if("YXZ"===e.order){let e=o*h,t=o*u,r=l*h,i=l*u;n[0]=e+i*s,n[4]=r*s-t,n[8]=a*l,n[1]=a*u,n[5]=a*h,n[9]=-s,n[2]=t*s-r,n[6]=i+e*s,n[10]=a*o}else if("ZXY"===e.order){let e=o*h,t=o*u,r=l*h,i=l*u;n[0]=e-i*s,n[4]=-a*u,n[8]=r+t*s,n[1]=t+r*s,n[5]=a*h,n[9]=i-e*s,n[2]=-a*l,n[6]=s,n[10]=a*o}else if("ZYX"===e.order){let e=a*h,t=a*u,r=s*h,i=s*u;n[0]=o*h,n[4]=r*l-t,n[8]=e*l+i,n[1]=o*u,n[5]=i*l+e,n[9]=t*l-r,n[2]=-l,n[6]=s*o,n[10]=a*o}else if("YZX"===e.order){let e=a*o,t=a*l,r=s*o,i=s*l;n[0]=o*h,n[4]=i-e*u,n[8]=r*u+t,n[1]=u,n[5]=a*h,n[9]=-s*h,n[2]=-l*h,n[6]=t*u+r,n[10]=e-i*u}else if("XZY"===e.order){let e=a*o,t=a*l,r=s*o,i=s*l;n[0]=o*h,n[4]=-u,n[8]=l*h,n[1]=e*u+i,n[5]=a*h,n[9]=t*u-r,n[2]=r*u-t,n[6]=s*h,n[10]=i*u+e}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(e){return this.compose(pn,e,mn)}lookAt(e,t,r){var i=this.elements;return yn.subVectors(e,t),0===yn.lengthSq()&&(yn.z=1),yn.normalize(),gn.crossVectors(r,yn),0===gn.lengthSq()&&(1===Math.abs(r.z)?yn.x+=1e-4:yn.z+=1e-4,yn.normalize(),gn.crossVectors(r,yn)),gn.normalize(),vn.crossVectors(yn,gn),i[0]=gn.x,i[4]=vn.x,i[8]=yn.x,i[1]=gn.y,i[5]=vn.y,i[9]=yn.y,i[2]=gn.z,i[6]=vn.z,i[10]=yn.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){var e=e.elements,t=t.elements,r=this.elements,i=e[0],n=e[4],a=e[8],s=e[12],o=e[1],l=e[5],h=e[9],u=e[13],d=e[2],c=e[6],f=e[10],p=e[14],m=e[3],g=e[7],v=e[11],e=e[15],y=t[0],x=t[4],b=t[8],_=t[12],T=t[1],S=t[5],w=t[9],E=t[13],M=t[2],A=t[6],L=t[10],R=t[14],C=t[3],D=t[7],I=t[11],t=t[15];return r[0]=i*y+n*T+a*M+s*C,r[4]=i*x+n*S+a*A+s*D,r[8]=i*b+n*w+a*L+s*I,r[12]=i*_+n*E+a*R+s*t,r[1]=o*y+l*T+h*M+u*C,r[5]=o*x+l*S+h*A+u*D,r[9]=o*b+l*w+h*L+u*I,r[13]=o*_+l*E+h*R+u*t,r[2]=d*y+c*T+f*M+p*C,r[6]=d*x+c*S+f*A+p*D,r[10]=d*b+c*w+f*L+p*I,r[14]=d*_+c*E+f*R+p*t,r[3]=m*y+g*T+v*M+e*C,r[7]=m*x+g*S+v*A+e*D,r[11]=m*b+g*w+v*L+e*I,r[15]=m*_+g*E+v*R+e*t,this}multiplyScalar(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){var e=this.elements,t=e[0],r=e[4],i=e[8],n=e[12],a=e[1],s=e[5],o=e[9],l=e[13],h=e[2],u=e[6],d=e[10],c=e[14];return e[3]*(+n*o*u-i*l*u-n*s*d+r*l*d+i*s*c-r*o*c)+e[7]*(+t*o*c-t*l*d+n*a*d-i*a*c+i*l*h-n*o*h)+e[11]*(+t*l*u-t*s*c-n*a*u+r*a*c+n*s*h-r*l*h)+e[15]*(-i*s*h-t*o*u+t*s*d+i*a*u-r*a*d+r*o*h)}transpose(){var e=this.elements,t=e[1];return e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){var i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){var e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],l=e[7],h=e[8],u=e[9],d=e[10],c=e[11],f=e[12],p=e[13],m=e[14],g=e[15],v=u*m*l-p*d*l+p*o*c-s*m*c-u*o*g+s*d*g,y=f*d*l-h*m*l-f*o*c+a*m*c+h*o*g-a*d*g,x=h*p*l-f*u*l+f*s*c-a*p*c-h*s*g+a*u*g,b=f*u*o-h*p*o-f*s*d+a*p*d+h*s*m-a*u*m,_=t*v+r*y+i*x+n*b;return 0==_?this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0):(e[0]=v*(v=1/_),e[1]=(p*d*n-u*m*n-p*i*c+r*m*c+u*i*g-r*d*g)*v,e[2]=(s*m*n-p*o*n+p*i*l-r*m*l-s*i*g+r*o*g)*v,e[3]=(u*o*n-s*d*n-u*i*l+r*d*l+s*i*c-r*o*c)*v,e[4]=y*v,e[5]=(h*m*n-f*d*n+f*i*c-t*m*c-h*i*g+t*d*g)*v,e[6]=(f*o*n-a*m*n-f*i*l+t*m*l+a*i*g-t*o*g)*v,e[7]=(a*d*n-h*o*n+h*i*l-t*d*l-a*i*c+t*o*c)*v,e[8]=x*v,e[9]=(f*u*n-h*p*n-f*r*c+t*p*c+h*r*g-t*u*g)*v,e[10]=(a*p*n-f*s*n+f*r*l-t*p*l-a*r*g+t*s*g)*v,e[11]=(h*s*n-a*u*n-h*r*l+t*u*l+a*r*c-t*s*c)*v,e[12]=b*v,e[13]=(h*p*i-f*u*i+f*r*d-t*p*d-h*r*m+t*u*m)*v,e[14]=(f*s*i-a*p*i-f*r*o+t*p*o+a*r*m-t*s*m)*v,e[15]=(a*u*i-h*s*i+h*r*o-t*u*o-a*r*d+t*s*d)*v,this)}scale(e){var t=this.elements,r=e.x,i=e.y,e=e.z;return t[0]*=r,t[4]*=i,t[8]*=e,t[1]*=r,t[5]*=i,t[9]*=e,t[2]*=r,t[6]*=i,t[10]*=e,t[3]*=r,t[7]*=i,t[11]*=e,this}getMaxScaleOnAxis(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,e))}makeTranslation(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this}makeRotationY(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this}makeRotationZ(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){var r=Math.cos(t),t=Math.sin(t),i=1-r,n=e.x,a=e.y,e=e.z,s=i*n,o=i*a;return this.set(s*n+r,s*a-t*e,s*e+t*a,0,s*a+t*e,o*a+r,o*e-t*n,0,s*e-t*a,o*e+t*n,i*e*e+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,n,a){return this.set(1,r,n,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){var i=this.elements,n=t._x,a=t._y,s=t._z,t=t._w,o=n+n,l=a+a,h=s+s,u=n*o,d=n*l,n=n*h,c=a*l,a=a*h,s=s*h,o=t*o,l=t*l,t=t*h,h=r.x,f=r.y,r=r.z;return i[0]=(1-(c+s))*h,i[1]=(d+t)*h,i[2]=(n-l)*h,i[3]=0,i[4]=(d-t)*f,i[5]=(1-(u+s))*f,i[6]=(a+o)*f,i[7]=0,i[8]=(n+l)*r,i[9]=(a-o)*r,i[10]=(1-(u+c))*r,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){var i=this.elements;let n=cn.set(i[0],i[1],i[2]).length();var a=cn.set(i[4],i[5],i[6]).length(),s=cn.set(i[8],i[9],i[10]).length(),e=(this.determinant()<0&&(n=-n),e.x=i[12],e.y=i[13],e.z=i[14],fn.copy(this),1/n),i=1/a,o=1/s;return fn.elements[0]*=e,fn.elements[1]*=e,fn.elements[2]*=e,fn.elements[4]*=i,fn.elements[5]*=i,fn.elements[6]*=i,fn.elements[8]*=o,fn.elements[9]*=o,fn.elements[10]*=o,t.setFromRotationMatrix(fn),r.x=n,r.y=a,r.z=s,this}makePerspective(e,t,r,i,n,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var s=this.elements,o=2*n/(r-i),l=(t+e)/(t-e),r=(r+i)/(r-i),i=-(a+n)/(a-n),a=-2*a*n/(a-n);return s[0]=2*n/(t-e),s[4]=0,s[8]=l,s[12]=0,s[1]=0,s[5]=o,s[9]=r,s[13]=0,s[2]=0,s[6]=0,s[10]=i,s[14]=a,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,r,i,n,a){var s=this.elements,o=1/(t-e),l=1/(r-i),h=1/(a-n),t=(t+e)*o,e=(r+i)*l,r=(a+n)*h;return s[0]=2*o,s[4]=0,s[8]=0,s[12]=-t,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-e,s[2]=0,s[6]=0,s[10]=-2*h,s[14]=-r,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){var t=this.elements,r=e.elements;for(let e=0;e<16;e++)if(t[e]!==r[e])return!1;return!0}fromArray(t,r=0){for(let e=0;e<16;e++)this.elements[e]=t[e+r];return this}toArray(e=[],t=0){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}ke.prototype.isMatrix4=!0;let cn=new Pe,fn=new ke,pn=new Pe(0,0,0),mn=new Pe(1,1,1),gn=new Pe,vn=new Pe,yn=new Pe,xn=new ke,bn=new ki;class _n{constructor(e=0,t=0,r=0,i=_n.DefaultOrder){this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){var e=e.elements,i=e[0],n=e[4],a=e[8],s=e[1],o=e[5],l=e[9],h=e[2],u=e[6],d=e[10];switch(t){case"XYZ":this._y=Math.asin(mi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-n,i)):(this._x=Math.atan2(u,o),this._z=0);break;case"YXZ":this._x=Math.asin(-mi(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(s,o)):(this._y=Math.atan2(-h,i),this._z=0);break;case"ZXY":this._x=Math.asin(mi(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-n,o)):(this._y=0,this._z=Math.atan2(s,i));break;case"ZYX":this._y=Math.asin(-mi(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-n,o));break;case"YZX":this._z=Math.asin(mi(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-l,o),this._y=Math.atan2(-h,i)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-mi(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(u,o),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-l,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===r&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return xn.makeRotationFromQuaternion(e),this.setFromRotationMatrix(xn,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return bn.setFromEuler(this),this.setFromQuaternion(bn,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new Pe(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}_n.prototype.isEuler=!0,_n.DefaultOrder="XYZ",_n.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Tn{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}let Sn=0,wn=new Pe,En=new ki,Mn=new ke,An=new Pe,Ln=new Pe,Rn=new Pe,Cn=new ki,Dn=new Pe(1,0,0),In=new Pe(0,1,0),Pn=new Pe(0,0,1),kn={type:"added"},On={type:"removed"};class f extends hi{constructor(){super(),Object.defineProperty(this,"id",{value:Sn++}),this.uuid=pi(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=f.DefaultUp.clone();let e=new Pe,t=new _n,r=new ki,i=new Pe(1,1,1);t._onChange(function(){r.setFromEuler(t,!1)}),r._onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new ke},normalMatrix:{value:new v}}),this.matrix=new ke,this.matrixWorld=new ke,this.matrixAutoUpdate=f.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Tn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return En.setFromAxisAngle(e,t),this.quaternion.multiply(En),this}rotateOnWorldAxis(e,t){return En.setFromAxisAngle(e,t),this.quaternion.premultiply(En),this}rotateX(e){return this.rotateOnAxis(Dn,e)}rotateY(e){return this.rotateOnAxis(In,e)}rotateZ(e){return this.rotateOnAxis(Pn,e)}translateOnAxis(e,t){return wn.copy(e).applyQuaternion(this.quaternion),this.position.add(wn.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Dn,e)}translateY(e){return this.translateOnAxis(In,e)}translateZ(e){return this.translateOnAxis(Pn,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Mn.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?An.copy(e):An.set(e,t,r);e=this.parent;this.updateWorldMatrix(!0,!1),Ln.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Mn.lookAt(Ln,An,this.up):Mn.lookAt(An,Ln,this.up),this.quaternion.setFromRotationMatrix(Mn),e&&(Mn.extractRotation(e.matrixWorld),En.setFromRotationMatrix(Mn),this.quaternion.premultiply(En.invert()))}add(e){if(1<arguments.length)for(let e=0;e<arguments.length;e++)this.add(arguments[e]);else e===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",e):e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),(e.parent=this).children.push(e),e.dispatchEvent(kn)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e);return this}remove(e){if(1<arguments.length)for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);else{var t=this.children.indexOf(e);-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(On))}return this}removeFromParent(){var e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){var t=this.children[e];t.parent=null,t.dispatchEvent(On)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Mn.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Mn.multiply(e.parent.matrixWorld)),e.applyMatrix4(Mn),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(r,i){if(this[r]===i)return this;for(let e=0,t=this.children.length;e<t;e++){var n=this.children[e].getObjectByProperty(r,i);if(void 0!==n)return n}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ln,e,Rn),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ln,Cn,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(r){r(this);var i=this.children;for(let e=0,t=i.length;e<t;e++)i[e].traverse(r)}traverseVisible(r){if(!1!==this.visible){r(this);var i=this.children;for(let e=0,t=i.length;e<t;e++)i[e].traverseVisible(r)}}traverseAncestors(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(r){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||r)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),r=!(this.matrixWorldNeedsUpdate=!1));var i=this.children;for(let e=0,t=i.length;e<t;e++)i[e].updateMatrixWorld(r)}updateWorldMatrix(e,t){var r=this.parent;if(!0===e&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){let r=this.children;for(let e=0,t=r.length;e<t;e++)r[e].updateWorldMatrix(!1,!0)}}toJSON(o){let e=void 0===o||"string"==typeof o,l={},i=(e&&(o={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},l.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"}),{});function n(e,t){return void 0===e[t.uuid]&&(e[t.uuid]=t.toJSON(o)),t.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor)&&(i.instanceColor=this.instanceColor.toJSON()),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(o).uuid)),this.environment&&this.environment.isTexture&&(i.environment=this.environment.toJSON(o).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=n(o.geometries,this.geometry);let e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){let r=e.shapes;if(Array.isArray(r))for(let t=0,e=r.length;t<e;t++){let e=r[t];n(o.shapes,e)}else n(o.shapes,r)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton)&&(n(o.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid),void 0!==this.material)if(Array.isArray(this.material)){let r=[];for(let e=0,t=this.material.length;e<t;e++)r.push(n(o.materials,this.material[e]));i.material=r}else i.material=n(o.materials,this.material);if(0<this.children.length){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(o).object)}if(0<this.animations.length){i.animations=[];for(let t=0;t<this.animations.length;t++){let e=this.animations[t];i.animations.push(n(o.animations,e))}}if(e){let e=h(o.geometries),t=h(o.materials),r=h(o.textures),i=h(o.images),n=h(o.shapes),a=h(o.skeletons),s=h(o.animations);0<e.length&&(l.geometries=e),0<t.length&&(l.materials=t),0<r.length&&(l.textures=r),0<i.length&&(l.images=i),0<n.length&&(l.shapes=n),0<a.length&&(l.skeletons=a),0<s.length&&(l.animations=s)}return l.object=i,l;function h(e){var t,r=[];for(t in e){var i=e[t];delete i.metadata,r.push(i)}return r}}clone(e){return(new this.constructor).copy(this,e)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){var r=t.children[e];this.add(r.clone())}return this}}f.DefaultUp=new Pe(0,1,0),f.DefaultMatrixAutoUpdate=!0,f.prototype.isObject3D=!0;let Fn=new Pe,Nn=new Pe,Bn=new Pe,Un=new Pe,Gn=new Pe,zn=new Pe,Hn=new Pe,Vn=new Pe,Wn=new Pe,jn=new Pe;class p{constructor(e=new Pe,t=new Pe,r=new Pe){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),Fn.subVectors(e,t),i.cross(Fn);r=i.lengthSq();return 0<r?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,r,i,n){Fn.subVectors(i,t),Nn.subVectors(r,t),Bn.subVectors(e,t);var i=Fn.dot(Fn),r=Fn.dot(Nn),e=Fn.dot(Bn),t=Nn.dot(Nn),a=Nn.dot(Bn),s=i*t-r*r;return 0==s?n.set(-2,-1,-1):n.set(1-(t=(t*e-r*a)*(n=1/s))-(s=(i*a-r*e)*n),s,t)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,Un),0<=Un.x&&0<=Un.y&&Un.x+Un.y<=1}static getUV(e,t,r,i,n,a,s,o){return this.getBarycoord(e,t,r,i,Un),o.set(0,0),o.addScaledVector(n,Un.x),o.addScaledVector(a,Un.y),o.addScaledVector(s,Un.z),o}static isFrontFacing(e,t,r,i){return Fn.subVectors(r,t),Nn.subVectors(e,t),Fn.cross(Nn).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Fn.subVectors(this.c,this.b),Nn.subVectors(this.a,this.b),.5*Fn.cross(Nn).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return p.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return p.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,r,i,n){return p.getUV(e,this.a,this.b,this.c,t,r,i,n)}containsPoint(e){return p.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return p.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){var r=this.a,i=this.b,n=this.c;let a,s;Gn.subVectors(i,r),zn.subVectors(n,r),Vn.subVectors(e,r);var o=Gn.dot(Vn),l=zn.dot(Vn);if(o<=0&&l<=0)return t.copy(r);Wn.subVectors(e,i);var h=Gn.dot(Wn),u=zn.dot(Wn);if(0<=h&&u<=h)return t.copy(i);var d=o*u-h*l;if(d<=0&&0<=o&&h<=0)return a=o/(o-h),t.copy(r).addScaledVector(Gn,a);jn.subVectors(e,n);var e=Gn.dot(jn),c=zn.dot(jn);return 0<=c&&e<=c?t.copy(n):(o=e*l-o*c)<=0&&0<=l&&c<=0?(s=l/(l-c),t.copy(r).addScaledVector(zn,s)):(l=h*c-e*u)<=0&&0<=u-h&&0<=e-c?(Hn.subVectors(n,i),s=(u-h)/(u-h+(e-c)),t.copy(i).addScaledVector(Hn,s)):(n=1/(l+o+d),a=o*n,s=d*n,t.copy(r).addScaledVector(Gn,a).addScaledVector(zn,s))}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Yn=0;class r extends hi{constructor(){super(),Object.defineProperty(this,"id",{value:Yn++}),this.uuid=pi(),this.name="",this.type="Material",this.fog=!0,this.blending=K,this.side=Oe,this.vertexColors=!1,this.opacity=1,this.format=Ce,this.transparent=!1,this.blendSrc=he,this.blendDst=ue,this.blendEquation=ee,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=xe,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Jr,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Nr,this.stencilZFail=Nr,this.stencilZPass=Nr,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){0<this._alphaTest!=0<e&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(var t in e){var r,i=e[t];void 0===i?console.warn("THREE.Material: '"+t+"' parameter is undefined."):"shading"===t?(console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===P):void 0!==(r=this[t])?r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(r){let e=void 0===r||"string"==typeof r;e&&(r={textures:{},images:{}});var i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){var t,r=[];for(t in e){var i=e[t];delete i.metadata,r.push(i)}return r}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(r).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(r).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(r).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(r).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(r).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(r).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(r).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(r).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(r).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(r).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(r).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(r).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(r).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(r).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(r).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(r).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(r).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(r).uuid,void 0!==this.combine)&&(i.combine=this.combine),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(r).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(r).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(r).uuid),void 0!==this.attenuationDistance&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==K&&(i.blending=this.blending),this.side!==Oe&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.format!==Ce&&(i.format=this.format),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),0<this.alphaTest&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),1<this.wireframeLinewidth&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e){let e=n(r.textures),t=n(r.images);0<e.length&&(i.textures=e),0<t.length&&(i.images=t)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var r=e.clippingPlanes;let i=null;if(null!==r){let t=r.length;i=new Array(t);for(let e=0;e!==t;++e)i[e]=r[e].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}r.prototype.isMaterial=!0;let $n={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},qn={h:0,s:0,l:0},Kn={h:0,s:0,l:0};function Xn(e,t,r){return r<0&&(r+=1),1<r&&--r,r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}function Jn(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Zn(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class m{constructor(e,t,r){return void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,r){return this.r=e,this.g=t,this.b=r,this}setHSL(e,t,r){return e=gi(e,1),t=mi(t,0,1),r=mi(r,0,1),0===t?this.r=this.g=this.b=r:(this.r=Xn(t=2*r-(r=r<=.5?r*(1+t):r+t-r*t),r,e+1/3),this.g=Xn(t,r,e),this.b=Xn(t,r,e-1/3)),this}setStyle(t){function n(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let i;var e=r[1],a=r[2];switch(e){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,n(i[4]),this;if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,n(i[4]),this;break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){let e=parseFloat(i[1])/360,t=parseInt(i[2],10)/100,r=parseInt(i[3],10)/100;return n(i[4]),this.setHSL(e,t,r)}}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){let e=r[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return t&&0<t.length?this.setColorName(t):this}setColorName(e){var t=$n[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){t=0<t?1/t:1;return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=Jn(e.r),this.g=Jn(e.g),this.b=Jn(e.b),this}copyLinearToSRGB(e){return this.r=Zn(e.r),this.g=Zn(e.g),this.b=Zn(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){var t=this.r,r=this.g,i=this.b,n=Math.max(t,r,i),a=Math.min(t,r,i);let s,o;var l=(a+n)/2;if(a===n)s=0,o=0;else{let e=n-a;switch(o=l<=.5?e/(n+a):e/(2-n-a),n){case t:s=(r-i)/e+(r<i?6:0);break;case r:s=(i-t)/e+2;break;case i:s=(t-r)/e+4}s/=6}return e.h=s,e.s=o,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,r){return this.getHSL(qn),qn.h+=e,qn.s+=t,qn.l+=r,this.setHSL(qn.h,qn.s,qn.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(qn),e.getHSL(Kn);var e=vi(qn.h,Kn.h,t),r=vi(qn.s,Kn.s,t),t=vi(qn.l,Kn.l,t);return this.setHSL(e,r,t),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}m.NAMES=$n,m.prototype.isColor=!0,m.prototype.r=1,m.prototype.g=1,m.prototype.b=1;class Qn extends r{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new m(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=O,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Qn.prototype.isMeshBasicMaterial=!0;let i=new Pe,ea=new V;class E{constructor(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===r,this.usage=Zr,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(r,i,n){r*=this.itemSize,n*=i.itemSize;for(let e=0,t=this.itemSize;e<t;e++)this.array[r+e]=i.array[n+e];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(r){var i=this.array;let n=0;for(let t=0,e=r.length;t<e;t++){let e=r[t];void 0===e&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",t),e=new m),i[n++]=e.r,i[n++]=e.g,i[n++]=e.b}return this}copyVector2sArray(r){var i=this.array;let n=0;for(let t=0,e=r.length;t<e;t++){let e=r[t];void 0===e&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",t),e=new V),i[n++]=e.x,i[n++]=e.y}return this}copyVector3sArray(r){var i=this.array;let n=0;for(let t=0,e=r.length;t<e;t++){let e=r[t];void 0===e&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",t),e=new Pe),i[n++]=e.x,i[n++]=e.y,i[n++]=e.z}return this}copyVector4sArray(r){var i=this.array;let n=0;for(let t=0,e=r.length;t<e;t++){let e=r[t];void 0===e&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",t),e=new Ie),i[n++]=e.x,i[n++]=e.y,i[n++]=e.z,i[n++]=e.w}return this}applyMatrix3(r){if(2===this.itemSize)for(let e=0,t=this.count;e<t;e++)ea.fromBufferAttribute(this,e),ea.applyMatrix3(r),this.setXY(e,ea.x,ea.y);else if(3===this.itemSize)for(let e=0,t=this.count;e<t;e++)i.fromBufferAttribute(this,e),i.applyMatrix3(r),this.setXYZ(e,i.x,i.y,i.z);return this}applyMatrix4(r){for(let e=0,t=this.count;e<t;e++)i.x=this.getX(e),i.y=this.getY(e),i.z=this.getZ(e),i.applyMatrix4(r),this.setXYZ(e,i.x,i.y,i.z);return this}applyNormalMatrix(r){for(let e=0,t=this.count;e<t;e++)i.x=this.getX(e),i.y=this.getY(e),i.z=this.getZ(e),i.applyNormalMatrix(r),this.setXYZ(e,i.x,i.y,i.z);return this}transformDirection(r){for(let e=0,t=this.count;e<t;e++)i.x=this.getX(e),i.y=this.getY(e),i.z=this.getZ(e),i.transformDirection(r),this.setXYZ(e,i.x,i.y,i.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=n,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){var e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Zr&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}E.prototype.isBufferAttribute=!0;class ta extends E{constructor(e,t,r){super(new Int8Array(e),t,r)}}class ra extends E{constructor(e,t,r){super(new Uint8Array(e),t,r)}}class ia extends E{constructor(e,t,r){super(new Uint8ClampedArray(e),t,r)}}class na extends E{constructor(e,t,r){super(new Int16Array(e),t,r)}}class aa extends E{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class sa extends E{constructor(e,t,r){super(new Int32Array(e),t,r)}}class oa extends E{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class la extends E{constructor(e,t,r){super(new Uint16Array(e),t,r)}}la.prototype.isFloat16BufferAttribute=!0;class W extends E{constructor(e,t,r){super(new Float32Array(e),t,r)}}class ha extends E{constructor(e,t,r){super(new Float64Array(e),t,r)}}let ua=0,da=new ke,ca=new f,fa=new Pe,pa=new Ni,ma=new Ni,h=new Pe;class S extends hi{constructor(){super(),Object.defineProperty(this,"id",{value:ua++}),this.uuid=pi(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(65535<Ti(e)?oa:aa)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(t){let e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);var r=this.attributes.normal;if(void 0!==r){let e=(new v).getNormalMatrix(t);r.applyNormalMatrix(e),r.needsUpdate=!0}r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return da.makeRotationFromQuaternion(e),this.applyMatrix4(da),this}rotateX(e){return da.makeRotationX(e),this.applyMatrix4(da),this}rotateY(e){return da.makeRotationY(e),this.applyMatrix4(da),this}rotateZ(e){return da.makeRotationZ(e),this.applyMatrix4(da),this}translate(e,t,r){return da.makeTranslation(e,t,r),this.applyMatrix4(da),this}scale(e,t,r){return da.makeScale(e,t,r),this.applyMatrix4(da),this}lookAt(e){return ca.lookAt(e),ca.updateMatrix(),this.applyMatrix4(ca.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(fa).negate(),this.translate(fa.x,fa.y,fa.z),this}setFromPoints(r){var i=[];for(let e=0,t=r.length;e<t;e++){var n=r[e];i.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new W(i,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Ni);var e=this.attributes.position,r=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Pe(-1/0,-1/0,-1/0),new Pe(1/0,1/0,1/0));else{if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),r)for(let e=0,t=r.length;e<t;e++){var i=r[e];pa.setFromBufferAttribute(i),this.morphTargetsRelative?(h.addVectors(this.boundingBox.min,pa.min),this.boundingBox.expandByPoint(h),h.addVectors(this.boundingBox.max,pa.max),this.boundingBox.expandByPoint(h)):(this.boundingBox.expandByPoint(pa.min),this.boundingBox.expandByPoint(pa.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new rn);var i=this.attributes.position,n=this.morphAttributes.position;if(i&&i.isGLBufferAttribute)console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Pe,1/0);else if(i){var a=this.boundingSphere.center;if(pa.setFromBufferAttribute(i),n)for(let e=0,t=n.length;e<t;e++){var s=n[e];ma.setFromBufferAttribute(s),this.morphTargetsRelative?(h.addVectors(pa.min,ma.min),pa.expandByPoint(h),h.addVectors(pa.max,ma.max),pa.expandByPoint(h)):(pa.expandByPoint(ma.min),pa.expandByPoint(ma.max))}pa.getCenter(a);let r=0;for(let e=0,t=i.count;e<t;e++)h.fromBufferAttribute(i,e),r=Math.max(r,a.distanceToSquared(h));if(n)for(let e=0,t=n.length;e<t;e++){var o=n[e],l=this.morphTargetsRelative;for(let e=0,t=o.count;e<t;e++)h.fromBufferAttribute(o,e),l&&(fa.fromBufferAttribute(i,e),h.add(fa)),r=Math.max(r,a.distanceToSquared(h))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,T=this.attributes;if(null===e||void 0===T.position||void 0===T.normal||void 0===T.uv)console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");else{let n=e.array,a=T.position.array,r=T.normal.array,s=T.uv.array,t=a.length/3,i=(void 0===T.tangent&&this.setAttribute("tangent",new E(new Float32Array(4*t),4)),T.tangent.array),o=[],l=[];for(let e=0;e<t;e++)o[e]=new Pe,l[e]=new Pe;let h=new Pe,u=new Pe,d=new Pe,c=new V,f=new V,p=new V,m=new Pe,g=new Pe,v=this.groups;for(let e=0,t=(v=0===v.length?[{start:0,count:n.length}]:v).length;e<t;++e){let r=v[e],i=r.start;for(let e=i,t=i+r.count;e<t;e+=3)S(n[e+0],n[e+1],n[e+2])}let y=new Pe,x=new Pe,b=new Pe,_=new Pe;for(let e=0,t=v.length;e<t;++e){let r=v[e],i=r.start;for(let e=i,t=i+r.count;e<t;e+=3)w(n[e+0]),w(n[e+1]),w(n[e+2])}function S(e,t,r){h.fromArray(a,3*e),u.fromArray(a,3*t),d.fromArray(a,3*r),c.fromArray(s,2*e),f.fromArray(s,2*t),p.fromArray(s,2*r),u.sub(h),d.sub(h),f.sub(c),p.sub(c);var i=1/(f.x*p.y-p.x*f.y);isFinite(i)&&(m.copy(u).multiplyScalar(p.y).addScaledVector(d,-f.y).multiplyScalar(i),g.copy(d).multiplyScalar(f.x).addScaledVector(u,-p.x).multiplyScalar(i),o[e].add(m),o[t].add(m),o[r].add(m),l[e].add(g),l[t].add(g),l[r].add(g))}function w(e){b.fromArray(r,3*e),_.copy(b);var t=o[e],t=(y.copy(t),y.sub(b.multiplyScalar(b.dot(t))).normalize(),x.crossVectors(_,t),x.dot(l[e])<0?-1:1);i[4*e]=y.x,i[4*e+1]=y.y,i[4*e+2]=y.z,i[4*e+3]=t}}}computeVertexNormals(){var i=this.index,n=this.getAttribute("position");if(void 0!==n){let r=this.getAttribute("normal");if(void 0===r)r=new E(new Float32Array(3*n.count),3),this.setAttribute("normal",r);else for(let e=0,t=r.count;e<t;e++)r.setXYZ(e,0,0,0);var a=new Pe,s=new Pe,o=new Pe,l=new Pe,h=new Pe,u=new Pe,d=new Pe,c=new Pe;if(i)for(let e=0,t=i.count;e<t;e+=3){var f=i.getX(e+0),p=i.getX(e+1),m=i.getX(e+2);a.fromBufferAttribute(n,f),s.fromBufferAttribute(n,p),o.fromBufferAttribute(n,m),d.subVectors(o,s),c.subVectors(a,s),d.cross(c),l.fromBufferAttribute(r,f),h.fromBufferAttribute(r,p),u.fromBufferAttribute(r,m),l.add(d),h.add(d),u.add(d),r.setXYZ(f,l.x,l.y,l.z),r.setXYZ(p,h.x,h.y,h.z),r.setXYZ(m,u.x,u.y,u.z)}else for(let e=0,t=n.count;e<t;e+=3)a.fromBufferAttribute(n,e+0),s.fromBufferAttribute(n,e+1),o.fromBufferAttribute(n,e+2),d.subVectors(o,s),c.subVectors(a,s),d.cross(c),r.setXYZ(e+0,d.x,d.y,d.z),r.setXYZ(e+1,d.x,d.y,d.z),r.setXYZ(e+2,d.x,d.y,d.z);this.normalizeNormals(),r.needsUpdate=!0}}merge(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r,i=this.attributes;for(r in i)if(void 0!==e.attributes[r]){var n=i[r].array,a=e.attributes[r],s=a.array,a=a.itemSize*t,o=Math.min(s.length,n.length-a);for(let e=0,t=a;e<o;e++,t++)n[t]=s[e]}return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)}normalizeNormals(){var r=this.attributes.normal;for(let e=0,t=r.count;e<t;e++)h.fromBufferAttribute(r,e),h.normalize(),r.setXYZ(e,h.x,h.y,h.z)}toNonIndexed(){function n(r,i){var n=r.array,a=r.itemSize,e=r.normalized,s=new n.constructor(i.length*a);let o=0,l=0;for(let e=0,t=i.length;e<t;e++){o=r.isInterleavedBufferAttribute?i[e]*r.data.stride+r.offset:i[e]*a;for(let e=0;e<a;e++)s[l++]=n[o++]}return new E(s,a,e)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let a=new S,s=this.index.array,r=this.attributes;for(let t in r){let e=n(r[t],s);a.setAttribute(t,e)}let t=this.morphAttributes;for(let e in t){let r=[],i=t[e];for(let t=0,e=i.length;t<e;t++){let e=n(i[t],s);r.push(e)}a.morphAttributes[e]=r}a.morphTargetsRelative=this.morphTargetsRelative;let i=this.groups;for(let t=0,e=i.length;t<e;t++){let e=i[t];a.addGroup(e.start,e.count,e.materialIndex)}return a}toJSON(){var a={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(a.uuid=this.uuid,a.type=this.type,""!==this.name&&(a.name=this.name),0<Object.keys(this.userData).length&&(a.userData=this.userData),void 0!==this.parameters){let t=this.parameters;for(let e in t)void 0!==t[e]&&(a[e]=t[e])}else{a.data={attributes:{}};let e=this.index,r=(null!==e&&(a.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)}),this.attributes);for(let t in r){let e=r[t];a.data.attributes[t]=e.toJSON(a.data)}let t={},n=!1;for(let e in this.morphAttributes){let r=this.morphAttributes[e],i=[];for(let t=0,e=r.length;t<e;t++){let e=r[t];i.push(e.toJSON(a.data))}0<i.length&&(t[e]=i,n=!0)}n&&(a.data.morphAttributes=t,a.data.morphTargetsRelative=this.morphTargetsRelative);let i=this.groups;0<i.length&&(a.data.groups=JSON.parse(JSON.stringify(i)));var s=this.boundingSphere;null!==s&&(a.data.boundingSphere={center:s.center.toArray(),radius:s.radius})}return a}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let n={},t=(this.name=e.name,e.index),r=(null!==t&&this.setIndex(t.clone(n)),e.attributes);for(let t in r){let e=r[t];this.setAttribute(t,e.clone(n))}var a=e.morphAttributes;for(let e in a){let r=[],i=a[e];for(let e=0,t=i.length;e<t;e++)r.push(i[e].clone(n));this.morphAttributes[e]=r}this.morphTargetsRelative=e.morphTargetsRelative;var i=e.groups;for(let t=0,e=i.length;t<e;t++){let e=i[t];this.addGroup(e.start,e.count,e.materialIndex)}var s=e.boundingBox,s=(null!==s&&(this.boundingBox=s.clone()),e.boundingSphere);return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}S.prototype.isBufferGeometry=!0;let ga=new ke,va=new dn,ya=new rn,xa=new Pe,ba=new Pe,_a=new Pe,Ta=new Pe,Sa=new Pe,wa=new Pe,Ea=new Pe,Ma=new Pe,Aa=new Pe,La=new V,Ra=new V,Ca=new V,Da=new Pe,Ia=new Pe;class w extends f{constructor(e=new S,t=new Qn){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,i=Object.keys(t);if(0<i.length){let r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){var n=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{t=e.morphTargets;void 0!==t&&0<t.length&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(f,p){let e=this.geometry,m=this.material,t=this.matrixWorld;if(void 0!==m&&(null===e.boundingSphere&&e.computeBoundingSphere(),ya.copy(e.boundingSphere),ya.applyMatrix4(t),!1!==f.ray.intersectsSphere(ya))&&(ga.copy(t).invert(),va.copy(f.ray).applyMatrix4(ga),null===e.boundingBox||!1!==va.intersectsBox(e.boundingBox))){let c;if(e.isBufferGeometry){let n=e.index,a=e.attributes.position,s=e.morphAttributes.position,o=e.morphTargetsRelative,l=e.attributes.uv,h=e.attributes.uv2,u=e.groups,d=e.drawRange;if(null!==n)if(Array.isArray(m))for(let e=0,t=u.length;e<t;e++){var g=u[e],v=m[g.materialIndex];for(let i=Math.max(g.start,d.start),e=Math.min(n.count,Math.min(g.start+g.count,d.start+d.count));i<e;i+=3){let e=n.getX(i),t=n.getX(i+1),r=n.getX(i+2);(c=Pa(this,v,f,va,a,s,o,l,h,e,t,r))&&(c.faceIndex=Math.floor(i/3),c.face.materialIndex=g.materialIndex,p.push(c))}}else for(let e=Math.max(0,d.start),t=Math.min(n.count,d.start+d.count);e<t;e+=3){var r=n.getX(e),i=n.getX(e+1),y=n.getX(e+2);(c=Pa(this,m,f,va,a,s,o,l,h,r,i,y))&&(c.faceIndex=Math.floor(e/3),p.push(c))}else if(void 0!==a)if(Array.isArray(m))for(let e=0,t=u.length;e<t;e++){let r=u[e],i=m[r.materialIndex];for(let e=Math.max(r.start,d.start),t=Math.min(a.count,Math.min(r.start+r.count,d.start+d.count));e<t;e+=3)(c=Pa(this,i,f,va,a,s,o,l,h,e,e+1,e+2))&&(c.faceIndex=Math.floor(e/3),c.face.materialIndex=r.materialIndex,p.push(c))}else for(let e=Math.max(0,d.start),t=Math.min(a.count,d.start+d.count);e<t;e+=3)(c=Pa(this,m,f,va,a,s,o,l,h,e,e+1,e+2))&&(c.faceIndex=Math.floor(e/3),p.push(c))}else e.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function Pa(e,t,r,i,n,a,s,o,l,h,u,d){xa.fromBufferAttribute(n,h),ba.fromBufferAttribute(n,u),_a.fromBufferAttribute(n,d);var c=e.morphTargetInfluences;if(a&&c){Ea.set(0,0,0),Ma.set(0,0,0),Aa.set(0,0,0);for(let r=0,e=a.length;r<e;r++){let e=c[r],t=a[r];0!==e&&(Ta.fromBufferAttribute(t,h),Sa.fromBufferAttribute(t,u),wa.fromBufferAttribute(t,d),s?(Ea.addScaledVector(Ta,e),Ma.addScaledVector(Sa,e),Aa.addScaledVector(wa,e)):(Ea.addScaledVector(Ta.sub(xa),e),Ma.addScaledVector(Sa.sub(ba),e),Aa.addScaledVector(wa.sub(_a),e)))}xa.add(Ea),ba.add(Ma),_a.add(Aa)}e.isSkinnedMesh&&(e.boneTransform(h,xa),e.boneTransform(u,ba),e.boneTransform(d,_a));n=function(e,t,r,i,n,a,s,o){if(null===(t.side===Ae?i.intersectTriangle(s,a,n,!0,o):i.intersectTriangle(n,a,s,t.side!==Fe,o)))return null;Ia.copy(o),Ia.applyMatrix4(e.matrixWorld);i=r.ray.origin.distanceTo(Ia);return i<r.near||i>r.far?null:{distance:i,point:Ia.clone(),object:e}}(e,t,r,i,xa,ba,_a,Da);if(n){o&&(La.fromBufferAttribute(o,h),Ra.fromBufferAttribute(o,u),Ca.fromBufferAttribute(o,d),n.uv=p.getUV(Da,xa,ba,_a,La,Ra,Ca,new V)),l&&(La.fromBufferAttribute(l,h),Ra.fromBufferAttribute(l,u),Ca.fromBufferAttribute(l,d),n.uv2=p.getUV(Da,xa,ba,_a,La,Ra,Ca,new V));let e={a:h,b:u,c:d,normal:new Pe,materialIndex:0};p.getNormal(xa,ba,_a,e.normal),n.face=e}return n}w.prototype.isMesh=!0;class ka extends S{constructor(e=1,t=1,r=1,i=1,n=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:n,depthSegments:a};let T=this,S=(i=Math.floor(i),n=Math.floor(n),a=Math.floor(a),[]),w=[],E=[],M=[],A=0,L=0;function s(n,a,s,o,l,e,t,h,u,d,r){var c=e/u,f=t/d,p=e/2,m=t/2,g=h/2,v=u+1,y=d+1;let x=0,b=0;var _=new Pe;for(let i=0;i<y;i++){let r=i*f-m;for(let t=0;t<v;t++){let e=t*c-p;_[n]=e*o,_[a]=r*l,_[s]=g,w.push(_.x,_.y,_.z),_[n]=0,_[a]=0,_[s]=0<h?1:-1,E.push(_.x,_.y,_.z),M.push(t/u),M.push(1-i/d),x+=1}}for(let a=0;a<d;a++)for(let n=0;n<u;n++){let e=A+n+v*a,t=A+n+v*(a+1),r=A+(n+1)+v*(a+1),i=A+(n+1)+v*a;S.push(e,t,i),S.push(t,r,i),b+=6}T.addGroup(L,b,r),L+=b,A+=x}s("z","y","x",-1,-1,r,t,e,a,n,0),s("z","y","x",1,-1,r,t,-e,a,n,1),s("x","z","y",1,1,e,r,t,i,a,2),s("x","z","y",1,-1,e,r,-t,i,a,3),s("x","y","z",1,-1,e,t,r,i,n,4),s("x","y","z",-1,-1,e,t,-r,i,n,5),this.setIndex(S),this.setAttribute("position",new W(w,3)),this.setAttribute("normal",new W(E,3)),this.setAttribute("uv",new W(M,2))}static fromJSON(e){return new ka(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Oa(e){var t,r={};for(t in e)for(var i in r[t]={},e[t]){var n=e[t][i];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?r[t][i]=n.clone():Array.isArray(n)?r[t][i]=n.slice():r[t][i]=n}return r}function Fa(t){var r={};for(let e=0;e<t.length;e++){var i=Oa(t[e]);for(let e in i)r[e]=i[e]}return r}let Na={clone:Oa,merge:Fa};class Ba extends r{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Oa(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(t){var r=super.toJSON(t);r.glslVersion=this.glslVersion,r.uniforms={};for(let e in this.uniforms){var i=this.uniforms[e].value;i&&i.isTexture?r.uniforms[e]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?r.uniforms[e]={type:"c",value:i.getHex()}:i&&i.isVector2?r.uniforms[e]={type:"v2",value:i.toArray()}:i&&i.isVector3?r.uniforms[e]={type:"v3",value:i.toArray()}:i&&i.isVector4?r.uniforms[e]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?r.uniforms[e]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?r.uniforms[e]={type:"m4",value:i.toArray()}:r.uniforms[e]={value:i}}0<Object.keys(this.defines).length&&(r.defines=this.defines),r.vertexShader=this.vertexShader,r.fragmentShader=this.fragmentShader;let n={};for(let e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return 0<Object.keys(n).length&&(r.extensions=n),r}}Ba.prototype.isShaderMaterial=!0;class Ua extends f{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new ke,this.projectionMatrix=new ke,this.projectionMatrixInverse=new ke}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Ua.prototype.isCamera=!0;class F extends Ua{constructor(e=50,t=1,r=.1,i=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){e=.5*this.getFilmHeight()/e;this.fov=2*ci*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){var e=Math.tan(.5*di*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*ci*Math.atan(Math.tan(.5*di*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,r,i,n,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,r=e*Math.tan(.5*di*this.fov)/this.zoom,i=2*r,n=this.aspect*i,a=-.5*n;var s=this.view;if(null!==this.view&&this.view.enabled){let e=s.fullWidth,t=s.fullHeight;a+=s.offsetX*n/e,r-=s.offsetY*i/t,n*=s.width/e,i*=s.height/t}let t=this.filmOffset;0!==t&&(a+=e*t/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+n,r,r-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){e=super.toJSON(e);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}F.prototype.isPerspectiveCamera=!0;class Ga extends f{constructor(e,t,r){super(),this.type="CubeCamera",!0!==r.isWebGLCubeRenderTarget?console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter."):(this.renderTarget=r,(r=new F(90,1,e,t)).layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Pe(1,0,0)),this.add(r),(r=new F(90,1,e,t)).layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Pe(-1,0,0)),this.add(r),(r=new F(90,1,e,t)).layers=this.layers,r.up.set(0,0,1),r.lookAt(new Pe(0,1,0)),this.add(r),(r=new F(90,1,e,t)).layers=this.layers,r.up.set(0,0,-1),r.lookAt(new Pe(0,-1,0)),this.add(r),(r=new F(90,1,e,t)).layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Pe(0,0,1)),this.add(r),(r=new F(90,1,e,t)).layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Pe(0,0,-1)),this.add(r))}update(e,t){null===this.parent&&this.updateMatrixWorld();var r=this.renderTarget,[i,n,a,s,o,l]=this.children,h=e.xr.enabled,u=e.getRenderTarget(),d=(e.xr.enabled=!1,r.texture.generateMipmaps);r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(t,i),e.setRenderTarget(r,1),e.render(t,n),e.setRenderTarget(r,2),e.render(t,a),e.setRenderTarget(r,3),e.render(t,s),e.setRenderTarget(r,4),e.render(t,o),r.texture.generateMipmaps=d,e.setRenderTarget(r,5),e.render(t,l),e.setRenderTarget(u),e.xr.enabled=h}}class za extends u{constructor(e,t,r,i,n,a,s,o,l,h){super(e=void 0!==e?e:[],t=void 0!==t?t:Be,r,i,n,a,s,o,l,h),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}za.prototype.isCubeTexture=!0;class Ha extends Di{constructor(e,t,r){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=r),super(e,e,t),t=t||{},this.texture=new za(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:B,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Ce,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",n="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",a=new ka(5,5,5),s=new Ba({name:"CubemapFromEquirect",uniforms:Oa(r),vertexShader:i,fragmentShader:n,side:Ae,blending:q});s.uniforms.tEquirect.value=t;var o=new w(a,s),l=t.minFilter;return t.minFilter===Ze&&(t.minFilter=B),new Ga(1,10,this).update(e,o),t.minFilter=l,o.geometry.dispose(),o.material.dispose(),this}clear(t,r,i,n){var e=t.getRenderTarget();for(let e=0;e<6;e++)t.setRenderTarget(this,e),t.clear(r,i,n);t.setRenderTarget(e)}}Ha.prototype.isWebGLCubeRenderTarget=!0;let Va=new Pe,Wa=new Pe,ja=new v;class Ya{constructor(e=new Pe(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){r=Va.subVectors(r,t).cross(Wa.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){var r=e.delta(Va),i=this.normal.dot(r);return 0===i?0===this.distanceToPoint(e.start)?t.copy(e.start):null:(i=-(e.start.dot(this.normal)+this.constant)/i)<0||1<i?null:t.copy(r).multiplyScalar(i).add(e.start)}intersectsLine(e){var t=this.distanceToPoint(e.start),e=this.distanceToPoint(e.end);return t<0&&0<e||e<0&&0<t}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){t=t||ja.getNormalMatrix(e),e=this.coplanarPoint(Va).applyMatrix4(e),t=this.normal.applyMatrix3(t).normalize();return this.constant=-e.dot(t),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Ya.prototype.isPlane=!0;let $a=new rn,qa=new Pe;class Ka{constructor(e=new Ya,t=new Ya,r=new Ya,i=new Ya,n=new Ya,a=new Ya){this.planes=[e,t,r,i,n,a]}set(e,t,r,i,n,a){var s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(r),s[3].copy(i),s[4].copy(n),s[5].copy(a),this}copy(t){var r=this.planes;for(let e=0;e<6;e++)r[e].copy(t.planes[e]);return this}setFromProjectionMatrix(e){var t=this.planes,e=e.elements,r=e[0],i=e[1],n=e[2],a=e[3],s=e[4],o=e[5],l=e[6],h=e[7],u=e[8],d=e[9],c=e[10],f=e[11],p=e[12],m=e[13],g=e[14],e=e[15];return t[0].setComponents(a-r,h-s,f-u,e-p).normalize(),t[1].setComponents(a+r,h+s,f+u,e+p).normalize(),t[2].setComponents(a+i,h+o,f+d,e+m).normalize(),t[3].setComponents(a-i,h-o,f-d,e-m).normalize(),t[4].setComponents(a-n,h-l,f-c,e-g).normalize(),t[5].setComponents(a+n,h+l,f+c,e+g).normalize(),this}intersectsObject(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),$a.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere($a)}intersectsSprite(e){return $a.center.set(0,0,0),$a.radius=.7071067811865476,$a.applyMatrix4(e.matrixWorld),this.intersectsSphere($a)}intersectsSphere(e){var t=this.planes,r=e.center,i=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(r)<i)return!1;return!0}intersectsBox(t){var r=this.planes;for(let e=0;e<6;e++){var i=r[e];if(qa.x=(0<i.normal.x?t.max:t.min).x,qa.y=(0<i.normal.y?t.max:t.min).y,qa.z=(0<i.normal.z?t.max:t.min).z,i.distanceToPoint(qa)<0)return!1}return!0}containsPoint(t){var r=this.planes;for(let e=0;e<6;e++)if(r[e].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Xa(){let r=null,e=!1,i=null,n=null;function a(e,t){i(e,t),n=r.requestAnimationFrame(a)}return{start:function(){!0!==e&&null!==i&&(n=r.requestAnimationFrame(a),e=!0)},stop:function(){r.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(e){i=e},setContext:function(e){r=e}}}function Ja(s,e){let o=e.isWebGL2,l=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),l.get(e)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);var t=l.get(e);t&&(s.deleteBuffer(t.buffer),l.delete(e))},update:function(t,e){if(t.isGLBufferAttribute){let e=l.get(t);void((!e||e.version<t.version)&&l.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}else{t.isInterleavedBufferAttribute&&(t=t.data);var r,i,n,a=l.get(t);void 0===a?l.set(t,function(e,t){var r=e.array,i=e.usage,n=s.createBuffer();s.bindBuffer(t,n),s.bufferData(t,r,i),e.onUploadCallback();let a=5126;return r instanceof Float32Array?a=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?e.isFloat16BufferAttribute?o?a=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=5123:r instanceof Int16Array?a=5122:r instanceof Uint32Array?a=5125:r instanceof Int32Array?a=5124:r instanceof Int8Array?a=5120:(r instanceof Uint8Array||r instanceof Uint8ClampedArray)&&(a=5121),{buffer:n,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(t,e)):a.version<t.version&&(r=a.buffer,e=e,n=(i=t).array,i=i.updateRange,s.bindBuffer(e,r),-1===i.count?s.bufferSubData(e,0,n):(o?s.bufferSubData(e,i.offset*n.BYTES_PER_ELEMENT,n,i.offset,i.count):s.bufferSubData(e,i.offset*n.BYTES_PER_ELEMENT,n.subarray(i.offset,i.offset+i.count)),i.count=-1),a.version=t.version)}}}}class Za extends S{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};let n=e/2,a=t/2,s=Math.floor(r),o=Math.floor(i),l=s+1,h=o+1,u=e/s,d=t/o,c=[],f=[],p=[],m=[];for(let i=0;i<h;i++){let r=i*d-a;for(let t=0;t<l;t++){let e=t*u-n;f.push(e,-r,0),p.push(0,0,1),m.push(t/s),m.push(1-i/o)}}for(let a=0;a<o;a++)for(let n=0;n<s;n++){let e=n+l*a,t=n+l*(a+1),r=n+1+l*(a+1),i=n+1+l*a;c.push(e,t,i),c.push(t,r,i)}this.setIndex(c),this.setAttribute("position",new W(f,3)),this.setAttribute("normal",new W(p,3)),this.setAttribute("uv",new W(m,2))}static fromJSON(e){return new Za(e.width,e.height,e.widthSegments,e.heightSegments)}}let M={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= specularColorMapTexelToLinear( texture2D( specularColorMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= sheenColorMapTexelToLinear( texture2D( sheenColorMap, vUv ) ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {\n\t\t\tfloat texelIndex = float( vertexIndex * stride + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV ).xyz;\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\t#ifndef USE_MORPHNORMALS\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];\n\t\t\t#else\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];\n\t\t\t#endif\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( float roughness, float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},a={common:{diffuse:{value:new m(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new v},uv2Transform:{value:new v},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new V(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new m(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new m(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new v}},sprite:{diffuse:{value:new m(16777215)},opacity:{value:1},center:{value:new V(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new v}}},Qa={basic:{uniforms:Fa([a.common,a.specularmap,a.envmap,a.aomap,a.lightmap,a.fog]),vertexShader:M.meshbasic_vert,fragmentShader:M.meshbasic_frag},lambert:{uniforms:Fa([a.common,a.specularmap,a.envmap,a.aomap,a.lightmap,a.emissivemap,a.fog,a.lights,{emissive:{value:new m(0)}}]),vertexShader:M.meshlambert_vert,fragmentShader:M.meshlambert_frag},phong:{uniforms:Fa([a.common,a.specularmap,a.envmap,a.aomap,a.lightmap,a.emissivemap,a.bumpmap,a.normalmap,a.displacementmap,a.fog,a.lights,{emissive:{value:new m(0)},specular:{value:new m(1118481)},shininess:{value:30}}]),vertexShader:M.meshphong_vert,fragmentShader:M.meshphong_frag},standard:{uniforms:Fa([a.common,a.envmap,a.aomap,a.lightmap,a.emissivemap,a.bumpmap,a.normalmap,a.displacementmap,a.roughnessmap,a.metalnessmap,a.fog,a.lights,{emissive:{value:new m(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:M.meshphysical_vert,fragmentShader:M.meshphysical_frag},toon:{uniforms:Fa([a.common,a.aomap,a.lightmap,a.emissivemap,a.bumpmap,a.normalmap,a.displacementmap,a.gradientmap,a.fog,a.lights,{emissive:{value:new m(0)}}]),vertexShader:M.meshtoon_vert,fragmentShader:M.meshtoon_frag},matcap:{uniforms:Fa([a.common,a.bumpmap,a.normalmap,a.displacementmap,a.fog,{matcap:{value:null}}]),vertexShader:M.meshmatcap_vert,fragmentShader:M.meshmatcap_frag},points:{uniforms:Fa([a.points,a.fog]),vertexShader:M.points_vert,fragmentShader:M.points_frag},dashed:{uniforms:Fa([a.common,a.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:M.linedashed_vert,fragmentShader:M.linedashed_frag},depth:{uniforms:Fa([a.common,a.displacementmap]),vertexShader:M.depth_vert,fragmentShader:M.depth_frag},normal:{uniforms:Fa([a.common,a.bumpmap,a.normalmap,a.displacementmap,{opacity:{value:1}}]),vertexShader:M.meshnormal_vert,fragmentShader:M.meshnormal_frag},sprite:{uniforms:Fa([a.sprite,a.fog]),vertexShader:M.sprite_vert,fragmentShader:M.sprite_frag},background:{uniforms:{uvTransform:{value:new v},t2D:{value:null}},vertexShader:M.background_vert,fragmentShader:M.background_frag},cube:{uniforms:Fa([a.envmap,{opacity:{value:1}}]),vertexShader:M.cube_vert,fragmentShader:M.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:M.equirect_vert,fragmentShader:M.equirect_frag},distanceRGBA:{uniforms:Fa([a.common,a.displacementmap,{referencePosition:{value:new Pe},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:M.distanceRGBA_vert,fragmentShader:M.distanceRGBA_frag},shadow:{uniforms:Fa([a.lights,a.fog,{color:{value:new m(0)},opacity:{value:1}}]),vertexShader:M.shadow_vert,fragmentShader:M.shadow_frag}};function es(n,a,r,s,i){let o=new m(0),l,h,u=0,d=null,c=0,f=null;function p(e,t){r.buffers.color.setClear(e.r,e.g,e.b,t,i)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),u=t,p(o,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,p(o,u)},render:function(e,t){let r=!1,i=!0===t.isScene?t.background:null;i&&i.isTexture&&(i=a.get(i));t=n.xr,t=t.getSession&&t.getSession();null===(i=t&&"additive"===t.environmentBlendMode?null:i)?p(o,u):i&&i.isColor&&(p(i,1),r=!0),(n.autoClear||r)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),i&&(i.isCubeTexture||i.mapping===He)?(void 0===h&&((h=new w(new ka(1,1,1),new Ba({name:"BackgroundCubeMaterial",uniforms:Oa(Qa.cube.uniforms),vertexShader:Qa.cube.vertexShader,fragmentShader:Qa.cube.fragmentShader,side:Ae,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(h)),h.material.uniforms.envMap.value=i,h.material.uniforms.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,d===i&&c===i.version&&f===n.toneMapping||(h.material.needsUpdate=!0,d=i,c=i.version,f=n.toneMapping),e.unshift(h,h.geometry,h.material,0,0,null)):i&&i.isTexture&&(void 0===l&&((l=new w(new Za(2,2),new Ba({name:"BackgroundMaterial",uniforms:Oa(Qa.background.uniforms),vertexShader:Qa.background.vertexShader,fragmentShader:Qa.background.fragmentShader,side:Oe,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(l)),!0===(l.material.uniforms.t2D.value=i).matrixAutoUpdate&&i.updateMatrix(),l.material.uniforms.uvTransform.value.copy(i.matrix),d===i&&c===i.version&&f===n.toneMapping||(l.material.needsUpdate=!0,d=i,c=i.version,f=n.toneMapping),e.unshift(l,l.geometry,l.material,0,0,null))}}}function ts(c,f,p,m){let n=c.getParameter(34921),u=m.isWebGL2?null:f.get("OES_vertex_array_object"),d=m.isWebGL2||null!==u,g={},e=x(null),v=e;function y(e){m.isWebGL2?c.bindVertexArray(e):u.bindVertexArrayOES(e)}function a(e){m.isWebGL2?c.deleteVertexArray(e):u.deleteVertexArrayOES(e)}function x(e){var t=[],r=[],i=[];for(let e=0;e<n;e++)t[e]=0,r[e]=0,i[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:r,attributeDivisors:i,object:e,attributes:{},index:null}}function b(){var r=v.newAttributes;for(let e=0,t=r.length;e<t;e++)r[e]=0}function _(e){T(e,0)}function T(e,t){var r=v.newAttributes,i=v.enabledAttributes,n=v.attributeDivisors;r[e]=1,0===i[e]&&(c.enableVertexAttribArray(e),i[e]=1),n[e]!==t&&((m.isWebGL2?c:f.get("ANGLE_instanced_arrays"))[m.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](e,t),n[e]=t)}function S(){var r=v.newAttributes,i=v.enabledAttributes;for(let e=0,t=i.length;e<t;e++)i[e]!==r[e]&&(c.disableVertexAttribArray(e),i[e]=0)}function w(e,t,r,i,n,a){!0!==m.isWebGL2||5124!==r&&5125!==r?c.vertexAttribPointer(e,t,r,i,n,a):c.vertexAttribIPointer(e,t,r,n,a)}function s(){t(),v!==e&&y((v=e).object)}function t(){e.geometry=null,e.program=null,e.wireframe=!1}return{setup:function(e,s,t,r,n){let i=!1;if(d){let e=function(e,t){var r=!0===s.wireframe;let i=g[e.id],n=(void 0===i&&(i={},g[e.id]=i),i[t.id]),a=(void 0===n&&(n={},i[t.id]=n),n[r]);return void 0===a&&(a=x(m.isWebGL2?c.createVertexArray():u.createVertexArrayOES()),n[r]=a),a}(r,t);if(v!==e&&y((v=e).object),i=function(e,t){var i=v.attributes,n=e.attributes;let a=0;for(let r in n){let e=i[r],t=n[r];if(void 0===e)return!0;if(e.attribute!==t)return!0;if(e.data!==t.data)return!0;a++}return v.attributesNum!==a||v.index!==t}(r,n)){var a=r;var o=n;var l={},h=a.attributes;let i=0;for(let r in h){let e=h[r],t={};(t.attribute=e).data&&(t.data=e.data),l[r]=t,i++}v.attributes=l,v.attributesNum=i,v.index=o}}else{let e=!0===s.wireframe;v.geometry===r.id&&v.program===t.id&&v.wireframe===e||(v.geometry=r.id,v.program=t.id,v.wireframe=e,i=!0)}!0===e.isInstancedMesh&&(i=!0),null!==n&&p.update(n,34963),i&&(function(u,t,n,d){if(!1!==m.isWebGL2||!u.isInstancedMesh&&!d.isInstancedBufferGeometry||null!==f.get("ANGLE_instanced_arrays")){b();let e=d.attributes,r=n.getAttributes(),i=t.defaultAttributeValues;for(let t in r){let h=r[t];if(0<=h.location){let l=e[t];if(void 0!==(l=void 0===l&&("instanceMatrix"===t&&u.instanceMatrix&&(l=u.instanceMatrix),"instanceColor"===t)&&u.instanceColor?u.instanceColor:l)){let s=l.normalized,o=l.itemSize,t=p.get(l);if(void 0!==t){let e=t.buffer,n=t.type,a=t.bytesPerElement;if(l.isInterleavedBufferAttribute){let t=l.data,r=t.stride,i=l.offset;if(t&&t.isInstancedInterleavedBuffer){for(let e=0;e<h.locationSize;e++)T(h.location+e,t.meshPerAttribute);!0!==u.isInstancedMesh&&void 0===d._maxInstanceCount&&(d._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<h.locationSize;e++)_(h.location+e);c.bindBuffer(34962,e);for(let e=0;e<h.locationSize;e++)w(h.location+e,o/h.locationSize,n,s,r*a,(i+o/h.locationSize*e)*a)}else{if(l.isInstancedBufferAttribute){for(let e=0;e<h.locationSize;e++)T(h.location+e,l.meshPerAttribute);!0!==u.isInstancedMesh&&void 0===d._maxInstanceCount&&(d._maxInstanceCount=l.meshPerAttribute*l.count)}else for(let e=0;e<h.locationSize;e++)_(h.location+e);c.bindBuffer(34962,e);for(let e=0;e<h.locationSize;e++)w(h.location+e,o/h.locationSize,n,s,o*a,o/h.locationSize*e*a)}}}else if(void 0!==i){let e=i[t];if(void 0!==e)switch(e.length){case 2:c.vertexAttrib2fv(h.location,e);break;case 3:c.vertexAttrib3fv(h.location,e);break;case 4:c.vertexAttrib4fv(h.location,e);break;default:c.vertexAttrib1fv(h.location,e)}}}}S()}}(e,s,t,r),null!==n)&&c.bindBuffer(34963,p.get(n).buffer)},reset:s,resetDefaultState:t,dispose:function(){for(var e in s(),g){var t,r=g[e];for(t in r){var i,n=r[t];for(i in n)a(n[i].object),delete n[i];delete r[t]}delete g[e]}},releaseStatesOfGeometry:function(e){if(void 0!==g[e.id]){var t=g[e.id];for(let e in t){var r=t[e];for(let e in r)a(r[e].object),delete r[e];delete t[e]}delete g[e.id]}},releaseStatesOfProgram:function(e){for(var t in g){t=g[t];if(void 0!==t[e.id]){var r=t[e.id];for(let e in r)a(r[e].object),delete r[e];delete t[e.id]}}},initAttributes:b,enableAttribute:_,disableUnusedAttributes:S}}function rs(a,s,o,e){let l=e.isWebGL2,h;this.setMode=function(e){h=e},this.render=function(e,t){a.drawArrays(h,e,t),o.update(t,h,1)},this.renderInstances=function(r,i,n){if(0!==n){let e,t;if(l)e=a,t="drawArraysInstanced";else if(e=s.get("ANGLE_instanced_arrays"),t="drawArraysInstancedANGLE",null===e)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");e[t](h,r,i,n),o.update(i,h,n)}}}function is(t,r,e){let i;function n(e){if("highp"===e){if(0<t.getShaderPrecisionFormat(35633,36338).precision&&0<t.getShaderPrecisionFormat(35632,36338).precision)return"highp";e="mediump"}return"mediump"===e&&0<t.getShaderPrecisionFormat(35633,36337).precision&&0<t.getShaderPrecisionFormat(35632,36337).precision?"mediump":"lowp"}var a="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let s=void 0!==e.precision?e.precision:"highp";var o=n(s),o=(o!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",o,"instead."),s=o),a||r.has("WEBGL_draw_buffers")),e=!0===e.logarithmicDepthBuffer,l=t.getParameter(34930),h=t.getParameter(35660),u=t.getParameter(3379),d=t.getParameter(34076),c=t.getParameter(34921),f=t.getParameter(36347),p=t.getParameter(36348),m=t.getParameter(36349),g=0<h,v=a||r.has("OES_texture_float");return{isWebGL2:a,drawBuffers:o,getMaxAnisotropy:function(){var e;return i=void 0===i?!0===r.has("EXT_texture_filter_anisotropic")?(e=r.get("EXT_texture_filter_anisotropic"),t.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT)):0:i},getMaxPrecision:n,precision:s,logarithmicDepthBuffer:e,maxTextures:l,maxVertexTextures:h,maxTextureSize:u,maxCubemapSize:d,maxAttributes:c,maxVertexUniforms:f,maxVaryings:p,maxFragmentUniforms:m,vertexTextures:g,floatFragmentTextures:v,floatVertexTextures:g&&v,maxSamples:a?t.getParameter(36183):0}}function ns(l){let r=this,h=null,u=0,d=!1,c=!1,o=new Ya,f=new v,p={value:null,needsUpdate:!1};function m(){p.value!==h&&(p.value=h,p.needsUpdate=0<u),r.numPlanes=u,r.numIntersection=0}function g(i,t,n,e){var a=null!==i?i.length:0;let s=null;if(0!==a){if(s=p.value,!0!==e||null===s){let e=n+4*a,r=t.matrixWorldInverse;f.getNormalMatrix(r),(null===s||s.length<e)&&(s=new Float32Array(e));for(let e=0,t=n;e!==a;++e,t+=4)o.copy(i[e]).applyMatrix4(r,f),o.normal.toArray(s,t),s[t+3]=o.constant}p.value=s,p.needsUpdate=!0}return r.numPlanes=a,r.numIntersection=0,s}this.uniform=p,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,r){var i=0!==e.length||t||0!==u||d;return d=t,h=g(e,r,0),u=e.length,i},this.beginShadows=function(){c=!0,g(null)},this.endShadows=function(){c=!1,m()},this.setState=function(e,r,i){var n=e.clippingPlanes,a=e.clipIntersection,t=e.clipShadows,s=l.get(e);if(!d||null===n||0===n.length||c&&!t)c?g(null):m();else{let e=c?0:u,t=4*e;var o=s.clippingState||null;p.value=o,o=g(n,r,t,i);for(let e=0;e!==t;++e)o[e]=h[e];s.clippingState=o,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=e}}}function as(i){let n=new WeakMap;function a(e,t){return t===Ge?e.mapping=Be:t===ze&&(e.mapping=Ue),e}function s(e){var e=e.target,t=(e.removeEventListener("dispose",s),n.get(e));void 0!==t&&(n.delete(e),t.dispose())}return{get:function(e){if(e&&e.isTexture&&!1===e.isRenderTargetTexture){var t,r=e.mapping;if(r===Ge||r===ze)return n.has(e)?a(n.get(e).texture,e.mapping):(r=e.image)&&0<r.height?(t=i.getRenderTarget(),(r=new Ha(r.height/2)).fromEquirectangularTexture(i,e),n.set(e,r),i.setRenderTarget(t),e.addEventListener("dispose",s),a(r.texture,e.mapping)):null}return e},dispose:function(){n=new WeakMap}}}Qa.physical={uniforms:Fa([Qa.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new V(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new m(0)},sheenColorMap:{value:null},sheenRoughness:{value:0},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new V},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new m(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularColor:{value:new m(1,1,1)},specularColorMap:{value:null}}]),vertexShader:M.meshphysical_vert,fragmentShader:M.meshphysical_frag};class ss extends Ua{constructor(e=-1,t=1,r=1,i=-1,n=.1,a=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=n,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,n,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2,n=r-e,a=r+e,s=i+t,o=i-t;if(null!==this.view&&this.view.enabled){let e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=e*this.view.offsetX,a=n+e*this.view.width,s-=t*this.view.offsetY,o=s-t*this.view.height}this.projectionMatrix.makeOrthographic(n,a,s,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){e=super.toJSON(e);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}ss.prototype.isOrthographicCamera=!0;class os extends Ba{constructor(e){super(e),this.type="RawShaderMaterial"}}os.prototype.isRawShaderMaterial=!0;let ls=Math.pow(2,8),hs=[.125,.215,.35,.446,.526,.582],us=5+hs.length,ds={[De]:0,[Er]:1,[Ar]:2,[Rr]:3,[Cr]:4,[Dr]:5,[Mr]:6},cs=new ss,{_lodPlanes:fs,_sizeLods:ps,_sigmas:ms}=function(){let r=[],i=[],n=[],a=8;for(let t=0;t<us;t++){var s=Math.pow(2,a);i.push(s);let e=1/s;4<t?e=hs[t-8+4-1]:0==t&&(e=0),n.push(e);var s=1/(s-1),o=-s/2,s=1+s/2,l=[o,o,s,o,s,s,o,o,s,s,o,s],h=new Float32Array(108),u=new Float32Array(72),d=new Float32Array(36);for(let i=0;i<6;i++){let e=i%3*2/3-1,t=2<i?0:-1,r=[e,t,0,e+2/3,t,0,e+2/3,1+t,0,e,t,0,e+2/3,1+t,0,e,1+t,0];h.set(r,18*i),u.set(l,12*i);var c=[i,i,i,i,i,i];d.set(c,6*i)}o=new S;o.setAttribute("position",new E(h,3)),o.setAttribute("uv",new E(u,2)),o.setAttribute("faceIndex",new E(d,1)),r.push(o),4<a&&a--}return{_lodPlanes:r,_sizeLods:i,_sigmas:n}}(),gs=new m,vs=null,ys=(1+Math.sqrt(5))/2,xs=1/ys,bs=[new Pe(1,1,1),new Pe(-1,1,1),new Pe(1,1,-1),new Pe(-1,1,-1),new Pe(0,ys,xs),new Pe(0,ys,-xs),new Pe(xs,0,ys),new Pe(-xs,0,ys),new Pe(ys,xs,0),new Pe(-ys,xs,0)];class _s{constructor(e){var t;this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=(e=new Float32Array(20),t=new Pe(0,1,0),new os({name:"SphericalGaussianBlur",defines:{n:20},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:t},inputEncoding:{value:ds[De]},outputEncoding:{value:ds[De]}},vertexShader:Ms(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			${As()}

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:q,depthTest:!1,depthWrite:!1})),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100){vs=this._renderer.getRenderTarget();var n=this._allocateTargets();return this._sceneToCubeUV(e,r,i,n),0<t&&this._blur(n,0,0,t),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=Es(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=ws(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<fs.length;e++)fs[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(vs),e.scissorTest=!1,Ss(e,0,0,e.width,e.height)}_fromTexture(e){vs=this._renderer.getRenderTarget();var t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){var t={magFilter:Re,minFilter:Re,generateMipmaps:!1,type:et,format:gt,encoding:void 0===(t=e)||t.type!==et||t.encoding!==De&&t.encoding!==Er&&t.encoding!==Mr?Ar:e.encoding,depthBuffer:!1},r=Ts(t);return r.depthBuffer=!e,this._pingPongRenderTarget=Ts(t),r}_compileMaterial(e){e=new w(fs[0],e);this._renderer.compile(e,cs)}_sceneToCubeUV(r,e,t,i){var n=new F(90,1,e,t),a=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],o=this._renderer,e=o.autoClear,t=o.outputEncoding,l=o.toneMapping,h=(o.getClearColor(gs),o.toneMapping=Ne,o.outputEncoding=De,o.autoClear=!1,new Qn({name:"PMREM.Background",side:Ae,depthWrite:!1,depthTest:!1})),u=new w(new ka,h);let d=!1;var c=r.background;c?c.isColor&&(h.color.copy(c),r.background=null,d=!0):(h.color.copy(gs),d=!0);for(let t=0;t<6;t++){let e=t%3;0==e?(n.up.set(0,a[t],0),n.lookAt(s[t],0,0)):1==e?(n.up.set(0,0,a[t]),n.lookAt(0,s[t],0)):(n.up.set(0,a[t],0),n.lookAt(0,0,s[t])),Ss(i,e*ls,2<t?ls:0,ls,ls),o.setRenderTarget(i),d&&o.render(u,n),o.render(r,n)}u.geometry.dispose(),u.material.dispose(),o.toneMapping=l,o.outputEncoding=t,o.autoClear=e,r.background=c}_setEncoding(e,t){!0===this._renderer.capabilities.isWebGL2&&t.format===Ce&&t.type===et&&t.encoding===Er?e.value=ds[De]:e.value=ds[t.encoding]}_textureToCubeUV(e,t){var r=this._renderer,i=e.mapping===Be||e.mapping===Ue,n=(i?null==this._cubemapShader&&(this._cubemapShader=Es()):null==this._equirectShader&&(this._equirectShader=ws()),i?this._cubemapShader:this._equirectShader),a=new w(fs[0],n),n=n.uniforms;n.envMap.value=e,i||n.texelSize.value.set(1/e.image.width,1/e.image.height),this._setEncoding(n.inputEncoding,e),this._setEncoding(n.outputEncoding,t.texture),Ss(t,0,0,3*ls,2*ls),r.setRenderTarget(t),r.render(a,cs)}_applyPMREM(i){let e=this._renderer,t=e.autoClear;e.autoClear=!1;for(let r=1;r<us;r++){let e=Math.sqrt(ms[r]*ms[r]-ms[r-1]*ms[r-1]),t=bs[(r-1)%bs.length];this._blur(i,r-1,r,e,t)}e.autoClear=t}_blur(e,t,r,i,n){var a=this._pingPongRenderTarget;this._halfBlur(e,a,t,r,i,"latitudinal",n),this._halfBlur(a,e,r,r,i,"longitudinal",n)}_halfBlur(e,t,r,i,n,a,s){var o=this._renderer,l=this._blurMaterial,h=("latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!"),new w(fs[i],l)),l=l.uniforms,u=ps[r]-1,u=isFinite(n)?Math.PI/(2*u):2*Math.PI/39,d=n/u,c=isFinite(n)?1+Math.floor(3*d):20,f=(20<c&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${c} samples when the maximum is set to 20`),[]);let p=0;for(let r=0;r<20;++r){let e=r/d,t=Math.exp(-e*e/2);f.push(t),0==r?p+=t:r<c&&(p+=2*t)}for(let e=0;e<f.length;e++)f[e]=f[e]/p;l.envMap.value=e.texture,l.samples.value=c,l.weights.value=f,l.latitudinal.value="latitudinal"===a,s&&(l.poleAxis.value=s),l.dTheta.value=u,l.mipInt.value=8-r,this._setEncoding(l.inputEncoding,e.texture),this._setEncoding(l.outputEncoding,e.texture);n=ps[i];Ss(t,3*Math.max(0,ls-2*n),(0===i?0:2*ls)+2*n*(4<i?i-8+4:0),3*n,2*n),o.setRenderTarget(t),o.render(h,cs)}}function Ts(e){e=new Di(3*ls,3*ls,e);return e.texture.mapping=He,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function Ss(e,t,r,i,n){e.viewport.set(t,r,i,n),e.scissor.set(t,r,i,n)}function ws(){var e=new V(1,1);return new os({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:ds[De]},outputEncoding:{value:ds[De]}},vertexShader:Ms(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			${As()}

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:q,depthTest:!1,depthWrite:!1})}function Es(){return new os({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:ds[De]},outputEncoding:{value:ds[De]}},vertexShader:Ms(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			${As()}

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:q,depthTest:!1,depthWrite:!1})}function Ms(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function As(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}function Ls(n){let a=new WeakMap,s=null;function o(e){var e=e.target,t=(e.removeEventListener("dispose",o),a.get(e));void 0!==t&&(a.delete(e),t.dispose())}return{get:function(e){if(e&&e.isTexture&&!1===e.isRenderTargetTexture){var t,r=e.mapping,i=r===Ge||r===ze,r=r===Be||r===Ue;if(i||r)return a.has(e)?a.get(e).texture:(t=e.image,i&&t&&0<t.height||r&&t&&function(t){let r=0;for(let e=0;e<6;e++)void 0!==t[e]&&r++;return 6===r}(t)?(r=n.getRenderTarget(),null===s&&(s=new _s(n)),t=i?s.fromEquirectangular(e):s.fromCubemap(e),a.set(e,t),n.setRenderTarget(r),e.addEventListener("dispose",o),t.texture):null)}return e},dispose:function(){a=new WeakMap,null!==s&&(s.dispose(),s=null)}}}function Rs(r){let i={};function n(e){if(void 0!==i[e])return i[e];let t;switch(e){case"WEBGL_depth_texture":t=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":t=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":t=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":t=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:t=r.getExtension(e)}return i[e]=t}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(e){var t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Cs(e,o,r,i){let n={},l=new WeakMap;function a(e){var t=e.target;null!==t.index&&o.remove(t.index);for(let e in t.attributes)o.remove(t.attributes[e]);t.removeEventListener("dispose",a),delete n[t.id];e=l.get(t);e&&(o.remove(e),l.delete(t)),i.releaseStatesOfGeometry(t),!0===t.isInstancedBufferGeometry&&delete t._maxInstanceCount,r.memory.geometries--}function s(e){let a=[],t=e.index,r=e.attributes.position,i=0;if(null!==t){let n=t.array;i=t.version;for(let i=0,e=n.length;i<e;i+=3){let e=n[i+0],t=n[i+1],r=n[i+2];a.push(e,t,t,r,r,e)}}else{let t=r.array;i=r.version;for(let i=0,e=t.length/3-1;i<e;i+=3){let e=i+0,t=i+1,r=i+2;a.push(e,t,t,r,r,e)}}var n=new(65535<Ti(a)?oa:aa)(a,1),s=(n.version=i,l.get(e));s&&o.remove(s),l.set(e,n)}return{get:function(e,t){return!0!==n[t.id]&&(t.addEventListener("dispose",a),n[t.id]=!0,r.memory.geometries++),t},update:function(e){let t=e.attributes;for(let e in t)o.update(t[e],34962);var i=e.morphAttributes;for(let e in i){let r=i[e];for(let e=0,t=r.length;e<t;e++)o.update(r[e],34962)}},getWireframeAttribute:function(e){var t,r=l.get(e);return(!r||null!==(t=e.index)&&r.version<t.version)&&s(e),l.get(e)}}}function Ds(a,s,o,e){let l=e.isWebGL2,h,u,d;this.setMode=function(e){h=e},this.setIndex=function(e){u=e.type,d=e.bytesPerElement},this.render=function(e,t){a.drawElements(h,t,u,e*d),o.update(t,h,1)},this.renderInstances=function(r,i,n){if(0!==n){let e,t;if(l)e=a,t="drawElementsInstanced";else if(e=s.get("ANGLE_instanced_arrays"),t="drawElementsInstancedANGLE",null===e)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");e[t](h,i,u,r*d,n),o.update(i,h,n)}}}function Is(e){let i={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:i,programs:null,autoReset:!0,reset:function(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0},update:function(e,t,r){switch(i.calls++,t){case 4:i.triangles+=r*(e/3);break;case 1:i.lines+=r*(e/2);break;case 3:i.lines+=r*(e-1);break;case 2:i.lines+=r*e;break;case 0:i.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",t)}}}}class Ps extends u{constructor(e=null,t=1,r=1,i=1){super(null),this.image={data:e,width:t,height:r,depth:i},this.magFilter=Re,this.minFilter=Re,this.wrapR=Le,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}function ks(e,t){return e[0]-t[0]}function Os(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Fs(e,t){let r=1;t=(t.isInterleavedBufferAttribute?t.data:t).array;t instanceof Int8Array?r=127:t instanceof Int16Array?r=32767:t instanceof Int32Array?r=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",t),e.divideScalar(r)}function Ns(h,c,r){let f={},p=new Float32Array(8),m=new WeakMap,g=new Pe,v=[];for(let e=0;e<8;e++)v[e]=[e,0];return{update:function(e,u,t,o){let l=e.morphTargetInfluences;if(!0===c.isWebGL2){let i=u.morphAttributes.position.length,n=m.get(u);if(void 0===n||n.count!==i){void 0!==n&&n.texture.dispose();let a=void 0!==u.morphAttributes.normal,t=u.morphAttributes.position,s=u.morphAttributes.normal||[],e=!0==a?2:1,o=u.attributes.position.count*e,l=1,h=(o>c.maxTextureSize&&(l=Math.ceil(o/c.maxTextureSize),o=c.maxTextureSize),new Float32Array(o*l*4*i)),r=new Ps(h,o,l,i);r.format=Ce,r.type=st;var d=4*e;for(let e=0;e<i;e++){let r=t[e],i=s[e],n=o*l*4*e;for(let t=0;t<r.count;t++){g.fromBufferAttribute(r,t),!0===r.normalized&&Fs(g,r);let e=t*d;h[n+e]=g.x,h[n+e+1]=g.y,h[n+e+2]=g.z,!(h[n+e+3]=0)==a&&(g.fromBufferAttribute(i,t),!0===i.normalized&&Fs(g,i),h[n+e+4]=g.x,h[n+e+5]=g.y,h[n+e+6]=g.z,h[n+e+7]=0)}}n={count:i,texture:r,size:new V(o,l)},m.set(u,n)}let t=0;for(let e=0;e<l.length;e++)t+=l[e];let e=u.morphTargetsRelative?1:1-t;o.getUniforms().setValue(h,"morphTargetBaseInfluence",e),o.getUniforms().setValue(h,"morphTargetInfluences",l),o.getUniforms().setValue(h,"morphTargetsTexture",n.texture,r),o.getUniforms().setValue(h,"morphTargetsTextureSize",n.size)}else{let r=void 0===l?0:l.length,i=f[u.id];if(void 0===i||i.length!==r){i=[];for(let e=0;e<r;e++)i[e]=[e,0];f[u.id]=i}for(let t=0;t<r;t++){let e=i[t];e[0]=t,e[1]=l[t]}i.sort(Os);for(let e=0;e<8;e++)e<r&&i[e][1]?(v[e][0]=i[e][0],v[e][1]=i[e][1]):(v[e][0]=Number.MAX_SAFE_INTEGER,v[e][1]=0);v.sort(ks);let n=u.morphAttributes.position,a=u.morphAttributes.normal,s=0;for(let i=0;i<8;i++){let e=v[i],t=e[0],r=e[1];t!==Number.MAX_SAFE_INTEGER&&r?(n&&u.getAttribute("morphTarget"+i)!==n[t]&&u.setAttribute("morphTarget"+i,n[t]),a&&u.getAttribute("morphNormal"+i)!==a[t]&&u.setAttribute("morphNormal"+i,a[t]),p[i]=r,s+=r):(n&&!0===u.hasAttribute("morphTarget"+i)&&u.deleteAttribute("morphTarget"+i),a&&!0===u.hasAttribute("morphNormal"+i)&&u.deleteAttribute("morphNormal"+i),p[i]=0)}let e=u.morphTargetsRelative?1:1-s;o.getUniforms().setValue(h,"morphTargetBaseInfluence",e),o.getUniforms().setValue(h,"morphTargetInfluences",p)}}}}function Bs(e,i,n,a){let s=new WeakMap;function o(e){e=e.target;e.removeEventListener("dispose",o),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(e){var t=a.render.frame,r=e.geometry,r=i.get(e,r);return s.get(r)!==t&&(i.update(r),s.set(r,t)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",o)&&e.addEventListener("dispose",o),n.update(e.instanceMatrix,34962),null!==e.instanceColor)&&n.update(e.instanceColor,34962),r},dispose:function(){s=new WeakMap}}}Ps.prototype.isDataTexture2DArray=!0;class Us extends u{constructor(e=null,t=1,r=1,i=1){super(null),this.image={data:e,width:t,height:r,depth:i},this.magFilter=Re,this.minFilter=Re,this.wrapR=Le,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Us.prototype.isDataTexture3D=!0;let Gs=new u,zs=new Ps,Hs=new Us,Vs=new za,Ws=[],js=[],Ys=new Float32Array(16),$s=new Float32Array(9),qs=new Float32Array(4);function Ks(r,i,n){var e=r[0];if(e<=0||0<e)return r;var t=i*n;let a=Ws[t];if(void 0===a&&(a=new Float32Array(t),Ws[t]=a),0!==i){e.toArray(a,0);for(let e=1,t=0;e!==i;++e)t+=n,r[e].toArray(a,t)}return a}function Xs(r,i){if(r.length===i.length){for(let e=0,t=r.length;e<t;e++)if(r[e]!==i[e])return;return 1}}function Js(r,i){for(let e=0,t=i.length;e<t;e++)r[e]=i[e]}function Zs(t,r){let i=js[r];void 0===i&&(i=new Int32Array(r),js[r]=i);for(let e=0;e!==r;++e)i[e]=t.allocateTextureUnit();return i}function Qs(e,t){var r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function eo(e,t){var r=this.cache;void 0!==t.x?r[0]===t.x&&r[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y):Xs(r,t)||(e.uniform2fv(this.addr,t),Js(r,t))}function to(e,t){var r=this.cache;void 0!==t.x?r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z):void 0!==t.r?r[0]===t.r&&r[1]===t.g&&r[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b):Xs(r,t)||(e.uniform3fv(this.addr,t),Js(r,t))}function ro(e,t){var r=this.cache;void 0!==t.x?r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w):Xs(r,t)||(e.uniform4fv(this.addr,t),Js(r,t))}function io(e,t){var r=this.cache,i=t.elements;void 0===i?Xs(r,t)||(e.uniformMatrix2fv(this.addr,!1,t),Js(r,t)):Xs(r,i)||(qs.set(i),e.uniformMatrix2fv(this.addr,!1,qs),Js(r,i))}function no(e,t){var r=this.cache,i=t.elements;void 0===i?Xs(r,t)||(e.uniformMatrix3fv(this.addr,!1,t),Js(r,t)):Xs(r,i)||($s.set(i),e.uniformMatrix3fv(this.addr,!1,$s),Js(r,i))}function ao(e,t){var r=this.cache,i=t.elements;void 0===i?Xs(r,t)||(e.uniformMatrix4fv(this.addr,!1,t),Js(r,t)):Xs(r,i)||(Ys.set(i),e.uniformMatrix4fv(this.addr,!1,Ys),Js(r,i))}function so(e,t){var r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function oo(e,t){var r=this.cache;Xs(r,t)||(e.uniform2iv(this.addr,t),Js(r,t))}function lo(e,t){var r=this.cache;Xs(r,t)||(e.uniform3iv(this.addr,t),Js(r,t))}function ho(e,t){var r=this.cache;Xs(r,t)||(e.uniform4iv(this.addr,t),Js(r,t))}function uo(e,t){var r=this.cache;r[0]!==t&&(e.uniform1ui(this.addr,t),r[0]=t)}function co(e,t){var r=this.cache;Xs(r,t)||(e.uniform2uiv(this.addr,t),Js(r,t))}function fo(e,t){var r=this.cache;Xs(r,t)||(e.uniform3uiv(this.addr,t),Js(r,t))}function po(e,t){var r=this.cache;Xs(r,t)||(e.uniform4uiv(this.addr,t),Js(r,t))}function mo(e,t,r){var i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.safeSetTexture2D(t||Gs,n)}function go(e,t,r){var i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture3D(t||Hs,n)}function vo(e,t,r){var i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.safeSetTextureCube(t||Vs,n)}function yo(e,t,r){var i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture2DArray(t||zs,n)}function xo(e,t){e.uniform1fv(this.addr,t)}function bo(e,t){t=Ks(t,this.size,2);e.uniform2fv(this.addr,t)}function _o(e,t){t=Ks(t,this.size,3);e.uniform3fv(this.addr,t)}function To(e,t){t=Ks(t,this.size,4);e.uniform4fv(this.addr,t)}function So(e,t){t=Ks(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,t)}function wo(e,t){t=Ks(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,t)}function Eo(e,t){t=Ks(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,t)}function Mo(e,t){e.uniform1iv(this.addr,t)}function Ao(e,t){e.uniform2iv(this.addr,t)}function Lo(e,t){e.uniform3iv(this.addr,t)}function Ro(e,t){e.uniform4iv(this.addr,t)}function Co(e,t){e.uniform1uiv(this.addr,t)}function Do(e,t){e.uniform2uiv(this.addr,t)}function Io(e,t){e.uniform3uiv(this.addr,t)}function Po(e,t){e.uniform4uiv(this.addr,t)}function ko(e,t,r){var i=t.length,n=Zs(r,i);e.uniform1iv(this.addr,n);for(let e=0;e!==i;++e)r.safeSetTexture2D(t[e]||Gs,n[e])}function Oo(e,t,r){var i=t.length,n=Zs(r,i);e.uniform1iv(this.addr,n);for(let e=0;e!==i;++e)r.safeSetTextureCube(t[e]||Vs,n[e])}function Fo(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=function(){switch(t.type){case 5126:return Qs;case 35664:return eo;case 35665:return to;case 35666:return ro;case 35674:return io;case 35675:return no;case 35676:return ao;case 5124:case 35670:return so;case 35667:case 35671:return oo;case 35668:case 35672:return lo;case 35669:case 35673:return ho;case 5125:return uo;case 36294:return co;case 36295:return fo;case 36296:return po;case 35678:case 36198:case 36298:case 36306:case 35682:return mo;case 35679:case 36299:case 36307:return go;case 35680:case 36300:case 36308:case 36293:return vo;case 36289:case 36303:case 36311:case 36292:return yo}}()}function No(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=function(){switch(t.type){case 5126:return xo;case 35664:return bo;case 35665:return _o;case 35666:return To;case 35674:return So;case 35675:return wo;case 35676:return Eo;case 5124:case 35670:return Mo;case 35667:case 35671:return Ao;case 35668:case 35672:return Lo;case 35669:case 35673:return Ro;case 5125:return Co;case 36294:return Do;case 36295:return Io;case 36296:return Po;case 35678:case 36198:case 36298:case 36306:case 35682:return ko;case 35680:case 36300:case 36308:case 36293:return Oo}}()}function Bo(e){this.id=e,this.seq=[],this.map={}}No.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Js(t,e)},Bo.prototype.setValue=function(r,i,n){var a=this.seq;for(let e=0,t=a.length;e!==t;++e){var s=a[e];s.setValue(r,i[s.id],n)}};let Uo=/(\w+)(\])?(\[|\.)?/g;function Go(e,t){e.seq.push(t),e.map[t.id]=t}function zo(r,i){this.seq=[],this.map={};let e=r.getProgramParameter(i,35718);for(let t=0;t<e;++t){let e=r.getActiveUniform(i,t);d=u=h=l=o=s=a=n=void 0;var n=e,a=r.getUniformLocation(i,e.name),s=this,o=n.name,l=o.length;for(Uo.lastIndex=0;;){var h=Uo.exec(o),u=Uo.lastIndex;let t=h[1];var d="]"===h[2],h=h[3];if(d&&(t|=0),void 0===h||"["===h&&u+2===l){Go(s,new(void 0===h?Fo:No)(t,n,a));break}{let e=s.map[t];void 0===e&&Go(s,e=new Bo(t)),s=e}}}}function Ho(e,t,r){t=e.createShader(t);return e.shaderSource(t,r),e.compileShader(t),t}zo.prototype.setValue=function(e,t,r,i){t=this.map[t];void 0!==t&&t.setValue(e,r,i)},zo.prototype.setOptional=function(e,t,r){t=t[r];void 0!==t&&this.setValue(e,r,t)},zo.upload=function(r,i,n,a){for(let e=0,t=i.length;e!==t;++e){var s=i[e],o=n[s.id];!1!==o.needsUpdate&&s.setValue(r,o.value,a)}},zo.seqWithValue=function(r,i){var n=[];for(let e=0,t=r.length;e!==t;++e){var a=r[e];a.id in i&&n.push(a)}return n};let Vo=0;function Wo(e){switch(e){case De:return["Linear","( value )"];case Er:return["sRGB","( value )"];case Ar:return["RGBE","( value )"];case Rr:return["RGBM","( value, 7.0 )"];case Cr:return["RGBM","( value, 16.0 )"];case Dr:return["RGBD","( value, 256.0 )"];case Mr:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case Lr:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function jo(e,r,t){var i=e.getShaderParameter(r,35713),n=e.getShaderInfoLog(r).trim();return i&&""===n?"":t.toUpperCase()+"\n\n"+n+"\n\n"+function(){var t=e.getShaderSource(r).split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}()}function Yo(e,t){t=Wo(t);return"vec4 "+e+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function $o(e){return""!==e}function qo(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Ko(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}let Xo=/^[ \t]*#include +<([\w\d./]+)>/gm;function Jo(e){return e.replace(Xo,Zo)}function Zo(e,t){var r=M[t];if(void 0===r)throw new Error("Can not resolve #include <"+t+">");return Jo(r)}let Qo=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,el=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function tl(e){return e.replace(el,il).replace(Qo,rl)}function rl(e,t,r,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),il(0,t,r,i)}function il(e,t,r,i){let n="";for(let e=parseInt(t);e<parseInt(r);e++)n+=i.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return n}function nl(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function al(e,t,r,i){let a=e.getContext(),n=r.defines;var s=r.vertexShader,o=r.fragmentShader;let l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===C?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===D?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===I&&(t="SHADOWMAP_TYPE_VSM"),t}(r),h=function(){let e="ENVMAP_TYPE_CUBE";if(r.envMap)switch(r.envMapMode){case Be:case Ue:e="ENVMAP_TYPE_CUBE";break;case He:case Ve:e="ENVMAP_TYPE_CUBE_UV"}return e}(),u=function(){let e="ENVMAP_MODE_REFLECTION";if(r.envMap)switch(r.envMapMode){case Ue:case Ve:e="ENVMAP_MODE_REFRACTION"}return e}(),d=function(){let e="ENVMAP_BLENDING_NONE";if(r.envMap)switch(r.combine){case O:e="ENVMAP_BLENDING_MULTIPLY";break;case N:e="ENVMAP_BLENDING_MIX";break;case U:e="ENVMAP_BLENDING_ADD"}return e}(),c=0<e.gammaFactor?e.gammaFactor:1,f=r.isWebGL2?"":[r.extensionDerivatives||r.envMapCubeUV||r.bumpMap||r.tangentSpaceNormalMap||r.clearcoatNormalMap||r.flatShading||"physical"===r.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(r.extensionFragDepth||r.logarithmicDepthBuffer)&&r.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",r.extensionDrawBuffers&&r.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(r.extensionShaderTextureLOD||r.envMap||r.transmission)&&r.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter($o).join("\n"),p=function(e){var t,r=[];for(t in e){var i=e[t];!1!==i&&r.push("#define "+t+" "+i)}return r.join("\n")}(n),m=a.createProgram(),g,v,y=r.glslVersion?"#version "+r.glslVersion+"\n":"";r.isRawShaderMaterial?(0<(g=[p].filter($o).join("\n")).length&&(g+="\n"),0<(v=[f,p].filter($o).join("\n")).length&&(v+="\n")):(g=[nl(r),"#define SHADER_NAME "+r.shaderName,p,r.instancing?"#define USE_INSTANCING":"",r.instancingColor?"#define USE_INSTANCING_COLOR":"",r.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+c,"#define MAX_BONES "+r.maxBones,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+u:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.displacementMap&&r.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",r.specularColorMap?"#define USE_SPECULARCOLORMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.sheenColorMap?"#define USE_SHEENCOLORMAP":"",r.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&!1===r.flatShading?"#define USE_MORPHNORMALS":"",r.morphTargets&&r.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",r.morphTargets&&r.isWebGL2?"#define MORPHTARGETS_COUNT "+r.morphTargetsCount:"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+l:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter($o).join("\n"),v=[f,nl(r),"#define SHADER_NAME "+r.shaderName,p,"#define GAMMA_FACTOR "+c,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.matcap?"#define USE_MATCAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+h:"",r.envMap?"#define "+u:"",r.envMap?"#define "+d:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoat?"#define USE_CLEARCOAT":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",r.specularColorMap?"#define USE_SPECULARCOLORMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.alphaTest?"#define USE_ALPHATEST":"",r.sheen?"#define USE_SHEEN":"",r.sheenColorMap?"#define USE_SHEENCOLORMAP":"",r.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors||r.instancingColor?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+l:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(r.extensionShaderTextureLOD||r.envMap)&&r.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",r.toneMapping!==Ne?"#define TONE_MAPPING":"",r.toneMapping!==Ne?M.tonemapping_pars_fragment:"",r.toneMapping!==Ne?function(e,t){let r;switch(t){case G:r="Linear";break;case z:r="Reinhard";break;case H:r="OptimizedCineon";break;case we:r="ACESFilmic";break;case Ee:r="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),r="Linear"}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}("toneMapping",r.toneMapping):"",r.dithering?"#define DITHERING":"",r.format===ft?"#define OPAQUE":"",M.encodings_pars_fragment,r.map?Yo("mapTexelToLinear",r.mapEncoding):"",r.matcap?Yo("matcapTexelToLinear",r.matcapEncoding):"",r.envMap?Yo("envMapTexelToLinear",r.envMapEncoding):"",r.emissiveMap?Yo("emissiveMapTexelToLinear",r.emissiveMapEncoding):"",r.specularColorMap?Yo("specularColorMapTexelToLinear",r.specularColorMapEncoding):"",r.sheenColorMap?Yo("sheenColorMapTexelToLinear",r.sheenColorMapEncoding):"",r.lightMap?Yo("lightMapTexelToLinear",r.lightMapEncoding):"",(x="linearToOutputTexel",b=Wo(b=r.outputEncoding),"vec4 "+x+"( vec4 value ) { return LinearTo"+b[0]+b[1]+"; }"),r.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter($o).join("\n")),s=Ko(qo(Jo(s),r),r),o=Ko(qo(Jo(o),r),r),s=tl(s),o=tl(o),r.isWebGL2&&!0!==r.isRawShaderMaterial&&(y="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",r.glslVersion===li?"":"out highp vec4 pc_fragColor;",r.glslVersion===li?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);var x=y+v+o,b=Ho(a,35633,y+g+s),o=Ho(a,35632,x);if(a.attachShader(m,b),a.attachShader(m,o),void 0!==r.index0AttributeName?a.bindAttribLocation(m,0,r.index0AttributeName):!0===r.morphTargets&&a.bindAttribLocation(m,0,"position"),a.linkProgram(m),e.debug.checkShaderErrors){let r=a.getProgramInfoLog(m).trim(),e=a.getShaderInfoLog(b).trim(),t=a.getShaderInfoLog(o).trim(),i=!0,n=!0;if(!1===a.getProgramParameter(m,35714)){i=!1;let e=jo(a,b,"vertex"),t=jo(a,o,"fragment");console.error("THREE.WebGLProgram: Shader Error "+a.getError()+" - VALIDATE_STATUS "+a.getProgramParameter(m,35715)+"\n\nProgram Info Log: "+r+"\n"+e+"\n"+t)}else""!==r?console.warn("THREE.WebGLProgram: Program Info Log:",r):""!==e&&""!==t||(n=!1);n&&(this.diagnostics={runnable:i,programLog:r,vertexShader:{log:e,prefix:g},fragmentShader:{log:t,prefix:v}})}let _,T;return a.deleteShader(b),a.deleteShader(o),this.getUniforms=function(){return _=void 0===_?new zo(a,m):_},this.getAttributes=function(){return T=void 0===T?function(n,a){let s={},e=n.getProgramParameter(a,35721);for(let i=0;i<e;i++){let e=n.getActiveAttrib(a,i),t=e.name,r=1;35674===e.type&&(r=2),35675===e.type&&(r=3),35676===e.type&&(r=4),s[t]={type:e.type,location:n.getAttribLocation(a,t),locationSize:r}}return s}(a,m):T},this.destroy=function(){i.releaseStatesOfProgram(this),a.deleteProgram(m),this.program=void 0},this.name=r.shaderName,this.id=Vo++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=b,this.fragmentShader=o,this}function sl(f,p,m,g,v,t,y){let n=[],x=v.isWebGL2,b=v.logarithmicDepthBuffer,_=v.floatVertexTextures,T=v.maxVertexUniforms,S=v.vertexTextures,w=v.precision,E={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},i=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap",,"roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","morphTargetsCount","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","specularIntensityMap","specularColorMap","specularColorMapEncoding","transmission","transmissionMap","thicknessMap","sheen","sheenColorMap","sheenColorMapEncoding","sheenRoughnessMap"];function M(e){let t;return t=e&&e.isTexture?e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e.texture.encoding):De,t=x&&e&&e.isTexture&&e.format===Ce&&e.type===et&&e.encoding===Er?De:t}return{getParameters:function(e,t,r,i,n){var a=i.fog,i=e.isMeshStandardMaterial?i.environment:null,i=(e.isMeshStandardMaterial?m:p).get(e.envMap||i),s=E[e.type],o=n.isSkinnedMesh?function(e){var i=e.skeleton.bones;if(_)return 1024;{let e=T,t=Math.floor((e-20)/4),r=Math.min(t,i.length);return r<i.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+i.length+" bones. This GPU supports "+r+"."),0):r}}(n):0;let l,h;if(null!==e.precision&&(w=v.getMaxPrecision(e.precision))!==e.precision&&console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",w,"instead."),s){let e=Qa[s];l=e.vertexShader,h=e.fragmentShader}else l=e.vertexShader,h=e.fragmentShader;var u=f.getRenderTarget(),d=0<e.alphaTest,c=0<e.clearcoat;return{isWebGL2:x,shaderID:s,shaderName:e.type,vertexShader:l,fragmentShader:h,defines:e.defines,isRawShaderMaterial:!0===e.isRawShaderMaterial,glslVersion:e.glslVersion,precision:w,instancing:!0===n.isInstancedMesh,instancingColor:!0===n.isInstancedMesh&&null!==n.instanceColor,supportsVertexTextures:S,outputEncoding:null!==u?M(u.texture):f.outputEncoding,map:!!e.map,mapEncoding:M(e.map),matcap:!!e.matcap,matcapEncoding:M(e.matcap),envMap:!!i,envMapMode:i&&i.mapping,envMapEncoding:M(i),envMapCubeUV:!!i&&(i.mapping===He||i.mapping===Ve),lightMap:!!e.lightMap,lightMapEncoding:M(e.lightMap),aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:M(e.emissiveMap),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,objectSpaceNormalMap:e.normalMapType===Or,tangentSpaceNormalMap:e.normalMapType===kr,clearcoat:c,clearcoatMap:c&&!!e.clearcoatMap,clearcoatRoughnessMap:c&&!!e.clearcoatRoughnessMap,clearcoatNormalMap:c&&!!e.clearcoatNormalMap,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,specularIntensityMap:!!e.specularIntensityMap,specularColorMap:!!e.specularColorMap,specularColorMapEncoding:M(e.specularColorMap),alphaMap:!!e.alphaMap,alphaTest:d,gradientMap:!!e.gradientMap,sheen:0<e.sheen,sheenColorMap:!!e.sheenColorMap,sheenColorMapEncoding:M(e.sheenColorMap),sheenRoughnessMap:!!e.sheenRoughnessMap,transmission:0<e.transmission,transmissionMap:!!e.transmissionMap,thicknessMap:!!e.thicknessMap,combine:e.combine,vertexTangents:!!e.normalMap&&!!n.geometry&&!!n.geometry.attributes.tangent,vertexColors:e.vertexColors,vertexAlphas:!0===e.vertexColors&&!!n.geometry&&!!n.geometry.attributes.color&&4===n.geometry.attributes.color.itemSize,vertexUvs:!!e.map||!!e.bumpMap||!!e.normalMap||!!e.specularMap||!!e.alphaMap||!!e.emissiveMap||!!e.roughnessMap||!!e.metalnessMap||!!e.clearcoatMap||!!e.clearcoatRoughnessMap||!!e.clearcoatNormalMap||!!e.displacementMap||!!e.transmissionMap||!!e.thicknessMap||!!e.specularIntensityMap||!!e.specularColorMap||!!e.sheenColorMap||e.sheenRoughnessMap,uvsVertexOnly:!(e.map||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e.emissiveMap||e.roughnessMap||e.metalnessMap||e.clearcoatNormalMap||0<e.transmission||e.transmissionMap||e.thicknessMap||e.specularIntensityMap||e.specularColorMap||0<!!e.sheen||e.sheenColorMap||e.sheenRoughnessMap||!e.displacementMap),fog:!!a,useFog:e.fog,fogExp2:a&&a.isFogExp2,flatShading:!!e.flatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:b,skinning:!0===n.isSkinnedMesh&&0<o,maxBones:o,useVertexTexture:_,morphTargets:!!n.geometry&&!!n.geometry.morphAttributes.position,morphNormals:!!n.geometry&&!!n.geometry.morphAttributes.normal,morphTargetsCount:n.geometry&&n.geometry.morphAttributes.position?n.geometry.morphAttributes.position.length:0,numDirLights:t.directional.length,numPointLights:t.point.length,numSpotLights:t.spot.length,numRectAreaLights:t.rectArea.length,numHemiLights:t.hemi.length,numDirLightShadows:t.directionalShadowMap.length,numPointLightShadows:t.pointShadowMap.length,numSpotLightShadows:t.spotShadowMap.length,numClippingPlanes:y.numPlanes,numClipIntersection:y.numIntersection,format:e.format,dithering:e.dithering,shadowMapEnabled:f.shadowMap.enabled&&0<r.length,shadowMapType:f.shadowMap.type,toneMapping:e.toneMapped?f.toneMapping:Ne,physicallyCorrectLights:f.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,doubleSided:e.side===Fe,flipSided:e.side===Ae,depthPacking:void 0!==e.depthPacking&&e.depthPacking,index0AttributeName:e.index0AttributeName,extensionDerivatives:e.extensions&&e.extensions.derivatives,extensionFragDepth:e.extensions&&e.extensions.fragDepth,extensionDrawBuffers:e.extensions&&e.extensions.drawBuffers,extensionShaderTextureLOD:e.extensions&&e.extensions.shaderTextureLOD,rendererExtensionFragDepth:x||g.has("EXT_frag_depth"),rendererExtensionDrawBuffers:x||g.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:x||g.has("EXT_shader_texture_lod"),customProgramCacheKey:e.customProgramCacheKey()}},getProgramCacheKey:function(t){var r=[];if(t.shaderID?r.push(t.shaderID):(r.push(Mi(t.fragmentShader)),r.push(Mi(t.vertexShader))),void 0!==t.defines)for(let e in t.defines)r.push(e),r.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<i.length;e++)r.push(t[i[e]]);r.push(f.outputEncoding),r.push(f.gammaFactor)}return r.push(t.customProgramCacheKey),r.join()},getUniforms:function(e){var t=E[e.type];let r;if(t){let e=Qa[t];r=Na.clone(e.uniforms)}else r=e.uniforms;return r},acquireProgram:function(e,r){let i;for(let t=0,e=n.length;t<e;t++){let e=n[t];if(e.cacheKey===r){++(i=e).usedTimes;break}}return void 0===i&&(i=new al(f,r,e,t),n.push(i)),i},releaseProgram:function(e){var t;0==--e.usedTimes&&(t=n.indexOf(e),n[t]=n[n.length-1],n.pop(),e.destroy())},programs:n}}function ol(){let i=new WeakMap;return{get:function(e){let t=i.get(e);return void 0===t&&(t={},i.set(e,t)),t},remove:function(e){i.delete(e)},update:function(e,t,r){i.get(e)[t]=r},dispose:function(){i=new WeakMap}}}function ll(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function hl(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function ul(l){let h=[],u=0,s=[],o=[],d=[],c={id:-1};function f(e,t,r,i,n,a){let s=h[u];var o=l.get(r);return void 0===s?(s={id:e.id,object:e,geometry:t,material:r,program:o.program||c,groupOrder:i,renderOrder:e.renderOrder,z:n,group:a},h[u]=s):(s.id=e.id,s.object=e,s.geometry=t,s.material=r,s.program=o.program||c,s.groupOrder=i,s.renderOrder=e.renderOrder,s.z=n,s.group=a),u++,s}return{opaque:s,transmissive:o,transparent:d,init:function(){u=0,s.length=0,o.length=0,d.length=0},push:function(e,t,r,i,n,a){e=f(e,t,r,i,n,a);(0<r.transmission?o:!0===r.transparent?d:s).push(e)},unshift:function(e,t,r,i,n,a){e=f(e,t,r,i,n,a);(0<r.transmission?o:!0===r.transparent?d:s).unshift(e)},finish:function(){for(let t=u,e=h.length;t<e;t++){let e=h[t];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.program=null,e.group=null}},sort:function(e,t){1<s.length&&s.sort(e||ll),1<o.length&&o.sort(t||hl),1<d.length&&d.sort(t||hl)}}}function dl(i){let n=new WeakMap;return{get:function(e,t){let r;return!1===n.has(e)?(r=new ul(i),n.set(e,[r])):t>=n.get(e).length?(r=new ul(i),n.get(e).push(r)):r=n.get(e)[t],r},dispose:function(){n=new WeakMap}}}function cl(){let r={};return{get:function(e){if(void 0!==r[e.id])return r[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Pe,color:new m};break;case"SpotLight":t={position:new Pe,direction:new Pe,color:new m,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Pe,color:new m,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Pe,skyColor:new m,groundColor:new m};break;case"RectAreaLight":t={color:new m,position:new Pe,halfWidth:new Pe,halfHeight:new Pe}}return r[e.id]=t}}}let fl=0;function pl(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function ml(r,i){let x=new cl,b=function(){let r={};return{get:function(e){if(void 0!==r[e.id])return r[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new V};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new V,shadowCameraNear:1,shadowCameraFar:1e3}}return r[e.id]=t}}}(),_={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)_.probe.push(new Pe);let u=new Pe,d=new ke,c=new ke;return{setup:function(s,e){let o=0,l=0,h=0;for(let e=0;e<9;e++)_.probe[e].set(0,0,0);let u=0,d=0,c=0,f=0,p=0,m=0,g=0,v=0;s.sort(pl);var y=!0!==e?Math.PI:1;for(let e=0,t=s.length;e<t;e++){let r=s[e],t=r.color,i=r.intensity,n=r.distance,a=r.shadow&&r.shadow.map?r.shadow.map.texture:null;if(r.isAmbientLight)o+=t.r*i*y,l+=t.g*i*y,h+=t.b*i*y;else if(r.isLightProbe)for(let e=0;e<9;e++)_.probe[e].addScaledVector(r.sh.coefficients[e],i);else if(r.isDirectionalLight){let e=x.get(r);if(e.color.copy(r.color).multiplyScalar(r.intensity*y),r.castShadow){let e=r.shadow,t=b.get(r);t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,_.directionalShadow[u]=t,_.directionalShadowMap[u]=a,_.directionalShadowMatrix[u]=r.shadow.matrix,m++}_.directional[u]=e,u++}else if(r.isSpotLight){let e=x.get(r);if(e.position.setFromMatrixPosition(r.matrixWorld),e.color.copy(t).multiplyScalar(i*y),e.distance=n,e.coneCos=Math.cos(r.angle),e.penumbraCos=Math.cos(r.angle*(1-r.penumbra)),e.decay=r.decay,r.castShadow){let e=r.shadow,t=b.get(r);t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,_.spotShadow[c]=t,_.spotShadowMap[c]=a,_.spotShadowMatrix[c]=r.shadow.matrix,v++}_.spot[c]=e,c++}else if(r.isRectAreaLight){let e=x.get(r);e.color.copy(t).multiplyScalar(i),e.halfWidth.set(.5*r.width,0,0),e.halfHeight.set(0,.5*r.height,0),_.rectArea[f]=e,f++}else if(r.isPointLight){let e=x.get(r);if(e.color.copy(r.color).multiplyScalar(r.intensity*y),e.distance=r.distance,e.decay=r.decay,r.castShadow){let e=r.shadow,t=b.get(r);t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,t.shadowCameraNear=e.camera.near,t.shadowCameraFar=e.camera.far,_.pointShadow[d]=t,_.pointShadowMap[d]=a,_.pointShadowMatrix[d]=r.shadow.matrix,g++}_.point[d]=e,d++}else if(r.isHemisphereLight){let e=x.get(r);e.skyColor.copy(r.color).multiplyScalar(i*y),e.groundColor.copy(r.groundColor).multiplyScalar(i*y),_.hemi[p]=e,p++}}0<f&&(i.isWebGL2||!0===r.has("OES_texture_float_linear")?(_.rectAreaLTC1=a.LTC_FLOAT_1,_.rectAreaLTC2=a.LTC_FLOAT_2):!0===r.has("OES_texture_half_float_linear")?(_.rectAreaLTC1=a.LTC_HALF_1,_.rectAreaLTC2=a.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),_.ambient[0]=o,_.ambient[1]=l,_.ambient[2]=h;let t=_.hash;t.directionalLength===u&&t.pointLength===d&&t.spotLength===c&&t.rectAreaLength===f&&t.hemiLength===p&&t.numDirectionalShadows===m&&t.numPointShadows===g&&t.numSpotShadows===v||(_.directional.length=u,_.spot.length=c,_.rectArea.length=f,_.point.length=d,_.hemi.length=p,_.directionalShadow.length=m,_.directionalShadowMap.length=m,_.pointShadow.length=g,_.pointShadowMap.length=g,_.spotShadow.length=v,_.spotShadowMap.length=v,_.directionalShadowMatrix.length=m,_.pointShadowMatrix.length=g,_.spotShadowMatrix.length=v,t.directionalLength=u,t.pointLength=d,t.spotLength=c,t.rectAreaLength=f,t.hemiLength=p,t.numDirectionalShadows=m,t.numPointShadows=g,t.numSpotShadows=v,_.version=fl++)},setupView:function(r,e){let i=0,n=0,a=0,s=0,o=0;var l=e.matrixWorldInverse;for(let e=0,t=r.length;e<t;e++){var h=r[e];if(h.isDirectionalLight){let e=_.directional[i];e.direction.setFromMatrixPosition(h.matrixWorld),u.setFromMatrixPosition(h.target.matrixWorld),e.direction.sub(u),e.direction.transformDirection(l),i++}else if(h.isSpotLight){let e=_.spot[a];e.position.setFromMatrixPosition(h.matrixWorld),e.position.applyMatrix4(l),e.direction.setFromMatrixPosition(h.matrixWorld),u.setFromMatrixPosition(h.target.matrixWorld),e.direction.sub(u),e.direction.transformDirection(l),a++}else if(h.isRectAreaLight){let e=_.rectArea[s];e.position.setFromMatrixPosition(h.matrixWorld),e.position.applyMatrix4(l),c.identity(),d.copy(h.matrixWorld),d.premultiply(l),c.extractRotation(d),e.halfWidth.set(.5*h.width,0,0),e.halfHeight.set(0,.5*h.height,0),e.halfWidth.applyMatrix4(c),e.halfHeight.applyMatrix4(c),s++}else if(h.isPointLight){let e=_.point[n];e.position.setFromMatrixPosition(h.matrixWorld),e.position.applyMatrix4(l),n++}else if(h.isHemisphereLight){let e=_.hemi[o];e.direction.setFromMatrixPosition(h.matrixWorld),e.direction.transformDirection(l),e.direction.normalize(),o++}}},state:_}}function gl(e,t){let r=new ml(e,t),i=[],n=[];return{init:function(){i.length=0,n.length=0},state:{lightsArray:i,shadowsArray:n,lights:r},setupLights:function(e){r.setup(i,e)},setupLightsView:function(e){r.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){n.push(e)}}}function vl(i,n){let a=new WeakMap;return{get:function(e,t=0){let r;return!1===a.has(e)?(r=new gl(i,n),a.set(e,[r])):t>=a.get(e).length?(r=new gl(i,n),a.get(e).push(r)):r=a.get(e)[t],r},dispose:function(){a=new WeakMap}}}class yl extends r{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=Ir,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}yl.prototype.isMeshDepthMaterial=!0;class xl extends r{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new Pe,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function bl(c,f,e){let p=new Ka,m=new V,g=new V,v=new Ie,l=new yl({depthPacking:Pr}),h=new xl,u={},y=e.maxTextureSize,d={0:Ae,1:Oe,2:Fe},x=new Ba({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new V},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),b=x.clone();b.defines.HORIZONTAL_PASS=1;e=new S;e.setAttribute("position",new E(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let _=new w(e,x),i=this;function T(e,t,n,r,i,a,s){let o=null;e=!0===r.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(o=void 0!==e?e:!0===r.isPointLight?h:l,c.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&0<n.alphaTest){let e=o.uuid,t=n.uuid,r=u[e],i=(void 0===r&&(r={},u[e]=r),r[t]);void 0===i&&(i=o.clone(),r[t]=i),o=i}return o.visible=n.visible,o.wireframe=n.wireframe,o.side=s===I?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:d[n.side],o.alphaMap=n.alphaMap,o.alphaTest=n.alphaTest,o.clipShadows=n.clipShadows,o.clippingPlanes=n.clippingPlanes,o.clipIntersection=n.clipIntersection,o.displacementMap=n.displacementMap,o.displacementScale=n.displacementScale,o.displacementBias=n.displacementBias,o.wireframeLinewidth=n.wireframeLinewidth,o.linewidth=n.linewidth,!0===r.isPointLight&&!0===o.isMeshDistanceMaterial&&(o.referencePosition.setFromMatrixPosition(r.matrixWorld),o.nearDistance=i,o.farDistance=a),o}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=C,this.render=function(a,s,o){if(!1!==i.enabled&&(!1!==i.autoUpdate||!1!==i.needsUpdate)&&0!==a.length){let e=c.getRenderTarget(),t=c.getActiveCubeFace(),r=c.getActiveMipmapLevel(),n=c.state;n.setBlending(q),n.buffers.color.setClear(1,1,1,1),n.buffers.depth.setTest(!0),n.setScissorTest(!1);for(let e=0,t=a.length;e<t;e++){let r=a[e],i=r.shadow;if(void 0===i)console.warn("THREE.WebGLShadowMap:",r,"has no shadow.");else if(!1!==i.autoUpdate||!1!==i.needsUpdate){m.copy(i.mapSize);var l=i.getFrameExtents();if(m.multiply(l),g.copy(i.mapSize),(m.x>y||m.y>y)&&(m.x>y&&(g.x=Math.floor(y/l.x),m.x=g.x*l.x,i.mapSize.x=g.x),m.y>y)&&(g.y=Math.floor(y/l.y),m.y=g.y*l.y,i.mapSize.y=g.y),null===i.map&&!i.isPointLightShadow&&this.type===I){let e={minFilter:B,magFilter:B,format:Ce};i.map=new Di(m.x,m.y,e),i.map.texture.name=r.name+".shadowMap",i.mapPass=new Di(m.x,m.y,e),i.camera.updateProjectionMatrix()}if(null===i.map){let e={minFilter:Re,magFilter:Re,format:Ce};i.map=new Di(m.x,m.y,e),i.map.texture.name=r.name+".shadowMap",i.camera.updateProjectionMatrix()}c.setRenderTarget(i.map),c.clear();var h=i.getViewportCount();for(let t=0;t<h;t++){let e=i.getViewport(t);v.set(g.x*e.x,g.y*e.y,g.x*e.z,g.y*e.w),n.viewport(v),i.updateMatrices(r,t),p=i.getFrustum(),function r(a,i,s,o,l){if(!1!==a.visible){if(a.layers.test(i.layers)&&(a.isMesh||a.isLine||a.isPoints)&&(a.castShadow||a.receiveShadow&&l===I)&&(!a.frustumCulled||p.intersectsObject(a))){a.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,a.matrixWorld);let i=f.update(a),n=a.material;if(Array.isArray(n)){let r=i.groups;for(let e=0,t=r.length;e<t;e++){var h=r[e],u=n[h.materialIndex];if(u&&u.visible){let e=T(a,0,u,o,s.near,s.far,l);c.renderBufferDirect(s,null,i,e,a,h)}}}else if(n.visible){let e=T(a,0,n,o,s.near,s.far,l);c.renderBufferDirect(s,null,i,e,a,null)}}var n=a.children;for(let e=0,t=n.length;e<t;e++)r(n[e],i,s,o,l)}}(s,o,i.camera,r,this.type)}i.isPointLightShadow||this.type!==I||(l=i,u=o,d=void 0,d=f.update(_),x.defines.VSM_SAMPLES!==l.blurSamples&&(x.defines.VSM_SAMPLES=l.blurSamples,b.defines.VSM_SAMPLES=l.blurSamples,x.needsUpdate=!0,b.needsUpdate=!0),x.uniforms.shadow_pass.value=l.map.texture,x.uniforms.resolution.value=l.mapSize,x.uniforms.radius.value=l.radius,c.setRenderTarget(l.mapPass),c.clear(),c.renderBufferDirect(u,null,d,x,_,null),b.uniforms.shadow_pass.value=l.mapPass.texture,b.uniforms.resolution.value=l.mapSize,b.uniforms.radius.value=l.radius,c.setRenderTarget(l.map),c.clear(),c.renderBufferDirect(u,null,d,b,_,null)),i.needsUpdate=!1}}var u,d;i.needsUpdate=!1,c.setRenderTarget(e,t,r)}}}function _l(u,F,e){let r=e.isWebGL2,i=new function(){let t=!1,a=new Ie,r=null,s=new Ie(0,0,0,0);return{setMask:function(e){r===e||t||(u.colorMask(e,e,e,e),r=e)},setLocked:function(e){t=e},setClear:function(e,t,r,i,n){!0===n&&(e*=i,t*=i,r*=i),a.set(e,t,r,i),!1===s.equals(a)&&(u.clearColor(e,t,r,i),s.copy(a))},reset:function(){t=!1,r=null,s.set(-1,0,0,0)}}},n=new function(){let t=!1,r=null,i=null,n=null;return{setTest:function(e){(e?D:I)(2929)},setMask:function(e){r===e||t||(u.depthMask(e),r=e)},setFunc:function(e){if(i!==e){if(e)switch(e){case ge:u.depthFunc(512);break;case ve:u.depthFunc(519);break;case ye:u.depthFunc(513);break;case xe:u.depthFunc(515);break;case be:u.depthFunc(514);break;case _e:u.depthFunc(518);break;case Te:u.depthFunc(516);break;case Se:u.depthFunc(517);break;default:u.depthFunc(515)}else u.depthFunc(515);i=e}},setLocked:function(e){t=e},setClear:function(e){n!==e&&(u.clearDepth(e),n=e)},reset:function(){t=!1,r=null,i=null,n=null}}},a=new function(){let t=!1,r=null,i=null,n=null,a=null,s=null,o=null,l=null,h=null;return{setTest:function(e){t||(e?D:I)(2960)},setMask:function(e){r===e||t||(u.stencilMask(e),r=e)},setFunc:function(e,t,r){i===e&&n===t&&a===r||(u.stencilFunc(e,t,r),i=e,n=t,a=r)},setOp:function(e,t,r){s===e&&o===t&&l===r||(u.stencilOp(e,t,r),s=e,o=t,l=r)},setLocked:function(e){t=e},setClear:function(e){h!==e&&(u.clearStencil(e),h=e)},reset:function(){t=!1,r=null,i=null,n=null,a=null,s=null,o=null,l=null,h=null}}},t={},s=null,o={},l=null,h=!1,d=null,c=null,f=null,p=null,m=null,g=null,v=null,y=!1,x=null,b=null,_=null,T=null,S=null,N=u.getParameter(35661),w=!1,E=0;e=u.getParameter(7938);-1!==e.indexOf("WebGL")?(E=parseFloat(/^WebGL (\d)/.exec(e)[1]),w=1<=E):-1!==e.indexOf("OpenGL ES")&&(E=parseFloat(/^OpenGL ES (\d)/.exec(e)[1]),w=2<=E);let M=null,A={},B=u.getParameter(3088),U=u.getParameter(2978),L=(new Ie).fromArray(B),R=(new Ie).fromArray(U);function G(e,t,r){var i=new Uint8Array(4),n=u.createTexture();u.bindTexture(e,n),u.texParameteri(e,10241,9728),u.texParameteri(e,10240,9728);for(let e=0;e<r;e++)u.texImage2D(t+e,0,6408,1,1,0,6408,5121,i);return n}let C={};function D(e){!0!==t[e]&&(u.enable(e),t[e]=!0)}function I(e){!1!==t[e]&&(u.disable(e),t[e]=!1)}C[3553]=G(3553,3553,1),C[34067]=G(34067,34069,6),i.setClear(0,0,0,1),n.setClear(1),a.setClear(0),D(2929),n.setFunc(xe),z(!1),H(Y),D(2884),O(q);let P={[ee]:32774,[te]:32778,[re]:32779};if(r)P[ie]=32775,P[ne]=32776;else{let e=F.get("EXT_blend_minmax");null!==e&&(P[ie]=e.MIN_EXT,P[ne]=e.MAX_EXT)}let k={[ae]:0,[se]:1,[oe]:768,[he]:770,[me]:776,[fe]:774,[de]:772,[le]:769,[ue]:771,[pe]:775,[ce]:773};function O(e,t,r,i,n,a,s,o){if(e!==q){if(!1===h&&(D(3042),h=!0),e===Q)n=n||t,a=a||r,s=s||i,t===c&&n===m||(u.blendEquationSeparate(P[t],P[n]),c=t,m=n),r===f&&i===p&&a===g&&s===v||(u.blendFuncSeparate(k[r],k[i],k[a],k[s]),f=r,p=i,g=a,v=s),d=e,y=null;else if(e!==d||o!==y){if(c===ee&&m===ee||(u.blendEquation(32774),c=ee,m=ee),o)switch(e){case K:u.blendFuncSeparate(1,771,1,771);break;case X:u.blendFunc(1,1);break;case J:u.blendFuncSeparate(0,0,769,771);break;case Z:u.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case K:u.blendFuncSeparate(770,771,1,771);break;case X:u.blendFunc(770,1);break;case J:u.blendFunc(0,769);break;case Z:u.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}f=null,p=null,g=null,v=null,d=e,y=o}}else!0===h&&(I(3042),h=!1)}function z(e){x!==e&&(e?u.frontFace(2304):u.frontFace(2305),x=e)}function H(e){e!==j?(D(2884),e!==b&&(e===Y?u.cullFace(1029):e===$?u.cullFace(1028):u.cullFace(1032))):I(2884),b=e}function V(e,t,r){e?(D(32823),T===t&&S===r||(u.polygonOffset(t,r),T=t,S=r)):I(32823)}function W(e){void 0===e&&(e=33984+N-1),M!==e&&(u.activeTexture(e),M=e)}return{buffers:{color:i,depth:n,stencil:a},enable:D,disable:I,bindFramebuffer:function(e,t){return null===t&&null!==s&&(t=s),o[e]!==t&&(u.bindFramebuffer(e,t),o[e]=t,r&&(36009===e&&(o[36160]=t),36160===e)&&(o[36009]=t),!0)},bindXRFramebuffer:function(e){e!==s&&(u.bindFramebuffer(36160,e),s=e)},useProgram:function(e){return l!==e&&(u.useProgram(e),l=e,!0)},setBlending:O,setMaterial:function(e,t){(e.side===Fe?I:D)(2884);let r=e.side===Ae;z(r=t?!r:r),e.blending===K&&!1===e.transparent?O(q):O(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),n.setFunc(e.depthFunc),n.setTest(e.depthTest),n.setMask(e.depthWrite),i.setMask(e.colorWrite);t=e.stencilWrite;a.setTest(t),t&&(a.setMask(e.stencilWriteMask),a.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),a.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),V(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),(!0===e.alphaToCoverage?D:I)(32926)},setFlipSided:z,setCullFace:H,setLineWidth:function(e){e!==_&&(w&&u.lineWidth(e),_=e)},setPolygonOffset:V,setScissorTest:function(e){(e?D:I)(3089)},activeTexture:W,bindTexture:function(e,t){null===M&&W();let r=A[M];void 0===r&&(r={type:void 0,texture:void 0},A[M]=r),r.type===e&&r.texture===t||(u.bindTexture(e,t||C[e]),r.type=e,r.texture=t)},unbindTexture:function(){var e=A[M];void 0!==e&&void 0!==e.type&&(u.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{u.compressedTexImage2D.apply(u,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{u.texImage2D.apply(u,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{u.texImage3D.apply(u,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(e){!1===L.equals(e)&&(u.scissor(e.x,e.y,e.z,e.w),L.copy(e))},viewport:function(e){!1===R.equals(e)&&(u.viewport(e.x,e.y,e.z,e.w),R.copy(e))},reset:function(){u.disable(3042),u.disable(2884),u.disable(2929),u.disable(32823),u.disable(3089),u.disable(2960),u.disable(32926),u.blendEquation(32774),u.blendFunc(1,0),u.blendFuncSeparate(1,0,1,0),u.colorMask(!0,!0,!0,!0),u.clearColor(0,0,0,0),u.depthMask(!0),u.depthFunc(513),u.clearDepth(1),u.stencilMask(4294967295),u.stencilFunc(519,0,4294967295),u.stencilOp(7680,7680,7680),u.clearStencil(0),u.cullFace(1029),u.frontFace(2305),u.polygonOffset(0,0),u.activeTexture(33984),u.bindFramebuffer(36160,null),!0===r&&(u.bindFramebuffer(36009,null),u.bindFramebuffer(36008,null)),u.useProgram(null),u.lineWidth(1),u.scissor(0,0,u.canvas.width,u.canvas.height),u.viewport(0,0,u.canvas.width,u.canvas.height),t={},M=null,A={},s=null,o={},l=null,h=!1,d=null,c=null,f=null,p=null,m=null,g=null,v=null,y=!1,x=null,b=null,_=null,T=null,S=null,L.set(0,0,u.canvas.width,u.canvas.height),R.set(0,0,u.canvas.width,u.canvas.height),i.reset(),n.reset(),a.reset()}}}function Tl(f,a,p,m,d,g,c){let v=d.isWebGL2,t=d.maxTextures,y=d.maxCubemapSize,u=d.maxTextureSize,N=d.maxSamples,s=new WeakMap,o,r=!1;try{r="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(f){}function l(e,t){return r?new OffscreenCanvas(e,t):Ei("canvas")}function x(i,n,a,e){let s=1;if((s=i.width>e||i.height>e?e/Math.max(i.width,i.height):s)<1||!0===n){if("undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&i instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&i instanceof ImageBitmap){let e=n?bi:Math.floor,t=e(s*i.width),r=e(s*i.height);void 0===o&&(o=l(t,r));n=a?l(t,r):o;return n.width=t,n.height=r,n.getContext("2d").drawImage(i,0,0,t,r),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+i.width+"x"+i.height+") to ("+t+"x"+r+")."),n}"data"in i&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+i.width+"x"+i.height+").")}return i}function b(e){return yi(e.width)&&yi(e.height)}function _(e,t){return e.generateMipmaps&&t&&e.minFilter!==Re&&e.minFilter!==B}function T(e,t,r,i,n=1){f.generateMipmap(e),m.get(t).__maxMipLevel=Math.log2(Math.max(r,i,n))}function S(e,t,r,i){if(!1===v)return t;if(null!==e){if(void 0!==f[e])return f[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let n=t;return 6403===t&&(5126===r&&(n=33326),5131===r&&(n=33325),5121===r)&&(n=33321),6407===t&&(5126===r&&(n=34837),5131===r&&(n=34843),5121===r)&&(n=32849),33325!==(n=6408===t&&(5126===r&&(n=34836),5131===r&&(n=34842),5121===r)?i===Er?35907:32856:n)&&33326!==n&&34842!==n&&34836!==n||a.get("EXT_color_buffer_float"),n}function i(e){return e===Re||e===Ye||e===qe?9728:9729}function n(e){var t,r,e=e.target;e.removeEventListener("dispose",n),t=e,void 0!==(r=m.get(t)).__webglInit&&(f.deleteTexture(r.__webglTexture),m.remove(t)),e.isVideoTexture&&s.delete(e),c.memory.textures--}function w(i){i=i.target;i.removeEventListener("dispose",w);{let r=i.texture,t=m.get(i),e=m.get(r);if(i){if(void 0!==e.__webglTexture&&(f.deleteTexture(e.__webglTexture),c.memory.textures--),i.depthTexture&&i.depthTexture.dispose(),i.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)f.deleteFramebuffer(t.__webglFramebuffer[e]),t.__webglDepthbuffer&&f.deleteRenderbuffer(t.__webglDepthbuffer[e]);else f.deleteFramebuffer(t.__webglFramebuffer),t.__webglDepthbuffer&&f.deleteRenderbuffer(t.__webglDepthbuffer),t.__webglMultisampledFramebuffer&&f.deleteFramebuffer(t.__webglMultisampledFramebuffer),t.__webglColorRenderbuffer&&f.deleteRenderbuffer(t.__webglColorRenderbuffer),t.__webglDepthRenderbuffer&&f.deleteRenderbuffer(t.__webglDepthRenderbuffer);if(i.isWebGLMultipleRenderTargets)for(let t=0,e=r.length;t<e;t++){let e=m.get(r[t]);e.__webglTexture&&(f.deleteTexture(e.__webglTexture),c.memory.textures--),m.remove(r[t])}m.remove(r),m.remove(i)}}}let h=0;function E(t,r){var e,i,n=m.get(t);if(t.isVideoTexture&&(e=t,i=c.render.frame,s.get(e)!==i&&(s.set(e,i),e.update())),0<t.version&&n.__version!==t.version){let e=t.image;if(void 0===e)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==e.complete)return void D(n,t,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}p.activeTexture(33984+r),p.bindTexture(3553,n.__webglTexture)}function M(e,t){var r=m.get(e);if(0<e.version&&r.__version!==e.version){var n=r,a=e,s=t;if(6===a.image.length){C(n,a),p.activeTexture(33984+s),p.bindTexture(34067,n.__webglTexture),f.pixelStorei(37440,a.flipY),f.pixelStorei(37441,a.premultiplyAlpha),f.pixelStorei(3317,a.unpackAlignment),f.pixelStorei(37443,0);var o=a&&(a.isCompressedTexture||a.image[0].isCompressedTexture),l=a.image[0]&&a.image[0].isDataTexture,h=[];for(let e=0;e<6;e++)h[e]=o||l?l?a.image[e].image:a.image[e]:x(a.image[e],!1,!0,y);var s=h[0],e=b(s)||v,u=g.convert(a.format),d=g.convert(a.type),c=S(a.internalFormat,u,d,a.encoding);let i;if(R(34067,a,e),o){for(let r=0;r<6;r++){i=h[r].mipmaps;for(let t=0;t<i.length;t++){let e=i[t];a.format!==Ce&&a.format!==ft?null!==u?p.compressedTexImage2D(34069+r,t,c,e.width,e.height,0,e.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):p.texImage2D(34069+r,t,c,e.width,e.height,0,u,d,e.data)}}n.__maxMipLevel=i.length-1}else{i=a.mipmaps;for(let r=0;r<6;r++)if(l){p.texImage2D(34069+r,0,c,h[r].width,h[r].height,0,u,d,h[r].data);for(let t=0;t<i.length;t++){let e=i[t].image[r].image;p.texImage2D(34069+r,t+1,c,e.width,e.height,0,u,d,e.data)}}else{p.texImage2D(34069+r,0,c,u,d,h[r]);for(let t=0;t<i.length;t++){let e=i[t];p.texImage2D(34069+r,t+1,c,u,d,e.image[r])}}n.__maxMipLevel=i.length}_(a,e)&&T(34067,a,s.width,s.height),n.__version=a.version,a.onUpdate&&a.onUpdate(a)}}else p.activeTexture(33984+t),p.bindTexture(34067,r.__webglTexture)}let A={[We]:10497,[Le]:33071,[je]:33648},L={[Re]:9728,[Ye]:9984,[qe]:9986,[B]:9729,[Xe]:9985,[Ze]:9987};function R(t,r,e){if(e?(f.texParameteri(t,10242,A[r.wrapS]),f.texParameteri(t,10243,A[r.wrapT]),32879!==t&&35866!==t||f.texParameteri(t,32882,A[r.wrapR]),f.texParameteri(t,10240,L[r.magFilter]),f.texParameteri(t,10241,L[r.minFilter])):(f.texParameteri(t,10242,33071),f.texParameteri(t,10243,33071),32879!==t&&35866!==t||f.texParameteri(t,32882,33071),r.wrapS===Le&&r.wrapT===Le||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),f.texParameteri(t,10240,i(r.magFilter)),f.texParameteri(t,10241,i(r.minFilter)),r.minFilter!==Re&&r.minFilter!==B&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===a.has("EXT_texture_filter_anisotropic")){let e=a.get("EXT_texture_filter_anisotropic");r.type===st&&!1===a.has("OES_texture_float_linear")||!1===v&&r.type===ot&&!1===a.has("OES_texture_half_float_linear")||(1<r.anisotropy||m.get(r).__currentAnisotropy)&&(f.texParameterf(t,e.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r.anisotropy,d.getMaxAnisotropy())),m.get(r).__currentAnisotropy=r.anisotropy)}}function C(e,t){void 0===e.__webglInit&&(e.__webglInit=!0,t.addEventListener("dispose",n),e.__webglTexture=f.createTexture(),c.memory.textures++)}function D(e,r,t){let i=3553;r.isDataTexture2DArray&&(i=35866),r.isDataTexture3D&&(i=32879),C(e,r),p.activeTexture(33984+t),p.bindTexture(i,e.__webglTexture),f.pixelStorei(37440,r.flipY),f.pixelStorei(37441,r.premultiplyAlpha),f.pixelStorei(3317,r.unpackAlignment),f.pixelStorei(37443,0);t=r;var t=!v&&(t.wrapS!==Le||t.wrapT!==Le||t.minFilter!==Re&&t.minFilter!==B)&&!1===b(r.image),t=x(r.image,t,!1,u),n=b(t)||v,a=g.convert(r.format);let s,o=g.convert(r.type),l=S(r.internalFormat,a,o,r.encoding);R(i,r,n);var h=r.mipmaps;if(r.isDepthTexture)l=6402,v?l=r.type===st?36012:r.type===at?33190:r.type===dt?35056:33189:r.type===st&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===vt&&6402===l&&r.type!==it&&r.type!==at&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=it,o=g.convert(r.type)),r.format===yt&&6402===l&&(l=34041,r.type!==dt)&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=dt,o=g.convert(r.type)),p.texImage2D(3553,0,l,t.width,t.height,0,a,o,null);else if(r.isDataTexture)if(0<h.length&&n){for(let e=0,t=h.length;e<t;e++)s=h[e],p.texImage2D(3553,e,l,s.width,s.height,0,a,o,s.data);r.generateMipmaps=!1,e.__maxMipLevel=h.length-1}else p.texImage2D(3553,0,l,t.width,t.height,0,a,o,t.data),e.__maxMipLevel=0;else if(r.isCompressedTexture){for(let e=0,t=h.length;e<t;e++)s=h[e],r.format!==Ce&&r.format!==ft?null!==a?p.compressedTexImage2D(3553,e,l,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):p.texImage2D(3553,e,l,s.width,s.height,0,a,o,s.data);e.__maxMipLevel=h.length-1}else if(r.isDataTexture2DArray)p.texImage3D(35866,0,l,t.width,t.height,t.depth,0,a,o,t.data),e.__maxMipLevel=0;else if(r.isDataTexture3D)p.texImage3D(32879,0,l,t.width,t.height,t.depth,0,a,o,t.data),e.__maxMipLevel=0;else if(0<h.length&&n){for(let e=0,t=h.length;e<t;e++)s=h[e],p.texImage2D(3553,e,l,a,o,s);r.generateMipmaps=!1,e.__maxMipLevel=h.length-1}else p.texImage2D(3553,0,l,a,o,t),e.__maxMipLevel=0;_(r,n)&&T(i,r,t.width,t.height),e.__version=r.version,r.onUpdate&&r.onUpdate(r)}function I(e,t,r,i,n){var a=g.convert(r.format),s=g.convert(r.type),o=S(r.internalFormat,a,s,r.encoding);32879===n||35866===n?p.texImage3D(n,0,o,t.width,t.height,t.depth,0,a,s,null):p.texImage2D(n,0,o,t.width,t.height,0,a,s,null),p.bindFramebuffer(36160,e),f.framebufferTexture2D(36160,i,n,m.get(r).__webglTexture,0),p.bindFramebuffer(36160,null)}function P(e,n,a){if(f.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){let r=33189;if(a){let e=n.depthTexture,t=(e&&e.isDepthTexture&&(e.type===st?r=36012:e.type===at&&(r=33190)),k(n));f.renderbufferStorageMultisample(36161,t,r,n.width,n.height)}else f.renderbufferStorage(36161,r,n.width,n.height);f.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){if(a){let e=k(n);f.renderbufferStorageMultisample(36161,e,35056,n.width,n.height)}else f.renderbufferStorage(36161,34041,n.width,n.height);f.framebufferRenderbuffer(36160,33306,36161,e)}else{let e=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,t=g.convert(e.format),r=g.convert(e.type),i=S(e.internalFormat,t,r,e.encoding);if(a){let e=k(n);f.renderbufferStorageMultisample(36161,e,i,n.width,n.height)}else f.renderbufferStorage(36161,i,n.width,n.height)}f.bindRenderbuffer(36161,null)}function k(e){return v&&e.isWebGLMultisampleRenderTarget?Math.min(N,e.samples):0}let O=!1,F=!1;this.allocateTextureUnit=function(){var e=h;return e>=t&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+t),h+=1,e},this.resetTextureUnits=function(){h=0},this.setTexture2D=E,this.setTexture2DArray=function(e,t){var r=m.get(e);0<e.version&&r.__version!==e.version?D(r,e,t):(p.activeTexture(33984+t),p.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(e,t){var r=m.get(e);0<e.version&&r.__version!==e.version?D(r,e,t):(p.activeTexture(33984+t),p.bindTexture(32879,r.__webglTexture))},this.setTextureCube=M,this.setupRenderTarget=function(n){var a=n.texture,s=m.get(n),t=m.get(a),e=(n.addEventListener("dispose",w),!0!==n.isWebGLMultipleRenderTargets&&(t.__webglTexture=f.createTexture(),t.__version=a.version,c.memory.textures++),!0===n.isWebGLCubeRenderTarget),r=!0===n.isWebGLMultipleRenderTargets,i=!0===n.isWebGLMultisampleRenderTarget,o=a.isDataTexture3D||a.isDataTexture2DArray,l=b(n)||v;if(!v||a.format!==ft||a.type!==st&&a.type!==ot||(a.format=Ce,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),e){s.__webglFramebuffer=[];for(let e=0;e<6;e++)s.__webglFramebuffer[e]=f.createFramebuffer()}else if(s.__webglFramebuffer=f.createFramebuffer(),r)if(d.drawBuffers){let r=n.texture;for(let t=0,e=r.length;t<e;t++){let e=m.get(r[t]);void 0===e.__webglTexture&&(e.__webglTexture=f.createTexture(),c.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(i)if(v){s.__webglMultisampledFramebuffer=f.createFramebuffer(),s.__webglColorRenderbuffer=f.createRenderbuffer(),f.bindRenderbuffer(36161,s.__webglColorRenderbuffer);let e=g.convert(a.format),t=g.convert(a.type),r=S(a.internalFormat,e,t,a.encoding),i=k(n);f.renderbufferStorageMultisample(36161,i,r,n.width,n.height),p.bindFramebuffer(36160,s.__webglMultisampledFramebuffer),f.framebufferRenderbuffer(36160,36064,36161,s.__webglColorRenderbuffer),f.bindRenderbuffer(36161,null),n.depthBuffer&&(s.__webglDepthRenderbuffer=f.createRenderbuffer(),P(s.__webglDepthRenderbuffer,n,!0)),p.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(e){p.bindTexture(34067,t.__webglTexture),R(34067,a,l);for(let e=0;e<6;e++)I(s.__webglFramebuffer[e],n,a,36064,34069+e);_(a,l)&&T(34067,a,n.width,n.height)}else if(r){let i=n.texture;for(let r=0,e=i.length;r<e;r++){let e=i[r],t=m.get(e);p.bindTexture(3553,t.__webglTexture),R(3553,e,l),I(s.__webglFramebuffer,n,e,36064+r,3553),_(e,l)&&T(3553,e,n.width,n.height)}}else{let e=3553;o&&(v?e=a.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),p.bindTexture(e,t.__webglTexture),R(e,a,l),I(s.__webglFramebuffer,n,a,36064,e),_(a,l)&&T(e,a,n.width,n.height,n.depth)}if(p.unbindTexture(),n.depthBuffer){var h=n,u=m.get(h),i=!0===h.isWebGLCubeRenderTarget;if(h.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");e=u.__webglFramebuffer,r=h;if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(p.bindFramebuffer(36160,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");if(m.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),E(r.depthTexture,0),e=m.get(r.depthTexture).__webglTexture,r.depthTexture.format===vt)f.framebufferTexture2D(36160,36096,3553,e,0);else{if(r.depthTexture.format!==yt)throw new Error("Unknown depthTexture format");f.framebufferTexture2D(36160,33306,3553,e,0)}}else if(i){u.__webglDepthbuffer=[];for(let e=0;e<6;e++)p.bindFramebuffer(36160,u.__webglFramebuffer[e]),u.__webglDepthbuffer[e]=f.createRenderbuffer(),P(u.__webglDepthbuffer[e],h,!1)}else p.bindFramebuffer(36160,u.__webglFramebuffer),u.__webglDepthbuffer=f.createRenderbuffer(),P(u.__webglDepthbuffer,h,!1);p.bindFramebuffer(36160,null)}},this.updateRenderTargetMipmap=function(r){let i=b(r)||v,n=!0===r.isWebGLMultipleRenderTargets?r.texture:[r.texture];for(let e=0,t=n.length;e<t;e++){var a=n[e];if(_(a,i)){let e=r.isWebGLCubeRenderTarget?34067:3553,t=m.get(a).__webglTexture;p.bindTexture(e,t),T(e,a,r.width,r.height),p.unbindTexture()}}},this.updateMultisampleRenderTarget=function(r){if(r.isWebGLMultisampleRenderTarget)if(v){var i=r.width,n=r.height;let e=16384,t=(r.depthBuffer&&(e|=256),r.stencilBuffer&&(e|=1024),m.get(r));p.bindFramebuffer(36008,t.__webglMultisampledFramebuffer),p.bindFramebuffer(36009,t.__webglFramebuffer),f.blitFramebuffer(0,0,i,n,0,0,i,n,e,9728),p.bindFramebuffer(36008,null),p.bindFramebuffer(36009,t.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===O&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),O=!0),e=e.texture),E(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===F&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),F=!0),e=e.texture),M(e,t)}}function Sl(e,r,t){let i=t.isWebGL2;return{convert:function(e){let t;if(e===et)return 5121;if(e===lt)return 32819;if(e===ht)return 32820;if(e===ut)return 33635;if(e===tt)return 5120;if(e===rt)return 5122;if(e===it)return 5123;if(e===nt)return 5124;if(e===at)return 5125;if(e===st)return 5126;if(e===ot)return i?5131:null!==(t=r.get("OES_texture_half_float"))?t.HALF_FLOAT_OES:null;if(e===ct)return 6406;if(e===ft)return 6407;if(e===Ce)return 6408;if(e===pt)return 6409;if(e===mt)return 6410;if(e===vt)return 6402;if(e===yt)return 34041;if(e===xt)return 6403;if(e===bt)return 36244;if(e===_t)return 33319;if(e===Tt)return 33320;if(e===St)return 36248;if(e===wt)return 36249;if(e===Et||e===Mt||e===At||e===Lt){if(null===(t=r.get("WEBGL_compressed_texture_s3tc")))return null;if(e===Et)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Mt)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===At)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Lt)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===Rt||e===Ct||e===Dt||e===It){if(null===(t=r.get("WEBGL_compressed_texture_pvrtc")))return null;if(e===Rt)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===Ct)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===Dt)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===It)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===Pt)return null!==(t=r.get("WEBGL_compressed_texture_etc1"))?t.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===kt||e===Ot)&&null!==(t=r.get("WEBGL_compressed_texture_etc"))){if(e===kt)return t.COMPRESSED_RGB8_ETC2;if(e===Ot)return t.COMPRESSED_RGBA8_ETC2_EAC}return e===Ft||e===Nt||e===Bt||e===Ut||e===Gt||e===zt||e===Ht||e===Vt||e===Wt||e===jt||e===Yt||e===$t||e===qt||e===Kt||e===Jt||e===Zt||e===Qt||e===er||e===tr||e===rr||e===ir||e===nr||e===ar||e===sr||e===or||e===lr||e===hr||e===ur?null!==(t=r.get("WEBGL_compressed_texture_astc"))?e:null:e===Xt?null!==(t=r.get("EXT_texture_compression_bptc"))?e:null:e===dt?i?34042:null!==(t=r.get("WEBGL_depth_texture"))?t.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}xl.prototype.isMeshDistanceMaterial=!0;class wl extends F{constructor(e=[]){super(),this.cameras=e}}wl.prototype.isArrayCamera=!0;class El extends f{constructor(){super(),this.type="Group"}}El.prototype.isGroup=!0;let Ml={type:"move"};class Al{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new El,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new El,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Pe,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Pe),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new El,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Pe,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Pe),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(i,n,a){let e=null,t=null,s=null,r=this._targetRay,o=this._grip,l=this._hand;if(i&&"visible-blurred"!==n.session.visibilityState)if(null!==r&&null!==(e=n.getPose(i.targetRaySpace,a))&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),e.linearVelocity?(r.hasLinearVelocity=!0,r.linearVelocity.copy(e.linearVelocity)):r.hasLinearVelocity=!1,e.angularVelocity?(r.hasAngularVelocity=!0,r.angularVelocity.copy(e.angularVelocity)):r.hasAngularVelocity=!1,this.dispatchEvent(Ml)),l&&i.hand){s=!0;for(let r of i.hand.values()){let e=n.getJointPose(r,a);if(void 0===l.joints[r.jointName]){let e=new El;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[r.jointName]=e,l.add(e)}let t=l.joints[r.jointName];null!==e&&(t.matrix.fromArray(e.transform.matrix),t.matrix.decompose(t.position,t.rotation,t.scale),t.jointRadius=e.radius),t.visible=null!==e}let e=l.joints["index-finger-tip"],t=l.joints["thumb-tip"],r=e.position.distanceTo(t.position);l.inputState.pinching&&.025<r?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:i.handedness,target:this})):!l.inputState.pinching&&r<=.015&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:i.handedness,target:this}))}else null!==o&&i.gripSpace&&null!==(t=n.getPose(i.gripSpace,a))&&(o.matrix.fromArray(t.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),t.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(t.linearVelocity)):o.hasLinearVelocity=!1,t.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(t.angularVelocity)):o.hasAngularVelocity=!1);return null!==r&&(r.visible=null!==e),null!==o&&(o.visible=null!==t),null!==l&&(l.visible=null!==s),this}}class Ll extends hi{constructor(e,s){super();let t=this,o=e.state,p=null,i=1,l=null,n="local-floor",r,h=null,u=null,d=null,c=null,f=!1,m=null,a=null,g=null,v=null,y=null,x=null,b=[],_=new Map,T=new F,S=(T.layers.enable(1),T.viewport=new Ie,new F),w=(S.layers.enable(2),S.viewport=new Ie,[T,S]),E=new wl,M=(E.layers.enable(1),E.layers.enable(2),null),A=null;function L(e){var t=_.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function R(){_.forEach(function(e,t){e.disconnect(t)}),_.clear(),M=null,A=null,o.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),u&&s.deleteFramebuffer(u),m&&s.deleteFramebuffer(m),a&&s.deleteRenderbuffer(a),g&&s.deleteRenderbuffer(g),u=null,m=null,a=null,g=null,c=null,d=null,h=null,p=null,O.stop(),t.isPresenting=!1,t.dispatchEvent({type:"sessionend"})}function C(t){var r=p.inputSources;for(let e=0;e<b.length;e++)_.set(r[e],b[e]);for(let e=0;e<t.removed.length;e++){var i=t.removed[e],n=_.get(i);n&&(n.dispatchEvent({type:"disconnected",data:i}),_.delete(i))}for(let e=0;e<t.added.length;e++){var a=t.added[e],s=_.get(a);s&&s.dispatchEvent({type:"connected",data:a})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=b[e];return void 0===t&&(t=new Al,b[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=b[e];return void 0===t&&(t=new Al,b[e]=t),t.getGripSpace()},this.getHand=function(e){let t=b[e];return void 0===t&&(t=new Al,b[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,!0===t.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){n=e,!0===t.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l},this.getBaseLayer=function(){return null!==d?d:c},this.getBinding=function(){return h},this.getFrame=function(){return v},this.getSession=function(){return p},this.setSession=async function(e){if(null!==(p=e)){p.addEventListener("select",L),p.addEventListener("selectstart",L),p.addEventListener("selectend",L),p.addEventListener("squeeze",L),p.addEventListener("squeezestart",L),p.addEventListener("squeezeend",L),p.addEventListener("end",R),p.addEventListener("inputsourceschange",C);let r=s.getContextAttributes();if(!0!==r.xrCompatible&&await s.makeXRCompatible(),void 0===p.renderState.layers){let e={antialias:r.antialias,alpha:r.alpha,depth:r.depth,stencil:r.stencil,framebufferScaleFactor:i};c=new XRWebGLLayer(p,s,e),p.updateRenderState({baseLayer:c})}else if(s instanceof WebGLRenderingContext){let e={antialias:!0,alpha:r.alpha,depth:r.depth,stencil:r.stencil,framebufferScaleFactor:i};c=new XRWebGLLayer(p,s,e),p.updateRenderState({layers:[c]})}else{f=r.antialias;let e=null,t=(r.depth&&(x=256,r.stencil&&(x|=1024),y=r.stencil?33306:36096,e=r.stencil?35056:33190),{colorFormat:r.alpha?32856:32849,depthFormat:e,scaleFactor:i});h=new XRWebGLBinding(p,s),d=h.createProjectionLayer(t),u=s.createFramebuffer(),p.updateRenderState({layers:[d]}),f&&(m=s.createFramebuffer(),a=s.createRenderbuffer(),s.bindRenderbuffer(36161,a),s.renderbufferStorageMultisample(36161,4,32856,d.textureWidth,d.textureHeight),o.bindFramebuffer(36160,m),s.framebufferRenderbuffer(36160,36064,36161,a),s.bindRenderbuffer(36161,null),null!==e&&(g=s.createRenderbuffer(),s.bindRenderbuffer(36161,g),s.renderbufferStorageMultisample(36161,4,e,d.textureWidth,d.textureHeight),s.framebufferRenderbuffer(36160,y,36161,g),s.bindRenderbuffer(36161,null)),o.bindFramebuffer(36160,null))}l=await p.requestReferenceSpace(n),O.setContext(p),O.start(),t.isPresenting=!0,t.dispatchEvent({type:"sessionstart"})}};let D=new Pe,I=new Pe;function P(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null!==p){E.near=S.near=T.near=e.near,E.far=S.far=T.far=e.far,M===E.near&&A===E.far||(p.updateRenderState({depthNear:E.near,depthFar:E.far}),M=E.near,A=E.far);var t=e.parent,r=E.cameras;P(E,t);for(let e=0;e<r.length;e++)P(r[e],t);E.matrixWorld.decompose(E.position,E.quaternion,E.scale),e.position.copy(E.position),e.quaternion.copy(E.quaternion),e.scale.copy(E.scale),e.matrix.copy(E.matrix),e.matrixWorld.copy(E.matrixWorld);var i,n,a,s,o,l,h,u,d,c,f=e.children;for(let e=0,t=f.length;e<t;e++)f[e].updateMatrixWorld(!0);2===r.length?(e=E,i=T,n=S,D.setFromMatrixPosition(i.matrixWorld),I.setFromMatrixPosition(n.matrixWorld),a=D.distanceTo(I),s=i.projectionMatrix.elements,n=n.projectionMatrix.elements,o=s[14]/(s[10]-1),l=s[14]/(s[10]+1),h=(s[9]+1)/s[5],u=(s[9]-1)/s[5],s=(s[8]-1)/s[0],n=(n[8]+1)/n[0],d=o*s,c=o*n,s=(n=a/(n-s))*-s,i.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(s),e.translateZ(n),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),i=o+n,o=l+n,e.projectionMatrix.makePerspective(d-s,a-s+c,h*l/o*i,u*l/o*i,i,o)):E.projectionMatrix.copy(T.projectionMatrix)}},this.getCamera=function(){return E},this.getFoveation=function(){return null!==d?d.fixedFoveation:null!==c?c.fixedFoveation:void 0},this.setFoveation=function(e){null!==d&&(d.fixedFoveation=e),null!==c&&void 0!==c.fixedFoveation&&(c.fixedFoveation=e)};let k=null,O=new Xa;O.setAnimationLoop(function(e,i){if(r=i.getViewerPose(l),v=i,null!==r){let i=r.views,n=(null!==c&&o.bindXRFramebuffer(c.framebuffer),!1);i.length!==E.cameras.length&&(E.cameras.length=0,n=!0);for(let e=0;e<i.length;e++){let t=i[e],r=null;if(null!==c)r=c.getViewport(t);else{let e=h.getViewSubImage(d,t);o.bindXRFramebuffer(u),void 0!==e.depthStencilTexture&&s.framebufferTexture2D(36160,y,3553,e.depthStencilTexture,0),s.framebufferTexture2D(36160,36064,3553,e.colorTexture,0),r=e.viewport}var a=w[e];a.matrix.fromArray(t.transform.matrix),a.projectionMatrix.fromArray(t.projectionMatrix),a.viewport.set(r.x,r.y,r.width,r.height),0===e&&E.matrix.copy(a.matrix),!0===n&&E.cameras.push(a)}f&&(o.bindXRFramebuffer(m),null!==x)&&s.clear(x)}let n=p.inputSources;for(let r=0;r<b.length;r++){let e=b[r],t=n[r];e.update(t,i,l)}if(k&&k(e,i),f){let e=d.textureWidth,t=d.textureHeight;o.bindFramebuffer(36008,m),o.bindFramebuffer(36009,u),s.invalidateFramebuffer(36008,[y]),s.invalidateFramebuffer(36009,[y]),s.blitFramebuffer(0,0,e,t,0,0,e,t,16384,9728),s.invalidateFramebuffer(36008,[36064]),o.bindFramebuffer(36008,null),o.bindFramebuffer(36009,null),o.bindFramebuffer(36160,m)}v=null}),this.setAnimationLoop=function(e){k=e},this.dispose=function(){}}}function Rl(a){function c(t,r){t.opacity.value=r.opacity,r.color&&t.diffuse.value.copy(r.color),r.emissive&&t.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(t.map.value=r.map),r.alphaMap&&(t.alphaMap.value=r.alphaMap),r.specularMap&&(t.specularMap.value=r.specularMap),0<r.alphaTest&&(t.alphaTest.value=r.alphaTest);var i=a.get(r).envMap;if(i){t.envMap.value=i,t.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,t.reflectivity.value=r.reflectivity,t.ior.value=r.ior,t.refractionRatio.value=r.refractionRatio;let e=a.get(i).__maxMipLevel;void 0!==e&&(t.maxMipLevel.value=e)}let e,n;r.lightMap&&(t.lightMap.value=r.lightMap,t.lightMapIntensity.value=r.lightMapIntensity),r.aoMap&&(t.aoMap.value=r.aoMap,t.aoMapIntensity.value=r.aoMapIntensity),r.map?e=r.map:r.specularMap?e=r.specularMap:r.displacementMap?e=r.displacementMap:r.normalMap?e=r.normalMap:r.bumpMap?e=r.bumpMap:r.roughnessMap?e=r.roughnessMap:r.metalnessMap?e=r.metalnessMap:r.alphaMap?e=r.alphaMap:r.emissiveMap?e=r.emissiveMap:r.clearcoatMap?e=r.clearcoatMap:r.clearcoatNormalMap?e=r.clearcoatNormalMap:r.clearcoatRoughnessMap?e=r.clearcoatRoughnessMap:r.specularIntensityMap?e=r.specularIntensityMap:r.specularColorMap?e=r.specularColorMap:r.transmissionMap?e=r.transmissionMap:r.thicknessMap?e=r.thicknessMap:r.sheenColorMap?e=r.sheenColorMap:r.sheenRoughnessMap&&(e=r.sheenRoughnessMap),void 0!==e&&(!0===(e=e.isWebGLRenderTarget?e.texture:e).matrixAutoUpdate&&e.updateMatrix(),t.uvTransform.value.copy(e.matrix)),r.aoMap?n=r.aoMap:r.lightMap&&(n=r.lightMap),void 0!==n&&(!0===(n=n.isWebGLRenderTarget?n.texture:n).matrixAutoUpdate&&n.updateMatrix(),t.uv2Transform.value.copy(n.matrix))}function f(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Ae)&&(e.bumpScale.value*=-1),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Ae)&&e.normalScale.value.negate(),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),a.get(t).envMap&&(e.envMapIntensity.value=t.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(t,r,i,n,a){if(r.isMeshBasicMaterial)c(t,r);else if(r.isMeshLambertMaterial)c(t,r),d=t,r.emissiveMap&&(d.emissiveMap.value=r.emissiveMap);else if(r.isMeshToonMaterial)c(t,r),d=t,(u=r).gradientMap&&(d.gradientMap.value=u.gradientMap),u.emissiveMap&&(d.emissiveMap.value=u.emissiveMap),u.bumpMap&&(d.bumpMap.value=u.bumpMap,d.bumpScale.value=u.bumpScale,u.side===Ae)&&(d.bumpScale.value*=-1),u.normalMap&&(d.normalMap.value=u.normalMap,d.normalScale.value.copy(u.normalScale),u.side===Ae)&&d.normalScale.value.negate(),u.displacementMap&&(d.displacementMap.value=u.displacementMap,d.displacementScale.value=u.displacementScale,d.displacementBias.value=u.displacementBias);else if(r.isMeshPhongMaterial)c(t,r),u=r,(h=t).specular.value.copy(u.specular),h.shininess.value=Math.max(u.shininess,1e-4),u.emissiveMap&&(h.emissiveMap.value=u.emissiveMap),u.bumpMap&&(h.bumpMap.value=u.bumpMap,h.bumpScale.value=u.bumpScale,u.side===Ae)&&(h.bumpScale.value*=-1),u.normalMap&&(h.normalMap.value=u.normalMap,h.normalScale.value.copy(u.normalScale),u.side===Ae)&&h.normalScale.value.negate(),u.displacementMap&&(h.displacementMap.value=u.displacementMap,h.displacementScale.value=u.displacementScale,h.displacementBias.value=u.displacementBias);else if(r.isMeshStandardMaterial)c(t,r),r.isMeshPhysicalMaterial?(h=a,f(a=t,l=r),a.ior.value=l.ior,0<l.sheen&&(a.sheenColor.value.copy(l.sheenColor).multiplyScalar(l.sheen),a.sheenRoughness.value=l.sheenRoughness,l.sheenColorMap&&(a.sheenColorMap.value=l.sheenColorMap),l.sheenRoughnessMap)&&(a.sheenRoughnessMap.value=l.sheenRoughnessMap),0<l.clearcoat&&(a.clearcoat.value=l.clearcoat,a.clearcoatRoughness.value=l.clearcoatRoughness,l.clearcoatMap&&(a.clearcoatMap.value=l.clearcoatMap),l.clearcoatRoughnessMap&&(a.clearcoatRoughnessMap.value=l.clearcoatRoughnessMap),l.clearcoatNormalMap)&&(a.clearcoatNormalScale.value.copy(l.clearcoatNormalScale),a.clearcoatNormalMap.value=l.clearcoatNormalMap,l.side===Ae)&&a.clearcoatNormalScale.value.negate(),0<l.transmission&&(a.transmission.value=l.transmission,a.transmissionSamplerMap.value=h.texture,a.transmissionSamplerSize.value.set(h.width,h.height),l.transmissionMap&&(a.transmissionMap.value=l.transmissionMap),a.thickness.value=l.thickness,l.thicknessMap&&(a.thicknessMap.value=l.thicknessMap),a.attenuationDistance.value=l.attenuationDistance,a.attenuationColor.value.copy(l.attenuationColor)),a.specularIntensity.value=l.specularIntensity,a.specularColor.value.copy(l.specularColor),l.specularIntensityMap&&(a.specularIntensityMap.value=l.specularIntensityMap),l.specularColorMap&&(a.specularColorMap.value=l.specularColorMap)):f(t,r);else if(r.isMeshMatcapMaterial)c(t,r),a=t,(l=r).matcap&&(a.matcap.value=l.matcap),l.bumpMap&&(a.bumpMap.value=l.bumpMap,a.bumpScale.value=l.bumpScale,l.side===Ae)&&(a.bumpScale.value*=-1),l.normalMap&&(a.normalMap.value=l.normalMap,a.normalScale.value.copy(l.normalScale),l.side===Ae)&&a.normalScale.value.negate(),l.displacementMap&&(a.displacementMap.value=l.displacementMap,a.displacementScale.value=l.displacementScale,a.displacementBias.value=l.displacementBias);else if(r.isMeshDepthMaterial)c(t,r),a=t,(o=r).displacementMap&&(a.displacementMap.value=o.displacementMap,a.displacementScale.value=o.displacementScale,a.displacementBias.value=o.displacementBias);else if(r.isMeshDistanceMaterial)c(t,r),a=t,(o=r).displacementMap&&(a.displacementMap.value=o.displacementMap,a.displacementScale.value=o.displacementScale,a.displacementBias.value=o.displacementBias),a.referencePosition.value.copy(o.referencePosition),a.nearDistance.value=o.nearDistance,a.farDistance.value=o.farDistance;else if(r.isMeshNormalMaterial)c(t,r),a=t,(e=r).bumpMap&&(a.bumpMap.value=e.bumpMap,a.bumpScale.value=e.bumpScale,e.side===Ae)&&(a.bumpScale.value*=-1),e.normalMap&&(a.normalMap.value=e.normalMap,a.normalScale.value.copy(e.normalScale),e.side===Ae)&&a.normalScale.value.negate(),e.displacementMap&&(a.displacementMap.value=e.displacementMap,a.displacementScale.value=e.displacementScale,a.displacementBias.value=e.displacementBias);else if(r.isLineBasicMaterial)a=r,(e=t).diffuse.value.copy(a.color),e.opacity.value=a.opacity,r.isLineDashedMaterial&&(a=r,(s=t).dashSize.value=a.dashSize,s.totalSize.value=a.dashSize+a.gapSize,s.scale.value=a.scale);else if(r.isPointsMaterial){a=r,(s=t).diffuse.value.copy(a.color),s.opacity.value=a.opacity,s.size.value=a.size*i,s.scale.value=.5*n,a.map&&(s.map.value=a.map),a.alphaMap&&(s.alphaMap.value=a.alphaMap),0<a.alphaTest&&(s.alphaTest.value=a.alphaTest);let e;a.map?e=a.map:a.alphaMap&&(e=a.alphaMap),void 0!==e&&(!0===e.matrixAutoUpdate&&e.updateMatrix(),s.uvTransform.value.copy(e.matrix))}else if(r.isSpriteMaterial){n=r,(i=t).diffuse.value.copy(n.color),i.opacity.value=n.opacity,i.rotation.value=n.rotation,n.map&&(i.map.value=n.map),n.alphaMap&&(i.alphaMap.value=n.alphaMap),0<n.alphaTest&&(i.alphaTest.value=n.alphaTest);let e;n.map?e=n.map:n.alphaMap&&(e=n.alphaMap),void 0!==e&&(!0===e.matrixAutoUpdate&&e.updateMatrix(),i.uvTransform.value.copy(e.matrix))}else r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1);var s,e,o,l,h,u,d}}}function s(e={}){let n=void 0!==e.canvas?e.canvas:((j=Ei("canvas")).style.display="block",j),F=void 0!==e.context?e.context:null,N=void 0!==e.alpha&&e.alpha,B=void 0===e.depth||e.depth,U=void 0===e.stencil||e.stencil,G=void 0!==e.antialias&&e.antialias,z=void 0===e.premultipliedAlpha||e.premultipliedAlpha,H=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,V=void 0!==e.powerPreference?e.powerPreference:"default",W=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;var j;let u=null,b=null,r=[],a=[],_=(this.domElement=n,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=De,this.physicallyCorrectLights=!1,this.toneMapping=Ne,this.toneMappingExposure=1,this),Y=!1,$=0,q=0,T=null,S=-1,w=null,d=new Ie,K=new Ie,X=null,i=n.width,E=n.height,M=1,J=null,Z=null,l=new Ie(0,0,i,E),h=new Ie(0,0,i,E),Q=!1,c=[],ee=new Ka,te=!1,re=!1,A=null,ie=new ke,L=new Pe,ne={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ae(){return null===T?M:1}let f,R,C,p,D,I,P,se,oe,le,m,g,he,ue,de,k,s,o,ce,fe,pe,v,y,O=F;function me(t,r){for(let e=0;e<t.length;e++){var i=t[e],i=n.getContext(i,r);if(null!==i)return i}return null}try{let t={alpha:N,depth:B,stencil:U,antialias:G,premultipliedAlpha:z,preserveDrawingBuffer:H,powerPreference:V,failIfMajorPerformanceCaveat:W};if(n.addEventListener("webglcontextlost",ve,!1),n.addEventListener("webglcontextrestored",ye,!1),null===O){let e=["webgl2","webgl","experimental-webgl"];if(!0===_.isWebGL1Renderer&&e.shift(),null===(O=me(e,t)))throw me(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===O.getShaderPrecisionFormat&&(O.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function ge(){f=new Rs(O),R=new is(O,f,e),f.init(R),v=new Sl(O,f,R),C=new _l(O,f,R),c[0]=1029,p=new Is(O),D=new ol,I=new Tl(O,f,C,D,R,v,p),P=new as(_),se=new Ls(_),oe=new Ja(O,R),y=new ts(O,f,oe,R),le=new Cs(O,oe,p,y),m=new Bs(O,le,oe,p),ce=new Ns(O,R,I),k=new ns(D),g=new sl(_,P,se,f,R,y,k),he=new Rl(D),ue=new dl(D),de=new vl(f,R),o=new es(_,P,C,m,z),s=new bl(_,m,R),fe=new rs(O,f,p,R),pe=new Ds(O,f,p,R),p.programs=g.programs,_.capabilities=R,_.extensions=f,_.properties=D,_.renderLists=ue,_.shadowMap=s,_.state=C,_.info=p}ge();let x=new Ll(_,O);function ve(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Y=!0}function ye(){console.log("THREE.WebGLRenderer: Context Restored."),Y=!1;var e=p.autoReset,t=s.enabled,r=s.autoUpdate,i=s.needsUpdate,n=s.type;ge(),p.autoReset=e,s.enabled=t,s.autoUpdate=r,s.needsUpdate=i,s.type=n}function xe(e){var t,e=e.target;e.removeEventListener("dispose",xe),t=e=e,void 0!==(t=D.get(t).programs)&&t.forEach(function(e){g.releaseProgram(e)}),D.remove(e)}this.xr=x,this.getContext=function(){return O},this.getContextAttributes=function(){return O.getContextAttributes()},this.forceContextLoss=function(){var e=f.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=f.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return M},this.setPixelRatio=function(e){void 0!==e&&(M=e,this.setSize(i,E,!1))},this.getSize=function(e){return e.set(i,E)},this.setSize=function(e,t,r){x.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(i=e,E=t,n.width=Math.floor(e*M),n.height=Math.floor(t*M),!1!==r&&(n.style.width=e+"px",n.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(i*M,E*M).floor()},this.setDrawingBufferSize=function(e,t,r){i=e,E=t,M=r,n.width=Math.floor(e*r),n.height=Math.floor(t*r),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(d)},this.getViewport=function(e){return e.copy(l)},this.setViewport=function(e,t,r,i){e.isVector4?l.set(e.x,e.y,e.z,e.w):l.set(e,t,r,i),C.viewport(d.copy(l).multiplyScalar(M).floor())},this.getScissor=function(e){return e.copy(h)},this.setScissor=function(e,t,r,i){e.isVector4?h.set(e.x,e.y,e.z,e.w):h.set(e,t,r,i),C.scissor(K.copy(h).multiplyScalar(M).floor())},this.getScissorTest=function(){return Q},this.setScissorTest=function(e){C.setScissorTest(Q=e)},this.setOpaqueSort=function(e){J=e},this.setTransparentSort=function(e){Z=e},this.getClearColor=function(e){return e.copy(o.getClearColor())},this.setClearColor=function(){o.setClearColor.apply(o,arguments)},this.getClearAlpha=function(){return o.getClearAlpha()},this.setClearAlpha=function(){o.setClearAlpha.apply(o,arguments)},this.clear=function(e,t,r){let i=0;void 0!==e&&!e||(i|=16384),void 0!==t&&!t||(i|=256),void 0!==r&&!r||(i|=1024),O.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",ve,!1),n.removeEventListener("webglcontextrestored",ye,!1),ue.dispose(),de.dispose(),D.dispose(),P.dispose(),se.dispose(),m.dispose(),y.dispose(),x.dispose(),x.removeEventListener("sessionstart",_e),x.removeEventListener("sessionend",Te),A&&(A.dispose(),A=null),t.stop()},this.renderBufferDirect=function(e,t,r,i,n,a){null===t&&(t=ne);var s=n.isMesh&&n.matrixWorld.determinant()<0,e=function(t,e,r,i,n){!0!==e.isScene&&(e=ne),I.resetTextureUnits();var a=e.fog,s=i.isMeshStandardMaterial?e.environment:null,o=null===T?_.outputEncoding:T.texture.encoding,s=(i.isMeshStandardMaterial?se:P).get(i.envMap||s),l=!0===i.vertexColors&&!!r.attributes.color&&4===r.attributes.color.itemSize,h=!!i.normalMap&&!!r.attributes.tangent,u=!!r.morphAttributes.position,d=!!r.morphAttributes.normal,c=r.morphAttributes.position?r.morphAttributes.position.length:0,f=D.get(i),p=b.state.lights;if(!0===te&&(!0===re||t!==w)){let e=t===w&&i.id===S;k.setState(i,t,e)}let m=!1,g=(i.version===f.__version?(f.needsLights&&f.lightsStateVersion!==p.state.version||f.outputEncoding!==o||n.isInstancedMesh&&!1===f.instancing||!n.isInstancedMesh&&!0===f.instancing||n.isSkinnedMesh&&!1===f.skinning||!n.isSkinnedMesh&&!0===f.skinning||f.envMap!==s||i.fog&&f.fog!==a||void 0!==f.numClippingPlanes&&(f.numClippingPlanes!==k.numPlanes||f.numIntersection!==k.numIntersection)||f.vertexAlphas!==l||f.vertexTangents!==h||f.morphTargets!==u||f.morphNormals!==d||!0===R.isWebGL2&&f.morphTargetsCount!==c)&&(m=!0):(m=!0,f.__version=i.version),f.currentProgram),v=!1,y=!1,x=!1;p=(g=!0===m?Ee(i,e,n):g).getUniforms(),o=f.uniforms;if(C.useProgram(g.program)&&(v=!0,y=!0,x=!0),i.id!==S&&(S=i.id,y=!0),v||w!==t){if(p.setValue(O,"projectionMatrix",t.projectionMatrix),R.logarithmicDepthBuffer&&p.setValue(O,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),w!==t&&(w=t,y=!0,x=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){let e=p.map.cameraPosition;void 0!==e&&e.setValue(O,L.setFromMatrixPosition(t.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&p.setValue(O,"isOrthographic",!0===t.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||n.isSkinnedMesh)&&p.setValue(O,"viewMatrix",t.matrixWorldInverse)}if(n.isSkinnedMesh){p.setOptional(O,n,"bindMatrix"),p.setOptional(O,n,"bindMatrixInverse");let e=n.skeleton;e&&(R.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),p.setValue(O,"boneTexture",e.boneTexture,I),p.setValue(O,"boneTextureSize",e.boneTextureSize)):p.setOptional(O,e,"boneMatrices"))}return!r||void 0===r.morphAttributes.position&&void 0===r.morphAttributes.normal||ce.update(n,r,i,g),!y&&f.receiveShadow===n.receiveShadow||(f.receiveShadow=n.receiveShadow,p.setValue(O,"receiveShadow",n.receiveShadow)),y&&(p.setValue(O,"toneMappingExposure",_.toneMappingExposure),f.needsLights&&(s=x,(l=o).ambientLightColor.needsUpdate=s,l.lightProbe.needsUpdate=s,l.directionalLights.needsUpdate=s,l.directionalLightShadows.needsUpdate=s,l.pointLights.needsUpdate=s,l.pointLightShadows.needsUpdate=s,l.spotLights.needsUpdate=s,l.spotLightShadows.needsUpdate=s,l.rectAreaLights.needsUpdate=s,l.hemisphereLights.needsUpdate=s),a&&i.fog&&he.refreshFogUniforms(o,a),he.refreshMaterialUniforms(o,i,M,E,A),zo.upload(O,f.uniformsList,o,I)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(zo.upload(O,f.uniformsList,o,I),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&p.setValue(O,"center",n.center),p.setValue(O,"modelViewMatrix",n.modelViewMatrix),p.setValue(O,"normalMatrix",n.normalMatrix),p.setValue(O,"modelMatrix",n.matrixWorld),g}(e,t,r,i,n);C.setMaterial(i,s);let o=r.index;t=r.attributes.position;if(null===o){if(void 0===t||0===t.count)return}else if(0===o.count)return;let l,h=1,u=(!0===i.wireframe&&(o=le.getWireframeAttribute(r),h=2),y.setup(n,i,e,r,o),fe);null!==o&&(l=oe.get(o),(u=pe).setIndex(l));var s=(null!==o?o:t).count,e=r.drawRange.start*h,t=r.drawRange.count*h,d=null!==a?a.start*h:0,a=null!==a?a.count*h:1/0,c=Math.max(e,d),s=Math.min(s,e+t,d+a)-1,t=Math.max(0,s-c+1);if(0!==t){if(n.isMesh)!0===i.wireframe?(C.setLineWidth(i.wireframeLinewidth*ae()),u.setMode(1)):u.setMode(4);else if(n.isLine){let e=i.linewidth;void 0===e&&(e=1),C.setLineWidth(e*ae()),n.isLineSegments?u.setMode(1):n.isLineLoop?u.setMode(2):u.setMode(3)}else n.isPoints?u.setMode(0):n.isSprite&&u.setMode(4);if(n.isInstancedMesh)u.renderInstances(c,t,n.count);else if(r.isInstancedBufferGeometry){let e=Math.min(r.instanceCount,r._maxInstanceCount);u.renderInstances(c,t,e)}else u.render(c,t)}},this.compile=function(i,t){(b=de.get(i)).init(),a.push(b),i.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(b.pushLight(e),e.castShadow)&&b.pushShadow(e)}),b.setupLights(_.physicallyCorrectLights),i.traverse(function(t){var r=t.material;if(r)if(Array.isArray(r))for(let e=0;e<r.length;e++)Ee(r[e],i,t);else Ee(r,i,t)}),a.pop(),b=null};let be=null;function _e(){t.stop()}function Te(){t.start()}let t=new Xa;function Se(e,t,r,i){var n=e.opaque,a=e.transmissive,e=e.transparent;if(b.setupLightsView(r),0<a.length){var s=n,o=t,l=r;if(null===A){let e=!0===G&&!0===R.isWebGL2;A=new(e?Pi:Di)(1024,1024,{generateMipmaps:!0,type:null!==v.convert(ot)?ot:et,minFilter:Ze,magFilter:Re,wrapS:Le,wrapT:Le})}var h=_.getRenderTarget(),u=(_.setRenderTarget(A),_.clear(),_.toneMapping);_.toneMapping=Ne,we(s,o,l),_.toneMapping=u,I.updateMultisampleRenderTarget(A),I.updateRenderTargetMipmap(A),_.setRenderTarget(h)}i&&C.viewport(d.copy(i)),0<n.length&&we(n,t,r),0<a.length&&we(a,t,r),0<e.length&&we(e,t,r)}function we(r,i,n){var a,s,o=!0===i.isScene?i.overrideMaterial:null;for(let e=0,t=r.length;e<t;e++){var l=r[e],h=l.object,u=l.geometry,d=null===o?l.material:o,l=l.group;h.layers.test(n.layers)&&(a=i,s=n,u=u,d=d,l=l,(h=h).onBeforeRender(_,a,s,u,d,l),h.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,h.matrixWorld),h.normalMatrix.getNormalMatrix(h.modelViewMatrix),d.onBeforeRender(_,a,s,u,h,l),!0===d.transparent&&d.side===Fe?(d.side=Ae,d.needsUpdate=!0,_.renderBufferDirect(s,a,u,d,h,l),d.side=Oe,d.needsUpdate=!0,_.renderBufferDirect(s,a,u,d,h,l),d.side=Fe):_.renderBufferDirect(s,a,u,d,h,l),h.onAfterRender(_,a,s,u,d,l))}}function Ee(e,t,r){!0!==t.isScene&&(t=ne);var i=D.get(e),n=b.state.lights,a=b.state.shadowsArray,s=n.state.version,a=g.getParameters(e,n.state,a,t,r),o=g.getProgramCacheKey(a);let l=i.programs,h=(i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?se:P).get(e.envMap||i.environment),void 0===l&&(e.addEventListener("dispose",xe),l=new Map,i.programs=l),l.get(o));if(void 0!==h){if(i.currentProgram===h&&i.lightsStateVersion===s)return Me(e,a),h}else a.uniforms=g.getUniforms(e),e.onBuild(r,a,_),e.onBeforeCompile(a,_),h=g.acquireProgram(a,o),l.set(o,h),i.uniforms=a.uniforms;t=i.uniforms,(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(t.clippingPlanes=k.uniform),Me(e,a),i.needsLights=e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights,i.lightsStateVersion=s,i.needsLights&&(t.ambientLightColor.value=n.state.ambient,t.lightProbe.value=n.state.probe,t.directionalLights.value=n.state.directional,t.directionalLightShadows.value=n.state.directionalShadow,t.spotLights.value=n.state.spot,t.spotLightShadows.value=n.state.spotShadow,t.rectAreaLights.value=n.state.rectArea,t.ltc_1.value=n.state.rectAreaLTC1,t.ltc_2.value=n.state.rectAreaLTC2,t.pointLights.value=n.state.point,t.pointLightShadows.value=n.state.pointShadow,t.hemisphereLights.value=n.state.hemi,t.directionalShadowMap.value=n.state.directionalShadowMap,t.directionalShadowMatrix.value=n.state.directionalShadowMatrix,t.spotShadowMap.value=n.state.spotShadowMap,t.spotShadowMatrix.value=n.state.spotShadowMatrix,t.pointShadowMap.value=n.state.pointShadowMap,t.pointShadowMatrix.value=n.state.pointShadowMatrix),r=h.getUniforms(),o=zo.seqWithValue(r.seq,t);return i.currentProgram=h,i.uniformsList=o,h}function Me(e,t){e=D.get(e);e.outputEncoding=t.outputEncoding,e.instancing=t.instancing,e.skinning=t.skinning,e.morphTargets=t.morphTargets,e.morphNormals=t.morphNormals,e.morphTargetsCount=t.morphTargetsCount,e.numClippingPlanes=t.numClippingPlanes,e.numIntersection=t.numClipIntersection,e.vertexAlphas=t.vertexAlphas,e.vertexTangents=t.vertexTangents}t.setAnimationLoop(function(e){be&&be(e)}),"undefined"!=typeof window&&t.setContext(window),this.setAnimationLoop=function(e){be=e,x.setAnimationLoop(e),null===e?t.stop():t.start()},x.addEventListener("sessionstart",_e),x.addEventListener("sessionend",Te),this.render=function(i,t){if(void 0!==t&&!0!==t.isCamera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else if(!0!==Y){!0===i.autoUpdate&&i.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===x.enabled&&!0===x.isPresenting&&(!0===x.cameraAutoUpdate&&x.updateCamera(t),t=x.getCamera()),!0===i.isScene&&i.onBeforeRender(_,i,t,T),(b=de.get(i,a.length)).init(),a.push(b),ie.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),ee.setFromProjectionMatrix(ie),re=this.localClippingEnabled,te=k.init(this.clippingPlanes,re,t),(u=ue.get(i,r.length)).init(),r.push(u),function r(a,i,s,o){if(!1!==a.visible){if(a.layers.test(i.layers))if(a.isGroup)s=a.renderOrder;else if(a.isLOD)!0===a.autoUpdate&&a.update(i);else if(a.isLight)b.pushLight(a),a.castShadow&&b.pushShadow(a);else if(a.isSprite){if(!a.frustumCulled||ee.intersectsSprite(a)){o&&L.setFromMatrixPosition(a.matrixWorld).applyMatrix4(ie);let e=m.update(a),t=a.material;t.visible&&u.push(a,e,t,s,L.z,null)}}else if((a.isMesh||a.isLine||a.isPoints)&&(a.isSkinnedMesh&&a.skeleton.frame!==p.render.frame&&(a.skeleton.update(),a.skeleton.frame=p.render.frame),!a.frustumCulled||ee.intersectsObject(a))){o&&L.setFromMatrixPosition(a.matrixWorld).applyMatrix4(ie);let i=m.update(a),n=a.material;if(Array.isArray(n)){let r=i.groups;for(let e=0,t=r.length;e<t;e++){var l=r[e],h=n[l.materialIndex];h&&h.visible&&u.push(a,i,h,s,L.z,l)}}else n.visible&&u.push(a,i,n,s,L.z,null)}var n=a.children;for(let e=0,t=n.length;e<t;e++)r(n[e],i,s,o)}}(i,t,0,_.sortObjects),u.finish(),!0===_.sortObjects&&u.sort(J,Z),!0===te&&k.beginShadows();let e=b.state.shadowsArray;if(s.render(e,i,t),!0===te&&k.endShadows(),!0===this.info.autoReset&&this.info.reset(),o.render(u,i),b.setupLights(_.physicallyCorrectLights),t.isArrayCamera){let r=t.cameras;for(let e=0,t=r.length;e<t;e++){var n=r[e];Se(u,i,n,n.viewport)}}else Se(u,i,t);null!==T&&(I.updateMultisampleRenderTarget(T),I.updateRenderTargetMipmap(T)),!0===i.isScene&&i.onAfterRender(_,i,t),C.buffers.depth.setTest(!0),C.buffers.depth.setMask(!0),C.buffers.color.setMask(!0),C.setPolygonOffset(!1),y.resetDefaultState(),S=-1,w=null,a.pop(),b=0<a.length?a[a.length-1]:null,r.pop(),u=0<r.length?r[r.length-1]:null}},this.getActiveCubeFace=function(){return $},this.getActiveMipmapLevel=function(){return q},this.getRenderTarget=function(){return T},this.setRenderTarget=function(i,r=0,n=0){T=i,$=r,q=n,i&&void 0===D.get(i).__webglFramebuffer&&I.setupRenderTarget(i);let t=null,a=!1,s=!1;if(i){let e=i.texture;(e.isDataTexture3D||e.isDataTexture2DArray)&&(s=!0);var o=D.get(i).__webglFramebuffer;i.isWebGLCubeRenderTarget?(t=o[r],a=!0):t=i.isWebGLMultisampleRenderTarget?D.get(i).__webglMultisampledFramebuffer:o,d.copy(i.viewport),K.copy(i.scissor),X=i.scissorTest}else d.copy(l).multiplyScalar(M).floor(),K.copy(h).multiplyScalar(M).floor(),X=Q;if(C.bindFramebuffer(36160,t)&&R.drawBuffers){let e=!1;if(i)if(i.isWebGLMultipleRenderTargets){let r=i.texture;if(c.length!==r.length||36064!==c[0]){for(let e=0,t=r.length;e<t;e++)c[e]=36064+e;c.length=r.length,e=!0}}else 1===c.length&&36064===c[0]||(c[0]=36064,c.length=1,e=!0);else 1===c.length&&1029===c[0]||(c[0]=1029,c.length=1,e=!0);e&&(R.isWebGL2?O.drawBuffers(c):f.get("WEBGL_draw_buffers").drawBuffersWEBGL(c))}if(C.viewport(d),C.scissor(K),C.setScissorTest(X),a){let e=D.get(i.texture);O.framebufferTexture2D(36160,36064,34069+r,e.__webglTexture,n)}else if(s){let e=D.get(i.texture),t=r||0;O.framebufferTextureLayer(36160,36064,e.__webglTexture,n||0,t)}S=-1},this.readRenderTargetPixels=function(i,n,a,s,o,l,t){if(i&&i.isWebGLRenderTarget){let e=D.get(i).__webglFramebuffer;if(e=i.isWebGLCubeRenderTarget&&void 0!==t?e[t]:e){C.bindFramebuffer(36160,e);try{let e=i.texture,t=e.format,r=e.type;var h;t!==Ce&&v.convert(t)!==O.getParameter(35739)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):(h=r===ot&&(f.has("EXT_color_buffer_half_float")||R.isWebGL2&&f.has("EXT_color_buffer_float")),r===et||v.convert(r)===O.getParameter(35738)||r===st&&(R.isWebGL2||f.has("OES_texture_float")||f.has("WEBGL_color_buffer_float"))||h?36053===O.checkFramebufferStatus(36160)?0<=n&&n<=i.width-s&&0<=a&&a<=i.height-o&&O.readPixels(n,a,s,o,v.convert(t),v.convert(r),l):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type."))}finally{let e=null!==T?D.get(T).__webglFramebuffer:null;C.bindFramebuffer(36160,e)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,r=0){var i=Math.pow(2,-r),n=Math.floor(t.image.width*i),i=Math.floor(t.image.height*i);let a=v.convert(t.format);R.isWebGL2&&6408===(a=6407===a?32849:a)&&(a=32856),I.setTexture2D(t,0),O.copyTexImage2D(3553,r,a,e.x,e.y,n,i,0),C.unbindTexture()},this.copyTextureToTexture=function(e,t,r,i=0){var n=t.image.width,a=t.image.height,s=v.convert(r.format),o=v.convert(r.type);I.setTexture2D(r,0),O.pixelStorei(37440,r.flipY),O.pixelStorei(37441,r.premultiplyAlpha),O.pixelStorei(3317,r.unpackAlignment),t.isDataTexture?O.texSubImage2D(3553,i,e.x,e.y,n,a,s,o,t.image.data):t.isCompressedTexture?O.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,s,t.mipmaps[0].data):O.texSubImage2D(3553,i,e.x,e.y,s,o,t.image),0===i&&r.generateMipmaps&&O.generateMipmap(3553),C.unbindTexture()},this.copyTextureToTexture3D=function(t,r,i,n,a=0){if(_.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var s=t.max.x-t.min.x+1,o=t.max.y-t.min.y+1,l=t.max.z-t.min.z+1,h=v.convert(n.format),u=v.convert(n.type);let e;if(n.isDataTexture3D)I.setTexture3D(n,0),e=32879;else{if(!n.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");I.setTexture2DArray(n,0),e=35866}O.pixelStorei(37440,n.flipY),O.pixelStorei(37441,n.premultiplyAlpha),O.pixelStorei(3317,n.unpackAlignment);var d=O.getParameter(3314),c=O.getParameter(32878),f=O.getParameter(3316),p=O.getParameter(3315),m=O.getParameter(32877),g=i.isCompressedTexture?i.mipmaps[0]:i.image;O.pixelStorei(3314,g.width),O.pixelStorei(32878,g.height),O.pixelStorei(3316,t.min.x),O.pixelStorei(3315,t.min.y),O.pixelStorei(32877,t.min.z),i.isDataTexture||i.isDataTexture3D?O.texSubImage3D(e,a,r.x,r.y,r.z,s,o,l,h,u,g.data):i.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),O.compressedTexSubImage3D(e,a,r.x,r.y,r.z,s,o,l,h,g.data)):O.texSubImage3D(e,a,r.x,r.y,r.z,s,o,l,h,u,g),O.pixelStorei(3314,d),O.pixelStorei(32878,c),O.pixelStorei(3316,f),O.pixelStorei(3315,p),O.pixelStorei(32877,m),0===a&&n.generateMipmaps&&O.generateMipmap(e),C.unbindTexture()}},this.initTexture=function(e){I.setTexture2D(e,0),C.unbindTexture()},this.resetState=function(){$=0,q=0,T=null,C.reset(),y.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}s.prototype.isWebGLRenderer=!0;class Cl extends s{}Cl.prototype.isWebGL1Renderer=!0;class Dl{constructor(e,t=25e-5){this.name="",this.color=new m(e),this.density=t}clone(){return new Dl(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}Dl.prototype.isFogExp2=!0;class Il{constructor(e,t=1,r=1e3){this.name="",this.color=new m(e),this.near=t,this.far=r}clone(){return new Il(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Il.prototype.isFog=!0;class Pl extends f{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){e=super.toJSON(e);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}Pl.prototype.isScene=!0;class kl{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Zr,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=pi()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(r,i,n){r*=this.stride,n*=i.stride;for(let e=0,t=this.stride;e<t;e++)this.array[r+e]=i.array[n+e];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=pi()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);e=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),e=new this.constructor(e,this.stride);return e.setUsage(this.usage),e}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=pi()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}kl.prototype.isInterleavedBuffer=!0;let o=new Pe;class Ol{constructor(e,t,r,i=!1){this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=!0===i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(r){for(let e=0,t=this.data.count;e<t;e++)o.x=this.getX(e),o.y=this.getY(e),o.z=this.getZ(e),o.applyMatrix4(r),this.setXYZ(e,o.x,o.y,o.z);return this}applyNormalMatrix(r){for(let e=0,t=this.count;e<t;e++)o.x=this.getX(e),o.y=this.getY(e),o.z=this.getZ(e),o.applyNormalMatrix(r),this.setXYZ(e,o.x,o.y,o.z);return this}transformDirection(r){for(let e=0,t=this.count;e<t;e++)o.x=this.getX(e),o.y=this.getY(e),o.z=this.getZ(e),o.transformDirection(r),this.setXYZ(e,o.x,o.y,o.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this}setXYZ(e,t,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this}setXYZW(e,t,r,i,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=n,this}clone(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Ol(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);{console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");let t=[];for(let e=0;e<this.count;e++){var r=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[r+e])}return new E(new this.array.constructor(t),this.itemSize,this.normalized)}}toJSON(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized};{console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");let t=[];for(let e=0;e<this.count;e++){var r=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[r+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}}}Ol.prototype.isInterleavedBufferAttribute=!0;class Fl extends r{constructor(e){super(),this.type="SpriteMaterial",this.color=new m(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let Nl,Bl=(Fl.prototype.isSpriteMaterial=!0,new Pe),Ul=new Pe,Gl=new Pe,zl=new V,Hl=new V,Vl=new ke,Wl=new Pe,jl=new Pe,Yl=new Pe,$l=new V,ql=new V,Kl=new V;class Xl extends f{constructor(e){if(super(),this.type="Sprite",void 0===Nl){Nl=new S;let e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new kl(e,5);Nl.setIndex([0,1,2,0,2,3]),Nl.setAttribute("position",new Ol(t,3,0,!1)),Nl.setAttribute("uv",new Ol(t,2,3,!1))}this.geometry=Nl,this.material=void 0!==e?e:new Fl,this.center=new V(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ul.setFromMatrixScale(this.matrixWorld),Vl.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Gl.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ul.multiplyScalar(-Gl.z);var r=this.material.rotation;let i,n;0!==r&&(n=Math.cos(r),i=Math.sin(r));var r=this.center,a=(Jl(Wl.set(-.5,-.5,0),Gl,r,Ul,i,n),Jl(jl.set(.5,-.5,0),Gl,r,Ul,i,n),Jl(Yl.set(.5,.5,0),Gl,r,Ul,i,n),$l.set(0,0),ql.set(1,0),Kl.set(1,1),e.ray.intersectTriangle(Wl,jl,Yl,!1,Bl));null===a&&(Jl(jl.set(-.5,.5,0),Gl,r,Ul,i,n),ql.set(0,1),null===(a=e.ray.intersectTriangle(Wl,Yl,jl,!1,Bl)))||(r=e.ray.origin.distanceTo(Bl))<e.near||r>e.far||t.push({distance:r,point:Bl.clone(),uv:p.getUV(Bl,Wl,jl,Yl,$l,ql,Kl,new V),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function Jl(e,t,r,i,n,a){zl.subVectors(e,r).addScalar(.5).multiply(i),void 0!==n?(Hl.x=a*zl.x-n*zl.y,Hl.y=n*zl.x+a*zl.y):Hl.copy(zl),e.copy(t),e.x+=Hl.x,e.y+=Hl.y,e.applyMatrix4(Vl)}Xl.prototype.isSprite=!0;let Zl=new Pe,Ql=new Pe;class eh extends f{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);var r=e.levels;for(let e=0,t=r.length;e<t;e++){var i=r[e];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);var r=this.levels;let i;for(i=0;i<r.length&&!(t<r[i].distance);i++);return r.splice(i,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(r){var i=this.levels;if(0<i.length){let e,t;for(e=1,t=i.length;e<t&&!(r<i[e].distance);e++);return i[e-1].object}return null}raycast(e,t){var r;0<this.levels.length&&(Zl.setFromMatrixPosition(this.matrixWorld),r=e.ray.origin.distanceTo(Zl),this.getObjectForDistance(r).raycast(e,t))}update(r){var i=this.levels;if(1<i.length){Zl.setFromMatrixPosition(r.matrixWorld),Ql.setFromMatrixPosition(this.matrixWorld);var n=Zl.distanceTo(Ql)/r.zoom;let e,t;for(i[0].object.visible=!0,e=1,t=i.length;e<t&&n>=i[e].distance;e++)i[e-1].object.visible=!1,i[e].object.visible=!0;for(this._currentLevel=e-1;e<t;e++)i[e].object.visible=!1}}toJSON(e){var r=super.toJSON(e),i=(!1===this.autoUpdate&&(r.object.autoUpdate=!1),r.object.levels=[],this.levels);for(let e=0,t=i.length;e<t;e++){var n=i[e];r.object.levels.push({object:n.object.uuid,distance:n.distance})}return r}}let th=new Pe,rh=new Ie,ih=new Ie,nh=new Pe,ah=new ke;class sh extends w{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ke,this.bindMatrixInverse=new ke}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){var r=new Ie,i=this.geometry.attributes.skinWeight;for(let e=0,t=i.count;e<t;e++){r.x=i.getX(e),r.y=i.getY(e),r.z=i.getZ(e),r.w=i.getW(e);var n=1/r.manhattanLength();n!=1/0?r.multiplyScalar(n):r.set(1,0,0,0),i.setXYZW(e,r.x,r.y,r.z,r.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,r){let i=this.skeleton,t=this.geometry;rh.fromBufferAttribute(t.attributes.skinIndex,e),ih.fromBufferAttribute(t.attributes.skinWeight,e),th.copy(r).applyMatrix4(this.bindMatrix),r.set(0,0,0);for(let t=0;t<4;t++){let e=ih.getComponent(t);var n;0!==e&&(n=rh.getComponent(t),ah.multiplyMatrices(i.bones[n].matrixWorld,i.boneInverses[n]),r.addScaledVector(nh.copy(th).applyMatrix4(ah),e))}return r.applyMatrix4(this.bindMatrixInverse)}}sh.prototype.isSkinnedMesh=!0;class oh extends f{constructor(){super(),this.type="Bone"}}oh.prototype.isBone=!0;class lh extends u{constructor(e=null,t=1,r=1,i,n,a,s,o,l=Re,h=Re,u,d){super(null,a,s,o,l,h,i,n,u,d),this.image={data:e,width:t,height:r},this.magFilter=l,this.minFilter=h,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}lh.prototype.isDataTexture=!0;let hh=new ke,uh=new ke;class dh{constructor(e=[],t=[]){this.uuid=pi(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){var e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new ke)}}calculateInverses(){for(let e=this.boneInverses.length=0,t=this.bones.length;e<t;e++){var r=new ke;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){var r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){var i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){var r=this.bones,i=this.boneInverses,n=this.boneMatrices,e=this.boneTexture;for(let e=0,t=r.length;e<t;e++){var a=r[e]?r[e].matrixWorld:uh;hh.multiplyMatrices(a,i[e]),hh.toArray(n,16*e)}null!==e&&(e.needsUpdate=!0)}clone(){return new dh(this.bones,this.boneInverses)}computeBoneTexture(){var e=xi(Math.sqrt(4*this.bones.length)),t=(e=Math.max(e,4),new Float32Array(e*e*4)),r=(t.set(this.boneMatrices),new lh(t,e,e,Ce,st));return this.boneMatrices=t,this.boneTexture=r,this.boneTextureSize=e,this}getBoneByName(r){for(let e=0,t=this.bones.length;e<t;e++){var i=this.bones[e];if(i.name===r)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(r,i){this.uuid=r.uuid;for(let t=0,e=r.bones.length;t<e;t++){var n=r.bones[t];let e=i[n];void 0===e&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),e=new oh),this.bones.push(e),this.boneInverses.push((new ke).fromArray(r.boneInverses[t]))}return this.init(),this}toJSON(){var r={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]},i=(r.uuid=this.uuid,this.bones),n=this.boneInverses;for(let e=0,t=i.length;e<t;e++){var a=i[e],a=(r.bones.push(a.uuid),n[e]);r.boneInverses.push(a.toArray())}return r}}class ch extends E{constructor(e,t,r,i=1){"number"==typeof r&&(i=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,r),this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){var e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}ch.prototype.isInstancedBufferAttribute=!0;let fh=new ke,ph=new ke,mh=[],gh=new w;class vh extends w{constructor(e,t,r){super(e,t),this.instanceMatrix=new ch(new Float32Array(16*r),16),this.instanceColor=null,this.count=r,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,i){let t=this.matrixWorld,n=this.count;if(gh.geometry=this.geometry,gh.material=this.material,void 0!==gh.material)for(let r=0;r<n;r++){this.getMatrixAt(r,fh),ph.multiplyMatrices(t,fh),gh.matrixWorld=ph,gh.raycast(e,mh);for(let t=0,e=mh.length;t<e;t++){let e=mh[t];e.instanceId=r,e.object=this,i.push(e)}mh.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new ch(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}vh.prototype.isInstancedMesh=!0;class g extends r{constructor(e){super(),this.type="LineBasicMaterial",this.color=new m(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}g.prototype.isLineBasicMaterial=!0;let yh=new Pe,xh=new Pe,bh=new ke,_h=new dn,Th=new rn;class Sh extends f{constructor(e=new S,t=new g){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){var r=e.attributes.position,i=[0];for(let e=1,t=r.count;e<t;e++)yh.fromBufferAttribute(r,e-1),xh.fromBufferAttribute(r,e),i[e]=i[e-1],i[e]+=yh.distanceTo(xh);e.setAttribute("lineDistance",new W(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(d,c){let t=this.geometry,r=this.matrixWorld,i=d.params.Line.threshold,f=t.drawRange;if(null===t.boundingSphere&&t.computeBoundingSphere(),Th.copy(t.boundingSphere),Th.applyMatrix4(r),Th.radius+=i,!1!==d.ray.intersectsSphere(Th)){bh.copy(r).invert(),_h.copy(d.ray).applyMatrix4(bh);let e=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=e*e,s=new Pe,o=new Pe,l=new Pe,h=new Pe,u=this.isLineSegments?2:1;if(t.isBufferGeometry){let i=t.index,n=t.attributes.position;if(null!==i)for(let r=Math.max(0,f.start),e=Math.min(i.count,f.start+f.count)-1;r<e;r+=u){let e=i.getX(r),t=i.getX(r+1);if(s.fromBufferAttribute(n,e),o.fromBufferAttribute(n,t),!(_h.distanceSqToSegment(s,o,h,l)>a)){h.applyMatrix4(this.matrixWorld);let e=d.ray.origin.distanceTo(h);e<d.near||e>d.far||c.push({distance:e,point:l.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this})}}else for(let t=Math.max(0,f.start),e=Math.min(n.count,f.start+f.count)-1;t<e;t+=u)if(s.fromBufferAttribute(n,t),o.fromBufferAttribute(n,t+1),!(_h.distanceSqToSegment(s,o,h,l)>a)){h.applyMatrix4(this.matrixWorld);let e=d.ray.origin.distanceTo(h);e<d.near||e>d.far||c.push({distance:e,point:l.clone().applyMatrix4(this.matrixWorld),index:t,face:null,faceIndex:null,object:this})}}else t.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,i=Object.keys(t);if(0<i.length){let r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){var n=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{t=e.morphTargets;void 0!==t&&0<t.length&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Sh.prototype.isLine=!0;let wh=new Pe,Eh=new Pe;class Mh extends Sh{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){var r=e.attributes.position,i=[];for(let e=0,t=r.count;e<t;e+=2)wh.fromBufferAttribute(r,e),Eh.fromBufferAttribute(r,e+1),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+wh.distanceTo(Eh);e.setAttribute("lineDistance",new W(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Mh.prototype.isLineSegments=!0;class Ah extends Sh{constructor(e,t){super(e,t),this.type="LineLoop"}}Ah.prototype.isLineLoop=!0;class Lh extends r{constructor(e){super(),this.type="PointsMaterial",this.color=new m(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}Lh.prototype.isPointsMaterial=!0;let Rh=new ke,Ch=new dn,Dh=new rn,Ih=new Pe;class Ph extends f{constructor(e=new S,t=new Lh){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(a,s){let t=this.geometry,o=this.matrixWorld,r=a.params.Points.threshold,l=t.drawRange;if(null===t.boundingSphere&&t.computeBoundingSphere(),Dh.copy(t.boundingSphere),Dh.applyMatrix4(o),Dh.radius+=r,!1!==a.ray.intersectsSphere(Dh)){Rh.copy(o).invert(),Ch.copy(a.ray).applyMatrix4(Rh);let e=r/((this.scale.x+this.scale.y+this.scale.z)/3),n=e*e;if(t.isBufferGeometry){let r=t.index,i=t.attributes.position;if(null!==r)for(let t=Math.max(0,l.start),e=Math.min(r.count,l.start+l.count);t<e;t++){let e=r.getX(t);Ih.fromBufferAttribute(i,e),kh(Ih,e,n,o,a,s,this)}else for(let e=Math.max(0,l.start),t=Math.min(i.count,l.start+l.count);e<t;e++)Ih.fromBufferAttribute(i,e),kh(Ih,e,n,o,a,s,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,i=Object.keys(t);if(0<i.length){let r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){var n=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{t=e.morphTargets;void 0!==t&&0<t.length&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function kh(t,r,e,i,n,a,s){var o=Ch.distanceSqToPoint(t);if(o<e){let e=new Pe;Ch.closestPointToPoint(t,e),e.applyMatrix4(i);t=n.ray.origin.distanceTo(e);t<n.near||t>n.far||a.push({distance:t,distanceToRay:Math.sqrt(o),point:e,index:r,face:null,object:s})}}Ph.prototype.isPoints=!0;class Oh extends u{constructor(t,e,r,i,n,a,s,o,l){super(t,e,r,i,n,a,s,o,l),this.format=void 0!==s?s:ft,this.minFilter=void 0!==a?a:B,this.magFilter=void 0!==n?n:B,this.generateMipmaps=!1;let h=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(function e(){h.needsUpdate=!0,t.requestVideoFrameCallback(e)})}clone(){return new this.constructor(this.image).copy(this)}update(){var e=this.image;!1=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}Oh.prototype.isVideoTexture=!0;class Fh extends u{constructor(e,t,r,i,n,a,s,o,l,h,u,d){super(null,a,s,o,l,h,i,n,u,d),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}Fh.prototype.isCompressedTexture=!0;class Nh extends u{constructor(e,t,r,i,n,a,s,o,l){super(e,t,r,i,n,a,s,o,l),this.needsUpdate=!0}}Nh.prototype.isCanvasTexture=!0;class Bh extends u{constructor(e,t,r,i,n,a,s,o,l,h){if((h=void 0!==h?h:vt)!==vt&&h!==yt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super(null,i,n,a,s,o,h,r=void 0===(r=void 0===r&&h===vt?it:r)&&h===yt?dt:r,l),this.image={width:e,height:t},this.magFilter=void 0!==s?s:Re,this.minFilter=void 0!==o?o:Re,this.flipY=!1,this.generateMipmaps=!1}}Bh.prototype.isDepthTexture=!0;class Uh extends S{constructor(r=1,i=8,n=0,a=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:r,segments:i,thetaStart:n,thetaLength:a},i=Math.max(3,i);var t=[],s=[],o=[],l=[],h=new Pe,u=new V;s.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let e=0,t=3;e<=i;e++,t+=3){var d=n+e/i*a;h.x=r*Math.cos(d),h.y=r*Math.sin(d),s.push(h.x,h.y,h.z),o.push(0,0,1),u.x=(s[t]/r+1)/2,u.y=(s[t+1]/r+1)/2,l.push(u.x,u.y)}for(let e=1;e<=i;e++)t.push(e,e+1,0);this.setIndex(t),this.setAttribute("position",new W(s,3)),this.setAttribute("normal",new W(o,3)),this.setAttribute("uv",new W(l,2))}static fromJSON(e){return new Uh(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Gh extends S{constructor(t=1,r=1,u=1,d=8,i=1,e=!1,c=0,f=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:r,height:u,radialSegments:d,heightSegments:i,openEnded:e,thetaStart:c,thetaLength:f};let p=this,m=(d=Math.floor(d),i=Math.floor(i),[]),g=[],v=[],y=[],x=0,b=[],_=u/2,T=0;function n(i){let n=x,a=new V,s=new Pe,o=0;var l=!0===i?t:r,h=!0===i?1:-1;for(let e=1;e<=d;e++)g.push(0,_*h,0),v.push(0,h,0),y.push(.5,.5),x++;var u=x;for(let i=0;i<=d;i++){let e=i/d*f+c,t=Math.cos(e),r=Math.sin(e);s.x=l*r,s.y=_*h,s.z=l*t,g.push(s.x,s.y,s.z),v.push(0,h,0),a.x=.5*t+.5,a.y=.5*r*h+.5,y.push(a.x,a.y),x++}for(let r=0;r<d;r++){let e=n+r,t=u+r;!0===i?m.push(t,t+1,e):m.push(t+1,t,e),o+=3}p.addGroup(T,o,!0===i?1:2),T+=o}{let l=new Pe,h=new Pe,s=0;var S=(r-t)/u;for(let e=0;e<=i;e++){let a=[],s=e/i,o=s*(r-t)+t;for(let n=0;n<=d;n++){let e=n/d,t=e*f+c,r=Math.sin(t),i=Math.cos(t);h.x=o*r,h.y=-s*u+_,h.z=o*i,g.push(h.x,h.y,h.z),l.set(r,S,i).normalize(),v.push(l.x,l.y,l.z),y.push(e,1-s),a.push(x++)}b.push(a)}for(let a=0;a<d;a++)for(let n=0;n<i;n++){let e=b[n][a],t=b[n+1][a],r=b[n+1][a+1],i=b[n][a+1];m.push(e,t,i),m.push(t,r,i),s+=6}p.addGroup(T,s,0),T+=s}!1===e&&(0<t&&n(!0),0<r)&&n(!1),this.setIndex(m),this.setAttribute("position",new W(g,3)),this.setAttribute("normal",new W(v,3)),this.setAttribute("uv",new W(y,2))}static fromJSON(e){return new Gh(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class zh extends Gh{constructor(e=1,t=1,r=8,i=1,n=!1,a=0,s=2*Math.PI){super(0,e,t,r,i,n,a,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:n,thetaStart:a,thetaLength:s}}static fromJSON(e){return new zh(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Hh extends S{constructor(r=[],t=[],e=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:r,indices:t,radius:e,detail:i};let n=[],a=[];function s(e){n.push(e.x,e.y,e.z)}function o(e,t){e*=3;t.x=r[0+e],t.y=r[1+e],t.z=r[2+e]}function l(e,t,r,i){i<0&&1===e.x&&(a[t]=e.x-1),0===r.x&&0===r.z&&(a[t]=i/2/Math.PI+.5)}function h(e){return Math.atan2(e.z,-e.x)}var u=i,d=new Pe,c=new Pe,f=new Pe;for(let e=0;e<t.length;e+=3){o(t[e+0],d),o(t[e+1],c),o(t[e+2],f);{p=void 0;m=void 0;g=void 0;v=void 0;y=void 0;x=void 0;var p=d;var m=c;var g=f;var v=u;var y=v+1,x=[];for(let n=0;n<=y;n++){x[n]=[];let t=p.clone().lerp(g,n/y),r=m.clone().lerp(g,n/y),i=y-n;for(let e=0;e<=i;e++)x[n][e]=0===e&&n===y?t:t.clone().lerp(r,e/i)}for(let r=0;r<y;r++)for(let t=0;t<2*(y-r)-1;t++){let e=Math.floor(t/2);t%2==0?(s(x[r][e+1]),s(x[r+1][e]),s(x[r][e])):(s(x[r][e+1]),s(x[r+1][e+1]),s(x[r+1][e]))}}}var b=e,_=new Pe;for(let e=0;e<n.length;e+=3)_.x=n[e+0],_.y=n[e+1],_.z=n[e+2],_.normalize().multiplyScalar(b),n[e+0]=_.x,n[e+1]=_.y,n[e+2]=_.z;var T=new Pe;for(let e=0;e<n.length;e+=3){T.x=n[e+0],T.y=n[e+1],T.z=n[e+2];var S=h(T)/2/Math.PI+.5,w=Math.atan2(-T.y,Math.sqrt(T.x*T.x+T.z*T.z))/Math.PI+.5;a.push(S,1-w)}var E=new Pe,M=new Pe,A=new Pe,L=new Pe,R=new V,C=new V,D=new V;for(let e=0,t=0;e<n.length;e+=9,t+=6){E.set(n[e+0],n[e+1],n[e+2]),M.set(n[e+3],n[e+4],n[e+5]),A.set(n[e+6],n[e+7],n[e+8]),R.set(a[t+0],a[t+1]),C.set(a[t+2],a[t+3]),D.set(a[t+4],a[t+5]),L.copy(E).add(M).add(A).divideScalar(3);var I=h(L);l(R,t+0,E,I),l(C,t+2,M,I),l(D,t+4,A,I)}for(let e=0;e<a.length;e+=6){var P=a[e+0],k=a[e+2],O=a[e+4],F=Math.max(P,k,O),N=Math.min(P,k,O);.9<F&&N<.1&&(P<.2&&(a[e+0]+=1),k<.2&&(a[e+2]+=1),O<.2)&&(a[e+4]+=1)}this.setAttribute("position",new W(n,3)),this.setAttribute("normal",new W(n.slice(),3)),this.setAttribute("uv",new W(a,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new Hh(e.vertices,e.indices,e.radius,e.details)}}class Vh extends Hh{constructor(e=1,t=0){var r=(1+Math.sqrt(5))/2,i=1/r;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Vh(e.radius,e.detail)}}let Wh=new Pe,jh=new Pe,Yh=new Pe,$h=new p;class qh extends S{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){var n=Math.pow(10,4),l=Math.cos(di*t),a=e.getIndex(),s=e.getAttribute("position"),r=(a||s).count,h=[0,0,0],u=["a","b","c"],d=new Array(3),c={},f=[];for(let i=0;i<r;i+=3){a?(h[0]=a.getX(i),h[1]=a.getX(i+1),h[2]=a.getX(i+2)):(h[0]=i,h[1]=i+1,h[2]=i+2);let{a:e,b:t,c:r}=$h;if(e.fromBufferAttribute(s,h[0]),t.fromBufferAttribute(s,h[1]),r.fromBufferAttribute(s,h[2]),$h.getNormal(Yh),d[0]=`${Math.round(e.x*n)},${Math.round(e.y*n)},`+Math.round(e.z*n),d[1]=`${Math.round(t.x*n)},${Math.round(t.y*n)},`+Math.round(t.z*n),d[2]=`${Math.round(r.x*n)},${Math.round(r.y*n)},`+Math.round(r.z*n),d[0]!==d[1]&&d[1]!==d[2]&&d[2]!==d[0])for(let o=0;o<3;o++){let e=(o+1)%3,t=d[o],r=d[e],i=$h[u[o]],n=$h[u[e]],a=t+"_"+r,s=r+"_"+t;s in c&&c[s]?(Yh.dot(c[s].normal)<=l&&(f.push(i.x,i.y,i.z),f.push(n.x,n.y,n.z)),c[s]=null):a in c||(c[a]={index0:h[o],index1:h[e],normal:Yh.clone()})}}for(let r in c)if(c[r]){let{index0:e,index1:t}=c[r];Wh.fromBufferAttribute(s,e),jh.fromBufferAttribute(s,t),f.push(Wh.x,Wh.y,Wh.z),f.push(jh.x,jh.y,jh.z)}this.setAttribute("position",new W(f,3))}}}class Kh{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){e=this.getUtoTmapping(e);return this.getPoint(e,t)}getPoints(t=5){var r=[];for(let e=0;e<=t;e++)r.push(this.getPoint(e/t));return r}getSpacedPoints(t=5){var r=[];for(let e=0;e<=t;e++)r.push(this.getPointAt(e/t));return r}getLength(){var e=this.getLengths();return e[e.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var r=[];let i,n=this.getPoint(0),a=0;r.push(0);for(let e=1;e<=t;e++)i=this.getPoint(e/t),a+=i.distanceTo(n),r.push(a),n=i;return this.cacheArcLengths=r}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){var r=this.getLengths();let i=0;var n=r.length,a=t||e*r[n-1];let s,o=0,l=n-1;for(;o<=l;)if((s=r[i=Math.floor(o+(l-o)/2)]-a)<0)o=i+1;else{if(!(0<s)){l=i;break}l=i-1}return r[i=l]===a?i/(n-1):(t=r[i],(i+(a-t)/(r[i+1]-t))/(n-1))}getTangent(e,t){let r=e-1e-4,i=e+1e-4;r<0&&(r=0),1<i&&(i=1);var e=this.getPoint(r),n=this.getPoint(i),t=t||new(e.isVector2?V:Pe);return t.copy(n).sub(e).normalize(),t}getTangentAt(e,t){e=this.getUtoTmapping(e);return this.getTangent(e,t)}computeFrenetFrames(r,e){let t=new Pe,i=[],n=[],a=[],s=new Pe,o=new ke;for(let t=0;t<=r;t++){let e=t/r;i[t]=this.getTangentAt(e,new Pe)}n[0]=new Pe,a[0]=new Pe;let l=Number.MAX_VALUE;var h=Math.abs(i[0].x),u=Math.abs(i[0].y),d=Math.abs(i[0].z);h<=l&&(l=h,t.set(1,0,0)),u<=l&&(l=u,t.set(0,1,0)),d<=l&&t.set(0,0,1),s.crossVectors(i[0],t).normalize(),n[0].crossVectors(i[0],s),a[0].crossVectors(i[0],n[0]);for(let t=1;t<=r;t++){if(n[t]=n[t-1].clone(),a[t]=a[t-1].clone(),s.crossVectors(i[t-1],i[t]),s.length()>Number.EPSILON){s.normalize();let e=Math.acos(mi(i[t-1].dot(i[t]),-1,1));n[t].applyMatrix4(o.makeRotationAxis(s,e))}a[t].crossVectors(i[t],n[t])}if(!0===e){let t=Math.acos(mi(n[0].dot(n[r]),-1,1));t/=r,0<i[0].dot(s.crossVectors(n[0],n[r]))&&(t=-t);for(let e=1;e<=r;e++)n[e].applyMatrix4(o.makeRotationAxis(i[e],t*e)),a[e].crossVectors(i[e],n[e])}return{tangents:i,normals:n,binormals:a}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Xh extends Kh{constructor(e=0,t=0,r=1,i=1,n=0,a=2*Math.PI,s=!1,o=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=n,this.aEndAngle=a,this.aClockwise=s,this.aRotation=o}getPoint(e,t){let r=t||new V,i=2*Math.PI,n=this.aEndAngle-this.aStartAngle;for(t=Math.abs(n)<Number.EPSILON;n<0;)n+=i;for(;n>i;)n-=i;n<Number.EPSILON&&(n=t?0:i),!0!==this.aClockwise||t||(n===i?n=-i:n-=i);t=this.aStartAngle+e*n;let a=this.aX+this.xRadius*Math.cos(t),s=this.aY+this.yRadius*Math.sin(t);if(0!==this.aRotation){let e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),r=a-this.aX,i=s-this.aY;a=r*e-i*t+this.aX,s=r*t+i*e+this.aY}return r.set(a,s)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){var e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Xh.prototype.isEllipseCurve=!0;class Jh extends Xh{constructor(e,t,r,i,n,a){super(e,t,r,r,i,n,a),this.type="ArcCurve"}}function Zh(){let n=0,a=0,s=0,o=0;function l(e,t,r,i){n=e,a=r,s=-3*e+3*t-2*r-i,o=2*e-2*t+r+i}return{initCatmullRom:function(e,t,r,i,n){l(t,r,n*(r-e),n*(i-t))},initNonuniformCatmullRom:function(e,t,r,i,n,a,s){e=(t-e)/n-(r-e)/(n+a)+(r-t)/a,n=(r-t)/a-(i-t)/(a+s)+(i-r)/s;l(t,r,e*=a,n*=a)},calc:function(e){var t=e*e;return n+a*e+s*t+o*(t*e)}}}Jh.prototype.isArcCurve=!0;let Qh=new Pe,eu=new Zh,tu=new Zh,ru=new Zh;class iu extends Kh{constructor(e=[],t=!1,r="centripetal",i=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=r,this.tension=i}getPoint(e,t=new Pe){var r=this.points,i=r.length,e=(i-(this.closed?0:1))*e;let n,a,s=Math.floor(e),o=e-s;this.closed?s+=0<s?0:(Math.floor(Math.abs(s)/i)+1)*i:0===o&&s===i-1&&(s=i-2,o=1),n=this.closed||0<s?r[(s-1)%i]:(Qh.subVectors(r[0],r[1]).add(r[0]),Qh);var l=r[s%i],h=r[(s+1)%i];if(a=this.closed||s+2<i?r[(s+2)%i]:(Qh.subVectors(r[i-1],r[i-2]).add(r[i-1]),Qh),"centripetal"===this.curveType||"chordal"===this.curveType){let e="chordal"===this.curveType?.5:.25,t=Math.pow(n.distanceToSquared(l),e),r=Math.pow(l.distanceToSquared(h),e),i=Math.pow(h.distanceToSquared(a),e);r<1e-4&&(r=1),t<1e-4&&(t=r),i<1e-4&&(i=r),eu.initNonuniformCatmullRom(n.x,l.x,h.x,a.x,t,r,i),tu.initNonuniformCatmullRom(n.y,l.y,h.y,a.y,t,r,i),ru.initNonuniformCatmullRom(n.z,l.z,h.z,a.z,t,r,i)}else"catmullrom"===this.curveType&&(eu.initCatmullRom(n.x,l.x,h.x,a.x,this.tension),tu.initCatmullRom(n.y,l.y,h.y,a.y,this.tension),ru.initCatmullRom(n.z,l.z,h.z,a.z,this.tension));return t.set(eu.calc(o),tu.calc(o),ru.calc(o)),t}copy(r){super.copy(r),this.points=[];for(let e=0,t=r.points.length;e<t;e++){var i=r.points[e];this.points.push(i.clone())}return this.closed=r.closed,this.curveType=r.curveType,this.tension=r.tension,this}toJSON(){var r=super.toJSON();r.points=[];for(let e=0,t=this.points.length;e<t;e++){var i=this.points[e];r.points.push(i.toArray())}return r.closed=this.closed,r.curveType=this.curveType,r.tension=this.tension,r}fromJSON(r){super.fromJSON(r),this.points=[];for(let e=0,t=r.points.length;e<t;e++){var i=r.points[e];this.points.push((new Pe).fromArray(i))}return this.closed=r.closed,this.curveType=r.curveType,this.tension=r.tension,this}}function nu(e,t,r,i,n){var t=.5*(i-t),n=.5*(n-r),a=e*e;return e*a*(2*r-2*i+t+n)+(-3*r+3*i-2*t-n)*a+t*e+r}function au(e,t,r,i){return(n=1-e)*n*t+2*(1-e)*e*r+e*e*i;var n}function su(e,t,r,i,n){return(a=1-e)*a*a*t+3*(a=1-e)*a*e*r+3*(1-e)*e*e*i+e*e*e*n;var a}iu.prototype.isCatmullRomCurve3=!0;class ou extends Kh{constructor(e=new V,t=new V,r=new V,i=new V){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new V){var r=this.v0,i=this.v1,n=this.v2,a=this.v3;return t.set(su(e,r.x,i.x,n.x,a.x),su(e,r.y,i.y,n.y,a.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){var e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}ou.prototype.isCubicBezierCurve=!0;class lu extends Kh{constructor(e=new Pe,t=new Pe,r=new Pe,i=new Pe){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new Pe){var r=this.v0,i=this.v1,n=this.v2,a=this.v3;return t.set(su(e,r.x,i.x,n.x,a.x),su(e,r.y,i.y,n.y,a.y),su(e,r.z,i.z,n.z,a.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){var e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}lu.prototype.isCubicBezierCurve3=!0;class hu extends Kh{constructor(e=new V,t=new V){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new V){return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){t=t||new V;return t.copy(this.v2).sub(this.v1).normalize(),t}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){var e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}hu.prototype.isLineCurve=!0;class uu extends Kh{constructor(e=new Pe,t=new Pe){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new Pe){return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){var e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class du extends Kh{constructor(e=new V,t=new V,r=new V){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new V){var r=this.v0,i=this.v1,n=this.v2;return t.set(au(e,r.x,i.x,n.x),au(e,r.y,i.y,n.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){var e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}du.prototype.isQuadraticBezierCurve=!0;class cu extends Kh{constructor(e=new Pe,t=new Pe,r=new Pe){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new Pe){var r=this.v0,i=this.v1,n=this.v2;return t.set(au(e,r.x,i.x,n.x),au(e,r.y,i.y,n.y),au(e,r.z,i.z,n.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){var e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}cu.prototype.isQuadraticBezierCurve3=!0;class fu extends Kh{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new V){var r=this.points,e=(r.length-1)*e,i=Math.floor(e),e=e-i,n=r[0===i?i:i-1],a=r[i],s=r[i>r.length-2?r.length-1:i+1],r=r[i>r.length-3?r.length-1:i+2];return t.set(nu(e,n.x,a.x,s.x,r.x),nu(e,n.y,a.y,s.y,r.y)),t}copy(r){super.copy(r),this.points=[];for(let e=0,t=r.points.length;e<t;e++){var i=r.points[e];this.points.push(i.clone())}return this}toJSON(){var r=super.toJSON();r.points=[];for(let e=0,t=this.points.length;e<t;e++){var i=this.points[e];r.points.push(i.toArray())}return r}fromJSON(r){super.fromJSON(r),this.points=[];for(let e=0,t=r.points.length;e<t;e++){var i=r.points[e];this.points.push((new V).fromArray(i))}return this}}fu.prototype.isSplineCurve=!0;var pu=Object.freeze({__proto__:null,ArcCurve:Jh,CatmullRomCurve3:iu,CubicBezierCurve:ou,CubicBezierCurve3:lu,EllipseCurve:Xh,LineCurve:hu,LineCurve3:uu,QuadraticBezierCurve:du,QuadraticBezierCurve3:cu,SplineCurve:fu});class mu extends Kh{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new hu(t,e))}getPoint(e,n){var a=e*this.getLength(),s=this.getCurveLengths();let o=0;for(;o<s.length;){if(s[o]>=a){let e=s[o]-a,t=this.curves[o],r=t.getLength(),i=0===r?0:1-e/r;return t.getPointAt(i,n)}o++}return null}getLength(){var e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;var r=[];let i=0;for(let e=0,t=this.curves.length;e<t;e++)i+=this.curves[e].getLength(),r.push(i);return this.cacheLengths=r}getSpacedPoints(t=40){var r=[];for(let e=0;e<=t;e++)r.push(this.getPoint(e/t));return this.autoClose&&r.push(r[0]),r}getPoints(r=12){var i=[];let n;for(let e=0,t=this.curves;e<t.length;e++){var a=t[e],s=a&&a.isEllipseCurve?2*r:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?r*a.points.length:r,o=a.getPoints(s);for(let e=0;e<o.length;e++){var l=o[e];n&&n.equals(l)||(i.push(l),n=l)}}return this.autoClose&&1<i.length&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(r){super.copy(r),this.curves=[];for(let e=0,t=r.curves.length;e<t;e++){var i=r.curves[e];this.curves.push(i.clone())}return this.autoClose=r.autoClose,this}toJSON(){var r=super.toJSON();r.autoClose=this.autoClose,r.curves=[];for(let e=0,t=this.curves.length;e<t;e++){var i=this.curves[e];r.curves.push(i.toJSON())}return r}fromJSON(r){super.fromJSON(r),this.autoClose=r.autoClose,this.curves=[];for(let e=0,t=r.curves.length;e<t;e++){var i=r.curves[e];this.curves.push((new pu[i.type]).fromJSON(i))}return this}}class gu extends mu{constructor(e){super(),this.type="Path",this.currentPoint=new V,e&&this.setFromPoints(e)}setFromPoints(r){this.moveTo(r[0].x,r[0].y);for(let e=1,t=r.length;e<t;e++)this.lineTo(r[e].x,r[e].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){var r=new hu(this.currentPoint.clone(),new V(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,r,i){e=new du(this.currentPoint.clone(),new V(e,t),new V(r,i));return this.curves.push(e),this.currentPoint.set(r,i),this}bezierCurveTo(e,t,r,i,n,a){e=new ou(this.currentPoint.clone(),new V(e,t),new V(r,i),new V(n,a));return this.curves.push(e),this.currentPoint.set(n,a),this}splineThru(e){var t=[this.currentPoint.clone()].concat(e),t=new fu(t);return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,r,i,n,a){var s=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+s,t+o,r,i,n,a),this}absarc(e,t,r,i,n,a){return this.absellipse(e,t,r,r,i,n,a),this}ellipse(e,t,r,i,n,a,s,o){var l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+l,t+h,r,i,n,a,s,o),this}absellipse(e,t,r,i,n,a,s,o){t=new Xh(e,t,r,i,n,a,s,o);if(0<this.curves.length){let e=t.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(t);e=t.getPoint(1);return this.currentPoint.copy(e),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){var e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class vu extends gu{constructor(e){super(e),this.uuid=pi(),this.type="Shape",this.holes=[]}getPointsHoles(r){var i=[];for(let e=0,t=this.holes.length;e<t;e++)i[e]=this.holes[e].getPoints(r);return i}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(r){super.copy(r),this.holes=[];for(let e=0,t=r.holes.length;e<t;e++){var i=r.holes[e];this.holes.push(i.clone())}return this}toJSON(){var r=super.toJSON();r.uuid=this.uuid,r.holes=[];for(let e=0,t=this.holes.length;e<t;e++){var i=this.holes[e];r.holes.push(i.toJSON())}return r}fromJSON(r){super.fromJSON(r),this.uuid=r.uuid,this.holes=[];for(let e=0,t=r.holes.length;e<t;e++){var i=r.holes[e];this.holes.push((new gu).fromJSON(i))}return this}}function yu(o,l,h=2){var u=l&&l.length,d=u?l[0]*h:o.length;let c=xu(o,0,d,h,!0);var f=[];if(c&&c.next!==c.prev){let t,r,i,n,a,s,e;if(u&&(c=function(e,t,r,i){var n,a,s=[];let o,l,h,u,d;for(o=0,l=t.length;o<l;o++)h=t[o]*i,u=o<l-1?t[o+1]*i:e.length,(d=xu(e,h,u,i,!1))===d.next&&(d.steiner=!0),s.push(function(e){let t=e,r=e;for(;(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next,t!==e;);return r}(d));for(s.sort(Tu),o=0;o<s.length;o++)n=s[o],(a=function(r,e){let i=e;var n=r.x,a=r.y;let s,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){let e=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=n&&e>o){if((o=e)===n){if(a===i.y)return i;if(a===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}}while((i=i.next)!==e);if(!s)return null;if(n!==o){var l,h,u=s,d=s.x,c=s.y;let e,t=1/0;for(i=s;n>=i.x&&i.x>=d&&n!==i.x&&wu(a<c?n:o,a,d,c,a<c?o:n,a,i.x,i.y)&&(e=Math.abs(a-i.y)/(n-i.x),Ru(i,r))&&(e<t||e===t&&(i.x>s.x||i.x===s.x&&(l=s,h=i,y(l.prev,l,h.prev)<0)&&y(h.next,l,l.next)<0))&&(s=i,t=e),(i=i.next)!==u;);}return s}(n,a=r))&&(n=Cu(a,n),bu(a,a.next),bu(n,n.next)),r=bu(r,r.next);return r}(o,l,c,h)),o.length>80*h){t=i=o[0],r=n=o[1];for(let e=h;e<d;e+=h)a=o[e],s=o[e+1],a<t&&(t=a),s<r&&(r=s),a>i&&(i=a),s>n&&(n=s);e=0!==(e=Math.max(i-t,n-r))?1/e:0}_u(c,f,h,t,r,e)}return f}function xu(e,s,t,r,i){let n,a;if(i===0<function(r,i,n){let a=0;for(let e=s,t=i-n;e<i;e+=n)a+=(r[t]-r[e])*(r[e+1]+r[t+1]),t=e;return a}(e,t,r))for(n=s;n<t;n+=r)a=Du(n,e[n],e[n+1],a);else for(n=t-r;n>=s;n-=r)a=Du(n,e[n],e[n+1],a);return a&&Eu(a,a.next)&&(Iu(a),a=a.next),a}function bu(e,t){if(!e)return e;t=t||e;let r,i=e;do{if(r=!1,i.steiner||!Eu(i,i.next)&&0!==y(i.prev,i,i.next))i=i.next;else{if(Iu(i),(i=t=i.prev)===i.next)break;r=!0}}while(r||i!==t);return t}function _u(i,n,a,s,o,l,h){if(i){if(!h&&l){var u=i;var d=s;var c=o;var f=l;let h=u;for(;null===h.z&&(h.z=Su(h.x,h.y,d,c,f)),h.prevZ=h.prev,h.nextZ=h.next,(h=h.next)!==u;);h.prevZ.nextZ=null,h.prevZ=null;{var p=h;let e,t,r,i,n,a,s,o,l=1;do{for(t=p,p=null,n=null,a=0;t;){for(a++,r=t,s=0,e=0;e<l&&(s++,r=r.nextZ);e++);for(o=l;0<s||0<o&&r;)0!==s&&(0===o||!r||t.z<=r.z)?(t=(i=t).nextZ,s--):(r=(i=r).nextZ,o--),n?n.nextZ=i:p=i,i.prevZ=n,n=i;t=r}}while(n.nextZ=null,l*=2,1<a)}}let e,t,r=i;for(;i.prev!==i.next;)if(e=i.prev,t=i.next,l?function(e,t,r,i){var n=e.prev,a=e,s=e.next;if(0<=y(n,a,s))return;let o=(n.x<a.x?n.x<s.x?n:s:a.x<s.x?a:s).x,l=(n.y<a.y?n.y<s.y?n:s:a.y<s.y?a:s).y,h=(n.x>a.x?n.x>s.x?n:s:a.x>s.x?a:s).x,u=(n.y>a.y?n.y>s.y?n:s:a.y>s.y?a:s).y,d=Su(o,l,t,r,i),c=Su(h,u,t,r,i),f=e.prevZ,p=e.nextZ;for(;f&&f.z>=d&&p&&p.z<=c;){if(f!==e.prev&&f!==e.next&&wu(n.x,n.y,a.x,a.y,s.x,s.y,f.x,f.y)&&0<=y(f.prev,f,f.next))return;if(f=f.prevZ,p!==e.prev&&p!==e.next&&wu(n.x,n.y,a.x,a.y,s.x,s.y,p.x,p.y)&&0<=y(p.prev,p,p.next))return;p=p.nextZ}for(;f&&f.z>=d;){if(f!==e.prev&&f!==e.next&&wu(n.x,n.y,a.x,a.y,s.x,s.y,f.x,f.y)&&0<=y(f.prev,f,f.next))return;f=f.prevZ}for(;p&&p.z<=c;){if(p!==e.prev&&p!==e.next&&wu(n.x,n.y,a.x,a.y,s.x,s.y,p.x,p.y)&&0<=y(p.prev,p,p.next))return;p=p.nextZ}return 1}(i,s,o,l):function(e){var t=e.prev,r=e,i=e.next;if(0<=y(t,r,i))return;let n=e.next.next;for(;n!==e.prev;){if(wu(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&0<=y(n.prev,n,n.next))return;n=n.next}return 1}(i))n.push(e.i/a),n.push(i.i/a),n.push(t.i/a),Iu(i),i=t.next,r=t.next;else if((i=t)===r){h?1===h?_u(i=function(e,t,r){let i=e;do{var n=i.prev,a=i.next.next;!Eu(n,a)&&Mu(n,i,i.next,a)&&Ru(n,a)&&Ru(a,n)&&(t.push(n.i/r),t.push(i.i/r),t.push(a.i/r),Iu(i),Iu(i.next),i=e=a),i=i.next}while(i!==e);return bu(i)}(bu(i),n,a),n,a,s,o,l,2):2===h&&function(e,t,r,i,n,a){let s=e;do{let e=s.next.next;for(;e!==s.prev;){var o;if(s.i!==e.i&&function(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Mu(r,r.next,e,t))return 1}while((r=r.next)!==e)}(e,t)&&(Ru(e,t)&&Ru(t,e)&&function(e,t){let r=e,i=!1;for(var n=(e.x+t.x)/2,a=(e.y+t.y)/2;r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),(r=r.next)!==e;);return i}(e,t)&&(y(e.prev,e,t.prev)||y(e,t.prev,t))||Eu(e,t)&&0<y(e.prev,e,e.next)&&0<y(t.prev,t,t.next))}(s,e))return o=Cu(s,e),s=bu(s,s.next),o=bu(o,o.next),_u(s,t,r,i,n,a),_u(o,t,r,i,n,a);e=e.next}}while(s=s.next,s!==e)}(i,n,a,s,o,l):_u(bu(i),n,a,s,o,l,1);break}}}function Tu(e,t){return e.x-t.x}function Su(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function wu(e,t,r,i,n,a,s,o){return 0<=(n-s)*(t-o)-(e-s)*(a-o)&&0<=(e-s)*(i-o)-(r-s)*(t-o)&&0<=(r-s)*(a-o)-(n-s)*(i-o)}function y(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Eu(e,t){return e.x===t.x&&e.y===t.y}function Mu(e,t,r,i){var n=Lu(y(e,t,r)),a=Lu(y(e,t,i)),s=Lu(y(r,i,e)),o=Lu(y(r,i,t));return n!==a&&s!==o||0===n&&Au(e,r,t)||0===a&&Au(e,i,t)||0===s&&Au(r,e,i)||0===o&&Au(r,t,i)}function Au(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function Lu(e){return 0<e?1:e<0?-1:0}function Ru(e,t){return y(e.prev,e,e.next)<0?0<=y(e,t,e.next)&&0<=y(e,e.prev,t):y(e,t,e.prev)<0||y(e,e.next,t)<0}function Cu(e,t){var r=new Pu(e.i,e.x,e.y),i=new Pu(t.i,t.x,t.y),n=e.next,a=t.prev;return(e.next=t).prev=e,(r.next=n).prev=r,(i.next=r).prev=i,(a.next=i).prev=a,i}function Du(e,t,r,i){e=new Pu(e,t,r);return i?(e.next=i.next,(e.prev=i).next.prev=e,i.next=e):(e.prev=e).next=e,e}function Iu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Pu(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class ku{static area(r){var i=r.length;let n=0;for(let e=i-1,t=0;t<i;e=t++)n+=r[e].x*r[t].y-r[t].x*r[e].y;return.5*n}static isClockWise(e){return ku.area(e)<0}static triangulateShape(e,t){var r=[],i=[],n=[];Ou(e),Fu(r,e);let a=e.length;t.forEach(Ou);for(let e=0;e<t.length;e++)i.push(a),a+=t[e].length,Fu(r,t[e]);var s=yu(r,i);for(let e=0;e<s.length;e+=3)n.push(s.slice(e,e+3));return n}}function Ou(e){var t=e.length;2<t&&e[t-1].equals(e[0])&&e.pop()}function Fu(t,r){for(let e=0;e<r.length;e++)t.push(r[e].x),t.push(r[e].y)}class Nu extends S{constructor(r=new vu([new V(.5,.5),new V(-.5,.5),new V(-.5,-.5),new V(.5,-.5)]),U={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:r,options:U},r=Array.isArray(r)?r:[r];let G=this,z=[],H=[];for(let e=0,t=r.length;e<t;e++)!function(e){let i=[],F=void 0!==U.curveSegments?U.curveSegments:12,u=void 0!==U.steps?U.steps:1,a=void 0!==U.depth?U.depth:1,n=void 0===U.bevelEnabled||U.bevelEnabled,r=void 0!==U.bevelThickness?U.bevelThickness:.2,s=void 0!==U.bevelSize?U.bevelSize:r-.1,o=void 0!==U.bevelOffset?U.bevelOffset:0,d=void 0!==U.bevelSegments?U.bevelSegments:3,t=U.extrudePath,c=void 0!==U.UVGenerator?U.UVGenerator:Bu;void 0!==U.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),a=U.amount);let l,h,f,p,m,g=!1,v=(t&&(l=t.getSpacedPoints(u),g=!0,n=!1,h=t.computeFrenetFrames(u,!1),f=new Pe,p=new Pe,m=new Pe),n||(d=0,r=0,s=0,o=0),e.extractPoints(F)),y=v.shape,x=v.holes;if(!ku.isClockWise(y)){y=y.reverse();for(let t=0,e=x.length;t<e;t++){let e=x[t];ku.isClockWise(e)&&(x[t]=e.reverse())}}let b=ku.triangulateShape(y,x),_=y;for(let t=0,e=x.length;t<e;t++){let e=x[t];y=y.concat(e)}function T(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}let S=y.length,w=b.length;function E(a,s,o){let l,h,u,d=a.x-s.x,c=a.y-s.y,f=o.x-a.x,p=o.y-a.y,m=d*d+c*c,e=d*p-c*f;if(Math.abs(e)>Number.EPSILON){let e=Math.sqrt(m),t=Math.sqrt(f*f+p*p),r=s.x-c/e,i=s.y+d/e,n=((o.x-p/t-r)*p-(o.y+f/t-i)*f)/(d*p-c*f);l=r+d*n-a.x,h=i+c*n-a.y;s=l*l+h*h;if(s<=2)return new V(l,h);u=Math.sqrt(s/2)}else{let e=!1;d>Number.EPSILON?f>Number.EPSILON&&(e=!0):d<-Number.EPSILON?f<-Number.EPSILON&&(e=!0):Math.sign(c)===Math.sign(p)&&(e=!0),u=e?(l=-c,h=d,Math.sqrt(m)):(l=d,h=c,Math.sqrt(m/2))}return new V(l/u,h/u)}var M=[];for(let e=0,t=_.length,r=t-1,i=e+1;e<t;e++,r++,i++)r===t&&(r=0),i===t&&(i=0),M[e]=E(_[e],_[r],_[i]);let A=[],L,R=M.concat();for(let e=0,t=x.length;e<t;e++){let n=x[e];L=[];for(let e=0,t=n.length,r=t-1,i=e+1;e<t;e++,r++,i++)r===t&&(r=0),i===t&&(i=0),L[e]=E(n[e],n[r],n[i]);A.push(L),R=R.concat(L)}for(let t=0;t<d;t++){let e=t/d,i=r*Math.cos(e*Math.PI/2),n=s*Math.sin(e*Math.PI/2)+o;for(let t=0,e=_.length;t<e;t++){let e=T(_[t],M[t],n);C(e.x,e.y,-i)}for(let e=0,t=x.length;e<t;e++){let r=x[e];L=A[e];for(let t=0,e=r.length;t<e;t++){let e=T(r[t],L[t],n);C(e.x,e.y,-i)}}}var N=s+o;for(let t=0;t<S;t++){let e=n?T(y[t],R[t],N):y[t];g?(p.copy(h.normals[0]).multiplyScalar(e.x),f.copy(h.binormals[0]).multiplyScalar(e.y),m.copy(l[0]).add(p).add(f),C(m.x,m.y,m.z)):C(e.x,e.y,0)}for(let r=1;r<=u;r++)for(let t=0;t<S;t++){let e=n?T(y[t],R[t],N):y[t];g?(p.copy(h.normals[r]).multiplyScalar(e.x),f.copy(h.binormals[r]).multiplyScalar(e.y),m.copy(l[r]).add(p).add(f),C(m.x,m.y,m.z)):C(e.x,e.y,a/u*r)}for(let t=d-1;0<=t;t--){let e=t/d,i=r*Math.cos(e*Math.PI/2),n=s*Math.sin(e*Math.PI/2)+o;for(let t=0,e=_.length;t<e;t++){let e=T(_[t],M[t],n);C(e.x,e.y,a+i)}for(let e=0,t=x.length;e<t;e++){let r=x[e];L=A[e];for(let t=0,e=r.length;t<e;t++){let e=T(r[t],L[t],n);g?C(e.x,e.y+l[u-1].y,l[u-1].x+i):C(e.x,e.y,a+i)}}}function B(e,n){let t=e.length;for(;0<=--t;){var a=t;let i=t-1;i<0&&(i=e.length-1);for(let r=0,e=u+2*d;r<e;r++){let e=S*r,t=S*(r+1);h=l=o=s=void 0;var s=n+a+e,o=n+i+e,l=n+i+t,h=n+a+t;I(s),I(o),I(h),I(o),I(l),I(h),s=z.length/3,P((o=c.generateSideWallUV(G,z,s-6,s-3,s-2,s-1))[0]),P(o[1]),P(o[3]),P(o[1]),P(o[2]),P(o[3])}}}function C(e,t,r){i.push(e),i.push(t),i.push(r)}function D(e,t,r){I(e),I(t),I(r);e=z.length/3,t=c.generateTopUV(G,z,e-3,e-2,e-1);P(t[0]),P(t[1]),P(t[2])}function I(e){z.push(i[3*e+0]),z.push(i[3*e+1]),z.push(i[3*e+2])}function P(e){H.push(e.x),H.push(e.y)}{e=z.length/3;if(n){let e=0,r=0*S;for(let t=0;t<w;t++){let e=b[t];D(e[2]+r,e[1]+r,e[0]+r)}e=u+2*d,r=S*e;for(let t=0;t<w;t++){let e=b[t];D(e[0]+r,e[1]+r,e[2]+r)}}else{for(let e=0;e<w;e++){var k=b[e];D(k[2],k[1],k[0])}for(let e=0;e<w;e++){var O=b[e];D(O[0]+S*u,O[1]+S*u,O[2]+S*u)}}G.addGroup(e,z.length/3-e,0)}{e=z.length/3;let r=0;B(_,r),r+=_.length;for(let t=0,e=x.length;t<e;t++){let e=x[t];B(e,r),r+=e.length}G.addGroup(e,z.length/3-e,1)}}(r[e]);this.setAttribute("position",new W(z,3)),this.setAttribute("uv",new W(H,2)),this.computeVertexNormals()}toJSON(){var e=super.toJSON(),r=this.parameters.shapes,t=this.parameters.options,i=e;if(i.shapes=[],Array.isArray(r))for(let e=0,t=r.length;e<t;e++){var n=r[e];i.shapes.push(n.uuid)}else i.shapes.push(r.uuid);return void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON()),i}static fromJSON(r,i){var n=[];for(let e=0,t=r.shapes.length;e<t;e++){var a=i[r.shapes[e]];n.push(a)}var e=r.options.extrudePath;return void 0!==e&&(r.options.extrudePath=(new pu[e.type]).fromJSON(e)),new Nu(n,r.options)}}let Bu={generateTopUV:function(e,t,r,i,n){var a=t[3*r],r=t[3*r+1],s=t[3*i],i=t[3*i+1],o=t[3*n],t=t[3*n+1];return[new V(a,r),new V(s,i),new V(o,t)]},generateSideWallUV:function(e,t,r,i,n,a){var s=t[3*r],o=t[3*r+1],r=t[3*r+2],l=t[3*i],h=t[3*i+1],i=t[3*i+2],u=t[3*n],d=t[3*n+1],n=t[3*n+2],c=t[3*a],f=t[3*a+1],t=t[3*a+2];return Math.abs(o-h)<Math.abs(s-l)?[new V(s,1-r),new V(l,1-i),new V(u,1-n),new V(c,1-t)]:[new V(o,1-r),new V(h,1-i),new V(d,1-n),new V(f,1-t)]}};class Uu extends Hh{constructor(e=1,t=0){var r=(1+Math.sqrt(5))/2;super([-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Uu(e.radius,e.detail)}}class Gu extends S{constructor(o=[new V(0,.5),new V(.5,0),new V(0,-.5)],l=12,e=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:o,segments:l,phiStart:e,phiLength:r},l=Math.floor(l),r=mi(r,0,2*Math.PI);let h=[],i=[],n=[],a=1/l,s=new Pe,u=new V;for(let t=0;t<=l;t++){var d=e+t*a*r,c=Math.sin(d),f=Math.cos(d);for(let e=0;e<=o.length-1;e++)s.x=o[e].x*c,s.y=o[e].y,s.z=o[e].x*f,i.push(s.x,s.y,s.z),u.x=t/l,u.y=e/(o.length-1),n.push(u.x,u.y)}for(let s=0;s<l;s++)for(let a=0;a<o.length-1;a++){let e=a+s*o.length,t=e,r=e+o.length,i=e+o.length+1,n=e+1;h.push(t,r,n),h.push(r,i,n)}if(this.setIndex(h),this.setAttribute("position",new W(i,3)),this.setAttribute("uv",new W(n,2)),this.computeVertexNormals(),r===2*Math.PI){let r=this.attributes.normal.array,i=new Pe,n=new Pe,a=new Pe,s=l*o.length*3;for(let e=0,t=0;e<o.length;e++,t+=3)i.x=r[t+0],i.y=r[t+1],i.z=r[t+2],n.x=r[s+t+0],n.y=r[s+t+1],n.z=r[s+t+2],a.addVectors(i,n).normalize(),r[t+0]=r[s+t+0]=a.x,r[t+1]=r[s+t+1]=a.y,r[t+2]=r[s+t+2]=a.z}}static fromJSON(e){return new Gu(e.points,e.segments,e.phiStart,e.phiLength)}}class zu extends Hh{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new zu(e.radius,e.detail)}}class Hu extends S{constructor(e=.5,r=1,o=8,t=1,i=0,n=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:r,thetaSegments:o,phiSegments:t,thetaStart:i,thetaLength:n},o=Math.max(3,o);let l=[],a=[],s=[],h=[],u=e;var d=(r-e)/(t=Math.max(1,t)),c=new Pe,f=new V;for(let e=0;e<=t;e++){for(let t=0;t<=o;t++){let e=i+t/o*n;c.x=u*Math.cos(e),c.y=u*Math.sin(e),a.push(c.x,c.y,c.z),s.push(0,0,1),f.x=(c.x/r+1)/2,f.y=(c.y/r+1)/2,h.push(f.x,f.y)}u+=d}for(let e=0;e<t;e++){let s=e*(o+1);for(let a=0;a<o;a++){let e=a+s,t=e,r=e+o+1,i=e+o+2,n=e+1;l.push(t,r,n),l.push(r,i,n)}}this.setIndex(l),this.setAttribute("position",new W(a,3)),this.setAttribute("normal",new W(s,3)),this.setAttribute("uv",new W(h,2))}static fromJSON(e){return new Hu(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Vu extends S{constructor(t=new vu([new V(0,.5),new V(-.5,-.5),new V(.5,-.5)]),n=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:n};let o=[],l=[],h=[],u=[],r=0,d=0;if(!1===Array.isArray(t))i(t);else for(let e=0;e<t.length;e++)i(t[e]),this.addGroup(r,d,e),r+=d,d=0;function i(e){var a=l.length/3,e=e.extractPoints(n);let r=e.shape;var i=e.holes;!1===ku.isClockWise(r)&&(r=r.reverse());for(let t=0,e=i.length;t<e;t++){let e=i[t];!0===ku.isClockWise(e)&&(i[t]=e.reverse())}var s=ku.triangulateShape(r,i);for(let t=0,e=i.length;t<e;t++){let e=i[t];r=r.concat(e)}for(let t=0,e=r.length;t<e;t++){let e=r[t];l.push(e.x,e.y,0),h.push(0,0,1),u.push(e.x,e.y)}for(let n=0,e=s.length;n<e;n++){let e=s[n],t=e[0]+a,r=e[1]+a,i=e[2]+a;o.push(t,r,i),d+=3}}this.setIndex(o),this.setAttribute("position",new W(l,3)),this.setAttribute("normal",new W(h,3)),this.setAttribute("uv",new W(u,2))}toJSON(){var e=super.toJSON(),r=this.parameters.shapes,i=e;if(i.shapes=[],Array.isArray(r))for(let e=0,t=r.length;e<t;e++){var n=r[e];i.shapes.push(n.uuid)}else i.shapes.push(r.uuid);return i}static fromJSON(r,i){var n=[];for(let e=0,t=r.shapes.length;e<t;e++){var a=i[r.shapes[e]];n.push(a)}return new Vu(n,r.curveSegments)}}class Wu extends S{constructor(i=1,s=32,o=16,n=0,a=2*Math.PI,l=0,h=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:i,widthSegments:s,heightSegments:o,phiStart:n,phiLength:a,thetaStart:l,thetaLength:h},s=Math.max(3,Math.floor(s)),o=Math.max(2,Math.floor(o));let u=Math.min(l+h,Math.PI),d=0;var c=[],f=new Pe,p=new Pe,m=[],g=[],v=[],y=[];for(let e=0;e<=o;e++){var x=[],b=e/o;let r=0;0==e&&0==l?r=.5/s:e==o&&u==Math.PI&&(r=-.5/s);for(let t=0;t<=s;t++){let e=t/s;f.x=-i*Math.cos(n+e*a)*Math.sin(l+b*h),f.y=i*Math.cos(l+b*h),f.z=i*Math.sin(n+e*a)*Math.sin(l+b*h),g.push(f.x,f.y,f.z),p.copy(f).normalize(),v.push(p.x,p.y,p.z),y.push(e+r,1-b),x.push(d++)}c.push(x)}for(let a=0;a<o;a++)for(let n=0;n<s;n++){let e=c[a][n+1],t=c[a][n],r=c[a+1][n],i=c[a+1][n+1];(0!==a||0<l)&&m.push(e,t,i),(a!==o-1||u<Math.PI)&&m.push(t,r,i)}this.setIndex(m),this.setAttribute("position",new W(g,3)),this.setAttribute("normal",new W(v,3)),this.setAttribute("uv",new W(y,2))}static fromJSON(e){return new Wu(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class ju extends Hh{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ju(e.radius,e.detail)}}class Yu extends S{constructor(r=1,i=.4,n=8,s=6,a=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:r,tube:i,radialSegments:n,tubularSegments:s,arc:a},n=Math.floor(n),s=Math.floor(s);let o=[],l=[],h=[],u=[],d=new Pe,c=new Pe,f=new Pe;for(let t=0;t<=n;t++)for(let e=0;e<=s;e++){var p=e/s*a,m=t/n*Math.PI*2;c.x=(r+i*Math.cos(m))*Math.cos(p),c.y=(r+i*Math.cos(m))*Math.sin(p),c.z=i*Math.sin(m),l.push(c.x,c.y,c.z),d.x=r*Math.cos(p),d.y=r*Math.sin(p),f.subVectors(c,d).normalize(),h.push(f.x,f.y,f.z),u.push(e/s),u.push(t/n)}for(let a=1;a<=n;a++)for(let n=1;n<=s;n++){let e=(s+1)*a+n-1,t=(s+1)*(a-1)+n-1,r=(s+1)*(a-1)+n,i=(s+1)*a+n;o.push(e,t,i),o.push(t,r,i)}this.setIndex(o),this.setAttribute("position",new W(l,3)),this.setAttribute("normal",new W(h,3)),this.setAttribute("uv",new W(u,2))}static fromJSON(e){return new Yu(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class $u extends S{constructor(e=1,a=.4,s=64,o=8,t=2,r=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:a,tubularSegments:s,radialSegments:o,p:t,q:r},s=Math.floor(s),o=Math.floor(o);let l=[],h=[],u=[],d=[],c=new Pe,f=new Pe,p=new Pe,i=new Pe,m=new Pe,g=new Pe,v=new Pe;for(let n=0;n<=s;++n){var y=n/s*t*Math.PI*2;x(y,t,r,e,p),x(.01+y,t,r,e,i),g.subVectors(i,p),v.addVectors(i,p),m.crossVectors(g,v),v.crossVectors(m,g),m.normalize(),v.normalize();for(let i=0;i<=o;++i){let e=i/o*Math.PI*2,t=-a*Math.cos(e),r=a*Math.sin(e);c.x=p.x+(t*v.x+r*m.x),c.y=p.y+(t*v.y+r*m.y),c.z=p.z+(t*v.z+r*m.z),h.push(c.x,c.y,c.z),f.subVectors(c,p).normalize(),u.push(f.x,f.y,f.z),d.push(n/s),d.push(i/o)}}for(let a=1;a<=s;a++)for(let n=1;n<=o;n++){let e=(o+1)*(a-1)+(n-1),t=(o+1)*a+(n-1),r=(o+1)*a+n,i=(o+1)*(a-1)+n;l.push(e,t,i),l.push(t,r,i)}function x(e,t,r,i,n){var a=Math.cos(e),s=Math.sin(e),r=r/t*e,t=Math.cos(r);n.x=i*(2+t)*.5*a,n.y=i*(2+t)*s*.5,n.z=i*Math.sin(r)*.5}this.setIndex(l),this.setAttribute("position",new W(h,3)),this.setAttribute("normal",new W(u,3)),this.setAttribute("uv",new W(d,2))}static fromJSON(e){return new $u(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class qu extends S{constructor(t=new cu(new Pe(-1,-1,0),new Pe(-1,1,0),new Pe(1,1,0)),r=64,s=1,o=8,e=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:r,radius:s,radialSegments:o,closed:e};let i=t.computeFrenetFrames(r,e),l=(this.tangents=i.tangents,this.normals=i.normals,this.binormals=i.binormals,new Pe),h=new Pe,n=new V,u=new Pe,d=[],c=[],a=[],f=[];function p(e){u=t.getPointAt(e/r,u);var n=i.normals[e],a=i.binormals[e];for(let i=0;i<=o;i++){let e=i/o*Math.PI*2,t=Math.sin(e),r=-Math.cos(e);h.x=r*n.x+t*a.x,h.y=r*n.y+t*a.y,h.z=r*n.z+t*a.z,h.normalize(),c.push(h.x,h.y,h.z),l.x=u.x+s*h.x,l.y=u.y+s*h.y,l.z=u.z+s*h.z,d.push(l.x,l.y,l.z)}}for(let e=0;e<r;e++)p(e);p(!1===e?r:0);for(let t=0;t<=r;t++)for(let e=0;e<=o;e++)n.x=t/r,n.y=e/o,a.push(n.x,n.y);for(let t=1;t<=r;t++)for(let e=1;e<=o;e++){var m=(o+1)*(t-1)+(e-1),g=(o+1)*t+(e-1),v=(o+1)*t+e,y=(o+1)*(t-1)+e;f.push(m,g,y),f.push(g,v,y)}this.setIndex(f),this.setAttribute("position",new W(d,3)),this.setAttribute("normal",new W(c,3)),this.setAttribute("uv",new W(a,2))}toJSON(){var e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new qu((new pu[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Ku extends S{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){var i=[],n=new Set,a=new Pe,s=new Pe;if(null!==e.index){var o=e.attributes.position,l=e.index;let r=e.groups;for(let e=0,t=(r=0===r.length?[{start:0,count:l.count,materialIndex:0}]:r).length;e<t;++e){var h=r[e],u=h.start;for(let t=u,e=u+h.count;t<e;t+=3)for(let e=0;e<3;e++){var d=l.getX(t+e),c=l.getX(t+(e+1)%3);a.fromBufferAttribute(o,d),s.fromBufferAttribute(o,c),!0===Xu(a,s,n)&&(i.push(a.x,a.y,a.z),i.push(s.x,s.y,s.z))}}}else{var r=e.attributes.position;for(let t=0,e=r.count/3;t<e;t++)for(let e=0;e<3;e++){var f=3*t+e,p=3*t+(e+1)%3;a.fromBufferAttribute(r,f),s.fromBufferAttribute(r,p),!0===Xu(a,s,n)&&(i.push(a.x,a.y,a.z),i.push(s.x,s.y,s.z))}}this.setAttribute("position",new W(i,3))}}}function Xu(e,t,r){var i=`${e.x},${e.y},${e.z}-${t.x},${t.y},`+t.z,t=`${t.x},${t.y},${t.z}-${e.x},${e.y},`+e.z;return!0!==r.has(i)&&!0!==r.has(t)&&(r.add(i,t),!0)}var Ju=Object.freeze({__proto__:null,BoxGeometry:ka,BoxBufferGeometry:ka,CircleGeometry:Uh,CircleBufferGeometry:Uh,ConeGeometry:zh,ConeBufferGeometry:zh,CylinderGeometry:Gh,CylinderBufferGeometry:Gh,DodecahedronGeometry:Vh,DodecahedronBufferGeometry:Vh,EdgesGeometry:qh,ExtrudeGeometry:Nu,ExtrudeBufferGeometry:Nu,IcosahedronGeometry:Uu,IcosahedronBufferGeometry:Uu,LatheGeometry:Gu,LatheBufferGeometry:Gu,OctahedronGeometry:zu,OctahedronBufferGeometry:zu,PlaneGeometry:Za,PlaneBufferGeometry:Za,PolyhedronGeometry:Hh,PolyhedronBufferGeometry:Hh,RingGeometry:Hu,RingBufferGeometry:Hu,ShapeGeometry:Vu,ShapeBufferGeometry:Vu,SphereGeometry:Wu,SphereBufferGeometry:Wu,TetrahedronGeometry:ju,TetrahedronBufferGeometry:ju,TorusGeometry:Yu,TorusBufferGeometry:Yu,TorusKnotGeometry:$u,TorusKnotBufferGeometry:$u,TubeGeometry:qu,TubeBufferGeometry:qu,WireframeGeometry:Ku});class Zu extends r{constructor(e){super(),this.type="ShadowMaterial",this.color=new m(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}Zu.prototype.isShadowMaterial=!0;class Qu extends r{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new m(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new m(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kr,this.normalScale=new V(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}Qu.prototype.isMeshStandardMaterial=!0;class ed extends Qu{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new V(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return mi(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.sheenColor=new m(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new m(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new m(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){0<this._sheen!=0<e&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){0<this._clearcoat!=0<e&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){0<this._transmission!=0<e&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}ed.prototype.isMeshPhysicalMaterial=!0;class td extends r{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new m(16777215),this.specular=new m(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new m(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kr,this.normalScale=new V(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=O,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}td.prototype.isMeshPhongMaterial=!0;class rd extends r{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new m(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new m(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kr,this.normalScale=new V(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}rd.prototype.isMeshToonMaterial=!0;class id extends r{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kr,this.normalScale=new V(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}id.prototype.isMeshNormalMaterial=!0;class nd extends r{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new m(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new m(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=O,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}nd.prototype.isMeshLambertMaterial=!0;class ad extends r{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new m(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kr,this.normalScale=new V(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}ad.prototype.isMeshMatcapMaterial=!0;class sd extends g{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}sd.prototype.isLineDashedMaterial=!0;var od=Object.freeze({__proto__:null,ShadowMaterial:Zu,SpriteMaterial:Fl,RawShaderMaterial:os,ShaderMaterial:Ba,PointsMaterial:Lh,MeshPhysicalMaterial:ed,MeshStandardMaterial:Qu,MeshPhongMaterial:td,MeshToonMaterial:rd,MeshNormalMaterial:id,MeshLambertMaterial:nd,MeshDepthMaterial:yl,MeshDistanceMaterial:xl,MeshBasicMaterial:Qn,MeshMatcapMaterial:ad,LineDashedMaterial:sd,LineBasicMaterial:g,Material:r});let x={arraySlice:function(e,t,r){return x.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==r?r:e.length)):e.slice(t,r)},convertArray:function(e,t,r){return!e||!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(r){var t=r.length,i=new Array(t);for(let e=0;e!==t;++e)i[e]=e;return i.sort(function(e,t){return r[e]-r[t]}),i},sortedArray:function(i,n,a){let t=i.length,s=new i.constructor(t);for(let e=0,r=0;r!==t;++e){let t=a[e]*n;for(let e=0;e!==n;++e)s[r++]=i[t+e]}return s},flattenJSON:function(t,r,i,n){let a=1,s=t[0];for(;void 0!==s&&void 0===s[n];)s=t[a++];if(void 0!==s){let e=s[n];if(void 0!==e)if(Array.isArray(e))for(;void 0!==(e=s[n])&&(r.push(s.time),i.push.apply(i,e)),void 0!==(s=t[a++]););else if(void 0!==e.toArray)for(;void 0!==(e=s[n])&&(r.push(s.time),e.toArray(i,i.length)),void 0!==(s=t[a++]););else for(;void 0!==(e=s[n])&&(r.push(s.time),i.push(e)),void 0!==(s=t[a++]););}},subclip:function(e,t,s,o,l=30){let h=e.clone();h.name=t;var u=[];for(let e=0;e<h.tracks.length;++e){let r=h.tracks[e],i=r.getValueSize(),n=[],a=[];for(let t=0;t<r.times.length;++t){let e=r.times[t]*l;if(!(e<s||e>=o)){n.push(r.times[t]);for(let e=0;e<i;++e)a.push(r.values[t*i+e])}}0!==n.length&&(r.times=x.convertArray(n,r.times.constructor),r.values=x.convertArray(a,r.values.constructor),u.push(r))}h.tracks=u;let r=1/0;for(let e=0;e<h.tracks.length;++e)r>h.tracks[e].times[0]&&(r=h.tracks[e].times[0]);for(let e=0;e<h.tracks.length;++e)h.tracks[e].shift(-1*r);return h.resetDuration(),h},makeClipAdditive:function(r,e=0,i=r,t=30){let n=i.tracks.length,o=e/(t=t<=0?30:t);for(let e=0;e<n;++e){let s=i.tracks[e],t=s.ValueTypeName;if("bool"!==t&&"string"!==t){var l=r.tracks.find(function(e){return e.name===s.name&&e.ValueTypeName===t});if(void 0!==l){let i=0;var h=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(i=h/3);let n=0;var u=l.getValueSize(),d=(l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(n=u/3),s.times.length-1);let a;if(o<=s.times[0]){let e=i,t=h-i;a=x.arraySlice(s.values,e,t)}else if(o>=s.times[d]){let e=d*h+i,t=e+h-i;a=x.arraySlice(s.values,e,t)}else{let e=s.createInterpolant(),t=i,r=h-i;e.evaluate(o),a=x.arraySlice(e.resultBuffer,t,r)}"quaternion"===t&&(new ki).fromArray(a).normalize().conjugate().toArray(a);var c=l.times.length;for(let e=0;e<c;++e){let r=e*u+n;if("quaternion"===t)ki.multiplyQuaternionsFlat(l.values,r,a,0,l.values,r);else{let t=u-2*n;for(let e=0;e<t;++e)l.values[r+e]-=a[e]}}}}}return r.blendMode=_r,r}};class ld{constructor(e,t,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(r){var i=this.parameterPositions;let n=this._cachedIndex,e=i[n],a=i[n-1];e:{t:{let t;r:{i:if(!(r<e)){for(var s=n+2;;){if(void 0===e){if(r<a)break i;return n=i.length,this._cachedIndex=n,this.afterEnd_(n-1,r,a)}if(n===s)break;if(a=e,r<(e=i[++n]))break t}t=i.length;break r}if(r>=a)break e;var o=i[1];r<o&&(n=2,a=o);for(var l=n-2;;){if(void 0===a)return this._cachedIndex=0,this.beforeStart_(0,r,e);if(n===l)break;if(e=a,r>=(a=i[--n-1]))break t}t=n,n=0}for(;n<t;){let e=n+t>>>1;r<i[e]?t=e:n=1+e}if(e=i[n],void 0===(a=i[n-1]))return this._cachedIndex=0,this.beforeStart_(0,r,e);if(void 0===e)return n=i.length,this._cachedIndex=n,this.afterEnd_(n-1,a,r)}this._cachedIndex=n,this.intervalChanged_(n,a,e)}return this.interpolate_(n,a,r,e)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){var t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i;for(let e=0;e!==i;++e)t[e]=r[n+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}ld.prototype.beforeStart_=ld.prototype.copySampleValue_,ld.prototype.afterEnd_=ld.prototype.copySampleValue_;class hd extends ld{constructor(e,t,r,i){super(e,t,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:vr,endingEnd:vr}}intervalChanged_(e,t,r){var i=this.parameterPositions;let n=e-2,a=e+1,s=i[n],o=i[a];if(void 0===s)switch(this.getSettings_().endingStart){case yr:n=e,s=2*t-r;break;case xr:n=i.length-2,s=t+i[n]-i[n+1];break;default:n=e,s=r}if(void 0===o)switch(this.getSettings_().endingEnd){case yr:a=e,o=2*r-t;break;case xr:a=1,o=r+i[1]-i[0];break;default:a=e-1,o=t}var l=.5*(r-t),h=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(o-r),this._offsetPrev=n*h,this._offsetNext=a*h}interpolate_(e,t,r,i){var n=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,h=this._offsetPrev,u=this._offsetNext,e=this._weightPrev,d=this._weightNext,r=(r-t)/(i-t),i=r*r,t=i*r,c=-e*t+2*e*i-e*r,f=(1+e)*t+(-1.5-2*e)*i+(-.5+e)*r+1,p=(-1-d)*t+(1.5+d)*i+.5*r,m=d*t-d*i;for(let e=0;e!==s;++e)n[e]=c*a[h+e]+f*a[l+e]+p*a[o+e]+m*a[u+e];return n}}class ud extends ld{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){var n=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,h=(r-t)/(i-t),u=1-h;for(let e=0;e!==s;++e)n[e]=a[l+e]*u+a[o+e]*h;return n}}class dd extends ld{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class cd{constructor(e,t,r,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=x.convertArray(t,this.TimeBufferType),this.values=x.convertArray(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){let e=t.constructor,r;if(e.toJSON!==this.toJSON)r=e.toJSON(t);else{r={name:t.name,times:x.convertArray(t.times,Array),values:x.convertArray(t.values,Array)};let e=t.getInterpolation();e!==t.DefaultInterpolation&&(r.interpolation=e)}return r.type=t.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new dd(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new ud(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new hd(this.times,this.values,this.getValueSize(),e)}setInterpolation(t){let e;switch(t){case pr:e=this.InterpolantFactoryMethodDiscrete;break;case mr:e=this.InterpolantFactoryMethodLinear;break;case gr:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){let e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}console.warn("THREE.KeyframeTrack:",e)}else this.createInterpolant=e;return this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return pr;case this.InterpolantFactoryMethodLinear:return mr;case this.InterpolantFactoryMethodSmooth:return gr}}getValueSize(){return this.values.length/this.times.length}shift(r){if(0!==r){var i=this.times;for(let e=0,t=i.length;e!==t;++e)i[e]+=r}return this}scale(r){if(1!==r){var i=this.times;for(let e=0,t=i.length;e!==t;++e)i[e]*=r}return this}trim(e,t){var r=this.times,i=r.length;let n=0,a=i-1;for(;n!==i&&r[n]<e;)++n;for(;-1!==a&&r[a]>t;)--a;if(++a,0!==n||a!==i){n>=a&&(a=Math.max(a,1),n=a-1);let e=this.getValueSize();this.times=x.arraySlice(r,n,a),this.values=x.arraySlice(this.values,n*e,a*e)}return this}validate(){let r=!0;var e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),r=!1);let i=this.times,n=this.values,a=i.length,s=(0===a&&(console.error("THREE.KeyframeTrack: Track is empty.",this),r=!1),null);for(let t=0;t!==a;t++){let e=i[t];if("number"==typeof e&&isNaN(e)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,e),r=!1;break}if(null!==s&&s>e){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,e,s),r=!1;break}s=e}if(void 0!==n&&x.isTypedArray(n))for(let t=0,e=n.length;t!==e;++t){let e=n[t];if(isNaN(e)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,e),r=!1;break}}return r}optimize(){let i=x.arraySlice(this.times),s=x.arraySlice(this.values),o=this.getValueSize(),t=this.getInterpolation()===gr,n=i.length-1,l=1;for(let e=1;e<n;++e){let a=!1;var r=i[e];if(r!==i[e+1]&&(1!==e||r!==i[0]))if(t)a=!0;else{let r=e*o,i=r-o,n=r+o;for(let t=0;t!==o;++t){let e=s[r+t];if(e!==s[i+t]||e!==s[n+t]){a=!0;break}}}if(a){if(e!==l){i[l]=i[e];let t=e*o,r=l*o;for(let e=0;e!==o;++e)s[r+e]=s[t+e]}++l}}if(0<n){i[l]=i[n];for(let e=n*o,t=l*o,r=0;r!==o;++r)s[t+r]=s[e+r];++l}return l!==i.length?(this.times=x.arraySlice(i,0,l),this.values=x.arraySlice(s,0,l*o)):(this.times=i,this.values=s),this}clone(){var e=x.arraySlice(this.times,0),t=x.arraySlice(this.values,0),e=new this.constructor(this.name,e,t);return e.createInterpolant=this.createInterpolant,e}}cd.prototype.TimeBufferType=Float32Array,cd.prototype.ValueBufferType=Float32Array,cd.prototype.DefaultInterpolation=mr;class fd extends cd{}fd.prototype.ValueTypeName="bool",fd.prototype.ValueBufferType=Array,fd.prototype.DefaultInterpolation=pr,fd.prototype.InterpolantFactoryMethodLinear=void 0,fd.prototype.InterpolantFactoryMethodSmooth=void 0;class pd extends cd{}pd.prototype.ValueTypeName="color";class md extends cd{}md.prototype.ValueTypeName="number";class gd extends ld{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){var n=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=(r-t)/(i-t);let l=e*s;for(var h=l+s;l!==h;l+=4)ki.slerpFlat(n,0,a,l-s,a,l,o);return n}}class vd extends cd{InterpolantFactoryMethodLinear(e){return new gd(this.times,this.values,this.getValueSize(),e)}}vd.prototype.ValueTypeName="quaternion",vd.prototype.DefaultInterpolation=mr,vd.prototype.InterpolantFactoryMethodSmooth=void 0;class yd extends cd{}yd.prototype.ValueTypeName="string",yd.prototype.ValueBufferType=Array,yd.prototype.DefaultInterpolation=pr,yd.prototype.InterpolantFactoryMethodLinear=void 0,yd.prototype.InterpolantFactoryMethodSmooth=void 0;class xd extends cd{}class bd{constructor(e,t=-1,r,i=br){this.name=e,this.tracks=r,this.duration=t,this.blendMode=i,this.uuid=pi(),this.duration<0&&this.resetDuration()}static parse(e){var r=[],i=e.tracks,n=1/(e.fps||1);for(let e=0,t=i.length;e!==t;++e)r.push(function(r){if(void 0===r.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let e=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return md;case"vector":case"vector2":case"vector3":case"vector4":return xd;case"color":return pd;case"quaternion":return vd;case"bool":case"boolean":return fd;case"string":return yd}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(r.type);if(void 0===r.times){let e=[],t=[];x.flattenJSON(r.keys,e,t,"value"),r.times=e,r.values=t}return void 0!==e.parse?e.parse(r):new e(r.name,r.times,r.values,r.interpolation)}(i[e]).scale(n));var t=new this(e.name,e.duration,r,e.blendMode);return t.uuid=e.uuid,t}static toJSON(e){var r=[],i=e.tracks,e={name:e.name,duration:e.duration,tracks:r,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,t=i.length;e!==t;++e)r.push(cd.toJSON(i[e]));return e}static CreateFromMorphTargetSequence(e,i,n,a){var s=i.length,o=[];for(let r=0;r<s;r++){let e=[],t=[];e.push((r+s-1)%s,r,(r+1)%s),t.push(0,1,0);var l=x.getKeyframeOrder(e);e=x.sortedArray(e,1,l),t=x.sortedArray(t,1,l),a||0!==e[0]||(e.push(s),t.push(t[0])),o.push(new md(".morphTargetInfluences["+i[r].name+"]",e,t).scale(1/n))}return new this(e,-1,o)}static findByName(t,r){let i=t;if(!Array.isArray(t)){let e=t;i=e.geometry&&e.geometry.animations||e.animations}for(let e=0;e<i.length;e++)if(i[e].name===r)return i[e];return null}static CreateClipsFromMorphTargetSequences(n,t,r){var a={},s=/^([\w-]*?)([\d]+)$/;for(let e=0,t=n.length;e<t;e++){let r=n[e],i=r.name.match(s);if(i&&1<i.length){let e=i[1],t=a[e];t||(a[e]=t=[]),t.push(r)}}let i=[];for(let e in a)i.push(this.CreateFromMorphTargetSequence(e,a[e],t,r));return i}static parseAnimation(e,r){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(e,t,r,i,n){var a,s;0!==r.length&&(a=[],s=[],x.flattenJSON(r,a,s,i),0!==a.length)&&n.push(new e(t,a,s))},s=[],t=e.name||"default",o=e.fps||30,n=e.blendMode,l=e.length||-1;var h=e.hierarchy||[];for(let t=0;t<h.length;t++){let a=h[t].keys;if(a&&0!==a.length)if(a[0].morphTargets){let t={},n;for(n=0;n<a.length;n++)if(a[n].morphTargets)for(let e=0;e<a[n].morphTargets.length;e++)t[a[n].morphTargets[e]]=-1;for(let i in t){let t=[],r=[];for(let e=0;e!==a[n].morphTargets.length;++e){let e=a[n];t.push(e.time),r.push(e.morphTarget===i?1:0)}s.push(new md(".morphTargetInfluence["+i+"]",t,r))}l=t.length*(o||1)}else{let e=".bones["+r[t].name+"]";i(xd,e+".position",a,"pos",s),i(vd,e+".quaternion",a,"rot",s),i(xd,e+".scale",a,"scl",s)}}return 0===s.length?null:new this(t,l,s,n)}resetDuration(){let r=0;for(let e=0,t=this.tracks.length;e!==t;++e){var i=this.tracks[e];r=Math.max(r,i.times[i.times.length-1])}return this.duration=r,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){var t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}let _d={enabled:!(xd.prototype.ValueTypeName="vector"),files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Td{constructor(e,t,r){let i=this,n=!1,a=0,s=0,o=void 0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){s++,!1===n&&void 0!==i.onStart&&i.onStart(e,a,s),n=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,s),a===s&&(n=!1,void 0!==i.onLoad)&&i.onLoad()},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return o?o(e):e},this.setURLModifier=function(e){return o=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){e=l.indexOf(e);return-1!==e&&l.splice(e,2),this},this.getHandler=function(r){for(let e=0,t=l.length;e<t;e+=2){var i=l[e],n=l[e+1];if(i.global&&(i.lastIndex=0),i.test(r))return n}return null}}}let Sd=new Td;class wd{constructor(e){this.manager=void 0!==e?e:Sd,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(r,i){let n=this;return new Promise(function(e,t){n.load(r,e,i,t)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}let Ed={};class Md extends wd{constructor(e){super(e)}load(h,e,t,r){void 0===h&&(h=""),void 0!==this.path&&(h=this.path+h),h=this.manager.resolveURL(h);let i=_d.get(h);if(void 0!==i)return this.manager.itemStart(h),setTimeout(()=>{e&&e(i),this.manager.itemEnd(h)},0),i;void 0!==Ed[h]?Ed[h].push({onLoad:e,onProgress:t,onError:r}):(Ed[h]=[],Ed[h].push({onLoad:e,onProgress:t,onError:r}),t=new Request(h,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),fetch(t).then(r=>{if(200!==r.status&&0!==r.status)throw Error(`fetch for "${r.url}" responded with ${r.status}: `+r.statusText);{0===r.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");let a=Ed[h],e=r.body.getReader(),t=r.headers.get("Content-Length"),s=t?parseInt(t):0,o=0!==s,l=0;return new ReadableStream({start(n){!function i(){e.read().then(({done:e,value:t})=>{if(e)n.close();else{l+=t.byteLength;let r=new ProgressEvent("progress",{lengthComputable:o,loaded:l,total:s});for(let t=0,e=a.length;t<e;t++){let e=a[t];e.onProgress&&e.onProgress(r)}n.enqueue(t),i()}})}()}})}}).then(e=>{var t=new Response(e);switch(this.responseType){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then(e=>(new DOMParser).parseFromString(e,this.mimeType));case"json":return t.json();default:return t.text()}}).then(r=>{_d.add(h,r);var i=Ed[h];delete Ed[h];for(let e=0,t=i.length;e<t;e++){var n=i[e];n.onLoad&&n.onLoad(r)}this.manager.itemEnd(h)}).catch(r=>{var i=Ed[h];delete Ed[h];for(let e=0,t=i.length;e<t;e++){var n=i[e];n.onError&&n.onError(r)}this.manager.itemError(h),this.manager.itemEnd(h)}),this.manager.itemStart(h))}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Ad extends wd{constructor(e){super(e)}load(t,r,e,i){let n=this,a=new Md(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(e){try{r(n.parse(JSON.parse(e)))}catch(e){i?i(e):console.error(e),n.manager.itemError(t)}},e,i)}parse(t){var r=[];for(let e=0;e<t.length;e++){var i=bd.parse(t[e]);r.push(i)}return r}}class Ld extends wd{constructor(e){super(e)}load(r,i,n,a){let s=this,o=[],l=new Fh,h=new Md(this.manager),u=(h.setPath(this.path),h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),h.setWithCredentials(s.withCredentials),0);if(Array.isArray(r))for(let e=0,t=r.length;e<t;++e)!function(t){h.load(r[t],function(e){e=s.parse(e,!0);o[t]={width:e.width,height:e.height,format:e.format,mipmaps:e.mipmaps},6===(u+=1)&&(1===e.mipmapCount&&(l.minFilter=B),l.image=o,l.format=e.format,l.needsUpdate=!0,i)&&i(l)},n,a)}(e);else h.load(r,function(e){var r=s.parse(e,!0);if(r.isCubemap){let e=r.mipmaps.length/r.mipmapCount;for(let t=0;t<e;t++){o[t]={mipmaps:[]};for(let e=0;e<r.mipmapCount;e++)o[t].mipmaps.push(r.mipmaps[t*r.mipmapCount+e]),o[t].format=r.format,o[t].width=r.width,o[t].height=r.height}l.image=o}else l.image.width=r.width,l.image.height=r.height,l.mipmaps=r.mipmaps;1===r.mipmapCount&&(l.minFilter=B),l.format=r.format,l.needsUpdate=!0,i&&i(l)},n,a);return l}}class Rd extends wd{constructor(e){super(e)}load(t,e,r,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);let n=this,a=_d.get(t);if(void 0!==a)return n.manager.itemStart(t),setTimeout(function(){e&&e(a),n.manager.itemEnd(t)},0),a;let s=Ei("img");function o(){h(),_d.add(t,this),e&&e(this),n.manager.itemEnd(t)}function l(e){h(),i&&i(e),n.manager.itemError(t),n.manager.itemEnd(t)}function h(){s.removeEventListener("load",o,!1),s.removeEventListener("error",l,!1)}return s.addEventListener("load",o,!1),s.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),n.manager.itemStart(t),s.src=t,s}}class Cd extends wd{constructor(e){super(e)}load(r,i,e,n){let a=new za,s=new Rd(this.manager),o=(s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),0);for(let e=0;e<r.length;++e)!function(t){s.load(r[t],function(e){a.images[t]=e,6===++o&&(a.needsUpdate=!0,i)&&i(a)},void 0,n)}(e);return a}}class Dd extends wd{constructor(e){super(e)}load(e,t,r,i){let n=this,a=new lh,s=new Md(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(n.withCredentials),s.load(e,function(e){e=n.parse(e);e&&(void 0!==e.image?a.image=e.image:void 0!==e.data&&(a.image.width=e.width,a.image.height=e.height,a.image.data=e.data),a.wrapS=void 0!==e.wrapS?e.wrapS:Le,a.wrapT=void 0!==e.wrapT?e.wrapT:Le,a.magFilter=void 0!==e.magFilter?e.magFilter:B,a.minFilter=void 0!==e.minFilter?e.minFilter:B,a.anisotropy=void 0!==e.anisotropy?e.anisotropy:1,void 0!==e.encoding&&(a.encoding=e.encoding),void 0!==e.flipY&&(a.flipY=e.flipY),void 0!==e.format&&(a.format=e.format),void 0!==e.type&&(a.type=e.type),void 0!==e.mipmaps&&(a.mipmaps=e.mipmaps,a.minFilter=Ze),1===e.mipmapCount&&(a.minFilter=B),void 0!==e.generateMipmaps&&(a.generateMipmaps=e.generateMipmaps),a.needsUpdate=!0,t)&&t(a,e)},r,i),a}}class Id extends wd{constructor(e){super(e)}load(e,t,r,i){let n=new u,a=new Rd(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(e){n.image=e,n.needsUpdate=!0,void 0!==t&&t(n)},r,i),n}}class Pd extends f{constructor(e,t=1){super(),this.type="Light",this.color=new m(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){e=super.toJSON(e);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}Pd.prototype.isLight=!0;class kd extends Pd{constructor(e,t,r){super(e,r),this.type="HemisphereLight",this.position.copy(f.DefaultUp),this.updateMatrix(),this.groundColor=new m(t)}copy(e){return Pd.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}kd.prototype.isHemisphereLight=!0;let Od=new ke,Fd=new Pe,Nd=new Pe;class Bd{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new V(512,512),this.map=null,this.mapPass=null,this.matrix=new ke,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ka,this._frameExtents=new V(1,1),this._viewportCount=1,this._viewports=[new Ie(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){var t=this.camera,r=this.matrix;Fd.setFromMatrixPosition(e.matrixWorld),t.position.copy(Fd),Nd.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Nd),t.updateMatrixWorld(),Od.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Od),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(t.projectionMatrix),r.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){var e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Ud extends Bd{constructor(){super(new F(50,1,.5,500)),this.focus=1}updateMatrices(e){var t=this.camera,r=2*ci*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;r===t.fov&&i===t.aspect&&n===t.far||(t.fov=r,t.aspect=i,t.far=n,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}Ud.prototype.isSpotLightShadow=!0;class Gd extends Pd{constructor(e,t,r=0,i=Math.PI/3,n=0,a=1){super(e,t),this.type="SpotLight",this.position.copy(f.DefaultUp),this.updateMatrix(),this.target=new f,this.distance=r,this.angle=i,this.penumbra=n,this.decay=a,this.shadow=new Ud}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Gd.prototype.isSpotLight=!0;let zd=new ke,Hd=new Pe,Vd=new Pe;class Wd extends Bd{constructor(){super(new F(90,1,.5,500)),this._frameExtents=new V(4,2),this._viewportCount=6,this._viewports=[new Ie(2,1,1,1),new Ie(0,1,1,1),new Ie(3,1,1,1),new Ie(1,1,1,1),new Ie(3,0,1,1),new Ie(1,0,1,1)],this._cubeDirections=[new Pe(1,0,0),new Pe(-1,0,0),new Pe(0,0,1),new Pe(0,0,-1),new Pe(0,1,0),new Pe(0,-1,0)],this._cubeUps=[new Pe(0,1,0),new Pe(0,1,0),new Pe(0,1,0),new Pe(0,1,0),new Pe(0,0,1),new Pe(0,0,-1)]}updateMatrices(e,t=0){var r=this.camera,i=this.matrix,n=e.distance||r.far;n!==r.far&&(r.far=n,r.updateProjectionMatrix()),Hd.setFromMatrixPosition(e.matrixWorld),r.position.copy(Hd),Vd.copy(r.position),Vd.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(Vd),r.updateMatrixWorld(),i.makeTranslation(-Hd.x,-Hd.y,-Hd.z),zd.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(zd)}}Wd.prototype.isPointLightShadow=!0;class jd extends Pd{constructor(e,t,r=0,i=1){super(e,t),this.type="PointLight",this.distance=r,this.decay=i,this.shadow=new Wd}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}jd.prototype.isPointLight=!0;class Yd extends Bd{constructor(){super(new ss(-5,5,5,-5,.5,500))}}Yd.prototype.isDirectionalLightShadow=!0;class $d extends Pd{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(f.DefaultUp),this.updateMatrix(),this.target=new f,this.shadow=new Yd}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}$d.prototype.isDirectionalLight=!0;class qd extends Pd{constructor(e,t){super(e,t),this.type="AmbientLight"}}qd.prototype.isAmbientLight=!0;class Kd extends Pd{constructor(e,t,r=10,i=10){super(e,t),this.type="RectAreaLight",this.width=r,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){e=super.toJSON(e);return e.object.width=this.width,e.object.height=this.height,e}}Kd.prototype.isRectAreaLight=!0;class Xd{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Pe)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){var r=e.x,i=e.y,e=e.z,n=this.coefficients;return t.copy(n[0]).multiplyScalar(.282095),t.addScaledVector(n[1],.488603*i),t.addScaledVector(n[2],.488603*e),t.addScaledVector(n[3],.488603*r),t.addScaledVector(n[4],r*i*1.092548),t.addScaledVector(n[5],i*e*1.092548),t.addScaledVector(n[6],.315392*(3*e*e-1)),t.addScaledVector(n[7],r*e*1.092548),t.addScaledVector(n[8],.546274*(r*r-i*i)),t}getIrradianceAt(e,t){var r=e.x,i=e.y,e=e.z,n=this.coefficients;return t.copy(n[0]).multiplyScalar(.886227),t.addScaledVector(n[1],1.023328*i),t.addScaledVector(n[2],1.023328*e),t.addScaledVector(n[3],1.023328*r),t.addScaledVector(n[4],.858086*r*i),t.addScaledVector(n[5],.858086*i*e),t.addScaledVector(n[6],.743125*e*e-.247708),t.addScaledVector(n[7],.858086*r*e),t.addScaledVector(n[8],.429043*(r*r-i*i)),t}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,r){for(let e=0;e<9;e++)this.coefficients[e].addScaledVector(t.coefficients[e],r);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,r){for(let e=0;e<9;e++)this.coefficients[e].lerp(t.coefficients[e],r);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,r=0){var i=this.coefficients;for(let e=0;e<9;e++)i[e].fromArray(t,r+3*e);return this}toArray(t=[],r=0){var i=this.coefficients;for(let e=0;e<9;e++)i[e].toArray(t,r+3*e);return t}static getBasisAt(e,t){var r=e.x,i=e.y,e=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*e,t[3]=.488603*r,t[4]=1.092548*r*i,t[5]=1.092548*i*e,t[6]=.315392*(3*e*e-1),t[7]=1.092548*r*e,t[8]=.546274*(r*r-i*i)}}Xd.prototype.isSphericalHarmonics3=!0;class Jd extends Pd{constructor(e=new Xd,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){e=super.toJSON(e);return e.object.sh=this.sh.toArray(),e}}Jd.prototype.isLightProbe=!0;class Zd extends wd{constructor(e){super(e),this.textures={}}load(t,r,e,i){let n=this,a=new Md(n.manager);a.setPath(n.path),a.setRequestHeader(n.requestHeader),a.setWithCredentials(n.withCredentials),a.load(t,function(e){try{r(n.parse(JSON.parse(e)))}catch(e){i?i(e):console.error(e),n.manager.itemError(t)}},e,i)}parse(t){let r=this.textures;function i(e){return void 0===r[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),r[e]}var n=new od[t.type];if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&void 0!==n.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.sheen&&(n.sheen=t.sheen),void 0!==t.sheenColor&&(n.sheenColor=(new m).setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(n.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==n.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==n.specular&&n.specular.setHex(t.specular),void 0!==t.specularIntensity&&(n.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==n.specularColor&&n.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearcoat&&(n.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(n.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.transmission&&(n.transmission=t.transmission),void 0!==t.thickness&&(n.thickness=t.thickness),void 0!==t.attenuationDistance&&(n.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==n.attenuationColor&&n.attenuationColor.setHex(t.attenuationColor),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.flatShading&&(n.flatShading=t.flatShading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.combine&&(n.combine=t.combine),void 0!==t.side&&(n.side=t.side),void 0!==t.shadowSide&&(n.shadowSide=t.shadowSide),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.format&&(n.format=t.format),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(n.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(n.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(n.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(n.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(n.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(n.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(n.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(n.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(n.rotation=t.rotation),1!==t.linewidth&&(n.linewidth=t.linewidth),void 0!==t.dashSize&&(n.dashSize=t.dashSize),void 0!==t.gapSize&&(n.gapSize=t.gapSize),void 0!==t.scale&&(n.scale=t.scale),void 0!==t.polygonOffset&&(n.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(n.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(n.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(n.dithering=t.dithering),void 0!==t.alphaToCoverage&&(n.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(n.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.toneMapped&&(n.toneMapped=t.toneMapped),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?n.vertexColors=0<t.vertexColors:n.vertexColors=t.vertexColors),void 0!==t.uniforms)for(let e in t.uniforms){var a=t.uniforms[e];switch(n.uniforms[e]={},a.type){case"t":n.uniforms[e].value=i(a.value);break;case"c":n.uniforms[e].value=(new m).setHex(a.value);break;case"v2":n.uniforms[e].value=(new V).fromArray(a.value);break;case"v3":n.uniforms[e].value=(new Pe).fromArray(a.value);break;case"v4":n.uniforms[e].value=(new Ie).fromArray(a.value);break;case"m3":n.uniforms[e].value=(new v).fromArray(a.value);break;case"m4":n.uniforms[e].value=(new ke).fromArray(a.value);break;default:n.uniforms[e].value=a.value}}if(void 0!==t.defines&&(n.defines=t.defines),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(let e in t.extensions)n.extensions[e]=t.extensions[e];if(void 0!==t.shading&&(n.flatShading=1===t.shading),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=i(t.map)),void 0!==t.matcap&&(n.matcap=i(t.matcap)),void 0!==t.alphaMap&&(n.alphaMap=i(t.alphaMap)),void 0!==t.bumpMap&&(n.bumpMap=i(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=i(t.normalMap)),void 0!==t.normalMapType&&(n.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),n.normalScale=(new V).fromArray(e)}return void 0!==t.displacementMap&&(n.displacementMap=i(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=i(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=i(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=i(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=i(t.specularMap)),void 0!==t.specularIntensityMap&&(n.specularIntensityMap=i(t.specularIntensityMap)),void 0!==t.specularColorMap&&(n.specularColorMap=i(t.specularColorMap)),void 0!==t.envMap&&(n.envMap=i(t.envMap)),void 0!==t.envMapIntensity&&(n.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(n.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(n.lightMap=i(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=i(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=i(t.gradientMap)),void 0!==t.clearcoatMap&&(n.clearcoatMap=i(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=i(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(n.clearcoatNormalMap=i(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(n.clearcoatNormalScale=(new V).fromArray(t.clearcoatNormalScale)),void 0!==t.transmissionMap&&(n.transmissionMap=i(t.transmissionMap)),void 0!==t.thicknessMap&&(n.thicknessMap=i(t.thicknessMap)),void 0!==t.sheenColorMap&&(n.sheenColorMap=i(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(n.sheenRoughnessMap=i(t.sheenRoughnessMap)),n}setTextures(e){return this.textures=e,this}}class Qd{static decodeText(r){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(r);let i="";for(let e=0,t=r.length;e<t;e++)i+=String.fromCharCode(r[e]);try{return decodeURIComponent(escape(i))}catch(r){return i}}static extractUrlBase(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class ec extends S{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){var e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}ec.prototype.isInstancedBufferGeometry=!0;class tc extends wd{constructor(e){super(e)}load(t,r,e,i){let n=this,a=new Md(n.manager);a.setPath(n.path),a.setRequestHeader(n.requestHeader),a.setWithCredentials(n.withCredentials),a.load(t,function(e){try{r(n.parse(JSON.parse(e)))}catch(e){i?i(e):console.error(e),n.manager.itemError(t)}},e,i)}parse(a){let n={},s={};function o(e,t){var r,i;return void 0!==n[t]?n[t]:(r=e.interleavedBuffers[t],e=e,i=r.buffer,i=void 0!==s[i]?s[i]:(e=e.arrayBuffers[i],e=new Uint32Array(e).buffer,s[i]=e),e=wi(r.type,i),(i=new kl(e,r.stride)).uuid=r.uuid,n[t]=i)}let l=new(a.isInstancedBufferGeometry?ec:S),t=a.data.index;if(void 0!==t){let e=wi(t.type,t.array);l.setIndex(new E(e,1))}var i=a.data.attributes;for(let e in i){let t=i[e],r;if(t.isInterleavedBufferAttribute){let e=o(a.data,t.data);r=new Ol(e,t.itemSize,t.offset,t.normalized)}else{let e=wi(t.type,t.array);r=new(t.isInstancedBufferAttribute?ch:E)(e,t.itemSize,t.normalized)}void 0!==t.name&&(r.name=t.name),void 0!==t.usage&&r.setUsage(t.usage),void 0!==t.updateRange&&(r.updateRange.offset=t.updateRange.offset,r.updateRange.count=t.updateRange.count),l.setAttribute(e,r)}var r=a.data.morphAttributes;if(r)for(let e in r){let i=r[e],n=[];for(let e=0,t=i.length;e<t;e++){let t=i[e],r;if(t.isInterleavedBufferAttribute){let e=o(a.data,t.data);r=new Ol(e,t.itemSize,t.offset,t.normalized)}else{let e=wi(t.type,t.array);r=new E(e,t.itemSize,t.normalized)}void 0!==t.name&&(r.name=t.name),n.push(r)}l.morphAttributes[e]=n}a.data.morphTargetsRelative&&(l.morphTargetsRelative=!0);var h=a.data.groups||a.data.drawcalls||a.data.offsets;if(void 0!==h)for(let t=0,e=h.length;t!==e;++t){let e=h[t];l.addGroup(e.start,e.count,e.materialIndex)}var u=a.data.boundingSphere;if(void 0!==u){let e=new Pe;void 0!==u.center&&e.fromArray(u.center),l.boundingSphere=new rn(e,u.radius)}return a.name&&(l.name=a.name),a.userData&&(l.userData=a.userData),l}}class rc extends wd{constructor(e){super(e)}load(r,i,e,n){let a=this,t=""===this.path?Qd.extractUrlBase(r):this.path;this.resourcePath=this.resourcePath||t;var s=new Md(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(r,function(e){let t=null;try{t=JSON.parse(e)}catch(e){return void 0!==n&&n(e),void console.error("THREE:ObjectLoader: Can't parse "+r+".",e.message)}e=t.metadata;void 0!==e&&void 0!==e.type&&"geometry"!==e.type.toLowerCase()?a.parse(t,i):console.error("THREE.ObjectLoader: Can't load "+r)},e,n)}async loadAsync(e,t){var r=""===this.path?Qd.extractUrlBase(e):this.path,r=(this.resourcePath=this.resourcePath||r,new Md(this.manager)),r=(r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),await r.loadAsync(e,t)),t=JSON.parse(r),r=t.metadata;if(void 0===r||void 0===r.type||"geometry"===r.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return this.parseAsync(t)}parse(e,r){let t=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),n=this.parseGeometries(e.geometries,i),a=this.parseImages(e.images,function(){void 0!==r&&r(l)}),s=this.parseTextures(e.textures,a),o=this.parseMaterials(e.materials,s),l=this.parseObject(e.object,n,o,s,t),h=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,h),void 0!==r){let t=!1;for(let e in a)if(a[e]instanceof HTMLImageElement){t=!0;break}!1===t&&r(l)}return l}async parseAsync(e){var t=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,r),i=await this.parseImagesAsync(e.images),i=this.parseTextures(e.textures,i),n=this.parseMaterials(e.materials,i),r=this.parseObject(e.object,r,n,i,t),n=this.parseSkeletons(e.skeletons,r);return this.bindSkeletons(r,n),r}parseShapes(r){var i={};if(void 0!==r)for(let e=0,t=r.length;e<t;e++){var n=(new vu).fromJSON(r[e]);i[n.uuid]=n}return i}parseSkeletons(r,e){let i={},n={};if(e.traverse(function(e){e.isBone&&(n[e.uuid]=e)}),void 0!==r)for(let e=0,t=r.length;e<t;e++){var a=(new dh).fromJSON(r[e],n);i[a.uuid]=a}return i}parseGeometries(r,i){var n={};if(void 0!==r){var a=new tc;for(let t=0,e=r.length;t<e;t++){let e;var s=r[t];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":e=a.parse(s);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:s.type in Ju?e=Ju[s.type].fromJSON(s,i):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${s.type}"`)}e.uuid=s.uuid,void 0!==s.name&&(e.name=s.name),!0===e.isBufferGeometry&&void 0!==s.userData&&(e.userData=s.userData),n[s.uuid]=e}}return n}parseMaterials(r,e){let i={},n={};if(void 0!==r){var a=new Zd;a.setTextures(e);for(let e=0,t=r.length;e<t;e++){var s=r[e];if("MultiMaterial"===s.type){let r=[];for(let t=0;t<s.materials.length;t++){let e=s.materials[t];void 0===i[e.uuid]&&(i[e.uuid]=a.parse(e)),r.push(i[e.uuid])}n[s.uuid]=r}else void 0===i[s.uuid]&&(i[s.uuid]=a.parse(s)),n[s.uuid]=i[s.uuid]}}return n}parseAnimations(t){var r={};if(void 0!==t)for(let e=0;e<t.length;e++){var i=t[e],i=bd.parse(i);r[i.uuid]=i}return r}parseImages(n,t){let i=this,a={},s;function o(e){var t,r;return"string"==typeof e?(r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t=e)?t:i.resourcePath+t,i.manager.itemStart(r),s.load(r,function(){i.manager.itemEnd(r)},void 0,function(){i.manager.itemError(r),i.manager.itemEnd(r)})):e.data?{data:wi(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==n&&0<n.length){let e=new Td(t);(s=new Rd(e)).setCrossOrigin(this.crossOrigin);for(let e=0,t=n.length;e<t;e++){let r=n[e],i=r.url;if(Array.isArray(i)){a[r.uuid]=[];for(let t=0,e=i.length;t<e;t++){let e=o(i[t]);null!==e&&(e instanceof HTMLImageElement?a[r.uuid].push(e):a[r.uuid].push(new lh(e.data,e.width,e.height)))}}else{let e=o(r.url);null!==e&&(a[r.uuid]=e)}}}return a}async parseImagesAsync(r){let i=this,a={},n;async function s(e){var t;return"string"==typeof e?(t=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t=e)?t:i.resourcePath+t,n.loadAsync(t)):e.data?{data:wi(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==r&&0<r.length){(n=new Rd(this.manager)).setCrossOrigin(this.crossOrigin);for(let e=0,t=r.length;e<t;e++){let i=r[e],n=i.url;if(Array.isArray(n)){a[i.uuid]=[];for(let r=0,e=n.length;r<e;r++){let e=n[r],t=await s(e);null!==t&&(t instanceof HTMLImageElement?a[i.uuid].push(t):a[i.uuid].push(new lh(t.data,t.width,t.height)))}}else{let e=await s(i.url);null!==e&&(a[i.uuid]=e)}}}return a}parseTextures(r,i){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var a={};if(void 0!==r)for(let t=0,e=r.length;t<e;t++){var s=r[t];let e;void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===i[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);var o=i[s.image];Array.isArray(o)?(e=new za(o),6===o.length&&(e.needsUpdate=!0)):(e=o&&o.data?new lh(o.data,o.width,o.height):new u(o),o&&(e.needsUpdate=!0)),e.uuid=s.uuid,void 0!==s.name&&(e.name=s.name),void 0!==s.mapping&&(e.mapping=n(s.mapping,ic)),void 0!==s.offset&&e.offset.fromArray(s.offset),void 0!==s.repeat&&e.repeat.fromArray(s.repeat),void 0!==s.center&&e.center.fromArray(s.center),void 0!==s.rotation&&(e.rotation=s.rotation),void 0!==s.wrap&&(e.wrapS=n(s.wrap[0],nc),e.wrapT=n(s.wrap[1],nc)),void 0!==s.format&&(e.format=s.format),void 0!==s.type&&(e.type=s.type),void 0!==s.encoding&&(e.encoding=s.encoding),void 0!==s.minFilter&&(e.minFilter=n(s.minFilter,ac)),void 0!==s.magFilter&&(e.magFilter=n(s.magFilter,ac)),void 0!==s.anisotropy&&(e.anisotropy=s.anisotropy),void 0!==s.flipY&&(e.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(e.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(e.unpackAlignment=s.unpackAlignment),void 0!==s.userData&&(e.userData=s.userData),a[s.uuid]=e}return a}parseObject(n,r,a,i,s){let o,l,h;function u(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),r[e]}function d(r){if(void 0!==r){if(Array.isArray(r)){var i=[];for(let e=0,t=r.length;e<t;e++){var n=r[e];void 0===a[n]&&console.warn("THREE.ObjectLoader: Undefined material",n),i.push(a[n])}return i}return void 0===a[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),a[r]}}function c(e){return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),i[e]}switch(n.type){case"Scene":o=new Pl,void 0!==n.background&&(Number.isInteger(n.background)?o.background=new m(n.background):o.background=c(n.background)),void 0!==n.environment&&(o.environment=c(n.environment)),void 0!==n.fog&&("Fog"===n.fog.type?o.fog=new Il(n.fog.color,n.fog.near,n.fog.far):"FogExp2"===n.fog.type&&(o.fog=new Dl(n.fog.color,n.fog.density)));break;case"PerspectiveCamera":o=new F(n.fov,n.aspect,n.near,n.far),void 0!==n.focus&&(o.focus=n.focus),void 0!==n.zoom&&(o.zoom=n.zoom),void 0!==n.filmGauge&&(o.filmGauge=n.filmGauge),void 0!==n.filmOffset&&(o.filmOffset=n.filmOffset),void 0!==n.view&&(o.view=Object.assign({},n.view));break;case"OrthographicCamera":o=new ss(n.left,n.right,n.top,n.bottom,n.near,n.far),void 0!==n.zoom&&(o.zoom=n.zoom),void 0!==n.view&&(o.view=Object.assign({},n.view));break;case"AmbientLight":o=new qd(n.color,n.intensity);break;case"DirectionalLight":o=new $d(n.color,n.intensity);break;case"PointLight":o=new jd(n.color,n.intensity,n.distance,n.decay);break;case"RectAreaLight":o=new Kd(n.color,n.intensity,n.width,n.height);break;case"SpotLight":o=new Gd(n.color,n.intensity,n.distance,n.angle,n.penumbra,n.decay);break;case"HemisphereLight":o=new kd(n.color,n.groundColor,n.intensity);break;case"LightProbe":o=(new Jd).fromJSON(n);break;case"SkinnedMesh":l=u(n.geometry),h=d(n.material),o=new sh(l,h),void 0!==n.bindMode&&(o.bindMode=n.bindMode),void 0!==n.bindMatrix&&o.bindMatrix.fromArray(n.bindMatrix),void 0!==n.skeleton&&(o.skeleton=n.skeleton);break;case"Mesh":l=u(n.geometry),h=d(n.material),o=new w(l,h);break;case"InstancedMesh":l=u(n.geometry),h=d(n.material);let e=n.count,t=n.instanceMatrix,r=n.instanceColor;(o=new vh(l,h,e)).instanceMatrix=new ch(new Float32Array(t.array),16),void 0!==r&&(o.instanceColor=new ch(new Float32Array(r.array),r.itemSize));break;case"LOD":o=new eh;break;case"Line":o=new Sh(u(n.geometry),d(n.material));break;case"LineLoop":o=new Ah(u(n.geometry),d(n.material));break;case"LineSegments":o=new Mh(u(n.geometry),d(n.material));break;case"PointCloud":case"Points":o=new Ph(u(n.geometry),d(n.material));break;case"Sprite":o=new Xl(d(n.material));break;case"Group":o=new El;break;case"Bone":o=new oh;break;default:o=new f}if(o.uuid=n.uuid,void 0!==n.name&&(o.name=n.name),void 0!==n.matrix?(o.matrix.fromArray(n.matrix),void 0!==n.matrixAutoUpdate&&(o.matrixAutoUpdate=n.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==n.position&&o.position.fromArray(n.position),void 0!==n.rotation&&o.rotation.fromArray(n.rotation),void 0!==n.quaternion&&o.quaternion.fromArray(n.quaternion),void 0!==n.scale&&o.scale.fromArray(n.scale)),void 0!==n.castShadow&&(o.castShadow=n.castShadow),void 0!==n.receiveShadow&&(o.receiveShadow=n.receiveShadow),n.shadow&&(void 0!==n.shadow.bias&&(o.shadow.bias=n.shadow.bias),void 0!==n.shadow.normalBias&&(o.shadow.normalBias=n.shadow.normalBias),void 0!==n.shadow.radius&&(o.shadow.radius=n.shadow.radius),void 0!==n.shadow.mapSize&&o.shadow.mapSize.fromArray(n.shadow.mapSize),void 0!==n.shadow.camera)&&(o.shadow.camera=this.parseObject(n.shadow.camera)),void 0!==n.visible&&(o.visible=n.visible),void 0!==n.frustumCulled&&(o.frustumCulled=n.frustumCulled),void 0!==n.renderOrder&&(o.renderOrder=n.renderOrder),void 0!==n.userData&&(o.userData=n.userData),void 0!==n.layers&&(o.layers.mask=n.layers),void 0!==n.children){let t=n.children;for(let e=0;e<t.length;e++)o.add(this.parseObject(t[e],r,a,i,s))}if(void 0!==n.animations){let r=n.animations;for(let t=0;t<r.length;t++){let e=r[t];o.animations.push(s[e])}}if("LOD"===n.type){void 0!==n.autoUpdate&&(o.autoUpdate=n.autoUpdate);let i=n.levels;for(let r=0;r<i.length;r++){let e=i[r],t=o.getObjectByProperty("uuid",e.object);void 0!==t&&o.addLevel(t,e.distance)}}return o}bindSkeletons(e,r){0!==Object.keys(r).length&&e.traverse(function(e){var t;!0===e.isSkinnedMesh&&void 0!==e.skeleton&&(void 0===(t=r[e.skeleton])?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(t,e.bindMatrix))})}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}let ic={UVMapping:Me,CubeReflectionMapping:Be,CubeRefractionMapping:Ue,EquirectangularReflectionMapping:Ge,EquirectangularRefractionMapping:ze,CubeUVReflectionMapping:He,CubeUVRefractionMapping:Ve},nc={RepeatWrapping:We,ClampToEdgeWrapping:Le,MirroredRepeatWrapping:je},ac={NearestFilter:Re,NearestMipmapNearestFilter:Ye,NearestMipmapLinearFilter:qe,LinearFilter:B,LinearMipmapNearestFilter:Xe,LinearMipmapLinearFilter:Ze};class sc extends wd{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(t,r,e,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);let n=this,a=_d.get(t);if(void 0!==a)return n.manager.itemStart(t),setTimeout(function(){r&&r(a),n.manager.itemEnd(t)},0),a;var s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",s.headers=this.requestHeader,fetch(t,s).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(n.options,{colorSpaceConversion:"none"}))}).then(function(e){_d.add(t,e),r&&r(e),n.manager.itemEnd(t)}).catch(function(e){i&&i(e),n.manager.itemError(t),n.manager.itemEnd(t)}),n.manager.itemStart(t)}}let oc,lc=(sc.prototype.isImageBitmapLoader=!0,{getContext:function(){return oc=void 0===oc?new(window.AudioContext||window.webkitAudioContext):oc},setContext:function(e){oc=e}});class hc extends wd{constructor(e){super(e)}load(r,i,e,n){let a=this,t=new Md(this.manager);t.setResponseType("arraybuffer"),t.setPath(this.path),t.setRequestHeader(this.requestHeader),t.setWithCredentials(this.withCredentials),t.load(r,function(t){try{let e=t.slice(0);lc.getContext().decodeAudioData(e,function(e){i(e)})}catch(e){n?n(e):console.error(e),a.manager.itemError(r)}},e,n)}}class uc extends Jd{constructor(e,t,r=1){super(void 0,r);var r=(new m).set(e),e=(new m).set(t),t=new Pe(r.r,r.g,r.b),r=new Pe(e.r,e.g,e.b),e=Math.sqrt(Math.PI),i=e*Math.sqrt(.75);this.sh.coefficients[0].copy(t).add(r).multiplyScalar(e),this.sh.coefficients[1].copy(t).sub(r).multiplyScalar(i)}}uc.prototype.isHemisphereLightProbe=!0;class dc extends Jd{constructor(e,t=1){super(void 0,t);t=(new m).set(e);this.sh.coefficients[0].set(t.r,t.g,t.b).multiplyScalar(2*Math.sqrt(Math.PI))}}dc.prototype.isAmbientLightProbe=!0;let cc=new ke,fc=new ke;class pc{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new F,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new F,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){var t,r,i,n,a,s=this._cache;s.focus===e.focus&&s.fov===e.fov&&s.aspect===e.aspect*this.aspect&&s.near===e.near&&s.far===e.far&&s.zoom===e.zoom&&s.eyeSep===this.eyeSep||(s.focus=e.focus,s.fov=e.fov,s.aspect=e.aspect*this.aspect,s.near=e.near,s.far=e.far,s.zoom=e.zoom,s.eyeSep=this.eyeSep,t=e.projectionMatrix.clone(),r=(n=s.eyeSep/2)*s.near/s.focus,i=s.near*Math.tan(di*s.fov*.5)/s.zoom,fc.elements[12]=-n,cc.elements[12]=n,n=-i*s.aspect+r,a=i*s.aspect+r,t.elements[0]=2*s.near/(a-n),t.elements[8]=(a+n)/(a-n),this.cameraL.projectionMatrix.copy(t),n=-i*s.aspect-r,a=i*s.aspect-r,t.elements[0]=2*s.near/(a-n),t.elements[8]=(a+n)/(a-n),this.cameraR.projectionMatrix.copy(t)),this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(fc),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(cc)}}class mc{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=gc(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;var t;return this.autoStart&&!this.running?(this.start(),0):(this.running&&(t=gc(),e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e),e)}}function gc(){return("undefined"==typeof performance?Date:performance).now()}let vc=new Pe,yc=new ki,xc=new Pe,bc=new Pe;class _c extends f{constructor(){super(),this.type="AudioListener",this.context=lc.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new mc}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return(null!==this.filter?(this.gain.disconnect(this.filter),this.filter):this.gain).disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);var t=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(vc,yc,xc),bc.set(0,0,-1).applyQuaternion(yc),t.positionX){let e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(vc.x,e),t.positionY.linearRampToValueAtTime(vc.y,e),t.positionZ.linearRampToValueAtTime(vc.z,e),t.forwardX.linearRampToValueAtTime(bc.x,e),t.forwardY.linearRampToValueAtTime(bc.y,e),t.forwardZ.linearRampToValueAtTime(bc.z,e),t.upX.linearRampToValueAtTime(r.x,e),t.upY.linearRampToValueAtTime(r.y,e),t.upZ.linearRampToValueAtTime(r.z,e)}else t.setPosition(vc.x,vc.y,vc.z),t.setOrientation(bc.x,bc.y,bc.z,r.x,r.y,r.z)}}class Tc extends f{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else{if(!1!==this.hasPlaybackControl)return this._startedAt=this.context.currentTime+e,(e=this.context.createBufferSource()).buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect();console.warn("THREE.Audio: this Audio has no playback control.")}}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e=e||[],!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}let Sc=new Pe,wc=new ki,Ec=new Pe,Mc=new Pe;class Ac extends Tc{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(Sc,wc,Ec),Mc.set(0,0,1).applyQuaternion(wc);var t=this.panner;if(t.positionX){let e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Sc.x,e),t.positionY.linearRampToValueAtTime(Sc.y,e),t.positionZ.linearRampToValueAtTime(Sc.z,e),t.orientationX.linearRampToValueAtTime(Mc.x,e),t.orientationY.linearRampToValueAtTime(Mc.y,e),t.orientationZ.linearRampToValueAtTime(Mc.z,e)}else t.setPosition(Sc.x,Sc.y,Sc.z),t.setOrientation(Mc.x,Mc.y,Mc.z)}}}class Lc{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;var r=this.getFrequencyData();for(let e=0;e<r.length;e++)t+=r[e];return t/r.length}}class Rc{constructor(e,t,r){let i,n,a;switch(this.binding=e,this.valueSize=r,t){case"quaternion":i=this._slerp,n=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":i=this._select,n=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*r);break;default:i=this._lerp,n=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=n,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){var r=this.buffer,i=this.valueSize,n=e*i+i;let a=this.cumulativeWeight;if(0===a){for(let e=0;e!==i;++e)r[n+e]=r[e];a=t}else{let e=t/(a+=t);this._mixBufferRegion(r,n,0,e,i)}this.cumulativeWeight=a}accumulateAdditive(e){var t=this.buffer,r=this.valueSize,i=r*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){var r=this.valueSize,i=this.buffer,n=e*r+r,t=this.cumulativeWeight,e=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,t<1){let e=r*this._origIndex;this._mixBufferRegion(i,n,e,1-t,r)}0<e&&this._mixBufferRegionAdditive(i,n,this._addIndex*r,1,r);for(let e=r,t=r+r;e!==t;++e)if(i[e]!==i[e+r]){a.setValue(i,n);break}}saveOriginalState(){var e=this.binding,r=this.buffer,i=this.valueSize,n=i*this._origIndex;e.getValue(r,n);for(let e=i,t=n;e!==t;++e)r[e]=r[n+e%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){var t=this._addIndex*this.valueSize,r=t+this.valueSize;for(let e=t;e<r;e++)this.buffer[e]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){var t=this._origIndex*this.valueSize,r=this._addIndex*this.valueSize;for(let e=0;e<this.valueSize;e++)this.buffer[r+e]=this.buffer[t+e]}_select(t,r,i,e,n){if(.5<=e)for(let e=0;e!==n;++e)t[r+e]=t[i+e]}_slerp(e,t,r,i){ki.slerpFlat(e,t,e,t,e,r,i)}_slerpAdditive(e,t,r,i,n){n=this._workIndex*n;ki.multiplyQuaternionsFlat(e,n,e,t,e,r),ki.slerpFlat(e,t,e,t,e,n,i)}_lerp(r,i,n,a,e){var s=1-a;for(let t=0;t!==e;++t){let e=i+t;r[e]=r[e]*s+r[n+t]*a}}_lerpAdditive(r,i,n,a,e){for(let t=0;t!==e;++t){let e=i+t;r[e]=r[e]+r[n+t]*a}}}let Cc=new RegExp("[\\[\\]\\.:\\/]","g"),Dc="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Ic=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),Pc=/(WCOD+)?/.source.replace("WCOD",Dc),kc=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Oc=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Fc=new RegExp("^"+Ic+Pc+kc+Oc+"$"),Nc=["material","materials","bones"];class b{constructor(e,t,r){this.path=t,this.parsedPath=r||b.parseTrackName(t),this.node=b.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,r){return new(e&&e.isAnimationObjectGroup?b.Composite:b)(e,t,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Cc,"")}static parseTrackName(e){var t=Fc.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var t={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=t.nodeName&&t.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){let e=t.nodeName.substring(r+1);-1!==Nc.indexOf(e)&&(t.nodeName=t.nodeName.substring(0,r),t.objectName=e)}if(null===t.propertyName||0===t.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return t}static findNode(t,n){if(!n||""===n||"."===n||-1===n||n===t.name||n===t.uuid)return t;if(t.skeleton){var e=t.skeleton.getBoneByName(n);if(void 0!==e)return e}if(t.children){let i=function(t){for(let e=0;e<t.length;e++){var r=t[e];if(r.name===n||r.uuid===n)return r;r=i(r.children);if(r)return r}return null},e=i(t.children);if(e)return e}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(r,i){var n=this.resolvedProperty;for(let e=0,t=n.length;e!==t;++e)r[i++]=n[e]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(r,i){var n=this.resolvedProperty;for(let e=0,t=n.length;e!==t;++e)n[e]=r[i++]}_setValue_array_setNeedsUpdate(r,i){var n=this.resolvedProperty;for(let e=0,t=n.length;e!==t;++e)n[e]=r[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(r,i){var n=this.resolvedProperty;for(let e=0,t=n.length;e!==t;++e)n[e]=r[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let r=this.node,i=this.parsedPath,e=i.objectName,n=i.propertyName,a=i.propertyIndex;if(r||(r=b.findNode(this.rootNode,i.nodeName)||this.rootNode,this.node=r),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,r){if(e){let t=i.objectIndex;switch(e){case"materials":if(!r.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!r.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);r=r.material.materials;break;case"bones":if(!r.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);r=r.skeleton.bones;for(let e=0;e<r.length;e++)if(r[e].name===t){t=e;break}break;default:if(void 0===r[e])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);r=r[e]}if(void 0!==t){if(void 0===r[t])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,r);r=r[t]}}var s=r[n];if(void 0===s){let e=i.nodeName;void console.error("THREE.PropertyBinding: Trying to update property for track: "+e+"."+n+" but it wasn't found.",r)}else{let e=this.Versioning.None,t=(void 0!==(this.targetObject=r).needsUpdate?e=this.Versioning.NeedsUpdate:void 0!==r.matrixWorldNeedsUpdate&&(e=this.Versioning.MatrixWorldNeedsUpdate),this.BindingType.Direct);if(void 0!==a){if("morphTargetInfluences"===n){if(!r.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!r.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!r.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==r.morphTargetDictionary[a]&&(a=r.morphTargetDictionary[a])}t=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=a}else void 0!==s.fromArray&&void 0!==s.toArray?(t=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(t=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[t],this.setValue=this.SetterByBindingTypeAndVersioning[t][e]}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}b.Composite=class{constructor(e,t,r){r=r||b.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();var r=this._targetGroup.nCachedObjects_,r=this._bindings[r];void 0!==r&&r.getValue(e,t)}setValue(r,i){var n=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=n.length;e!==t;++e)n[e].setValue(r,i)}bind(){var r=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=r.length;e!==t;++e)r[e].bind()}unbind(){var r=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=r.length;e!==t;++e)r[e].unbind()}},b.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},b.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},b.prototype.GetterByBindingType=[b.prototype._getValue_direct,b.prototype._getValue_array,b.prototype._getValue_arrayElement,b.prototype._getValue_toArray],b.prototype.SetterByBindingTypeAndVersioning=[[b.prototype._setValue_direct,b.prototype._setValue_direct_setNeedsUpdate,b.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[b.prototype._setValue_array,b.prototype._setValue_array_setNeedsUpdate,b.prototype._setValue_array_setMatrixWorldNeedsUpdate],[b.prototype._setValue_arrayElement,b.prototype._setValue_arrayElement_setNeedsUpdate,b.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[b.prototype._setValue_fromArray,b.prototype._setValue_fromArray_setNeedsUpdate,b.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Bc{constructor(){this.uuid=pi(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var r={};this._indicesByUUID=r;for(let e=0,t=arguments.length;e!==t;++e)r[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};let e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){let r=this._objects,i=this._indicesByUUID,s=this._paths,o=this._parsedPaths,l=this._bindings,h=l.length,u=void 0,n=r.length,d=this.nCachedObjects_;for(let e=0,t=arguments.length;e!==t;++e){var c=arguments[e],f=c.uuid;let a=i[f];if(void 0===a){a=n++,i[f]=a,r.push(c);for(let e=0,t=h;e!==t;++e)l[e].push(new b(c,s[e],o[e]))}else if(a<d){u=r[a];let n=--d,e=r[n];i[e.uuid]=a,r[a]=e,i[f]=n,r[n]=c;for(let i=0,e=h;i!==e;++i){let e=l[i],t=e[n],r=e[a];e[a]=t,void 0===r&&(r=new b(c,s[i],o[i])),e[n]=r}}else r[a]!==u&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=d}remove(){let r=this._objects,i=this._indicesByUUID,n=this._bindings,a=n.length,s=this.nCachedObjects_;for(let e=0,t=arguments.length;e!==t;++e){var o=arguments[e],l=o.uuid,h=i[l];if(void 0!==h&&h>=s){var u=s++,d=r[u];i[d.uuid]=h,r[h]=d,i[l]=u,r[u]=o;for(let i=0,e=a;i!==e;++i){let e=n[i],t=e[u],r=e[h];e[h]=t,e[u]=r}}}this.nCachedObjects_=s}uncache(){let i=this._objects,n=this._indicesByUUID,a=this._bindings,s=a.length,r=this.nCachedObjects_,o=i.length;for(let e=0,t=arguments.length;e!==t;++e){var l=arguments[e].uuid,h=n[l];if(void 0!==h)if(delete n[l],h<r){var u=--r,l=i[u],d=--o,c=i[d];n[l.uuid]=h,i[h]=l,n[c.uuid]=u,i[u]=c,i.pop();for(let i=0,e=s;i!==e;++i){let e=a[i],t=e[u],r=e[d];e[h]=t,e[u]=r,e.pop()}}else{let r=--o,e=i[r];0<r&&(n[e.uuid]=h),i[h]=e,i.pop();for(let t=0,e=s;t!==e;++t){let e=a[t];e[h]=e[r],e.pop()}}}this.nCachedObjects_=r}subscribe_(r,i){var e=this._bindingsIndicesByPath;let t=e[r];var n=this._bindings;if(void 0!==t)return n[t];var a=this._paths,s=this._parsedPaths,o=this._objects,l=o.length,h=this.nCachedObjects_,u=new Array(l);t=n.length,e[r]=t,a.push(r),s.push(i),n.push(u);for(let t=h,e=o.length;t!==e;++t){let e=o[t];u[t]=new b(e,r,i)}return u}unsubscribe_(e){var t,r,i,n,a,s=this._bindingsIndicesByPath,o=s[e];void 0!==o&&(t=this._paths,r=this._parsedPaths,a=(i=this._bindings)[n=i.length-1],i[s[e[n]]=o]=a,i.pop(),r[o]=r[n],r.pop(),t[o]=t[n],t.pop())}}Bc.prototype.isAnimationObjectGroup=!0;class Uc{constructor(e,t,r=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=r,this.blendMode=i;var n=t.tracks,a=n.length,s=new Array(a),o={endingStart:vr,endingEnd:vr};for(let t=0;t!==a;++t){let e=n[t].createInterpolant(null);(s[t]=e).settings=o}this._interpolantSettings=o,this._interpolants=s,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=cr,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(n,a,e){if(n.fadeOut(a),this.fadeIn(a),e){let e=this._clip.duration,t=n._clip.duration,r=t/e,i=e/t;n.warp(1,r,a),this.warp(i,1,a)}return this}crossFadeTo(e,t,r){return e.crossFadeFrom(this,t,r)}stopFading(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,r){var i=this._mixer,n=i.time,a=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=i._lendControlInterpolant(),this._timeScaleInterpolant=s);var i=s.parameterPositions,o=s.sampleValues;return i[0]=n,i[1]=n+r,o[0]=e/a,o[1]=t/a,this}stopWarping(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,r,i,n){if(this.enabled){var a=this._startTime;if(null!==a){let e=(t-a)*i;if(e<0||0===i)return;this._startTime=null,r=i*e}r*=this._updateTimeScale(t);var s=this._updateTime(r),o=this._updateWeight(t);if(0<o){let r=this._interpolants,i=this._propertyBindings;if(this.blendMode===_r)for(let e=0,t=r.length;e!==t;++e)r[e].evaluate(s),i[e].accumulateAdditive(o);else{br;for(let e=0,t=r.length;e!==t;++e)r[e].evaluate(s),i[e].accumulate(n,o)}}}else this._updateWeight(t)}_updateWeight(e){let t=0;var r,i;return this.enabled&&(t=this.weight,null!==(r=this._weightInterpolant))&&(i=r.evaluate(e)[0],t*=i,e>r.parameterPositions[1])&&(this.stopFading(),0===i)&&(this.enabled=!1),this._effectiveWeight=t}_updateTimeScale(e){let t=0;var r;return this.paused||(t=this.timeScale,null!==(r=this._timeScaleInterpolant)&&(t*=r.evaluate(e)[0],e>r.parameterPositions[1])&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)),this._effectiveTimeScale=t}_updateTime(t){let r=this._clip.duration,e=this.loop,i=this.time+t,n=this._loopCount;var a=e===fr;if(0===t)return-1!==n&&a&&1==(1&n)?r-i:i;if(e===dr){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=r)i=r;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===n&&(0<=t?(n=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),i>=r||i<0){let e=Math.floor(i/r);i-=r*e,n+=Math.abs(e);var s=this.repetitions-n;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=0<t?r:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<t?1:-1});else{if(1==s){let e=t<0;this._setEndings(e,!e,a)}else this._setEndings(!1,!1,a);this._loopCount=n,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:e})}}else this.time=i;if(a&&1==(1&n))return r-i}return i}_setEndings(e,t,r){var i=this._interpolantSettings;r?(i.endingStart=yr,i.endingEnd=yr):(i.endingStart=e?this.zeroSlopeAtStart?yr:vr:xr,i.endingEnd=t?this.zeroSlopeAtEnd?yr:vr:xr)}_scheduleFading(e,t,r){var i=this._mixer,n=i.time;let a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);var i=a.parameterPositions,s=a.sampleValues;return i[0]=n,s[0]=t,i[1]=n+e,s[1]=r,this}}class Gc extends hi{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,a){let s=e._localRoot||this._root,o=e._clip.tracks,t=o.length,l=e._propertyBindings,h=e._interpolants,u=s.uuid,r=this._bindingsByRootAndName,d=r[u];void 0===d&&(d={},r[u]=d);for(let n=0;n!==t;++n){let t=o[n],r=t.name,i=d[r];if(void 0===i){if(void 0!==(i=l[n])){null===i._cacheIndex&&(++i.referenceCount,this._addInactiveBinding(i,u,r));continue}let e=a&&a._propertyBindings[n].binding.parsedPath;++(i=new Rc(b.create(s,r,e),t.ValueTypeName,t.getValueSize())).referenceCount,this._addInactiveBinding(i,u,r)}l[n]=i,h[n].resultBuffer=i.buffer}}_activateAction(e){if(!this._isActiveAction(e)){null===e._cacheIndex&&(t=(e._localRoot||this._root).uuid,r=e._clip.uuid,i=this._actionsByClip[r],this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,r,t));var t,r,i,n=e._propertyBindings;for(let e=0,t=n.length;e!==t;++e){var a=n[e];0==a.useCount++&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){var r=e._propertyBindings;for(let e=0,t=r.length;e!==t;++e){var i=r[e];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){e=e._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,r){var i=this._actions,n=this._actionsByClip;let a=n[e];if(void 0===a)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,n[e]=a;else{let e=a.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=i.length,i.push(t),a.actionByRoot[r]=t}_removeInactiveAction(e){var t=this._actions,r=t[t.length-1],i=e._cacheIndex,i=(t[r._cacheIndex=i]=r,t.pop(),e._cacheIndex=null,e._clip.uuid),r=this._actionsByClip,t=r[i],n=t.knownActions,a=n[n.length-1],s=e._byClipCacheIndex;n[a._byClipCacheIndex=s]=a,n.pop(),e._byClipCacheIndex=null,delete t.actionByRoot[(e._localRoot||this._root).uuid],0===n.length&&delete r[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){var r=e._propertyBindings;for(let e=0,t=r.length;e!==t;++e){var i=r[e];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(e){var t=this._actions,r=e._cacheIndex,i=this._nActiveActions++,n=t[i];t[e._cacheIndex=i]=e,t[n._cacheIndex=r]=n}_takeBackAction(e){var t=this._actions,r=e._cacheIndex,i=--this._nActiveActions,n=t[i];t[e._cacheIndex=i]=e,t[n._cacheIndex=r]=n}_addInactiveBinding(e,t,r){var i=this._bindingsByRootAndName,n=this._bindings;let a=i[t];void 0===a&&(a={},i[t]=a),(a[r]=e)._cacheIndex=n.length,n.push(e)}_removeInactiveBinding(e){var t=this._bindings,r=e.binding,i=r.rootNode.uuid,r=r.path,n=this._bindingsByRootAndName,a=n[i],s=t[t.length-1],e=e._cacheIndex;t[s._cacheIndex=e]=s,t.pop(),delete a[r],0===Object.keys(a).length&&delete n[i]}_lendBinding(e){var t=this._bindings,r=e._cacheIndex,i=this._nActiveBindings++,n=t[i];t[e._cacheIndex=i]=e,t[n._cacheIndex=r]=n}_takeBackBinding(e){var t=this._bindings,r=e._cacheIndex,i=--this._nActiveBindings,n=t[i];t[e._cacheIndex=i]=e,t[n._cacheIndex=r]=n}_lendControlInterpolant(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let r=e[t];return void 0===r&&(e[(r=new ud(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t]=r),r}_takeBackControlInterpolant(e){var t=this._controlInterpolants,r=e.__cacheIndex,i=--this._nActiveControlInterpolants,n=t[i];t[e.__cacheIndex=i]=e,t[n.__cacheIndex=r]=n}clipAction(e,t,r){var i=t||this._root,n=i.uuid;let a="string"==typeof e?bd.findByName(i,e):e;var i=null!==a?a.uuid:e,s=this._actionsByClip[i];let o=null;if(void 0===r&&(r=null!==a?a.blendMode:br),void 0!==s){let e=s.actionByRoot[n];if(void 0!==e&&e.blendMode===r)return e;o=s.knownActions[0],null===a&&(a=o._clip)}return null===a?null:(e=new Uc(this,a,t,r),this._bindAction(e,o),this._addInactiveAction(e,i,n),e)}existingAction(e,t){var t=t||this._root,r=t.uuid,t="string"==typeof e?bd.findByName(t,e):e,t=t?t.uuid:e,e=this._actionsByClip[t];return void 0!==e&&e.actionByRoot[r]||null}stopAllAction(){var t=this._actions;for(let e=this._nActiveActions-1;0<=e;--e)t[e].stop();return this}update(t){t*=this.timeScale;var r=this._actions,i=this._nActiveActions,n=this.time+=t,a=Math.sign(t),s=this._accuIndex^=1;for(let e=0;e!==i;++e)r[e]._update(n,t,a,s);var o=this._bindings,l=this._nActiveBindings;for(let e=0;e!==l;++e)o[e].apply(s);return this}setTime(e){for(let e=this.time=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let a=this._actions,t=e.uuid,r=this._actionsByClip,i=r[t];if(void 0!==i){let n=i.knownActions;for(let i=0,e=n.length;i!==e;++i){let e=n[i],t=(this._deactivateAction(e),e._cacheIndex),r=a[a.length-1];e._cacheIndex=null,e._byClipCacheIndex=null,r._cacheIndex=t,a[t]=r,a.pop(),this._removeInactiveBindingsForAction(e)}delete r[t]}}uncacheRoot(e){let r=e.uuid,i=this._actionsByClip;for(let t in i){let e=i[t].actionByRoot[r];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}let n=this._bindingsByRootAndName[r];if(void 0!==n)for(let t in n){let e=n[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(e,t){e=this.existingAction(e,t);null!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}}Gc.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class zc{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new zc(void 0===this.value.clone?this.value:this.value.clone())}}class Hc extends kl{constructor(e,t,r=1){super(e,t),this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){e=super.clone(e);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(e){e=super.toJSON(e);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}Hc.prototype.isInstancedInterleavedBuffer=!0;class Vc{constructor(e,t,r,i,n){this.buffer=e,this.type=t,this.itemSize=r,this.elementSize=i,this.count=n,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}Vc.prototype.isGLBufferAttribute=!0;class Wc{constructor(e,t,r=0,i=1/0){this.ray=new dn(e,t),this.near=r,this.far=i,this.camera=null,this.layers=new Tn,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,r=[]){return Yc(e,this,r,t),r.sort(jc),r}intersectObjects(r,i=!0,n=[]){for(let e=0,t=r.length;e<t;e++)Yc(r[e],this,n,i);return n.sort(jc),n}}function jc(e,t){return e.distance-t.distance}function Yc(e,i,n,t){if(e.layers.test(i.layers)&&e.raycast(i,n),!0===t){let r=e.children;for(let e=0,t=r.length;e<t;e++)Yc(r[e],i,n,!0)}}class $c{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(mi(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class qc{constructor(e=1,t=0,r=0){return this.radius=e,this.theta=t,this.y=r,this}set(e,t,r){return this.radius=e,this.theta=t,this.y=r,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}clone(){return(new this.constructor).copy(this)}}let Kc=new V;class Xc{constructor(e=new V(1/0,1/0),t=new V(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(r){this.makeEmpty();for(let e=0,t=r.length;e<t;e++)this.expandByPoint(r[e]);return this}setFromCenterAndSize(e,t){t=Kc.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(t),this.max.copy(e).add(t),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Kc.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Xc.prototype.isBox2=!0;let Jc=new Pe,Zc=new Pe;class Qc{constructor(e=new Pe,t=new Pe){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Jc.subVectors(e,this.start),Zc.subVectors(this.end,this.start);e=Zc.dot(Zc);let r=Zc.dot(Jc)/e;return r=t?mi(r,0,1):r}closestPointToPoint(e,t,r){e=this.closestPointToPointParameter(e,t);return this.delta(r).multiplyScalar(e).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}let ef=new Pe;class tf extends f{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;var e=new S,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let r=0,i=1;r<32;r++,i++){let e=r/32*Math.PI*2,t=i/32*Math.PI*2;n.push(Math.cos(e),Math.sin(e),1,Math.cos(t),Math.sin(t),1)}e.setAttribute("position",new W(n,3));let r=new g({fog:!1,toneMapped:!1});this.cone=new Mh(e,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();var e=this.light.distance||1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),ef.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(ef),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}let rf=new Pe,nf=new ke,af=new ke;class sf extends Mh{constructor(e){let r=function t(r){var i=[];r&&r.isBone&&i.push(r);for(let e=0;e<r.children.length;e++)i.push.apply(i,t(r.children[e]));return i}(e),t=new S,i=[],n=[],a=new m(0,0,1),s=new m(0,1,0);for(let t=0;t<r.length;t++){let e=r[t];e.parent&&e.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),n.push(a.r,a.g,a.b),n.push(s.r,s.g,s.b))}t.setAttribute("position",new W(i,3)),t.setAttribute("color",new W(n,3)),super(t,new g({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=r,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){var r=this.bones,t=this.geometry,i=t.getAttribute("position");af.copy(this.root.matrixWorld).invert();for(let e=0,t=0;e<r.length;e++){var n=r[e];n.parent&&n.parent.isBone&&(nf.multiplyMatrices(af,n.matrixWorld),rf.setFromMatrixPosition(nf),i.setXYZ(t,rf.x,rf.y,rf.z),nf.multiplyMatrices(af,n.parent.matrixWorld),rf.setFromMatrixPosition(nf),i.setXYZ(t+1,rf.x,rf.y,rf.z),t+=2)}t.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}class of extends w{constructor(e,t,r){super(new Wu(t,4,2),new Qn({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}let lf=new Pe,hf=new m,uf=new m;class df extends f{constructor(e,t,r){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;e=new zu(t),e.rotateY(.5*Math.PI),this.material=new Qn({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0),r=e.getAttribute("position"),t=new Float32Array(3*r.count);e.setAttribute("color",new E(t,3)),this.add(new w(e,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var r=e.geometry.getAttribute("color");hf.copy(this.light.color),uf.copy(this.light.groundColor);for(let e=0,t=r.count;e<t;e++){var i=e<t/2?hf:uf;r.setXYZ(e,i.r,i.g,i.b)}r.needsUpdate=!0}e.lookAt(lf.setFromMatrixPosition(this.light.matrixWorld).negate())}}class cf extends Mh{constructor(e=10,n=10,a=4473924,s=8947848){a=new m(a),s=new m(s);var o=n/2,l=e/n,h=e/2,u=[],d=[];for(let t=0,r=0,i=-h;t<=n;t++,i+=l){u.push(-h,0,i,h,0,i),u.push(i,0,-h,i,0,h);let e=t===o?a:s;e.toArray(d,r),r+=3,e.toArray(d,r),r+=3,e.toArray(d,r),r+=3,e.toArray(d,r),r+=3}e=new S;e.setAttribute("position",new W(u,3)),e.setAttribute("color",new W(d,3)),super(e,new g({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class ff extends Mh{constructor(n=10,a=16,i=8,s=64,o=4473924,l=8947848){o=new m(o),l=new m(l);var h=[],u=[];for(let i=0;i<=a;i++){let e=i/a*(2*Math.PI),t=Math.sin(e)*n,r=Math.cos(e)*n;h.push(0,0,0),h.push(t,0,r);var d=1&i?o:l;u.push(d.r,d.g,d.b),u.push(d.r,d.g,d.b)}for(let e=0;e<=i;e++){let t=1&e?o:l,r=n-n/i*e;for(let e=0;e<s;e++){var c=e/s*(2*Math.PI),f=Math.sin(c)*r,p=Math.cos(c)*r;h.push(f,0,p),u.push(t.r,t.g,t.b),c=(e+1)/s*(2*Math.PI),f=Math.sin(c)*r,p=Math.cos(c)*r,h.push(f,0,p),u.push(t.r,t.g,t.b)}}let e=new S;e.setAttribute("position",new W(h,3)),e.setAttribute("color",new W(u,3)),super(e,new g({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}let pf=new Pe,mf=new Pe,gf=new Pe;class vf extends f{constructor(e,t,r){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===t&&(t=1);let i=new S;i.setAttribute("position",new W([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));e=new g({fog:!1,toneMapped:!1});this.lightPlane=new Sh(i,e),this.add(this.lightPlane),(i=new S).setAttribute("position",new W([0,0,0,0,0,1],3)),this.targetLine=new Sh(i,e),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){pf.setFromMatrixPosition(this.light.matrixWorld),mf.setFromMatrixPosition(this.light.target.matrixWorld),gf.subVectors(mf,pf),this.lightPlane.lookAt(mf),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(mf),this.targetLine.scale.z=gf.length()}}let yf=new Pe,l=new Ua;class xf extends Mh{constructor(e){let t=new S,r=new g({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],n=[],a={},s=new m(16755200),o=new m(16711680),l=new m(43775),h=new m(16777215),u=new m(3355443);function d(e,t,r){c(e,r),c(t,r)}function c(e,t){i.push(0,0,0),n.push(t.r,t.g,t.b),void 0===a[e]&&(a[e]=[]),a[e].push(i.length/3-1)}d("n1","n2",s),d("n2","n4",s),d("n4","n3",s),d("n3","n1",s),d("f1","f2",s),d("f2","f4",s),d("f4","f3",s),d("f3","f1",s),d("n1","f1",s),d("n2","f2",s),d("n3","f3",s),d("n4","f4",s),d("p","n1",o),d("p","n2",o),d("p","n3",o),d("p","n4",o),d("u1","u2",l),d("u2","u3",l),d("u3","u1",l),d("c","t",h),d("p","c",u),d("cn1","cn2",u),d("cn3","cn4",u),d("cf1","cf2",u),d("cf3","cf4",u),t.setAttribute("position",new W(i,3)),t.setAttribute("color",new W(n,3)),super(t,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}update(){var e=this.geometry,t=this.pointMap;l.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),d("c",t,e,l,0,0,-1),d("t",t,e,l,0,0,1),d("n1",t,e,l,-1,-1,-1),d("n2",t,e,l,1,-1,-1),d("n3",t,e,l,-1,1,-1),d("n4",t,e,l,1,1,-1),d("f1",t,e,l,-1,-1,1),d("f2",t,e,l,1,-1,1),d("f3",t,e,l,-1,1,1),d("f4",t,e,l,1,1,1),d("u1",t,e,l,.7,1.1,-1),d("u2",t,e,l,-.7,1.1,-1),d("u3",t,e,l,0,2,-1),d("cf1",t,e,l,-1,0,1),d("cf2",t,e,l,1,0,1),d("cf3",t,e,l,0,-1,1),d("cf4",t,e,l,0,1,1),d("cn1",t,e,l,-1,0,-1),d("cn2",t,e,l,1,0,-1),d("cn3",t,e,l,0,-1,-1),d("cn4",t,e,l,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function d(e,t,i,r,n,a,s){yf.set(n,a,s).unproject(r);var o=t[e];if(void 0!==o){let r=i.getAttribute("position");for(let e=0,t=o.length;e<t;e++)r.setXYZ(o[e],yf.x,yf.y,yf.z)}}let bf=new Ni;class _f extends Mh{constructor(e,t=16776960){var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),n=new S;n.setIndex(new E(r,1)),n.setAttribute("position",new E(i,3)),super(n,new g({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){var t,r,i;void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&bf.setFromObject(this.object),bf.isEmpty()||(e=bf.min,t=bf.max,(i=(r=this.geometry.attributes.position).array)[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=e.x,i[4]=t.y,i[5]=t.z,i[6]=e.x,i[7]=e.y,i[8]=t.z,i[9]=t.x,i[10]=e.y,i[11]=t.z,i[12]=t.x,i[13]=t.y,i[14]=e.z,i[15]=e.x,i[16]=t.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=t.x,i[22]=e.y,i[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere())}setFromObject(e){return this.object=e,this.update(),this}copy(e){return Mh.prototype.copy.call(this,e),this.object=e.object,this}}class Tf extends Mh{constructor(e,t=16776960){var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new S;i.setIndex(new E(r,1)),i.setAttribute("position",new W([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new g({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class Sf extends Sh{constructor(e,t=1,r=16776960){var i=new S,i=(i.setAttribute("position",new W([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),super(i,new g({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t,new S);i.setAttribute("position",new W([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),i.computeBoundingSphere(),this.add(new w(i,new Qn({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?Ae:Oe,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}}let wf=new Pe,Ef,Mf;class Af extends f{constructor(e=new Pe(0,0,1),t=new Pe(0,0,0),r=1,i=16776960,n=.2*r,a=.2*n){super(),this.type="ArrowHelper",void 0===Ef&&((Ef=new S).setAttribute("position",new W([0,0,0,0,1,0],3)),(Mf=new Gh(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Sh(Ef,new g({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new w(Mf,new Qn({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,n,a)}setDirection(e){.99999<e.y?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):(wf.set(e.z,0,-e.x).normalize(),e=Math.acos(e.y),this.quaternion.setFromAxisAngle(wf,e))}setLength(e,t=.2*e,r=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class Lf extends Mh{constructor(e=1){var e=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],t=new S;t.setAttribute("position",new W(e,3)),t.setAttribute("color",new W([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(t,new g({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,r){var i=new m,n=this.geometry.attributes.color.array;return i.set(e),i.toArray(n,0),i.toArray(n,3),i.set(t),i.toArray(n,6),i.toArray(n,9),i.set(r),i.toArray(n,12),i.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Rf{constructor(){this.type="ShapePath",this.color=new m,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new gu,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,r,i){return this.currentPath.quadraticCurveTo(e,t,r,i),this}bezierCurveTo(e,t,r,i,n,a){return this.currentPath.bezierCurveTo(e,t,r,i,n,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(a,e){function t(r){var i=[];for(let e=0,t=r.length;e<t;e++){var n=r[e],a=new vu;a.curves=n.curves,i.push(a)}return i}let s=ku.isClockWise,l=this.subPaths;if(0===l.length)return[];if(!0===e)return t(l);let h,u,d;var c=[];if(1===l.length)u=l[0],(d=new vu).curves=u.curves,c.push(d);else{var f=!s(l[0].getPoints()),f=a?!f:f,p=[],m=[];let r,i,o=[],n=0;m[n]=void 0,o[n]=[];for(let e=0,t=l.length;e<t;e++)r=(u=l[e]).getPoints(),h=s(r),(h=a?!h:h)?(!f&&m[n]&&n++,m[n]={s:new vu,p:r},m[n].s.curves=u.curves,f&&n++,o[n]=[]):o[n].push({h:u,p:r[0]});if(!m[0])return t(l);if(1<m.length){let a=!1,s=[];for(let e=0,t=m.length;e<t;e++)p[e]=[];for(let n=0,e=m.length;n<e;n++){let e=o[n];for(let i=0;i<e.length;i++){let t=e[i],r=!0;for(let e=0;e<m.length;e++)!function(s,o){var e=o.length;let l=!1;for(let n=e-1,a=0;a<e;n=a++){let t=o[n],e=o[a],r=e.x-t.x,i=e.y-t.y;if(Math.abs(i)>Number.EPSILON){if(i<0&&(t=o[a],r=-r,e=o[n],i=-i),!(s.y<t.y||s.y>e.y))if(s.y===t.y){if(s.x===t.x)return 1}else{let e=i*(s.x-t.x)-r*(s.y-t.y);if(0==e)return 1;e<0||(l=!l)}}else if(s.y===t.y&&(e.x<=s.x&&s.x<=t.x||t.x<=s.x&&s.x<=e.x))return 1}return l}(t.p,m[e].p)||(n!==e&&s.push({froms:n,tos:e,hole:i}),r?(r=!1,p[e].push(t)):a=!0);r&&p[n].push(t)}}0<s.length&&(a||(o=p))}for(let r=0,e=m.length;r<e;r++){d=m[r].s,c.push(d);for(let e=0,t=(i=o[r]).length;e<t;e++)d.holes.push(i[e].h)}}return c}}let Cf=new Float32Array(1),Df=new Int32Array(Cf.buffer);class If{static toHalfFloat(e){65504<e&&(console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504."),e=65504),Cf[0]=e;e=Df[0];let t=e>>16&32768,r=e>>12&2047;var i=e>>23&255;return i<103||(142<i?t=t|31744|((255==i?0:1)&&8388607&e):i<113?(r|=2048,t|=(r>>114-i)+(r>>113-i&1)):t=(t|=i-112<<10|r>>1)+(1&r)),t}}let Pf=0,kf=1,Of=0,Ff=1,Nf=2;function Bf(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function Uf(e=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,(e.materials=e).clone=function(){return e.slice()},e}function Gf(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Ph(e,t)}function zf(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Xl(e)}function Hf(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Ph(e,t)}function Vf(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Lh(e)}function Wf(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Lh(e)}function jf(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Lh(e)}function Yf(e,t,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Pe(e,t,r)}function $f(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new E(e,t).setUsage(Qr)}function qf(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new ta(e,t)}function Kf(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new ra(e,t)}function Xf(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new ia(e,t)}function Jf(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new na(e,t)}function Zf(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new aa(e,t)}function Qf(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new sa(e,t)}function ep(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new oa(e,t)}function tp(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new W(e,t)}function rp(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new ha(e,t)}function ip(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Lf(e)}function np(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new _f(e,t)}function ap(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Mh(new qh(e.geometry),new g({color:void 0!==t?t:16777215}))}function sp(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Mh(new Ku(e.geometry),new g({color:void 0!==t?t:16777215}))}function op(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Md(e)}function lp(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Dd(e)}function hp(e,t,r){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Ha(e,r)}function up(){console.error("THREE.CanvasRenderer has been removed")}function dp(){console.error("THREE.JSONLoader has been removed.")}Kh.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Kh.prototype),(e.prototype.constructor=e).prototype.getPoint=t,e},gu.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},cf.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},sf.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},wd.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Qd.extractUrlBase(e)},wd.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Xc.prototype.center=function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},Xc.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Xc.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Xc.prototype.size=function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)},Ni.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Ni.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Ni.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Ni.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Ni.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},rn.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Ka.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Qc.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},v.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},v.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},v.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},v.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},v.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},v.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},ke.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},ke.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},ke.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Pe).setFromMatrixColumn(this,3)},ke.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},ke.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},ke.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},ke.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},ke.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},ke.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},ke.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},ke.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},ke.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},ke.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},ke.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},ke.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},ke.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},ke.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},ke.prototype.makeFrustum=function(e,t,r,i,n,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,r,n,a)},ke.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Ya.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},ki.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},ki.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},dn.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},dn.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},dn.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},p.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},p.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},p.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},p.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},p.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},p.barycoordFromPoint=function(e,t,r,i,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),p.getBarycoord(e,t,r,i,n)},p.normal=function(e,t,r,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),p.getNormal(e,t,r,i)},vu.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},vu.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Nu(this,e)},vu.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Vu(this,e)},V.prototype.fromAttribute=function(e,t,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},V.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},V.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Pe.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},Pe.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},Pe.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},Pe.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},Pe.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},Pe.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},Pe.prototype.fromAttribute=function(e,t,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},Pe.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Pe.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Ie.prototype.fromAttribute=function(e,t,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},Ie.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},f.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},f.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},f.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},f.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},f.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(f.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),w.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(w.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Tr},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),sh.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},F.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Pd.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(E.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Qr},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Qr)}}}),E.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Qr:Zr),this},E.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},E.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},S.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},S.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new E(t,arguments[2])))},S.prototype.addDrawCall=function(e,t,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},S.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},S.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},S.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},S.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(S.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),kl.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Qr:Zr),this},kl.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Nu.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Nu.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Nu.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Pl.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},zc.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(r.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new m}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===P}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(Ba.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),s.prototype.clearTarget=function(e,t,r,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,r,i)},s.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},s.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},s.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},s.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},s.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},s.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},s.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},s.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},s.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},s.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},s.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},s.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},s.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},s.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},s.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},s.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},s.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},s.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},s.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},s.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},s.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},s.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},s.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},s.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(s.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?Er:De}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(bl.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Di.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Tc.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");let t=this;return(new hc).load(e,function(e){t.setBuffer(e)}),this},Lc.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Ga.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},Ga.prototype.clear=function(e,t,r,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,r,i)},Li.crossOrigin=void 0,Li.loadTexture=function(e,t,r,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var n=new Id,n=(n.setCrossOrigin(this.crossOrigin),n.load(e,r,void 0,i));return t&&(n.mapping=t),n},Li.loadTextureCube=function(e,t,r,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var n=new Cd,n=(n.setCrossOrigin(this.crossOrigin),n.load(e,r,void 0,i));return t&&(n.mapping=t),n},Li.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Li.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};let cp={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function fp(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}function pp(){return console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),new S}function mp(){return console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),new S}function gp(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")}function vp(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")}function yp(){console.error("THREE.ImmediateRenderObject has been removed.")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:_}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=_)},557:function(e,C,D){!function(e){var w=D(766),a=D(767),l=D(768);function r(){return d.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function h(e,t){if(r()<t)throw new RangeError("Invalid typed array length");return d.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=d.prototype:(e=null===e?new d(t):e).length=t,e}function d(e,t,r){if(!(d.TYPED_ARRAY_SUPPORT||this instanceof d))return new d(e,t,r);if("number"!=typeof e)return i(this,e,t,r);if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return s(this,e)}function i(e,t,r,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer){var n=e,a=t,s=r;if(a.byteLength,s<0||a.byteLength<s)throw new RangeError("'offset' is out of bounds");if(a.byteLength<s+(i||0))throw new RangeError("'length' is out of bounds");return a=void 0===s&&void 0===i?new Uint8Array(a):void 0===i?new Uint8Array(a,s):new Uint8Array(a,s,i),d.TYPED_ARRAY_SUPPORT?(n=a).__proto__=d.prototype:n=u(n,a),n}if("string"==typeof t){s=e,i=t,a=r;if(d.isEncoding(a="string"==typeof a&&""!==a?a:"utf8"))return(i=(s=h(s,n=0|f(i,a))).write(i,a))!==n?s.slice(0,i):s;throw new TypeError('"encoding" must be a valid string encoding')}var o,r=e,i=t;if(d.isBuffer(i))return 0!==(r=h(r,o=0|c(i.length))).length&&i.copy(r,0,0,o),r;if(i){if("undefined"!=typeof ArrayBuffer&&i.buffer instanceof ArrayBuffer||"length"in i)return"number"!=typeof i.length||(o=i.length)!=o?h(r,0):u(r,i);if("Buffer"===i.type&&l(i.data))return u(r,i.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function n(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function s(e,t){if(n(t),e=h(e,t<0?0:0|c(t)),!d.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function u(e,t){var r=t.length<0?0:0|c(t.length);e=h(e,r);for(var i=0;i<r;i+=1)e[i]=255&t[i];return e}function c(e){if(e>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|e}function f(e,t){if(d.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;var r=(e="string"!=typeof e?""+e:e).length;if(0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return A(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return L(e).length;default:if(i)return A(e).length;t=(""+t).toLowerCase(),i=!0}}function t(e,t,r){var i,n=!1;if((t=void 0===t||t<0?0:t)>this.length)return"";if((r=void 0===r||r>this.length?this.length:r)<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":var a=this,s=t,o=r,l=a.length;(!o||o<0||l<o)&&(o=l);for(var h="",u=s=!s||s<0?0:s;u<o;++u)h+=function(e){return e<16?"0"+e.toString(16):e.toString(16)}(a[u]);return h;case"utf8":case"utf-8":return E(this,t,r);case"ascii":var d=this,l=t,c=r,f="";c=Math.min(d.length,c);for(var p=l;p<c;++p)f+=String.fromCharCode(127&d[p]);return f;case"latin1":case"binary":var m=this,s=t,g=r,v="";g=Math.min(m.length,g);for(var y=s;y<g;++y)v+=String.fromCharCode(m[y]);return v;case"base64":return x=this,i=r,0===(b=t)&&i===x.length?w.fromByteArray(x):w.fromByteArray(x.slice(b,i));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":for(var x=t,b=r,_=this.slice(x,b),T="",S=0;S<_.length;S+=2)T+=String.fromCharCode(_[S]+256*_[S+1]);return T;default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function o(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function p(e,t,r,i,n){if(0===e.length)return-1;if("string"==typeof r?(i=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,(r=(r=isNaN(r)?n?0:e.length-1:r)<0?e.length+r:r)>=e.length){if(n)return-1;r=e.length-1}else if(r<0){if(!n)return-1;r=0}if("string"==typeof t&&(t=d.from(t,i)),d.isBuffer(t))return 0===t.length?-1:m(e,t,r,i,n);if("number"==typeof t)return t&=255,d.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?(n?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(e,t,r):m(e,[t],r,i,n);throw new TypeError("val must be string, number or Buffer")}function m(e,t,r,i,n){var a=1,s=e.length,o=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;s/=a=2,o/=2,r/=2}function l(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(n)for(var h=-1,u=r;u<s;u++)if(l(e,u)===l(t,-1===h?0:u-h)){if(u-(h=-1===h?u:h)+1===o)return h*a}else-1!==h&&(u-=u-h),h=-1;else for(u=r=s<r+o?s-o:r;0<=u;u--){for(var d=!0,c=0;c<o;c++)if(l(e,u+c)!==l(t,c)){d=!1;break}if(d)return u}return-1}function y(e,t,r,i){return R(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,i)}function E(e,t,r){r=Math.min(e.length,r);for(var i=[],n=t;n<r;){var a,s,o,l,h=e[n],u=null,d=239<h?4:223<h?3:191<h?2:1;if(n+d<=r)switch(d){case 1:h<128&&(u=h);break;case 2:128==(192&(a=e[n+1]))&&127<(l=(31&h)<<6|63&a)&&(u=l);break;case 3:a=e[n+1],s=e[n+2],128==(192&a)&&128==(192&s)&&2047<(l=(15&h)<<12|(63&a)<<6|63&s)&&(l<55296||57343<l)&&(u=l);break;case 4:a=e[n+1],s=e[n+2],o=e[n+3],128==(192&a)&&128==(192&s)&&128==(192&o)&&65535<(l=(15&h)<<18|(63&a)<<12|(63&s)<<6|63&o)&&l<1114112&&(u=l)}null===u?(u=65533,d=1):65535<u&&(i.push((u-=65536)>>>10&1023|55296),u=56320|1023&u),i.push(u),n+=d}var c=i,f=c.length;if(f<=4096)return String.fromCharCode.apply(String,c);for(var p="",m=0;m<f;)p+=String.fromCharCode.apply(String,c.slice(m,m+=4096));return p}function g(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(r<e+t)throw new RangeError("Trying to access beyond buffer length")}function v(e,t,r,i,n,a){if(!d.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(n<t||t<a)throw new RangeError('"value" argument is out of bounds');if(r+i>e.length)throw new RangeError("Index out of range")}function x(e,t,r,i){t<0&&(t=65535+t+1);for(var n=0,a=Math.min(e.length-r,2);n<a;++n)e[r+n]=(t&255<<8*(i?n:1-n))>>>8*(i?n:1-n)}function b(e,t,r,i){t<0&&(t=4294967295+t+1);for(var n=0,a=Math.min(e.length-r,4);n<a;++n)e[r+n]=t>>>8*(i?n:3-n)&255}function _(e,t,r,i){if(r+i>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function T(e,t,r,i,n){return n||_(e,0,r,4),a.write(e,t,r,i,23,4),r+4}function S(e,t,r,i,n){return n||_(e,0,r,8),a.write(e,t,r,i,52,8),r+8}C.Buffer=d,C.SlowBuffer=function(e){return d.alloc(+(e=+e!=e?0:e))},C.INSPECT_MAX_BYTES=50,d.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),C.kMaxLength=r(),d.poolSize=8192,d._augment=function(e){return e.__proto__=d.prototype,e},d.from=function(e,t,r){return i(null,e,t,r)},d.TYPED_ARRAY_SUPPORT&&(d.prototype.__proto__=Uint8Array.prototype,d.__proto__=Uint8Array,"undefined"!=typeof Symbol)&&Symbol.species&&d[Symbol.species]===d&&Object.defineProperty(d,Symbol.species,{value:null,configurable:!0}),d.alloc=function(e,t,r){return t=t,r=r,n(e=e),!(e<=0)&&void 0!==t?"string"==typeof r?h(null,e).fill(t,r):h(null,e).fill(t):h(null,e)},d.allocUnsafe=function(e){return s(null,e)},d.allocUnsafeSlow=function(e){return s(null,e)},d.isBuffer=function(e){return!(null==e||!e._isBuffer)},d.compare=function(e,t){if(!d.isBuffer(e)||!d.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,i=t.length,n=0,a=Math.min(r,i);n<a;++n)if(e[n]!==t[n]){r=e[n],i=t[n];break}return r<i?-1:i<r?1:0},d.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.concat=function(e,t){if(!l(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return d.alloc(0);if(void 0===t)for(n=t=0;n<e.length;++n)t+=e[n].length;for(var r=d.allocUnsafe(t),i=0,n=0;n<e.length;++n){var a=e[n];if(!d.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,i),i+=a.length}return r},d.byteLength=f,d.prototype._isBuffer=!0,d.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)o(this,t,t+1);return this},d.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)o(this,t,t+3),o(this,t+1,t+2);return this},d.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)o(this,t,t+7),o(this,t+1,t+6),o(this,t+2,t+5),o(this,t+3,t+4);return this},d.prototype.toString=function(){var e=0|this.length;return 0==e?"":0===arguments.length?E(this,0,e):t.apply(this,arguments)},d.prototype.equals=function(e){if(d.isBuffer(e))return this===e||0===d.compare(this,e);throw new TypeError("Argument must be a Buffer")},d.prototype.inspect=function(){var e="",t=C.INSPECT_MAX_BYTES;return 0<this.length&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t)&&(e+=" ... "),"<Buffer "+e+">"},d.prototype.compare=function(e,t,r,i,n){if(!d.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===r&&(r=e?e.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),(t=void 0===t?0:t)<0||r>e.length||i<0||n>this.length)throw new RangeError("out of range index");if(n<=i&&r<=t)return 0;if(n<=i)return-1;if(r<=t)return 1;if(this===e)return 0;for(var a=(n>>>=0)-(i>>>=0),s=(r>>>=0)-(t>>>=0),o=Math.min(a,s),l=this.slice(i,n),h=e.slice(t,r),u=0;u<o;++u)if(l[u]!==h[u]){a=l[u],s=h[u];break}return a<s?-1:s<a?1:0},d.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},d.prototype.indexOf=function(e,t,r){return p(this,e,t,r,!0)},d.prototype.lastIndexOf=function(e,t,r){return p(this,e,t,r,!1)},d.prototype.write=function(e,t,r,i){if(void 0===t)i="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)i=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===i&&(i="utf8")):(i=r,r=void 0)}var n=this.length-t;if((void 0===r||n<r)&&(r=n),0<e.length&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i=i||"utf8";for(var a,s,o,l,h,u=!1;;)switch(i){case"hex":var d=this,c=e,f=t,p=r,m=(f=Number(f)||0,d.length-f);if((!p||(p=Number(p))>m)&&(p=m),(m=c.length)%2!=0)throw new TypeError("Invalid hex string");m/2<p&&(p=m/2);for(var g=0;g<p;++g){var v=parseInt(c.substr(2*g,2),16);if(isNaN(v))return g;d[f+g]=v}return g;case"utf8":case"utf-8":return m=t,h=r,R(A(e,(l=this).length-m),l,m,h);case"ascii":return y(this,e,t,r);case"latin1":case"binary":return y(this,e,t,r);case"base64":return l=this,h=t,o=r,R(L(e),l,h,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return o=t,s=r,R(function(e,t){for(var r,i,n=[],a=0;a<e.length&&!((t-=2)<0);++a)i=(r=e.charCodeAt(a))>>8,n.push(r%256),n.push(i);return n}(e,(a=this).length-o),a,o,s);default:if(u)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),u=!0}},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},d.prototype.slice=function(e,t){var r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):r<t&&(t=r),t<e&&(t=e),d.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=d.prototype;else for(var i=t-e,n=new d(i,void 0),a=0;a<i;++a)n[a]=this[a+e];return n},d.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||g(e,t,this.length);for(var i=this[e],n=1,a=0;++a<t&&(n*=256);)i+=this[e+a]*n;return i},d.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||g(e,t,this.length);for(var i=this[e+--t],n=1;0<t&&(n*=256);)i+=this[e+--t]*n;return i},d.prototype.readUInt8=function(e,t){return t||g(e,1,this.length),this[e]},d.prototype.readUInt16LE=function(e,t){return t||g(e,2,this.length),this[e]|this[e+1]<<8},d.prototype.readUInt16BE=function(e,t){return t||g(e,2,this.length),this[e]<<8|this[e+1]},d.prototype.readUInt32LE=function(e,t){return t||g(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},d.prototype.readUInt32BE=function(e,t){return t||g(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},d.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||g(e,t,this.length);for(var i=this[e],n=1,a=0;++a<t&&(n*=256);)i+=this[e+a]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*t)),i},d.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||g(e,t,this.length);for(var i=t,n=1,a=this[e+--i];0<i&&(n*=256);)a+=this[e+--i]*n;return a>=(n*=128)&&(a-=Math.pow(2,8*t)),a},d.prototype.readInt8=function(e,t){return t||g(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},d.prototype.readInt16LE=function(e,t){t||g(e,2,this.length);t=this[e]|this[e+1]<<8;return 32768&t?4294901760|t:t},d.prototype.readInt16BE=function(e,t){t||g(e,2,this.length);t=this[e+1]|this[e]<<8;return 32768&t?4294901760|t:t},d.prototype.readInt32LE=function(e,t){return t||g(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},d.prototype.readInt32BE=function(e,t){return t||g(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},d.prototype.readFloatLE=function(e,t){return t||g(e,4,this.length),a.read(this,e,!0,23,4)},d.prototype.readFloatBE=function(e,t){return t||g(e,4,this.length),a.read(this,e,!1,23,4)},d.prototype.readDoubleLE=function(e,t){return t||g(e,8,this.length),a.read(this,e,!0,52,8)},d.prototype.readDoubleBE=function(e,t){return t||g(e,8,this.length),a.read(this,e,!1,52,8)},d.prototype.writeUIntLE=function(e,t,r,i){e=+e,t|=0,r|=0,i||v(this,e,t,r,Math.pow(2,8*r)-1,0);var n=1,a=0;for(this[t]=255&e;++a<r&&(n*=256);)this[t+a]=e/n&255;return t+r},d.prototype.writeUIntBE=function(e,t,r,i){e=+e,t|=0,r|=0,i||v(this,e,t,r,Math.pow(2,8*r)-1,0);var n=r-1,a=1;for(this[t+n]=255&e;0<=--n&&(a*=256);)this[t+n]=e/a&255;return t+r},d.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||v(this,e,t,1,255,0),d.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},d.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||v(this,e,t,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):x(this,e,t,!0),t+2},d.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||v(this,e,t,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):x(this,e,t,!1),t+2},d.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||v(this,e,t,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):b(this,e,t,!0),t+4},d.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||v(this,e,t,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):b(this,e,t,!1),t+4},d.prototype.writeIntLE=function(e,t,r,i){e=+e,t|=0,i||v(this,e,t,r,(i=Math.pow(2,8*r-1))-1,-i);var n=0,a=1,s=0;for(this[t]=255&e;++n<r&&(a*=256);)e<0&&0===s&&0!==this[t+n-1]&&(s=1),this[t+n]=(e/a>>0)-s&255;return t+r},d.prototype.writeIntBE=function(e,t,r,i){e=+e,t|=0,i||v(this,e,t,r,(i=Math.pow(2,8*r-1))-1,-i);var n=r-1,a=1,s=0;for(this[t+n]=255&e;0<=--n&&(a*=256);)e<0&&0===s&&0!==this[t+n+1]&&(s=1),this[t+n]=(e/a>>0)-s&255;return t+r},d.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||v(this,e,t,1,127,-128),d.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&(e=e<0?255+e+1:e),t+1},d.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||v(this,e,t,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):x(this,e,t,!0),t+2},d.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||v(this,e,t,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):x(this,e,t,!1),t+2},d.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||v(this,e,t,4,2147483647,-2147483648),d.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):b(this,e,t,!0),t+4},d.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||v(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),d.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):b(this,e,t,!1),t+4},d.prototype.writeFloatLE=function(e,t,r){return T(this,e,t,!0,r)},d.prototype.writeFloatBE=function(e,t,r){return T(this,e,t,!1,r)},d.prototype.writeDoubleLE=function(e,t,r){return S(this,e,t,!0,r)},d.prototype.writeDoubleBE=function(e,t,r){return S(this,e,t,!1,r)},d.prototype.copy=function(e,t,r,i){if(r=r||0,i||0===i||(i=this.length),t>=e.length&&(t=e.length),(i=0<i&&i<r?r:i)===r)return 0;if(0===e.length||0===this.length)return 0;if((t=t||0)<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length);var n,a=(i=e.length-t<i-r?e.length-t+r:i)-r;if(this===e&&r<t&&t<i)for(n=a-1;0<=n;--n)e[n+t]=this[n+r];else if(a<1e3||!d.TYPED_ARRAY_SUPPORT)for(n=0;n<a;++n)e[n+t]=this[n+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+a),t);return a},d.prototype.fill=function(e,t,r,i){if("string"==typeof e){var n;if("string"==typeof t?(i=t,t=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),1===e.length&&(n=e.charCodeAt(0))<256&&(e=n),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!d.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(!(r<=t))if(t>>>=0,r=void 0===r?this.length:r>>>0,"number"==typeof(e=e||0))for(o=t;o<r;++o)this[o]=e;else for(var a=d.isBuffer(e)?e:A(new d(e,i).toString()),s=a.length,o=0;o<r-t;++o)this[o+t]=a[o%s];return this};var M=/[^+\/0-9A-Za-z-_]/g;function A(e,t){var r;t=t||1/0;for(var i=e.length,n=null,a=[],s=0;s<i;++s){if(55295<(r=e.charCodeAt(s))&&r<57344){if(!n){if(56319<r){-1<(t-=3)&&a.push(239,191,189);continue}if(s+1===i){-1<(t-=3)&&a.push(239,191,189);continue}n=r;continue}if(r<56320){-1<(t-=3)&&a.push(239,191,189),n=r;continue}r=65536+(n-55296<<10|r-56320)}else n&&-1<(t-=3)&&a.push(239,191,189);if(n=null,r<128){if(--t<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function L(e){return w.toByteArray(function(e){if((e=((t=e).trim?t.trim():t.replace(/^\s+|\s+$/g,"")).replace(M,"")).length<2)return"";for(var t;e.length%4!=0;)e+="=";return e}(e))}function R(e,t,r,i){for(var n=0;n<i&&!(n+r>=t.length||n>=e.length);++n)t[n+r]=e[n];return n}}.call(this,D(32))},561:function(e,t){function r(){return e.exports=r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)!{}.hasOwnProperty.call(i,r)||(e[r]=i[r])}return e},e.exports.__esModule=!0,e.exports.default=e.exports,r.apply(null,arguments)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},566:function(e,t,r){var i=r(701);e.exports=function(e){return null==e?"":i(e)}},567:function(e,t,r){var{default:r,DraggableCore:i}=r(723);e.exports=r,e.exports.default=r,e.exports.DraggableCore=i},569:function(e,n,a){!function(e){var t=void 0!==e&&e||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function i(e,t){this._id=e,this._clearFn=t}n.setTimeout=function(){return new i(r.call(setTimeout,t,arguments),clearTimeout)},n.setInterval=function(){return new i(r.call(setInterval,t,arguments),clearInterval)},n.clearTimeout=n.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(t,this._id)},n.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},n.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},n._unrefActive=n.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},a(763),n.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,n.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}.call(this,a(32))},575:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.dontSetMe=function(e,t,r){if(e[t])return new Error("Invalid prop ".concat(t," passed to ").concat(r," - do not set this, set it on the child."))},t.findInArray=function(r,i){for(let e=0,t=r.length;e<t;e++)if(i.apply(i,[r[e],e,r]))return r[e]},t.int=function(e){return parseInt(e,10)},t.isFunction=function(e){return"function"==typeof e||"[object Function]"===Object.prototype.toString.call(e)},t.isNum=function(e){return"number"==typeof e&&!isNaN(e)}},581:function(e,t,r){e.exports=r(666)},584:function(e,t){e.exports=function(e,t){if(null==e)return{};var r,i={};for(r in e)if({}.hasOwnProperty.call(e,r)){if(0<=t.indexOf(r))continue;i[r]=e[r]}return i},e.exports.__esModule=!0,e.exports.default=e.exports},588:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.addClassName=h,t.addEvent=function(e,t,r,i){e&&(i={capture:!0,...i},e.addEventListener?e.addEventListener(t,r,i):e.attachEvent?e.attachEvent("on"+t,r):e["on"+t]=r)},t.addUserSelectStyles=function(e){var t;e&&((t=e.getElementById("react-draggable-style-el"))||((t=e.createElement("style")).type="text/css",t.id="react-draggable-style-el",t.innerHTML=".react-draggable-transparent-selection *::-moz-selection {all: inherit;}\n",t.innerHTML+=".react-draggable-transparent-selection *::selection {all: inherit;}\n",e.getElementsByTagName("head")[0].appendChild(t)),e.body)&&h(e.body,"react-draggable-transparent-selection")},t.createCSSTransform=function(e,t){e=l(e,t,"px");return{[(0,n.browserPrefixToKey)("transform",n.default)]:e}},t.createSVGTransform=function(e,t){return l(e,t,"")},t.getTouch=function(e,t){return e.targetTouches&&(0,i.findInArray)(e.targetTouches,e=>t===e.identifier)||e.changedTouches&&(0,i.findInArray)(e.changedTouches,e=>t===e.identifier)},t.getTouchIdentifier=function(e){return e.targetTouches&&e.targetTouches[0]?e.targetTouches[0].identifier:e.changedTouches&&e.changedTouches[0]?e.changedTouches[0].identifier:void 0},t.getTranslation=l,t.innerHeight=function(e){var t=e.clientHeight,e=e.ownerDocument.defaultView.getComputedStyle(e);return(t-=(0,i.int)(e.paddingTop))-(0,i.int)(e.paddingBottom)},t.innerWidth=function(e){var t=e.clientWidth,e=e.ownerDocument.defaultView.getComputedStyle(e);return(t-=(0,i.int)(e.paddingLeft))-(0,i.int)(e.paddingRight)},t.matchesSelector=o,t.matchesSelectorAndParentsTo=function(e,t,r){let i=e;do{if(o(i,t))return!0;if(i===r)return!1}while(i=i.parentNode);return!1},t.offsetXYFromParent=function(e,t,r){var i=t===t.ownerDocument.body?{left:0,top:0}:t.getBoundingClientRect();return{x:(e.clientX+t.scrollLeft-i.left)/r,y:(e.clientY+t.scrollTop-i.top)/r}},t.outerHeight=function(e){var t=e.clientHeight,e=e.ownerDocument.defaultView.getComputedStyle(e);return(t+=(0,i.int)(e.borderTopWidth))+(0,i.int)(e.borderBottomWidth)},t.outerWidth=function(e){var t=e.clientWidth,e=e.ownerDocument.defaultView.getComputedStyle(e);return(t+=(0,i.int)(e.borderLeftWidth))+(0,i.int)(e.borderRightWidth)},t.removeClassName=u,t.removeEvent=function(e,t,r,i){e&&(i={capture:!0,...i},e.removeEventListener?e.removeEventListener(t,r,i):e.detachEvent?e.detachEvent("on"+t,r):e["on"+t]=null)},t.removeUserSelectStyles=function(e){if(e)try{var t;e.body&&u(e.body,"react-draggable-transparent-selection"),e.selection?e.selection.empty():(t=(e.defaultView||window).getSelection())&&"Caret"!==t.type&&t.removeAllRanges()}catch(e){}};var i=r(575),n=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=s(void 0);if(t&&t.has(e))return t.get(e);var r,i,n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((i=a?Object.getOwnPropertyDescriptor(e,r):null)&&(i.get||i.set)?Object.defineProperty(n,r,i):n[r]=e[r]);return n.default=e,t&&t.set(e,n),n}(r(724));function s(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(s=function(e){return e?r:t})(e))}let a="";function o(t,e){return a=a||(0,i.findInArray)(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"],function(e){return(0,i.isFunction)(t[e])}),!!(0,i.isFunction)(t[a])&&t[a](e)}function l(e,r,i){let{x:t,y:n}=e,a="translate(".concat(t).concat(i,",").concat(n).concat(i,")");if(r){let e="".concat("string"==typeof r.x?r.x:r.x+i),t="".concat("string"==typeof r.y?r.y:r.y+i);a="translate(".concat(e,", ").concat(t,")")+a}return a}function h(e,t){e.classList?e.classList.add(t):e.className.match(new RegExp("(?:^|\\s)".concat(t,"(?!\\S)")))||(e.className+=" ".concat(t))}function u(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(?:^|\\s)".concat(t,"(?!\\S)"),"g"),"")}},603:function(e,t,r){t.a={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1}},604:function(e,t,r){r.r(t),t.default=function(t){var r={};return function(e){return void 0===r[e]&&(r[e]=t(e)),r[e]}}},607:function(e,t){e.exports=function(e,t){for(var r=-1,i=null==e?0:e.length,n=Array(i);++r<i;)n[r]=t(e[r],r,e);return n}},615:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.canDragX=function(e){return"both"===e.props.axis||"x"===e.props.axis},t.canDragY=function(e){return"both"===e.props.axis||"y"===e.props.axis},t.createCoreData=function(e,t,r){var i=!(0,l.isNum)(e.lastX),n=u(e);return i?{node:n,deltaX:0,deltaY:0,lastX:t,lastY:r,x:t,y:r}:{node:n,deltaX:t-e.lastX,deltaY:r-e.lastY,lastX:e.lastX,lastY:e.lastY,x:t,y:r}},t.createDraggableData=function(e,t){var r=e.props.scale;return{node:t.node,x:e.state.x+t.deltaX/r,y:e.state.y+t.deltaY/r,deltaX:t.deltaX/r,deltaY:t.deltaY/r,lastX:e.state.x,lastY:e.state.y}},t.getBoundPosition=function(e,t,r){if(e.props.bounds){let a=e.props["bounds"];a="string"==typeof a?a:{left:(s=a).left,top:s.top,right:s.right,bottom:s.bottom};var s=u(e);if("string"==typeof a){let e=s["ownerDocument"],t=e.defaultView;var o="parent"===a?s.parentNode:e.querySelector(a);if(!(o instanceof t.HTMLElement))throw new Error('Bounds selector "'+a+'" could not find an element.');let r=o,i=t.getComputedStyle(s),n=t.getComputedStyle(r);a={left:-s.offsetLeft+(0,l.int)(n.paddingLeft)+(0,l.int)(i.marginLeft),top:-s.offsetTop+(0,l.int)(n.paddingTop)+(0,l.int)(i.marginTop),right:(0,h.innerWidth)(r)-(0,h.outerWidth)(s)-s.offsetLeft+(0,l.int)(n.paddingRight)-(0,l.int)(i.marginRight),bottom:(0,h.innerHeight)(r)-(0,h.outerHeight)(s)-s.offsetTop+(0,l.int)(n.paddingBottom)-(0,l.int)(i.marginBottom)}}(0,l.isNum)(a.right)&&(t=Math.min(t,a.right)),(0,l.isNum)(a.bottom)&&(r=Math.min(r,a.bottom)),(0,l.isNum)(a.left)&&(t=Math.max(t,a.left)),(0,l.isNum)(a.top)&&(r=Math.max(r,a.top))}return[t,r]},t.getControlPosition=function(e,t,r){var i="number"==typeof t?(0,h.getTouch)(e,t):null;return"number"!=typeof t||i?(t=u(r),t=r.props.offsetParent||t.offsetParent||t.ownerDocument.body,(0,h.offsetXYFromParent)(i||e,t,r.props.scale)):null},t.snapToGrid=function(e,t,r){return[Math.round(t/e[0])*e[0],Math.round(r/e[1])*e[1]]};var l=r(575),h=r(588);function u(e){e=e.findDOMNode();if(e)return e;throw new Error("<DraggableCore>: Unmounted during event!")}},616:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){}},621:function(e,t,r){r.d(t,"a",function(){return n});var i=r(622);function n(r){return function e(t){return 0===arguments.length||Object(i.a)(t)?e:r.apply(this,arguments)}}},622:function(e,t,r){function i(e){return null!=e&&"object"==typeof e&&!0===e["@@functional/placeholder"]}r.d(t,"a",function(){return i})},649:function(i,e,t){t.d(e,"a",function(){return In});n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,o=/^(?=([^\/?#]*))\1([^]*)$/,l=/(?:\/|^)\.(?=\/)/g,h=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var i=a.parseURL(e);if(i)return i.path=a.normalizePath(i.path),a.buildURLFromParts(i);throw new Error("Error trying to parse base URL.")}i=a.parseURL(t);if(!i)throw new Error("Error trying to parse relative URL.");if(i.scheme)return r.alwaysNormalize?(i.path=a.normalizePath(i.path),a.buildURLFromParts(i)):t;t=a.parseURL(e);if(!t)throw new Error("Error trying to parse base URL.");!t.netLoc&&t.path&&"/"!==t.path[0]&&(e=o.exec(t.path),t.netLoc=e[1],t.path=e[2]),t.netLoc&&!t.path&&(t.path="/");var n,e={scheme:t.scheme,netLoc:i.netLoc,path:null,params:i.params,query:i.query,fragment:i.fragment};return i.netLoc||(e.netLoc=t.netLoc,"/"===i.path[0])||(i.path?(n=(n=t.path).substring(0,n.lastIndexOf("/")+1)+i.path,e.path=a.normalizePath(n)):(e.path=t.path,i.params||(e.params=t.params,i.query)||(e.query=t.query))),null===e.path&&(e.path=r.alwaysNormalize?a.normalizePath(i.path):i.path),a.buildURLFromParts(e)},parseURL:function(e){e=n.exec(e);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(l,"");e.length!==(e=e.replace(h,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};var n,o,l,h,a,z=a;function H(t,e){var r,i=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,r)),i}function m(i){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?H(Object(n),!0).forEach(function(e){var t,r;t=i,e=n[r=e],(r=function(){var e=function(e){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return String(e);t=t.call(e,"string");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(r);return"symbol"==typeof e?e:String(e)}())in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(n,e))})}return i}function L(){return(L=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function V(){}let M=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},R=((t={}).MEDIA_ATTACHING="hlsMediaAttaching",t.MEDIA_ATTACHED="hlsMediaAttached",t.MEDIA_DETACHING="hlsMediaDetaching",t.MEDIA_DETACHED="hlsMediaDetached",t.BUFFER_RESET="hlsBufferReset",t.BUFFER_CODECS="hlsBufferCodecs",t.BUFFER_CREATED="hlsBufferCreated",t.BUFFER_APPENDING="hlsBufferAppending",t.BUFFER_APPENDED="hlsBufferAppended",t.BUFFER_EOS="hlsBufferEos",t.BUFFER_FLUSHING="hlsBufferFlushing",t.BUFFER_FLUSHED="hlsBufferFlushed",t.MANIFEST_LOADING="hlsManifestLoading",t.MANIFEST_LOADED="hlsManifestLoaded",t.MANIFEST_PARSED="hlsManifestParsed",t.LEVEL_SWITCHING="hlsLevelSwitching",t.LEVEL_SWITCHED="hlsLevelSwitched",t.LEVEL_LOADING="hlsLevelLoading",t.LEVEL_LOADED="hlsLevelLoaded",t.LEVEL_UPDATED="hlsLevelUpdated",t.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",t.LEVELS_UPDATED="hlsLevelsUpdated",t.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",t.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",t.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",t.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",t.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",t.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",t.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",t.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",t.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",t.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",t.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",t.CUES_PARSED="hlsCuesParsed",t.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",t.INIT_PTS_FOUND="hlsInitPtsFound",t.FRAG_LOADING="hlsFragLoading",t.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",t.FRAG_LOADED="hlsFragLoaded",t.FRAG_DECRYPTED="hlsFragDecrypted",t.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",t.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",t.FRAG_PARSING_METADATA="hlsFragParsingMetadata",t.FRAG_PARSED="hlsFragParsed",t.FRAG_BUFFERED="hlsFragBuffered",t.FRAG_CHANGED="hlsFragChanged",t.FPS_DROP="hlsFpsDrop",t.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",t.ERROR="hlsError",t.DESTROYING="hlsDestroying",t.KEY_LOADING="hlsKeyLoading",t.KEY_LOADED="hlsKeyLoaded",t.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",t.BACK_BUFFER_REACHED="hlsBackBufferReached",t),C=((e={}).NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e),D=((t={}).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",t.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",t.KEY_SYSTEM_NO_SESSION="keySystemNoSession",t.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",t.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",t.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",t.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",t.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",t.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",t.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",t.MANIFEST_LOAD_ERROR="manifestLoadError",t.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",t.MANIFEST_PARSING_ERROR="manifestParsingError",t.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",t.LEVEL_EMPTY_ERROR="levelEmptyError",t.LEVEL_LOAD_ERROR="levelLoadError",t.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",t.LEVEL_PARSING_ERROR="levelParsingError",t.LEVEL_SWITCH_ERROR="levelSwitchError",t.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",t.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",t.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",t.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",t.FRAG_LOAD_ERROR="fragLoadError",t.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",t.FRAG_DECRYPT_ERROR="fragDecryptError",t.FRAG_PARSING_ERROR="fragParsingError",t.FRAG_GAP="fragGap",t.REMUX_ALLOC_ERROR="remuxAllocError",t.KEY_LOAD_ERROR="keyLoadError",t.KEY_LOAD_TIMEOUT="keyLoadTimeOut",t.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",t.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",t.BUFFER_APPEND_ERROR="bufferAppendError",t.BUFFER_APPENDING_ERROR="bufferAppendingError",t.BUFFER_STALLED_ERROR="bufferStalledError",t.BUFFER_FULL_ERROR="bufferFullError",t.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",t.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",t.INTERNAL_EXCEPTION="internalException",t.INTERNAL_ABORTED="aborted",t.UNKNOWN="unknown",t),W={trace:V,debug:V,log:V,warn:V,info:V,error:V},j=W;function Y(r,...e){e.forEach(function(e){var t;j[e]=r[e]?r[e].bind(r):(t=self.console[e])?t.bind(self.console,`[${e}] >`):V})}let I=j,$=/^(\d+)x(\d+)$/,q=/(.+?)=(".*?"|.*?)(?:,|$)/g;class A{constructor(e){for(var t in e="string"==typeof e?A.parseAttrList(e):e)e.hasOwnProperty(t)&&("X-"===t.substring(0,2)&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(t)),this[t]=e[t])}decimalInteger(e){e=parseInt(this[e],10);return e>Number.MAX_SAFE_INTEGER?1/0:e}hexadecimalInteger(e){if(this[e]){var t=(1&(t=(this[e]||"0x").slice(2)).length?"0":"")+t,r=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)r[e]=parseInt(t.slice(2*e,2*e+2),16);return r}return null}hexadecimalIntegerAsNumber(e){e=parseInt(this[e],16);return e>Number.MAX_SAFE_INTEGER?1/0:e}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){e=this[e];return e?parseFloat(e):t}enumeratedString(e){return this[e]}bool(e){return"YES"===this[e]}decimalResolution(e){e=$.exec(this[e]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}}static parseAttrList(e){var t,r={};for(q.lastIndex=0;null!==(t=q.exec(e));){let e=t[2];0===e.indexOf('"')&&e.lastIndexOf('"')===e.length-1&&(e=e.slice(1,-1)),r[t[1].trim()]=e}return r}}class K{constructor(t,e){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,e){var r=e.attr;for(let e in r)if(Object.prototype.hasOwnProperty.call(t,e)&&t[e]!==r[e]){I.warn(`DATERANGE tag attribute: "${e}" does not match for tags with ID: "${t.ID}"`),this._badValueForSameId=e;break}t=L(new A({}),r,t)}if(this.attr=t,this._startDate=new Date(t["START-DATE"]),"END-DATE"in this.attr){let e=new Date(this.attr["END-DATE"]);M(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){var e;return this._endDate||(null!==(e=this.duration)?new Date(this._startDate.getTime()+1e3*e):null)}get duration(){if("DURATION"in this.attr){var e=this.attr.decimalFloatingPoint("DURATION");if(M(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&M(this.startDate.getTime())&&(null===this.duration||0<=this.duration)&&(!this.endOnNext||!!this.class)}}class X{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var T="audio",S="video",J="audiovideo";class Z{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={audio:null,video:null,audiovideo:null},this.baseurl=e}setByteRange(e,t){var e=e.split("@",2),r=[];1===e.length?r[0]=t?t.byteRangeEndOffset:0:r[0]=parseInt(e[1]),r[1]=parseInt(e[0])+r[0],this._byteRange=r}get byteRange(){return this._byteRange||[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=z.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class Q extends Z{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new X,this.urlId=0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.type=e}get decryptdata(){let e=this["levelkeys"];if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){let e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{let e=Object.keys(this.levelkeys);if(1===e.length)return this._decryptdata=this.levelkeys[e[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){var e;return null!==this.programDateTime&&M(this.programDateTime)?(e=M(this.duration)?this.duration:0,this.programDateTime+1e3*e):null}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){let e=Object.keys(this.levelkeys),t=e.length;if(1<t||1===t&&this.levelkeys[e[0]].encrypted)return!0}return!1}setKeyFormat(e){this.levelkeys&&(e=this.levelkeys[e])&&!this._decryptdata&&(this._decryptdata=e.getDecryptData(this.sn))}abortRequests(){var e;null!=(e=this.loader)&&e.abort(),null!=(e=this.keyLoader)&&e.abort()}setElementaryStreamInfo(e,t,r,i,n,a=!1){var s=this["elementaryStreams"],o=s[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,r),o.startDTS=Math.min(o.startDTS,i),o.endDTS=Math.max(o.endDTS,n)):s[e]={startPTS:t,endPTS:r,startDTS:i,endDTS:n,partial:a}}clearElementaryStreamInfo(){var e=this["elementaryStreams"];e[T]=null,e[S]=null,e[J]=null}}class ee extends Z{constructor(e,t,r,i,n){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new X,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;r=e.enumeratedString("BYTERANGE");r&&this.setByteRange(r,n),n&&(this.fragOffset=n.fragOffset+n.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){var e=this["elementaryStreams"];return!!(e.audio||e.video||e.audiovideo)}}class te{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){var t,r;e?(t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex,this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||0<t||0==t&&0<r,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay):(this.advanced=!0,this.updated=!0)}get hasProgramDateTime(){return!!this.fragments.length&&M(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){var e=this.driftEndTime-this.driftStartTime;return 0<e?1e3*(this.driftEnd-this.driftStart)/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function re(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0))}function ie(e){return Uint8Array.from(unescape(encodeURIComponent(e)),e=>e.charCodeAt(0))}var c={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},ne="org.w3.clearkey",ae="com.apple.streamingkeydelivery",se="com.microsoft.playready",oe="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function le(e){switch(e){case ae:return c.FAIRPLAY;case se:return c.PLAYREADY;case oe:return c.WIDEVINE;case ne:return c.CLEARKEY}}var he="edef8ba979d64acea3c827dcd51d21ed";function ue(e){switch(e){case c.FAIRPLAY:return ae;case c.PLAYREADY:return se;case c.WIDEVINE:return oe;case c.CLEARKEY:return ne}}function de(e){let{drmSystems:t,widevineLicenseUrl:r}=e,i=t?[c.FAIRPLAY,c.WIDEVINE,c.PLAYREADY,c.CLEARKEY].filter(e=>!!t[e]):[];return!i[c.WIDEVINE]&&r&&i.push(c.WIDEVINE),i}let ce="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function fe(e,t,r){return Uint8Array.prototype.slice?e.slice(t,r):new Uint8Array(Array.prototype.slice.call(e,t,r))}let pe=(e,t)=>t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128,me=(e,t)=>t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128,ge=(e,t)=>{var r=t;let i=0;for(;pe(e,t);)i=(i+=10)+ve(e,t+6),me(e,t+10)&&(i+=10),t+=i;if(0<i)return e.subarray(r,r+i)},ve=(e,t)=>{var r=(127&e[t])<<21;return(r|=(127&e[t+1])<<14)|(127&e[t+2])<<7|127&e[t+3]},ye=e=>e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info,xe=e=>{let t=0;for(var r,i=[];pe(e,t);){for(var n=ve(e,t+6),a=(t+=10)+n;t+8<a;){r=e.subarray(t),o=s=void 0,s=String.fromCharCode(r[0],r[1],r[2],r[3]),o=ve(r,4);var s={type:s,size:o,data:r.subarray(10,10+o)},o=("PRIV"===(r=s).type?be:"W"===r.type[0]?Te:_e)(r);o&&i.push(o),t+=s.size+10}me(e,t)&&(t+=10)}return i},be=e=>{var t,r;if(!(e.size<2))return t=w(e.data,!0),r=new Uint8Array(e.data.subarray(t.length+1)),{key:e.type,info:t,data:r.buffer}},_e=e=>{var t,r;if(!(e.size<2))return"TXXX"===e.type?(t=1,t+=(r=w(e.data.subarray(1),!0)).length+1,t=w(e.data.subarray(t)),{key:e.type,info:r,data:t}):(r=w(e.data.subarray(1)),{key:e.type,data:r})},Te=e=>{var t,r;return"WXXX"===e.type?e.size<2?void 0:(t=1,t+=(r=w(e.data.subarray(1),!0)).length+1,t=w(e.data.subarray(t)),{key:e.type,info:r,data:t}):(r=w(e.data),{key:e.type,data:r})},w=(e,r=!1)=>{var i=Se=Se||void 0===self.TextDecoder?Se:new self.TextDecoder("utf-8");if(i){let t=i.decode(e);if(r){let e=t.indexOf("\0");return-1!==e?t.substring(0,e):t}return t.replace(/\0/g,"")}let t=e.length,n,a,s,o="",l=0;for(;l<t;){if(0===(n=e[l++])&&r)return o;if(0!==n&&3!==n)switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(n);break;case 12:case 13:a=e[l++],o+=String.fromCharCode((31&n)<<6|63&a);break;case 14:a=e[l++],s=e[l++],o+=String.fromCharCode((15&n)<<12|(63&a)<<6|(63&s)<<0)}}return o},Se;function f(r){let i="";for(let t=0;t<r.length;t++){let e=r[t].toString(16);e.length<2&&(e="0"+e),i+=e}return i}let we=Math.pow(2,32)-1,Ee=[].push,Me={video:1,audio:2,id3:3,text:4};function p(e){return String.fromCharCode.apply(null,e)}function Ae(e,t){e=e[t]<<8|e[t+1];return e<0?65536+e:e}function E(e,t){e=Le(e,t);return e<0?4294967296+e:e}function Le(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function Re(e,t,r){e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r}function P(r,i){var n=[];if(i.length){let e=r.byteLength;for(let t=0;t<e;){var a=E(r,t),a=1<a?t+a:e;if(p(r.subarray(t+4,t+8))===i[0])if(1===i.length)n.push(r.subarray(t+8,a));else{let e=P(r.subarray(t+8,a),i.slice(1));e.length&&Ee.apply(n,e)}t=a}}return n}function Ce(e){let i=[],t=P(e,["moov","trak"]);for(let e=0;e<t.length;e++){var n=t[e],a=P(n,["tkhd"])[0];if(a){var a=E(a,0===a[0]?12:20),s=P(n,["mdia","mdhd"])[0];if(s){var s=E(s,0===s[0]?12:20),o=P(n,["mdia","hdlr"])[0];if(o){let e=p(o.subarray(8,12)),r={soun:T,vide:S}[e];if(r){let e=P(n,["mdia","minf","stbl","stsd"])[0],t;e&&(t=p(e.subarray(12,16))),i[a]={timescale:s,type:r},i[r]={timescale:s,id:a,codec:t}}}}}}return P(e,["moov","mvex","trex"]).forEach(e=>{var t=E(e,4),t=i[t];t&&(t.default={duration:E(e,12),flags:E(e,20)})}),i}function De(e){var t=P(e,["schm"])[0];if(t){t=p(t.subarray(4,8));if("cbcs"===t||"cenc"===t)return P(e,["schi","tenc"])[0]}return I.error("[eme] missing 'schm' box"),null}function Ie(e,t){var r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function Pe(v,y){let x=[],b=y.samples,_=y.timescale,o=y.id,T=!1;return P(b,["moof"]).map(e=>{let g=e.byteOffset-8;P(e,["traf"]).map(s=>{var e=P(s,["tfdt"]).map(e=>{var t=e[0];let r=E(e,4);return(r=1===t?(r*=Math.pow(2,32))+E(e,8):r)/_})[0];return void 0!==e&&(v=e),P(s,["tfhd"]).map(e=>{var t=E(e,4),r=16777215&E(e,0);let p=0;var i=0!=(16&r);let m=0;var n=0!=(32&r);let a=8;t===o&&(0!=(1&r)&&(a+=8),0!=(2&r)&&(a+=4),0!=(8&r)&&(p=E(e,a),a+=4),i&&(m=E(e,a),a+=4),n&&(a+=4),"video"===y.type&&(T=!!(t=y.codec)&&("hvc1"===(t=(r=t.indexOf("."))<0?t:t.substring(0,r))||"hev1"===t||"dvh1"===t||"dvhe"===t)),P(s,["trun"]).map(t=>{var r=t[0],e=16777215&E(t,0);let i=0;var n=0!=(256&e);let a=0;var s=0!=(512&e);let o=0;var l=0!=(1024&e),h=0!=(2048&e);let u=0;var d=E(t,4);let c=8,f=(0!=(1&e)&&(i=E(t,c),c+=4),0!=(4&e)&&(c+=4),i+g);for(let e=0;e<d;e++){if(n?(a=E(t,c),c+=4):a=p,s?(o=E(t,c),c+=4):o=m,l&&(c+=4),h&&(u=(0===r?E:Le)(t,c),c+=4),y.type===S){let t=0;for(;t<o;){let e=E(b,f);f+=4,function(e,t){if(e){let e=t>>1&63;return 39==e||40==e}return 6==(31&t)}(T,b[f])&&ke(b.subarray(f,f+e),T?2:1,v+u/_,x),f+=e,t+=e+4}}v+=a/_}}))})})}),x}function ke(e,t,s,o){var l=Oe(e);let h=0,u=(h+=t,0),n=0,r=!1,i=0;for(;h<l.length;){for(u=0;!(h>=l.length)&&(i=l[h++],u+=i,255===i););for(n=0;!(h>=l.length)&&(i=l[h++],n+=i,255===i););let e=l.length-h;if(!r&&4===u&&h<l.length){if(r=!0,181===l[h++]){let e=Ae(l,h);if(h+=2,49===e){let e=E(l,h);if(h+=4,1195456820===e){let a=l[h++];if(3===a){let e=l[h++],t=31&e,r=64&e,i=r?2+3*t:0,n=new Uint8Array(i);if(r){n[0]=e;for(let e=1;e<i;e++)n[e]=l[h++]}o.push({type:a,payloadType:u,pts:s,bytes:n})}}}}}else if(5===u&&n<e){if(r=!0,16<n){let r=[];for(let t=0;t<16;t++){let e=l[h++].toString(16);r.push(1==e.length?"0"+e:e),3!==t&&5!==t&&7!==t&&9!==t||r.push("-")}let t=n-16,i=new Uint8Array(t);for(let e=0;e<t;e++)i[e]=l[h++];o.push({payloadType:u,pts:s,uuid:r.join(""),userData:w(i),userDataBytes:i})}}else if(n<e)h+=n;else if(n>e)break}}function Oe(e){var t=e.byteLength,r=[];let i=1;for(;i<t-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(r.push(i+2),i+=2):i++;if(0===r.length)return e;var n=t-r.length,a=new Uint8Array(n);let s=0;for(i=0;i<n;s++,i++)s===r[0]&&(s++,r.shift()),a[i]=e[s];return a}let Fe={};class Ne{static clearKeyUriToKeyIdMap(){Fe={}}constructor(e,t,r,i=[1],n=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=i,this.iv=n,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&"AES-128"!==e}isSupported(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case ae:case oe:case se:case ne:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(t){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof t&&("AES-128"!==this.method||this.iv||I.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),t=0);let e=function(t){var r=new Uint8Array(16);for(let e=12;e<16;e++)r[e]=t>>8*(15-e)&255;return r}(t);return new Ne(this.method,this.uri,"identity",this.keyFormatVersions,e)}let r=function(e){let t=e.split(":"),n=null;if("data"===t[0]&&2===t.length){let r=t[1].split(";"),i=r[r.length-1].split(",");if(2===i.length){let e="base64"===i[0],t=i[1];n=e?(r.splice(-1,1),re(t)):(a=ie(t).subarray(0,16),(s=new Uint8Array(16)).set(a,16-a.length),s)}}var a,s;return n}(this.uri);if(r)switch(this.keyFormat){case oe:22<=(this.pssh=r).length&&(this.keyId=r.subarray(r.length-22,r.length-6));break;case se:{let e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=function(r,i,n){if(16!==r.byteLength)throw new RangeError("Invalid system id");let a,s,o;if(i){a=1,s=new Uint8Array(16*i.length);for(let t=0;t<i.length;t++){let e=i[t];if(16!==e.byteLength)throw new RangeError("Invalid key");s.set(e,16*t)}}else a=0,s=new Uint8Array;0<a?(o=new Uint8Array(4),0<i.length&&new DataView(o.buffer).setUint32(0,i.length,!1)):o=new Uint8Array;var l=new Uint8Array(4);n&&0<n.byteLength&&new DataView(l.buffer).setUint32(0,n.byteLength,!1);{var h=[new Uint8Array([a,0,0,0]),r,o,s,l,n||new Uint8Array],u=h.length;let e=8,t=u;for(;t--;)e+=h[t].byteLength;var d=new Uint8Array(e);for(d[0]=e>>24&255,d[1]=e>>16&255,d[2]=e>>8&255,d[3]=255&e,d.set([112,115,115,104],4),t=0,e=8;t<u;t++)d.set(h[t],e),e+=h[t].byteLength;return d}}(e,null,r);var i=new Uint16Array(r.buffer,r.byteOffset,r.byteLength/2),i=String.fromCharCode.apply(null,Array.from(i)),i=i.substring(i.indexOf("<"),i.length),i=(new DOMParser).parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(i){let t=i.childNodes[0]?i.childNodes[0].nodeValue:i.getAttribute("VALUE");if(t){let e=re(t).subarray(0,16);i=e,n(i,0,3),n(i,1,2),n(i,4,5),n(i,6,7),this.keyId=e}}break}default:{let t=r.subarray(0,16);if(16!==t.length){let e=new Uint8Array(16);e.set(t,16-t.length),t=e}this.keyId=t;break}}function n(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}if(!this.keyId||16!==this.keyId.byteLength){let t=Fe[this.uri];if(!t){let e=Object.keys(Fe).length%Number.MAX_SAFE_INTEGER;t=new Uint8Array(16),new DataView(t.buffer,12,4).setUint32(0,e),Fe[this.uri]=t}this.keyId=t}return this}}let Be=/\{\$([a-zA-Z0-9-_]+)\}/g;function Ue(e){return Be.test(e)}function k(t,r,i){if(null!==t.variableList||t.hasVariableRefs)for(let e=i.length;e--;){var n=i[e],a=r[n];a&&(r[n]=Ge(t,a))}}function Ge(n,e){if(null!==n.variableList||n.hasVariableRefs){let i=n.variableList;return e.replace(Be,e=>{var t=e.substring(2,e.length-1),r=null==i?void 0:i[t];return void 0===r?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${t}"`)),e):r})}return e}function ze(e,t,r){let i,n,a=e.variableList;if(a||(e.variableList=a={}),"QUERYPARAM"in t){i=t.QUERYPARAM;try{let e=new self.URL(r).searchParams;if(!e.has(i))throw new Error(`"${i}" does not match any query parameter in URI: "${r}"`);n=e.get(i)}catch(t){e.playlistParsingError||(e.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: "+t.message))}}else i=t.NAME,n=t.VALUE;i in a?e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):a[i]=n||""}function He(){if("undefined"!=typeof self)return self.MediaSource||self.WebKitMediaSource}let Ve={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},We=He();function je(e,t){return null!=(t=null==We?void 0:We.isTypeSupported(`${t||"video"}/mp4;codecs="${e}"`))&&t}let Ye=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,$e=/#EXT-X-MEDIA:(.*)/g,qe=/^#EXT(?:INF|-X-TARGETDURATION):/m,Ke=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Xe=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class g{static findGroup(t,r){for(let e=0;e<t.length;e++){var i=t[e];if(i.id===r)return i}}static convertAVC1ToAVCOTI(e){var t,r=e.split(".");return 2<r.length?(t=r.shift()+".",(t+=parseInt(r.shift()).toString(16))+("000"+parseInt(r.shift()).toString(16)).slice(-4)):e}static resolve(e,t){return z.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return qe.test(e)}static parseMasterPlaylist(e,a){let s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:Ue(e)},o=[];var l;for(Ye.lastIndex=0;null!=(l=Ye.exec(e));)if(l[1]){let e,t=new A(l[1]),r=(k(s,t,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]),Ge(s,l[2])),i={attrs:t,bitrate:t.decimalInteger("AVERAGE-BANDWIDTH")||t.decimalInteger("BANDWIDTH"),name:t.NAME,url:g.resolve(r,a)},n=t.decimalResolution("RESOLUTION");n&&(i.width=n.width,i.height=n.height),function(i,n){["video","audio","text"].forEach(r=>{let t=i.filter(e=>{var t=r;return!!(t=Ve[t])&&!0===t[e.slice(0,4)]});var e;t.length&&(e=t.filter(e=>0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)),n[r+"Codec"]=(0<e.length?e:t)[0],i=i.filter(e=>-1===t.indexOf(e)))}),n.unknownCodecs=i}((t.CODECS||"").split(/[ ,]+/).filter(e=>e),i),i.videoCodec&&-1!==i.videoCodec.indexOf("avc1")&&(i.videoCodec=g.convertAVC1ToAVCOTI(i.videoCodec)),null!=(e=i.unknownCodecs)&&e.length||o.push(i),s.levels.push(i)}else if(l[3]){let e=l[3],r=l[4];switch(e){case"SESSION-DATA":{let e=new A(r),t=(k(s,e,["DATA-ID","LANGUAGE","VALUE","URI"]),e["DATA-ID"]);t&&(null===s.sessionData&&(s.sessionData={}),s.sessionData[t]=e);break}case"SESSION-KEY":{let e=Je(r,a,s);e.encrypted&&e.isSupported()?(null===s.sessionKeys&&(s.sessionKeys=[]),s.sessionKeys.push(e)):I.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${r}"`);break}case"DEFINE":{let e=new A(r);k(s,e,["NAME","VALUE","QUERYPARAM"]),ze(s,e,a)}break;case"CONTENT-STEERING":{let e=new A(r);k(s,e,["SERVER-URI","PATHWAY-ID"]),s.contentSteering={uri:g.resolve(e["SERVER-URI"],a),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":s.startTimeOffset=Ze(r)}}let t=0<o.length&&o.length<s.levels.length;return s.levels=t?o:s.levels,0===s.levels.length&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,n,a){let t,s={},r=a.levels,o={AUDIO:r.map(e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec})),SUBTITLES:r.map(e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec})),"CLOSED-CAPTIONS":[]},l=0;for($e.lastIndex=0;null!==(t=$e.exec(e));){let r=new A(t[1]),i=r.TYPE;if(i){let t=o[i],e=s[i]||[];s[i]=e,k(a,r,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);var h={attrs:r,bitrate:0,id:l++,groupId:r["GROUP-ID"]||"",instreamId:r["INSTREAM-ID"],name:r.NAME||r.LANGUAGE||"",type:i,default:r.bool("DEFAULT"),autoselect:r.bool("AUTOSELECT"),forced:r.bool("FORCED"),lang:r.LANGUAGE,url:r.URI?g.resolve(r.URI,n):""};if(null!=t&&t.length){let e=g.findGroup(t,h.groupId)||t[0];Qe(h,e,"audioCodec"),Qe(h,e,"textCodec")}e.push(h)}}return s}static parseLevelPlaylist(e,s,r,i,n,o){let l=new te(s),h=l.fragments,u,d,c,f=null,p=0,m=0,a=0,g=0,v=null,y=new Q(i,s),x=-1,b=!1;for(Ke.lastIndex=0,l.m3u8=e,l.hasVariableRefs=Ue(e);null!==(u=Ke.exec(e));){b&&(b=!1,(y=new Q(i,s)).start=a,y.sn=p,y.cc=g,y.level=r,f)&&(y.initSegment=f,y.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null);let t=u[1];if(t){y.duration=parseFloat(t);let e=(" "+u[2]).slice(1);y.title=e||null,y.tagList.push(e?["INF",t,e]:["INF",t])}else if(u[3]){if(M(y.duration)){y.start=a,c&&rt(y,c,l),y.sn=p,y.level=r,y.cc=g,y.urlId=n,h.push(y);let e=(" "+u[3]).slice(1);y.relurl=Ge(l,e),et(y,v),v=y,a+=y.duration,p++,m=0,b=!0}}else if(u[4]){let e=(" "+u[4]).slice(1);v?y.setByteRange(e,v):y.setByteRange(e)}else if(u[5])y.rawProgramDateTime=(" "+u[5]).slice(1),y.tagList.push(["PROGRAM-DATE-TIME",y.rawProgramDateTime]),-1===x&&(x=h.length);else if(u=u[0].match(Xe)){for(d=1;d<u.length&&void 0===u[d];d++);let e=(" "+u[d]).slice(1),a=(" "+u[d+1]).slice(1),t=u[d+2]?(" "+u[d+2]).slice(1):"";switch(e){case"PLAYLIST-TYPE":l.type=a.toUpperCase();break;case"MEDIA-SEQUENCE":p=l.startSN=parseInt(a);break;case"SKIP":{let e=new A(a),t=(k(l,e,["RECENTLY-REMOVED-DATERANGES"]),e.decimalInteger("SKIPPED-SEGMENTS"));if(M(t)){for(let e=l.skippedSegments=t;e--;)h.unshift(null);p+=t}let r=e.enumeratedString("RECENTLY-REMOVED-DATERANGES");r&&(l.recentlyRemovedDateranges=r.split("\t"));break}case"TARGETDURATION":l.targetduration=Math.max(parseInt(a),1);break;case"VERSION":l.version=parseInt(a);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"#":(a||t)&&y.tagList.push(t?[a,t]:[a]);break;case"DISCONTINUITY":g++,y.tagList.push(["DIS"]);break;case"GAP":y.gap=!0,y.tagList.push([e]);break;case"BITRATE":y.tagList.push([e,a]);break;case"DATERANGE":{let e=new A(a),t=(k(l,e,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),k(l,e,e.clientAttrs),new K(e,l.dateRanges[e.ID]));t.isValid||l.skippedSegments?l.dateRanges[t.id]=t:I.warn(`Ignoring invalid DATERANGE tag: "${a}"`),y.tagList.push(["EXT-X-DATERANGE",a]);break}case"DEFINE":{let e=new A(a);if(k(l,e,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in e){_=void 0;T=void 0;S=void 0;var _=l;var T=e;var S=o;if(T=T.IMPORT,S&&T in S){let e=_.variableList;e||(_.variableList=e={}),e[T]=S[T]}else _.playlistParsingError||(_.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${T}"`))}else ze(l,e,s)}break;case"DISCONTINUITY-SEQUENCE":g=parseInt(a);break;case"KEY":{let e=Je(a,s,l);if(e.isSupported()){if("NONE"===e.method){c=void 0;break}(c=(c=c||{})[e.keyFormat]?L({},c):c)[e.keyFormat]=e}else I.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${a}"`);break}case"START":l.startTimeOffset=Ze(a);break;case"MAP":{let t=new A(a);if(k(l,t,["BYTERANGE","URI"]),y.duration){let e=new Q(i,s);tt(e,t,r,c),f=e,(y.initSegment=f).rawProgramDateTime&&!y.rawProgramDateTime&&(y.rawProgramDateTime=f.rawProgramDateTime)}else tt(y,t,r,c),f=y,b=!0;break}case"SERVER-CONTROL":{let e=new A(a);l.canBlockReload=e.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=e.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=0<l.canSkipUntil&&e.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=e.optionalFloat("PART-HOLD-BACK",0),l.holdBack=e.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{let e=new A(a);l.partTarget=e.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=l.partList,t=(e=e||(l.partList=[]),0<m?e[e.length-1]:void 0),r=m++,i=new A(a),n=(k(l,i,["BYTERANGE","URI"]),new ee(i,y,s,r,t));e.push(n),y.duration+=n.duration;break}case"PRELOAD-HINT":{let e=new A(a);k(l,e,["URI"]),l.preloadHint=e;break}case"RENDITION-REPORT":{let e=new A(a);k(l,e,["URI"]),l.renditionReports=l.renditionReports||[],l.renditionReports.push(e);break}default:I.warn("line parsed but not handled: "+u)}}else I.warn("No matches on slow regex match for level playlist!")}v&&!v.relurl?(h.pop(),a-=v.duration,l.partList&&(l.fragmentHint=v)):l.partList&&(et(y,v),y.cc=g,l.fragmentHint=y,c)&&rt(y,c,l);var t=h.length,w=h[0],E=h[t-1];if(0<(a+=l.skippedSegments*l.targetduration)&&t&&E){l.averagetargetduration=a/t;let e=E.sn;l.endSN="initSegment"!==e?e:0,l.live||(E.endList=!0),w&&(l.startCC=w.cc)}else l.endSN=0,l.startCC=0;return l.fragmentHint&&(a+=l.fragmentHint.duration),l.totalduration=a,l.endCC=g,0<x&&function(r,e){let i=r[e];for(let t=e;t--;){let e=r[t];if(!e)return;e.programDateTime=i.programDateTime-1e3*e.duration,i=e}}(h,x),l}}function Je(e,t,r){var e=new A(e),r=(k(r,e,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]),null!=(r=e.METHOD)?r:""),i=e.URI,n=e.hexadecimalInteger("IV"),a=e.KEYFORMATVERSIONS,s=null!=(s=e.KEYFORMAT)?s:"identity",e=(i&&e.IV&&!n&&I.error("Invalid IV: "+e.IV),i?g.resolve(i,t):""),i=(a||"1").split("/").map(Number).filter(Number.isFinite);return new Ne(r,e,s,i,n)}function Ze(e){e=new A(e).decimalFloatingPoint("TIME-OFFSET");return M(e)?e:null}function Qe(e,t,r){t=t[r];t&&(e[r]=t)}function et(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),M(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function tt(e,t,r,i){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=r,e.sn="initSegment",i&&(e.levelkeys=i),e.initSegment=null}function rt(e,t,r){e.levelkeys=t;r=r.encryptedFragments;r.length&&r[r.length-1].levelkeys===t||!Object.keys(t).some(e=>t[e].isCommonEncryption)||r.push(e)}var it="manifest",nt="level",v="audioTrack",y="subtitleTrack",x="main",_="audio",at="subtitle";function st(e){e=e.type;switch(e){case v:return _;case y:return at;default:return x}}function ot(e,t){let r=e.url;return r=void 0!==r&&0!==r.indexOf("data:")?r:t.url}class lt{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){var e=this["hls"];e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.LEVEL_LOADING,this.onLevelLoading,this),e.on(R.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(R.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){var e=this["hls"];e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.LEVEL_LOADING,this.onLevelLoading,this),e.off(R.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(R.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){var t=this.hls.config,r=t.pLoader,i=t.loader,r=new(r||i)(t);return this.loaders[e.type]=r}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){t=t.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:it,url:t,deliveryDirectives:null})}onLevelLoading(e,t){var{id:t,level:r,url:i,deliveryDirectives:n}=t;this.load({id:t,level:r,responseType:"text",type:nt,url:i,deliveryDirectives:n})}onAudioTrackLoading(e,t){var{id:t,groupId:r,url:i,deliveryDirectives:n}=t;this.load({id:t,groupId:r,level:null,responseType:"text",type:v,url:i,deliveryDirectives:n})}onSubtitleTrackLoading(e,t){var{id:t,groupId:r,url:i,deliveryDirectives:n}=t;this.load({id:t,groupId:r,level:null,responseType:"text",type:y,url:i,deliveryDirectives:n})}load(t){let e=this.hls.config,i,r=this.getInternalLoader(t);if(r){let e=r.context;if(e&&e.url===t.url)return void I.trace("[playlist-loader]: playlist request ongoing");I.log("[playlist-loader]: aborting previous loader for type: "+t.type),r.abort()}if(i=t.type===it?e.manifestLoadPolicy.default:L({},e.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(t),null!=(n=t.deliveryDirectives)&&n.part){let e;if(t.type===nt&&null!==t.level?e=this.hls.levels[t.level].details:t.type===v&&null!==t.id?e=this.hls.audioTracks[t.id].details:t.type===y&&null!==t.id&&(e=this.hls.subtitleTracks[t.id].details),e){let t=e.partTarget,r=e.targetduration;if(t&&r){let e=1e3*Math.max(3*t,.8*r);i=L({},i,{maxTimeToFirstByteMs:Math.min(e,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(e,i.maxTimeToFirstByteMs)})}}}var n=i.errorRetry||i.timeoutRetry||{},n={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:n.maxNumRetry||0,retryDelay:n.retryDelayMs||0,maxRetryDelay:n.maxRetryDelayMs||0};r.load(t,n,{onSuccess:(e,t,r,i)=>{var n=this.getInternalLoader(r),a=(this.resetInternalLoader(r.type),e.data);0===a.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),g.isMediaPlaylist(a)?this.handleTrackOrLevelPlaylist(e,t,r,i||null,n):this.handleMasterPlaylist(e,t,r,i)):this.handleManifestParsingError(e,r,new Error("no EXTM3U delimiter"),i||null,t)},onError:(e,t,r,i)=>{this.handleNetworkError(t,r,!1,e,i)},onTimeout:(e,t,r)=>{this.handleNetworkError(t,r,!0,void 0,e)}})}handleMasterPlaylist(e,t,r,i){var n,a,s,o,l,h=this.hls,u=e.data,d=ot(e,r),c=g.parseMasterPlaylist(u,d);c.playlistParsingError?this.handleManifestParsingError(e,r,c.playlistParsingError,i,t):({contentSteering:e,levels:r,sessionData:n,sessionKeys:a,startTimeOffset:s,variableList:o}=c,{AUDIO:u=[],SUBTITLES:c,"CLOSED-CAPTIONS":l}=(this.variableList=o,g.parseMasterPlaylistMedia(u,d,c)),u.length&&!u.some(e=>!e.url)&&r[0].audioCodec&&!r[0].attrs.AUDIO&&(I.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),u.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new A({}),bitrate:0,url:""})),h.trigger(R.MANIFEST_LOADED,{levels:r,audioTracks:u,subtitles:c,captions:l,contentSteering:e,url:d,stats:t,networkDetails:i,sessionData:n,sessionKeys:a,startTimeOffset:s,variableList:o}))}handleTrackOrLevelPlaylist(e,t,r,i,n){var a=this.hls,{id:s,level:o,type:l}=r,h=ot(e,r),s=M(s)?s:0,o=M(o)?o:s,u=st(r),o=g.parseLevelPlaylist(e.data,h,o,u,s,this.variableList);if(l===it){let e={attrs:new A({}),bitrate:0,details:o,name:"",url:h};a.trigger(R.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:h,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=o,this.handlePlaylistLoaded(o,e,t,r,i,n)}handleManifestParsingError(e,t,r,i,n){this.hls.trigger(R.ERROR,{type:C.NETWORK_ERROR,details:D.MANIFEST_PARSING_ERROR,fatal:t.type===it,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:i,stats:n})}handleNetworkError(t,r,e=!1,i,n){let a=`A network ${e?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading `+t.type;t.type===nt?a+=`: ${t.level} id: `+t.id:t.type!==v&&t.type!==y||(a+=` id: ${t.id} group-id: "${t.groupId}"`);var s=new Error(a);I.warn("[playlist-loader]: "+a);let o=D.UNKNOWN,l=!1;var h=this.getInternalLoader(t);switch(t.type){case it:o=e?D.MANIFEST_LOAD_TIMEOUT:D.MANIFEST_LOAD_ERROR,l=!0;break;case nt:o=e?D.LEVEL_LOAD_TIMEOUT:D.LEVEL_LOAD_ERROR,l=!1;break;case v:o=e?D.AUDIO_TRACK_LOAD_TIMEOUT:D.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case y:o=e?D.SUBTITLE_TRACK_LOAD_TIMEOUT:D.SUBTITLE_LOAD_ERROR,l=!1}h&&this.resetInternalLoader(t.type);h={type:C.NETWORK_ERROR,details:o,fatal:l,url:t.url,loader:h,context:t,error:s,networkDetails:r,stats:n};if(i){let e=(null==r?void 0:r.url)||t.url;h.response=m({url:e,data:void 0},i)}this.hls.trigger(R.ERROR,h)}handlePlaylistLoaded(e,t,r,i,n,a){var s=this.hls,{type:o,level:l,id:h,groupId:u,deliveryDirectives:d}=i,c=ot(t,i),f=st(i),p="number"==typeof i.level&&f===x?l:void 0;if(e.fragments.length){e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));l=e.playlistParsingError;if(l)s.trigger(R.ERROR,{type:C.NETWORK_ERROR,details:D.LEVEL_PARSING_ERROR,fatal:!1,url:c,error:l,reason:l.message,response:t,context:i,level:p,parent:f,networkDetails:n,stats:r});else switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),a.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),o){case it:case nt:s.trigger(R.LEVEL_LOADED,{details:e,level:p||0,id:h||0,stats:r,networkDetails:n,deliveryDirectives:d});break;case v:s.trigger(R.AUDIO_TRACK_LOADED,{details:e,id:h||0,groupId:u||"",stats:r,networkDetails:n,deliveryDirectives:d});break;case y:s.trigger(R.SUBTITLE_TRACK_LOADED,{details:e,id:h||0,groupId:u||"",stats:r,networkDetails:n,deliveryDirectives:d})}}else{let e=new Error("No Segments found in Playlist");void s.trigger(R.ERROR,{type:C.NETWORK_ERROR,details:D.LEVEL_EMPTY_ERROR,fatal:!1,url:c,error:e,reason:e.message,response:t,context:i,level:p,parent:f,networkDetails:n,stats:r})}}}function ht(e,t){let r;try{r=new Event("addtrack")}catch(e){(r=document.createEvent("Event")).initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)}function ut(t,r){let e=t.mode;if("disabled"===e&&(t.mode="hidden"),t.cues&&!t.cues.getCueById(r.id))try{if(t.addCue(r),!t.cues.getCueById(r.id))throw new Error("addCue is failed for: "+r)}catch(e){I.debug("[texttrack-utils]: "+e);try{let e=new self.TextTrackCue(r.startTime,r.endTime,r.text);e.id=r.id,t.addCue(e)}catch(t){I.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: "+t)}}"disabled"===e&&(t.mode=e)}function dt(t){var e=t.mode;if("disabled"===e&&(t.mode="hidden"),t.cues)for(let e=t.cues.length;e--;)t.removeCue(t.cues[e]);"disabled"===e&&(t.mode=e)}function ct(r,e,i,n){let t=r.mode;if("disabled"===t&&(r.mode="hidden"),r.cues&&0<r.cues.length){let t=function(r,i,n){let a=[],s=function(e,t){if(t<e[0].startTime)return 0;var r=e.length-1;if(t>e[r].endTime)return-1;let i=0,n=r;for(;i<=n;){var a=Math.floor((n+i)/2);if(t<e[a].startTime)n=a-1;else{if(!(t>e[a].startTime&&i<r))return a;i=a+1}}return e[i].startTime-t<t-e[n].startTime?i:n}(r,i);if(-1<s)for(let t=s,e=r.length;t<e;t++){let e=r[t];if(e.startTime>=i&&e.endTime<=n)a.push(e);else if(e.startTime>n)return a}return a}(r.cues,e,i);for(let e=0;e<t.length;e++)n&&!n(t[e])||r.removeCue(t[e])}"disabled"===t&&(r.mode=t)}var ft="org.id3",pt="https://aomedia.org/emsg/ID3";function mt(){if("undefined"!=typeof self)return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}let gt=(()=>{var e=mt();try{new e(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function vt(e,t){return e.getTime()/1e3-t}class yt{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){var e=this["hls"];e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(R.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){var e=this["hls"];e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(R.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(dt(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){e=this.getID3Track(e.textTracks);return e.mode="hidden",e}getID3Track(t){if(this.media){for(let e=0;e<t.length;e++){var r=t[e];if("metadata"===r.kind&&"id3"===r.label)return ht(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,n){if(this.media){let{config:{enableEmsgMetadataCues:r,enableID3MetadataCues:i}}=this["hls"];if(r||i){let t=n["samples"];this.id3Track||(this.id3Track=this.createTrack(this.media));var a=mt();for(let e=0;e<t.length;e++){let n=t[e].type;if((n!==pt||r)&&i){var s=xe(t[e].data);if(s){let r=t[e].pts,i=r+t[e].duration;(i=i>gt?gt:i)-r<=0&&(i=r+.25);for(let e=0;e<s.length;e++){let t=s[e];if(!ye(t)){this.updateId3CueEnds(r,n);let e=new a(r,i,"");e.value=t,n&&(e.type=n),this.id3Track.addCue(e)}}}}}}}}updateId3CueEnds(t,r){var e,i=null==(e=this.id3Track)?void 0:e.cues;if(i)for(let e=i.length;e--;){var n=i[e];n.type===r&&n.startTime<t&&n.endTime===gt&&(n.endTime=t)}}onBufferFlushing(e,{startOffset:i,endOffset:n,type:a}){var{id3Track:s,hls:o}=this;if(o){let{enableEmsgMetadataCues:t,enableID3MetadataCues:r}=o["config"];s&&(t||r)&&ct(s,i,n,"audio"===a?e=>e.type===ft&&r:"video"===a?e=>e.type===pt&&t:e=>e.type===ft&&r||e.type===pt&&t)}}onLevelUpdated(e,{details:r}){if(this.media&&r.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){let{dateRangeCuesAppended:h,id3Track:i}=this,u=r["dateRanges"],t=Object.keys(u);if(i){let r=Object.keys(h).filter(e=>!t.includes(e));for(let e=r.length;e--;){let t=r[e];Object.keys(h[t].cues).forEach(e=>{i.removeCue(h[t].cues[e])}),delete h[t]}}let e=r.fragments[r.fragments.length-1];if(0!==t.length&&M(null==e?void 0:e.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));var d,c=e.programDateTime/1e3-e.start,f=mt();for(let e=0;e<t.length;e++){let i=t[e],n=u[i],a=h[i],s=(null==a?void 0:a.cues)||{},o=(null==a?void 0:a.durationKnown)||!1;var p=vt(n.startDate,c);let l=gt;var m=n.endDate;if(m)l=vt(m,c),o=!0;else if(n.endOnNext&&!o){let e=t.reduce((e,t)=>{var r=u[t];return r.class===n.class&&r.id!==t&&r.startDate>n.startDate&&e.push(r),e},[]).sort((e,t)=>e.startDate.getTime()-t.startDate.getTime())[0];e&&(l=vt(e.startDate,c),o=!0)}var g=Object.keys(n.attr);for(let e=0;e<g.length;e++){let r=g[e];if("ID"!==(d=r)&&"CLASS"!==d&&"START-DATE"!==d&&"DURATION"!==d&&"END-DATE"!==d&&"END-ON-NEXT"!==d){let t=s[r];if(t)o&&!a.durationKnown&&(t.endTime=l);else{let e=n.attr[r];t=new f(p,l,""),"SCTE35-OUT"!==(d=r)&&"SCTE35-IN"!==d||(d=e,e=Uint8Array.from(d.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),t.value={key:r,data:e},t.type="com.apple.quicktime.HLS",t.id=i,this.id3Track.addCue(t),s[r]=t}}}h[i]={cues:s,dateRange:n,durationKnown:o}}}}}}class xt{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){var{config:e,levelDetails:t}=this;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){var e=this["levelDetails"];if(null===e)return null;var{holdBack:e,partHoldBack:t,targetduration:r}=e,{liveSyncDuration:i,liveSyncDurationCount:n,lowLatencyMode:a}=this.config,s=this.hls.userConfig;let o=a&&t||e;return(o=s.liveSyncDuration||s.liveSyncDurationCount||0===o?void 0!==i?i:n*r:o)+Math.min(+this.stallCount,r)}get liveSyncPosition(){var e,t=this.estimateLiveEdge(),r=this.targetLatency,i=this.levelDetails;return null===t||null===r||null===i?null:(e=i.edge,t=t-r-this.edgeStalled,r=e-i.totalduration,e=e-(this.config.lowLatencyMode&&i.partTarget||i.targetduration),Math.min(Math.max(r,t),e))}get drift(){var e=this["levelDetails"];return null===e?1:e.drift}get edgeStalled(){var e,t=this["levelDetails"];return null===t?0:(e=3*(this.config.lowLatencyMode&&t.partTarget||t.targetduration),Math.max(t.age-e,0))}get forwardBufferLength(){var e,{media:t,levelDetails:r}=this;return t&&r?((e=t.buffered.length)?t.buffered.end(e-1):r.edge)-this.currentTime:0}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(R.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(R.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(R.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(R.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(R.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(R.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){(this.levelDetails=t).advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){t.details===D.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(t=this.levelDetails))&&t.live&&I.warn("[playback-rate-controller]: Stall detected, adjusting target latency")}timeupdate(){let{media:r,levelDetails:t}=this;if(r&&t){this.currentTime=r.currentTime;let e=this.computeLatency();if(null!==e){this._latency=e;var{lowLatencyMode:i,maxLiveSyncPlaybackRate:n}=this.config;if(i&&1!==n){i=this.targetLatency;if(null!==i){var a=e-i,i=a<Math.min(this.maxLatency,i+t.targetduration);if(t.live&&i&&.05<a&&1<this.forwardBufferLength){let e=Math.min(2,Math.max(1,n)),t=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20;r.playbackRate=Math.min(e,Math.max(1,t))}else 1!==r.playbackRate&&0!==r.playbackRate&&(r.playbackRate=1)}}}}}estimateLiveEdge(){var e=this["levelDetails"];return null===e?null:e.edge+e.age}computeLatency(){var e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}let bt=["NONE","TYPE-0","TYPE-1",null];class _t{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){e=new self.URL(e);return void 0!==this.msn&&e.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href}}class Tt{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter(e=>e).join(",").replace(/\.[^.,]+/g,"")}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get attrs(){return this._attrs[this._urlId]}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get uri(){return this.url[this._urlId]||""}get urlId(){return this._urlId}set urlId(e){e%=this.url.length;this._urlId!==e&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=e)}get audioGroupId(){var e;return null==(e=this.audioGroupIds)?void 0:e[this.urlId]}get textGroupId(){var e;return null==(e=this.textGroupIds)?void 0:e[this.urlId]}addFallback(e){this.url.push(e.url),this._attrs.push(e.attrs)}}function St(r,i){var n=i.startPTS;if(M(n)){let e,t=0;(e=i.sn>r.sn?(t=n-r.start,r):(t=r.start-n,i)).duration!==t&&(e.duration=t)}else i.sn>r.sn?r.cc===i.cc&&r.minEndPTS?i.start=r.start+(r.minEndPTS-r.start):i.start=r.start+r.duration:i.start=Math.max(r.start-i.duration,0)}function wt(e,t,r,i,n,a){i-r<=0&&(I.warn("Fragment should have a positive duration",t),i=r+t.duration,a=n+t.duration);let s=r,o=i;var l=t.startPTS,h=t.endPTS;if(M(l)){let e=Math.abs(l-r);M(t.deltaPTS)?t.deltaPTS=Math.max(e,t.deltaPTS):t.deltaPTS=e,s=Math.max(r,l),r=Math.min(r,l),n=Math.min(n,t.startDTS),o=Math.min(i,h),i=Math.max(i,h),a=Math.max(a,t.endDTS)}l=r-t.start,0!==t.start&&(t.start=r),t.duration=i-t.start,t.startPTS=r,t.maxStartPTS=s,t.startDTS=n,t.endPTS=i,t.minEndPTS=o,t.endDTS=a,h=t.sn;if(!e||h<e.startSN||h>e.endSN)return 0;let u;var r=h-e.startSN,d=e.fragments;for(d[r]=t,u=r;0<u;u--)St(d[u],d[u-1]);for(u=r;u<d.length-1;u++)St(d[u],d[u+1]);return e.fragmentHint&&St(d[d.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,l}function Et(r,o){let l=null;var i=r.fragments;for(let t=i.length-1;0<=t;t--){let e=i[t].initSegment;if(e){l=e;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;let h,u=0;{var d,c,f=r,p=o;let i=p.skippedSegments,e=Math.max(f.startSN,p.startSN)-p.startSN,t=(f.fragmentHint?1:0)+(i?p.endSN:Math.min(f.endSN,p.endSN))-p.startSN,n=p.startSN-f.startSN,a=p.fragmentHint?p.fragments.concat(p.fragmentHint):p.fragments,s=f.fragmentHint?f.fragments.concat(f.fragmentHint):f.fragments;for(let r=e;r<=t;r++){let e=s[n+r],t=a[r];i&&!t&&r<i&&(t=p.fragments[r]=e),e&&t&&(d=e,c=t,d.relurl&&(u=d.cc-c.cc),M(d.startPTS)&&M(d.endPTS)&&(c.start=c.startPTS=d.startPTS,c.startDTS=d.startDTS,c.maxStartPTS=d.maxStartPTS,c.endPTS=d.endPTS,c.endDTS=d.endDTS,c.minEndPTS=d.minEndPTS,c.duration=d.endPTS-d.startPTS,c.duration&&(h=c),o.PTSKnown=o.alignedSliding=!0),c.elementaryStreams=d.elementaryStreams,c.loader=d.loader,c.stats=d.stats,c.urlId=d.urlId,d.initSegment)&&(c.initSegment=d.initSegment,l=d.initSegment)}}if(l&&(o.fragmentHint?o.fragments.concat(o.fragmentHint):o.fragments).forEach(e=>{var t;e.initSegment&&e.initSegment.relurl!==(null==(t=l)?void 0:t.relurl)||(e.initSegment=l)}),o.skippedSegments)if(o.deltaUpdateFailed=o.fragments.some(e=>!e),o.deltaUpdateFailed){I.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=o.skippedSegments;e--;)o.fragments.shift();o.startSN=o.fragments[0].sn,o.startCC=o.fragments[0].cc}else o.canSkipDateRanges&&(o.dateRanges=function(e,r,t){let i=L({},e);return t&&t.forEach(e=>{delete i[e]}),Object.keys(r).forEach(e=>{var t=new K(r[e].attr,i[e]);t.isValid?i[e]=t:I.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(r[e].attr)}"`)}),i}(r.dateRanges,o.dateRanges,o.recentlyRemovedDateranges));var t=o.fragments;if(u){I.warn("discontinuity sliding from playlist, take drift into account");for(let e=0;e<t.length;e++)t[e].cc+=u}o.skippedSegments&&(o.startCC=o.fragments[0].cc);var n=r.partList,a=o.partList;if(n&&a){let r=0;for(let e=0,t=n.length;e<=t;e++){var s=n[e],m=a[e+r];s&&m&&s.index===m.index&&s.fragment.sn===m.fragment.sn?(s=s,(m=m).elementaryStreams=s.elementaryStreams,m.stats=s.stats):r--}}h?wt(o,h,h.startPTS,h.endPTS,h.startDTS,h.endDTS):Mt(r,o),t.length&&(o.totalduration=o.edge-t[0].start),o.driftStartTime=r.driftStartTime,o.driftStart=r.driftStart;f=o.advancedDateTime;if(o.advanced&&f){let e=o.edge;o.driftStart||(o.driftStartTime=f,o.driftStart=e),o.driftEndTime=f,o.driftEnd=e}else o.driftEndTime=r.driftEndTime,o.driftEnd=r.driftEnd,o.advancedDateTime=r.advancedDateTime}function Mt(e,t){var r=t.startSN+t.skippedSegments-e.startSN,e=e.fragments;r<0||r>=e.length||At(t,e[r].start)}function At(t,r){if(r){var i=t.fragments;for(let e=t.skippedSegments;e<i.length;e++)i[e].start+=r;t.fragmentHint&&(t.fragmentHint.start+=r)}}function Lt(e,t,r){return null!=e&&e.details?Rt(null==(e=e.details)?void 0:e.partList,t,r):null}function Rt(t,r,i){if(t)for(let e=t.length;e--;){var n=t[e];if(n.index===i&&n.fragment.sn===r)return n}return null}function Ct(e){switch(e.details){case D.FRAG_LOAD_TIMEOUT:case D.KEY_LOAD_TIMEOUT:case D.LEVEL_LOAD_TIMEOUT:case D.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Dt(e,t){t=Ct(t);return e.default[(t?"timeout":"error")+"Retry"]}function It(e,t){t="linear"===e.backoff?1:Math.pow(2,t);return Math.min(t*e.retryDelayMs,e.maxRetryDelayMs)}function Pt(e){return m(m({},e),{errorRetry:null,timeoutRetry:null})}function kt(e,t,r,i){return e&&t<e.maxNumRetry&&(0===i&&!1===navigator.onLine||i&&(i<400||499<i)||r)}function Ot(e,t){let r=0,i=e.length-1,n,a;for(;r<=i;){var s=t(a=e[n=(r+i)/2|0]);if(0<s)r=1+n;else{if(!(s<0))return a;i=n-1}}return null}function Ft(e,t,r=0,i=0){let n=null;return e?n=t[e.sn-t[0].sn+1]||null:0===r&&0===t[0].start&&(n=t[0]),n&&0===Nt(r,i,n)||!(t=Ot(t,Nt.bind(null,r,i)))||t===e&&n?n:t}function Nt(e=0,t=0,r){return r.start<=e&&r.start+r.duration>e?0:(t=Math.min(t,r.duration+(r.deltaPTS||0)),r.start+r.duration-t<=e?1:r.start-t>e&&r.start?-1:0)}class Bt{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=I.log.bind(I,t+":"),this.warn=I.warn.bind(I,t+":"),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){clearTimeout(this.timer),this.timer=-1}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(r,n){var a=null==n?void 0:n.renditionReports;if(a){let i=-1;for(let t=0;t<a.length;t++){var s=a[t];let e;try{e=new self.URL(s.URI,n.url).href}catch(r){I.warn("Could not construct new URL for Rendition Report: "+r),e=s.URI||""}if(e===r){i=t;break}e===r.substring(0,e.length)&&(i=t)}if(-1!==i){let e=a[i],t=parseInt(e["LAST-MSN"])||(null==n?void 0:n.lastPartSn),r=parseInt(e["LAST-PART"])||(null==n?void 0:n.lastPartIndex);if(this.hls.config.lowLatencyMode){let e=Math.min(n.age-n.partTarget,n.targetduration);0<=r&&e>n.partTarget&&(r+=1)}return new _t(t,0<=r?r:void 0,"")}}}loadPlaylist(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)}playlistLoaded(e,u,d){let{details:c,stats:t}=u,r=self.performance.now(),i=t.loading.first?Math.max(0,r-t.loading.first):0;if(c.advancedDateTime=Date.now()-i,c.live||null!=d&&d.live){if(c.reloaded(d),d&&this.log(`live playlist ${e} `+(c.advanced?"REFRESHED "+c.lastPartSn+"-"+c.lastPartIndex:c.updated?"UPDATED":"MISSED")),d&&0<c.fragments.length&&Et(d,c),this.canLoad&&c.live){let o,l=void 0,h=void 0;if(c.canBlockReload&&c.endSN&&c.advanced){let e=this.hls.config.lowLatencyMode,t=c.lastPartSn,r=c.endSN,i=c.lastPartIndex,n=t===r,a=e?0:i;-1!==i?(l=n?r+1:t,h=n?a:i+1):l=r+1;var f=c.age,p=f+c.ageHeader;let s=Math.min(p-c.partTarget,1.5*c.targetduration);if(0<s){if(d&&s>d.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${d.tuneInGoal} to: ${s} with playlist age: `+c.age),s=0;else{let e=Math.floor(s/c.targetduration);l+=e,void 0!==h&&(h+=Math.round(s%c.targetduration/c.partTarget)),this.log(`CDN Tune-in age: ${c.ageHeader}s last advanced ${f.toFixed(2)}s goal: ${s} skip sn ${e} to part `+h)}c.tuneInGoal=s}if(o=this.getDeliveryDirectives(c,u.deliveryDirectives,l,h),e||!n)return void this.loadPlaylist(o)}else(c.canBlockReload||c.canSkipUntil)&&(o=this.getDeliveryDirectives(c,u.deliveryDirectives,l,h));p=this.hls.mainForwardBufferInfo,d=p?p.end-p.len:0,f=function(e,t){let r=1e3*e.targetduration;if(e.updated){var i=e.fragments;if(i.length&&4*r>t){let e=1e3*i[i.length-1].duration;e<r&&(r=e)}}else r/=2;return Math.round(r)}(c,1e3*(c.edge-d)),u=(c.updated&&r>this.requestScheduled+f&&(this.requestScheduled=t.loading.start),void 0!==l&&c.canBlockReload?this.requestScheduled=t.loading.first+f-(1e3*c.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+f<r?this.requestScheduled=r:this.requestScheduled-r<=0&&(this.requestScheduled+=f),this.requestScheduled-r),u=Math.max(0,u);this.log(`reload live playlist ${e} in ${Math.round(u)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(o),u)}}else this.clearTimer()}getDeliveryDirectives(i,e,n,t){let r=function(){var{canSkipUntil:e,canSkipDateRanges:t,endSN:r}=i;return e&&(void 0!==n?n-r:0)<e?t?"v2":"YES":""}();return null!=e&&e.skip&&i.deltaUpdateFailed&&(n=e.msn,t=e.part,r=""),new _t(n,t,r)}checkRetry(e){var t=e.details,r=Ct(e),i=e.errorAction,{action:n,retryCount:a=0,retryConfig:s}=i||{},n=!!i&&!!s&&(5===n||!i.resolved&&2===n);if(n){if(this.requestScheduled=-1,a>=s.maxNumRetry)return!1;if(r&&null!=(r=e.context)&&r.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${s.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{let e=It(s,a);this.timer=self.setTimeout(()=>this.loadPlaylist(),e),this.warn(`Retrying playlist loading ${a+1}/${s.maxNumRetry} after "${t}" in ${e}ms`)}e.levelRetry=!0,i.resolved=!0}return n}}let Ut;class Gt extends Bt{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){var e=this["hls"];e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(R.LEVEL_LOADED,this.onLevelLoaded,this),e.on(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(R.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(R.FRAG_LOADED,this.onFragLoaded,this),e.on(R.ERROR,this.onError,this)}_unregisterListeners(){var e=this["hls"];e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(R.LEVEL_LOADED,this.onLevelLoaded,this),e.off(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(R.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(R.FRAG_LOADED,this.onFragLoaded,this),e.off(R.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}startLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.startLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){let o=[],l={},h;t.levels.forEach(e=>{var t=e.attrs,{AUDIO:r,CODECS:t,"FRAME-RATE":i,"PATHWAY-ID":n,RESOLUTION:a,SUBTITLES:s}=(-1!==(null==(r=e.audioCodec)?void 0:r.indexOf("mp4a.40.34"))&&(Ut=Ut||/chrome|firefox/i.test(navigator.userAgent))&&(e.audioCodec=void 0),t),n=(n||".")+"-"+e.bitrate+`-${a}-${i}-`+t;(h=l[n])?h.addFallback(e):(h=new Tt(e),l[n]=h,o.push(h)),zt(h,"audio",r),zt(h,"text",s)}),this.filterAndSortMediaOptions(o,t)}filterAndSortMediaOptions(e,r){let i=[],n=[],a=!1,s=!1,o=!1,l=e.filter(({audioCodec:e,videoCodec:t,width:r,height:i,unknownCodecs:n})=>(a=a||!(!r||!i),s=s||!!t,o=o||!!e,!(null!=n&&n.length)&&(!e||je(e,"audio"))&&(!t||je(t,"video"))));if(0===(l=(a||s)&&o?l.filter(({videoCodec:e,width:t,height:r})=>!!e||!(!t||!r)):l).length)Promise.resolve().then(()=>{var e;this.hls&&(e=new Error("no level with compatible codecs found in manifest"),this.hls.trigger(R.ERROR,{type:C.MEDIA_ERROR,details:D.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:r.url,error:e,reason:e.message}))});else{r.audioTracks&&Ht(i=r.audioTracks.filter(e=>!e.audioCodec||je(e.audioCodec,"audio"))),r.subtitles&&Ht(n=r.subtitles);var h=l.slice(0);l.sort((e,t)=>e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"]?(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1:e.bitrate!==t.bitrate?e.bitrate-t.bitrate:e.attrs["FRAME-RATE"]!==t.attrs["FRAME-RATE"]?e.attrs.decimalFloatingPoint("FRAME-RATE")-t.attrs.decimalFloatingPoint("FRAME-RATE"):e.attrs.SCORE!==t.attrs.SCORE?e.attrs.decimalFloatingPoint("SCORE")-t.attrs.decimalFloatingPoint("SCORE"):a&&e.height!==t.height?e.height-t.height:0);let t=h[0];if(this.steering&&(l=this.steering.filterParsedLevels(l)).length!==h.length)for(let e=0;e<h.length;e++)if(h[e].pathwayId===l[0].pathwayId){t=h[e];break}this._levels=l;for(let e=0;e<l.length;e++)if(l[e]===t){this._firstLevel=e,this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: `+t.bitrate);break}e=o&&!s,e={levels:l,audioTracks:i,subtitleTracks:n,sessionData:r.sessionData,sessionKeys:r.sessionKeys,firstLevel:this._firstLevel,stats:r.stats,audio:o,video:s,altAudio:!e&&i.some(e=>!!e.url)};this.hls.trigger(R.MANIFEST_PARSED,e),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}}get levels(){return 0===this._levels.length?null:this._levels}get level(){return this.currentLevelIndex}set level(a){var s=this._levels;if(0!==s.length){if(a<0||a>=s.length){let e=new Error("invalid level idx"),t=a<0;if(this.hls.trigger(R.ERROR,{type:C.OTHER_ERROR,details:D.LEVEL_SWITCH_ERROR,level:a,fatal:t,error:e,reason:e.message}),t)return;a=Math.min(a,s.length-1)}let e=this.currentLevelIndex,t=this.currentLevel,r=t?t.attrs["PATHWAY-ID"]:void 0,i=s[a],n=i.attrs["PATHWAY-ID"];if(this.currentLevelIndex=a,this.currentLevel=i,e!==a||!i.details||!t||r!==n){this.log(`Switching to level ${a}${n?" with Pathway "+n:""} from level `+e+(r?" with Pathway "+r:""));s=L({},i,{level:a,maxBitrate:i.maxBitrate,attrs:i.attrs,uri:i.uri,urlId:i.urlId}),a=(delete s._attrs,delete s._urlId,this.hls.trigger(R.LEVEL_SWITCHING,s),i.details);if(!a||a.live){let e=this.switchParams(i.uri,null==t?void 0:t.details);this.loadPlaylist(e)}}}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){var e;return void 0===this._startLevel?void 0!==(e=this.hls.config.startLevel)?e:this._firstLevel:this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){!t.fatal&&t.context&&t.context.type===nt&&t.context.level===this.level&&this.checkRetry(t)}onFragLoaded(e,{frag:t}){if(void 0!==t&&t.type===x){let e=this._levels[t.level];void 0!==e&&(e.loadError=0)}}onLevelLoaded(e,t){var{level:r,details:i}=t,n=this._levels[r];n?r===this.currentLevelIndex?(0===n.fragmentError&&(n.loadError=0),this.playlistLoaded(r,t,n.details)):null!=(n=t.deliveryDirectives)&&n.skip&&(i.deltaUpdateFailed=!0):(this.warn("Invalid level index "+r),null!=(n=t.deliveryDirectives)&&n.skip&&(i.deltaUpdateFailed=!0))}onAudioTrackSwitched(e,t){var r=this.currentLevel;if(r){var i=this.hls.audioTracks[t.id].groupId;if(r.audioGroupIds&&r.audioGroupId!==i){let t=-1;for(let e=0;e<r.audioGroupIds.length;e++)if(r.audioGroupIds[e]===i){t=e;break}-1!==t&&t!==r.urlId&&(r.urlId=t,this.canLoad)&&this.startLoad()}}}loadPlaylist(t){super.loadPlaylist();var r=this.currentLevelIndex,i=this.currentLevel;if(i&&this.shouldLoadPlaylist(i)){var n=i.urlId;let e=i.uri;if(t)try{e=t.addDirectives(e)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}var a=i.attrs["PATHWAY-ID"];this.log(`Loading level index ${r}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""} with${a?" Pathway "+a:""} URI ${n+1}/${i.url.length} `+e),this.clearTimer(),this.hls.trigger(R.LEVEL_LOADING,{url:e,level:r,id:n,deliveryDirectives:t||null})}}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(r,i){let n=(e,t)=>t!==i,e=this._levels.filter((e,t)=>t!==r||(1<e.url.length&&void 0!==i?(e.url=e.url.filter(n),e.audioGroupIds&&(e.audioGroupIds=e.audioGroupIds.filter(n)),e.textGroupIds&&(e.textGroupIds=e.textGroupIds.filter(n)),!(e.urlId=0)):(this.steering&&this.steering.removeLevel(e),!1)));this.hls.trigger(R.LEVELS_UPDATED,{levels:e})}onLevelsUpdated(e,{levels:t}){t.forEach((e,t)=>{e=e.details;null!=e&&e.fragments&&e.fragments.forEach(e=>{e.level=t})}),this._levels=t}}function zt(e,t,r){r&&("audio"===t?(e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds[e.url.length-1]=r):"text"===t&&(e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds[e.url.length-1]=r))}function Ht(e){let r={};e.forEach(e=>{var t=e.groupId||"";e.id=r[t]=r[t]||0,r[t]++})}var Vt="NOT_LOADED",Wt="PARTIAL";class jt{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){var e=this["hls"];e.on(R.BUFFER_APPENDED,this.onBufferAppended,this),e.on(R.FRAG_BUFFERED,this.onFragBuffered,this),e.on(R.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){var e=this["hls"];e.off(R.BUFFER_APPENDED,this.onBufferAppended,this),e.off(R.FRAG_BUFFERED,this.onFragBuffered,this),e.off(R.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(t,e){var r=this.activePartLists[e];if(r)for(let e=r.length;e--;){var i=r[e];if(!i)break;var n=i.end;if(i.start<=t&&null!==n&&t<=n)return i}return this.getBufferedFrag(t,e)}getBufferedFrag(t,r){var i=this["fragments"],n=Object.keys(i);for(let e=n.length;e--;){var a=i[n[e]];if((null==a?void 0:a.body.type)===r&&a.buffered){let e=a.body;if(e.start<=t&&t<=e.end)return e}}return null}detectEvictedFragments(r,i,n,e){this.timeRanges&&(this.timeRanges[r]=i);let a=(null==e?void 0:e.fragment.sn)||-1;Object.keys(this.fragments).forEach(e=>{let t=this.fragments[e];!t||a>=t.body.sn||(t.buffered||t.loaded?(e=t.range[r])&&e.time.some(e=>{e=!this.isTimeBuffered(e.startPTS,e.endPTS,i);return e&&this.removeFragment(t.body),e}):t.body.type===n&&this.removeFragment(t.body))})}detectPartialFragments(e){let a=this.timeRanges,{frag:s,part:o}=e;if(a&&"initSegment"!==s.sn){let e=$t(s),n=this.fragments[e];if(!(!n||n.buffered&&s.gap)){let i=!s.relurl;Object.keys(a).forEach(e=>{var t,r=s.elementaryStreams[e];r&&(t=a[e],r=i||!0===r.partial,n.range[e]=this.getBufferedTimes(s,o,r,t))}),n.loaded=null,Object.keys(n.range).length?(n.buffered=!0,(n.body.endList=s.endList||n.body.endList)&&(this.endListFragments[n.body.type]=n),Yt(n)||this.removeParts(s.sn-1,s.type)):this.removeFragment(n.body)}}}removeParts(t,e){var r=this.activePartLists[e];r&&(this.activePartLists[e]=r.filter(e=>e.fragment.sn>=t))}fragBuffered(e,t){var r=$t(e);let i=this.fragments[r];!i&&t&&(i=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap)&&(this.hasGaps=!0),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,r,i){var n={time:[],partial:r},a=e.start,s=e.end,o=e.minEndPTS||s,l=e.maxStartPTS||a;for(let r=0;r<i.length;r++){let e=i.start(r)-this.bufferPadding,t=i.end(r)+this.bufferPadding;if(l>=e&&o<=t){n.time.push({startPTS:Math.max(a,i.start(r)),endPTS:Math.min(s,i.end(r))});break}if(a<t&&s>e)n.partial=!0,n.time.push({startPTS:Math.max(a,i.start(r)),endPTS:Math.min(s,i.end(r))});else if(s<=e)break}return n}getPartialFragment(t){let r,i,n,a=null,s=0,{bufferPadding:o,fragments:l}=this;return Object.keys(l).forEach(e=>{e=l[e];e&&Yt(e)&&(i=e.body.start-o,n=e.body.end+o,t>=i)&&t<=n&&(r=Math.min(t-i,n-t),s<=r)&&(a=e.body,s=r)}),a}isEndListAppended(e){e=this.endListFragments[e];return void 0!==e&&(e.buffered||Yt(e))}getState(e){e=$t(e),e=this.fragments[e];return e?e.buffered?Yt(e)?Wt:"OK":"APPENDING":Vt}isTimeBuffered(t,r,i){var n,a;for(let e=0;e<i.length;e++){if(n=i.start(e)-this.bufferPadding,a=i.end(e)+this.bufferPadding,n<=t&&r<=a)return!0;if(r<=n)return!1}return!1}onFragLoaded(e,t){var r,{frag:i,part:n}=t;"initSegment"===i.sn||i.bitrateTest||(r=$t(i),this.fragments[r]={body:i,appendedPTS:null,loaded:n?null:t,buffered:!1,range:Object.create(null)})}onBufferAppended(e,t){let{frag:i,part:n,timeRanges:a}=t;if("initSegment"!==i.sn){let r=i.type;if(n){let e=this.activePartLists[r];e||(this.activePartLists[r]=e=[]),e.push(n)}this.timeRanges=a,Object.keys(a).forEach(e=>{var t=a[e];this.detectEvictedFragments(e,t,r,n)})}}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){e=$t(e);return!!this.fragments[e]}hasParts(e){return!(null==(e=this.activePartLists[e])||!e.length)}removeFragmentsInRange(r,i,n,a,s){a&&!this.hasGaps||Object.keys(this.fragments).forEach(e=>{var t,e=this.fragments[e];!e||(t=e.body).type!==n||a&&!t.gap||t.start<i&&t.end>r&&(e.buffered||s)&&this.removeFragment(t)})}removeFragment(e){let t=$t(e);e.stats.loaded=0,e.clearElementaryStreamInfo();var r=this.activePartLists[e.type];if(r){let t=e.sn;this.activePartLists[e.type]=r.filter(e=>e.fragment.sn!==t)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function Yt(e){var t;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(t=e.range.audio)?void 0:t.partial)||(null==(t=e.range.audiovideo)?void 0:t.partial))}function $t(e){return`${e.type}_${e.level}_${e.urlId}_`+e.sn}let qt=Math.pow(2,17);class Kt{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(o,l){let h=o.url;if(!h)return Promise.reject(new b({type:C.NETWORK_ERROR,details:D.FRAG_LOAD_ERROR,fatal:!1,frag:o,error:new Error("Fragment does not have a "+(h?"part list":"url")),networkDetails:null}));this.abort();let r=this.config,u=r.fLoader,d=r.loader;return new Promise((a,n)=>{if(this.loader&&this.loader.destroy(),o.gap){if(o.tagList.some(e=>"GAP"===e[0]))return void n(Jt(o));o.gap=!1}let s=this.loader=o.loader=new(u||d)(r),e=Xt(o),t=Pt(r.fragLoadPolicy.default),i={loadPolicy:t,timeout:t.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===o.sn?1/0:qt};o.stats=s.stats,s.load(e,i,{onSuccess:(e,t,r,i)=>{this.resetLoader(o,s);let n=e.data;r.resetIV&&o.decryptdata&&(o.decryptdata.iv=new Uint8Array(n.slice(0,16)),n=n.slice(16)),a({frag:o,part:null,payload:n,networkDetails:i})},onError:(e,t,r,i)=>{this.resetLoader(o,s),n(new b({type:C.NETWORK_ERROR,details:D.FRAG_LOAD_ERROR,fatal:!1,frag:o,response:m({url:h,data:void 0},e),error:new Error(`HTTP Error ${e.code} `+e.text),networkDetails:r,stats:i}))},onAbort:(e,t,r)=>{this.resetLoader(o,s),n(new b({type:C.NETWORK_ERROR,details:D.INTERNAL_ABORTED,fatal:!1,frag:o,error:new Error("Aborted"),networkDetails:r,stats:e}))},onTimeout:(e,t,r)=>{this.resetLoader(o,s),n(new b({type:C.NETWORK_ERROR,details:D.FRAG_LOAD_TIMEOUT,fatal:!1,frag:o,error:new Error(`Timeout after ${i.timeout}ms`),networkDetails:r,stats:e}))},onProgress:(e,t,r,i)=>{l&&l({frag:o,part:null,payload:r,networkDetails:i})}})})}loadPart(l,h,u){this.abort();let t=this.config,r=t.fLoader,d=t.loader;return new Promise((s,o)=>{if(this.loader&&this.loader.destroy(),l.gap||h.gap)o(Jt(l,h));else{let n=this.loader=l.loader=new(r||d)(t),a=Xt(l,h),e=Pt(t.fragLoadPolicy.default),i={loadPolicy:e,timeout:e.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:qt};h.stats=n.stats,n.load(a,i,{onSuccess:(e,t,r,i)=>{this.resetLoader(l,n),this.updateStatsFromPart(l,h);e={frag:l,part:h,payload:e.data,networkDetails:i};u(e),s(e)},onError:(e,t,r,i)=>{this.resetLoader(l,n),o(new b({type:C.NETWORK_ERROR,details:D.FRAG_LOAD_ERROR,fatal:!1,frag:l,part:h,response:m({url:a.url,data:void 0},e),error:new Error(`HTTP Error ${e.code} `+e.text),networkDetails:r,stats:i}))},onAbort:(e,t,r)=>{l.stats.aborted=h.stats.aborted,this.resetLoader(l,n),o(new b({type:C.NETWORK_ERROR,details:D.INTERNAL_ABORTED,fatal:!1,frag:l,part:h,error:new Error("Aborted"),networkDetails:r,stats:e}))},onTimeout:(e,t,r)=>{this.resetLoader(l,n),o(new b({type:C.NETWORK_ERROR,details:D.FRAG_LOAD_TIMEOUT,fatal:!1,frag:l,part:h,error:new Error(`Timeout after ${i.timeout}ms`),networkDetails:r,stats:e}))}})}})}updateStatsFromPart(i,n){let a=i.stats,e=n.stats,s=e.total;if(a.loaded+=e.loaded,s){let e=Math.round(i.duration/n.duration),t=Math.min(Math.round(a.loaded/s),e),r=(e-t)*Math.round(a.loaded/t);a.total=a.loaded+r}else a.total=Math.max(a.loaded,a.total);let t=a.loading,r=e.loading;t.start?t.first+=r.first-r.start:(t.start=r.start,t.first=r.first),t.end=r.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Xt(i,n=null){var a=n||i,n={frag:i,part:n,responseType:"arraybuffer",url:a.url,headers:{},rangeStart:0,rangeEnd:0},s=a.byteRangeStartOffset,a=a.byteRangeEndOffset;if(M(s)&&M(a)){let e,t=s,r=a;if("initSegment"===i.sn&&"AES-128"===(null==(e=i.decryptdata)?void 0:e.method)){let e=a-s;e%16&&(r=a+(16-e%16)),0!==s&&(n.resetIV=!0,t=s-16)}n.rangeStart=t,n.rangeEnd=r}return n}function Jt(e,t){var r=new Error(`GAP ${e.gap?"tag":"attribute"} found`),r={type:C.MEDIA_ERROR,details:D.FRAG_GAP,fatal:!1,frag:e,error:r,networkDetails:null};return t&&(r.part=t),(t||e).stats.aborted=!0,new b(r)}class b extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Zt{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(var t in this.keyUriToKeyInfo){t=this.keyUriToKeyInfo[t].loader;if(t){if(e&&e!==t.context.frag.type)return;t.abort()}}}detach(){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){for(var e in this.detach(),this.keyUriToKeyInfo){e=this.keyUriToKeyInfo[e].loader;e&&e.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=D.KEY_LOAD_ERROR,r,i,n){return new b({type:C.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:n,error:r,networkDetails:i})}loadClear(e,r){if(this.emeController&&this.config.emeEnabled){var{sn:i,cc:n}=e;for(let e=0;e<r.length;e++){let t=r[e];if(n<=t.cc&&("initSegment"===i||"initSegment"===t.sn||i<t.sn)){this.emeController.selectKeySystemFormat(t).then(e=>{t.setKeyFormat(e)});break}}}}load(t){return!t.decryptdata&&t.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(t).then(e=>this.loadInternal(t,e)):this.loadInternal(t)}loadInternal(t,r){r&&t.setKeyFormat(r);let i=t.decryptdata;if(!i){let e=new Error(r?"Expected frag.decryptdata to be defined after setting format "+r:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(t,D.KEY_LOAD_ERROR,e))}var e,r=i.uri;if(!r)return Promise.reject(this.createKeyLoadError(t,D.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${r}"`)));let n=this.keyUriToKeyInfo[r];if(null!=(e=n)&&e.decryptdata.key)return i.key=n.decryptdata.key,Promise.resolve({frag:t,keyInfo:n});if(null!=(e=n)&&e.keyLoadPromise)switch(null==(e=n.mediaKeySessionContext)?void 0:e.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return n.keyLoadPromise.then(e=>(i.key=e.keyInfo.decryptdata.key,{frag:t,keyInfo:n}))}switch(n=this.keyUriToKeyInfo[r]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===i.keyFormat?this.loadKeyHTTP(n,t):this.loadKeyEME(n,t);case"AES-128":return this.loadKeyHTTP(n,t);default:return Promise.reject(this.createKeyLoadError(t,D.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(t,e){let r={frag:e,keyInfo:t};if(this.emeController&&this.config.emeEnabled){let e=this.emeController.loadKey(r);if(e)return(t.keyLoadPromise=e.then(e=>(t.mediaKeySessionContext=e,r))).catch(e=>{throw t.keyLoadPromise=null,e})}return Promise.resolve(r)}loadKeyHTTP(i,a){let l=this.config,h=new l.loader(l);return a.keyLoader=i.loader=h,i.keyLoadPromise=new Promise((s,o)=>{let n={keyInfo:i,frag:a,responseType:"arraybuffer",url:i.decryptdata.uri},e=l.keyLoadPolicy.default,t={loadPolicy:e,timeout:e.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},r={onSuccess:(e,t,r,i)=>{var{frag:r,keyInfo:n,url:a}=r;if(!r.decryptdata||n!==this.keyUriToKeyInfo[a])return o(this.createKeyLoadError(r,D.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),i));n.decryptdata.key=r.decryptdata.key=new Uint8Array(e.data),r.keyLoader=null,n.loader=null,s({frag:r,keyInfo:n})},onError:(e,t,r,i)=>{this.resetLoader(t),o(this.createKeyLoadError(a,D.KEY_LOAD_ERROR,new Error(`HTTP Error ${e.code} loading key `+e.text),r,m({url:n.url,data:void 0},e)))},onTimeout:(e,t,r)=>{this.resetLoader(t),o(this.createKeyLoadError(a,D.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),r))},onAbort:(e,t,r)=>{this.resetLoader(t),o(this.createKeyLoadError(a,D.INTERNAL_ABORTED,new Error("key loading aborted"),r))}};h.load(n,t,r)})}resetLoader(e){var{frag:e,keyInfo:t,url:r}=e,i=t.loader;e.keyLoader===i&&(e.keyLoader=null,t.loader=null),delete this.keyUriToKeyInfo[r],i&&i.destroy()}}let Qt={length:0,start:()=>0,end:()=>0};class O{static isBuffered(e,t){try{if(e){var r=O.getBuffered(e);for(let e=0;e<r.length;e++)if(t>=r.start(e)&&t<=r.end(e))return!0}}catch(e){}return!1}static bufferInfo(t,r,i){try{if(t){var n=O.getBuffered(t),a=[];let e;for(e=0;e<n.length;e++)a.push({start:n.start(e),end:n.end(e)});return this.bufferedInfo(a,r,i)}}catch(t){}return{len:0,start:r,end:r,nextStart:void 0}}static bufferedInfo(i,t,n){t=Math.max(0,t),i.sort(function(e,t){return e.start-t.start||t.end-e.end});let a=[];if(n)for(let r=0;r<i.length;r++){let t=a.length;if(t){let e=a[t-1].end;i[r].start-e<n?i[r].end>e&&(a[t-1].end=i[r].end):a.push(i[r])}else a.push(i[r])}else a=i;let r,s=0,o=t,l=t;for(let e=0;e<a.length;e++){var h=a[e].start,u=a[e].end;if(h<=t+n&&t<u)o=h,l=u,s=l-t;else if(t+n<h){r=h;break}}return{len:s,start:o||0,end:l||0,nextStart:r}}static getBuffered(e){try{return e.buffered}catch(e){return I.log("failed to get media.buffered",e),Qt}}}class er{constructor(e,t,r,i=0,n=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=r,this.size=i,this.part=n,this.partial=a}}function tr(r,i){let n=null;for(let e=0,t=r.length;e<t;e++){var a=r[e];if(a&&a.cc===i){n=a;break}}return n}function rr(e,t){e&&(t=e.start+t,e.start=e.startPTS=t,e.endPTS=t+e.duration)}function ir(r,e){var i=e.fragments;for(let e=0,t=i.length;e<t;e++)rr(i[e],r);e.fragmentHint&&rr(e.fragmentHint,r),e.alignedSliding=!0}function nr(e,t){var r,i,n;e.hasProgramDateTime&&t.hasProgramDateTime&&(r=e.fragments,t=t.fragments,r.length)&&t.length&&(r=tr(r,(t=t[Math.round(t.length/2)-1]).cc)||r[Math.round(r.length/2)-1],i=t.programDateTime,n=r.programDateTime,null!==i)&&null!==n&&ir((n-i)/1e3-(r.start-t.start),e)}class ar{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class sr{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}class or{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){var t=new DataView(e),r=new Uint32Array(4);for(let e=0;e<4;e++)r[e]=t.getUint32(4*e);return r}initTable(){let i=this.sBox,n=this.invSBox,e=this.subMix,a=e[0],s=e[1],o=e[2],l=e[3],t=this.invSubMix,h=t[0],u=t[1],d=t[2],c=t[3],f=new Uint32Array(256),p=0,m=0,r=0;for(r=0;r<256;r++)f[r]=r<128?r<<1:r<<1^283;for(r=0;r<256;r++){var g=(g=m^m<<1^m<<2^m<<3^m<<4)>>>8^255&g^99;i[p]=g,n[g]=p;let e=f[p],t=f[e],r=f[t];var v=257*f[g]^16843008*g;a[p]=v<<24|v>>>8,s[p]=v<<16|v>>>16,o[p]=v<<8|v>>>24,l[p]=v,v=16843009*r^65537*t^257*e^16843008*p,h[g]=v<<24|v>>>8,u[g]=v<<16|v>>>16,d[g]=v<<8|v>>>24,c[g]=v,p?(p=e^f[f[f[r^e]]],m^=f[f[m]]):p=m=1}}expandKey(n){var a=this.uint8ArrayToUint32Array_(n);let e=!0,t=0;for(;t<a.length&&e;)e=a[t]===this.key[t],t++;if(!e){this.key=a;var s=this.keySize=a.length;if(4!==s&&6!==s&&8!==s)throw new Error("Invalid aes key size="+s);var o=this.ksRows=4*(s+6+1);let e,t;var l=this.keySchedule=new Uint32Array(o),h=this.invKeySchedule=new Uint32Array(o),u=this.sBox,d=this.rcon,n=this.invSubMix,c=n[0],f=n[1],p=n[2],m=n[3];let r,i;for(e=0;e<o;e++)e<s?r=l[e]=a[e]:(i=r,e%s==0?(i=u[(i=i<<8|i>>>24)>>>24]<<24|u[i>>>16&255]<<16|u[i>>>8&255]<<8|u[255&i],i^=d[e/s|0]<<24):6<s&&e%s==4&&(i=u[i>>>24]<<24|u[i>>>16&255]<<16|u[i>>>8&255]<<8|u[255&i]),l[e]=r=(l[e-s]^i)>>>0);for(t=0;t<o;t++)e=o-t,i=3&t?l[e]:l[e-4],h[t]=t<4||e<=4?i:c[u[i>>>24]]^f[u[i>>>16&255]]^p[u[i>>>8&255]]^m[u[255&i]],h[t]=h[t]>>>0}}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,r){var i=this.keySize+6,n=this.invKeySchedule,a=this.invSBox,s=this.invSubMix,o=s[0],l=s[1],h=s[2],u=s[3],s=this.uint8ArrayToUint32Array_(r);let d=s[0],c=s[1],f=s[2],p=s[3];var m=new Int32Array(e),g=new Int32Array(m.length);let v,y,x,b,_,T,S,w,E,M,A,L,R,C;for(var D=this.networkToHostOrderSwap;t<m.length;){for(E=D(m[t]),M=D(m[t+1]),A=D(m[t+2]),L=D(m[t+3]),_=E^n[0],T=L^n[1],S=A^n[2],w=M^n[3],R=4,C=1;C<i;C++)v=o[_>>>24]^l[T>>16&255]^h[S>>8&255]^u[255&w]^n[R],y=o[T>>>24]^l[S>>16&255]^h[w>>8&255]^u[255&_]^n[R+1],x=o[S>>>24]^l[w>>16&255]^h[_>>8&255]^u[255&T]^n[R+2],b=o[w>>>24]^l[_>>16&255]^h[T>>8&255]^u[255&S]^n[R+3],_=v,T=y,S=x,w=b,R+=4;v=a[_>>>24]<<24^a[T>>16&255]<<16^a[S>>8&255]<<8^a[255&w]^n[R],y=a[T>>>24]<<24^a[S>>16&255]<<16^a[w>>8&255]<<8^a[255&_]^n[R+1],x=a[S>>>24]<<24^a[w>>16&255]<<16^a[_>>8&255]<<8^a[255&T]^n[R+2],b=a[w>>>24]<<24^a[_>>16&255]<<16^a[T>>8&255]<<8^a[255&S]^n[R+3],g[t]=D(v^d),g[t+1]=D(b^c),g[t+2]=D(x^f),g[t+3]=D(y^p),d=E,c=M,f=A,p=L,t+=4}return g.buffer}}class lr{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t)try{let e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(e){}null===this.subtle&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){var e,t,{currentResult:r,remainderData:i}=this;return!r||i?(this.reset(),null):(i=new Uint8Array(r),this.reset(),this.removePKCS7Padding?(e=(r=i).byteLength,(t=e&&new DataView(r.buffer).getUint8(e-1))?fe(r,0,e-t):r):i)}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(i,n,a){return this.useSoftware?new Promise((e,t)=>{this.softwareDecrypt(new Uint8Array(i),n,a);var r=this.flush();r?e(r.buffer):t(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(i),n,a)}softwareDecrypt(e,t,r){var{currentIV:i,currentResult:n,remainderData:a}=this,a=(this.logOnce("JS AES decrypt"),a&&(e=Ie(a,e),this.remainderData=null),this.getValidChunk(e));if(!a.length)return null;i&&(r=i);let s=this.softwareDecrypter;(s=s||(this.softwareDecrypter=new or)).expandKey(t);e=n;return this.currentResult=s.decrypt(a.buffer,0,r),this.currentIV=fe(a,-16).buffer,e||null}webCryptoDecrypt(t,r,i){let n=this.subtle;return this.key===r&&this.fastAesKey||(this.key=r,this.fastAesKey=new sr(n,r)),this.fastAesKey.expandKey().then(e=>n?(this.logOnce("WebCrypto AES decrypt"),new ar(n,new Uint8Array(i)).decrypt(t.buffer,e)):Promise.reject(new Error("web crypto not initialized"))).catch(e=>(I.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${e.name}: `+e.message),this.onWebCryptoError(t,r,i)))}onWebCryptoError(e,t,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r);e=this.flush();if(e)return e.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;var r=e.length-e.length%16;return r!==e.length&&(t=fe(e,0,r),this.remainderData=fe(e,r)),t}logOnce(e){this.logEnabled&&(I.log("[decrypter]: "+e),this.logEnabled=!1)}}let s="STOPPED",u="IDLE",hr="KEY_LOADING",ur="FRAG_LOADING",dr="FRAG_LOADING_WAITING_RETRY",cr="WAITING_TRACK",F="PARSING",fr="PARSED",pr="ENDED",mr="ERROR",gr="WAITING_INIT_PTS",vr="WAITING_LEVEL";class yr extends class{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),!(this._tickInterval=null))}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),!(this._tickTimer=null))}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),1<this._tickCallCount&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}{constructor(e,t,r,i,n){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=s,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=n,this.logPrefix=i,this.log=I.log.bind(I,i+":"),this.warn=I.warn.bind(I,i+":"),this.hls=e,this.fragmentLoader=new Kt(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new lr(e.config),e.on(R.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=s}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;var r=t.partList;if(null!=r&&r.length){let e=r[r.length-1];return O.isBuffered(this.media,e.start+e.duration/2)}e=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(e)}getLevelDetails(){var e;return!this.levels||null===this.levelLastLoaded||null==(e=this.levels[this.levelLastLoaded])?void 0:e.details}onMediaAttached(e,t){t=this.media=this.mediaBuffer=t.media,this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended),t=this.config;this.levels&&t.autoStartLoad&&this.state===s&&this.startLoad(t.startPosition)}onMediaDetaching(){var e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){let{config:i,fragCurrent:n,media:e,mediaBuffer:t,state:r}=this,a=e?e.currentTime:0,s=O.bufferInfo(t||e,a,i.maxBufferHole);if(this.log(`media seeking to ${M(a)?a.toFixed(3):a}, state: `+r),this.state===pr)this.resetLoadingState();else if(n){let e=i.maxFragLookUpTolerance,t=n.start-e,r=n.start+n.duration+e;if(!s.len||r<s.start||t>s.end){let e=a>r;(a<t||e)&&(e&&n.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),n.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}e&&(this.fragmentTracker.removeFragmentsInRange(a,1/0,this.playlistType,!0),this.lastCurrentTime=a),this.loadedmetadata||s.len||(this.nextLoadPosition=this.startPosition=a),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.stopLoad(),super.onHandlerDestroying()}onHandlerDestroyed(){this.state=s,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(r,e,t){this._doFragLoad(r,e,t,e=>{this.fragContextChanged(r)?(this.warn(`Fragment ${r.sn}${e.part?" p: "+e.part.index:""} of level ${r.level} was dropped during download.`),this.fragmentTracker.removeFragment(r)):(r.stats.chunkCount++,this._handleFragmentLoadProgress(e))}).then(e=>{var t;e&&(t=this.state,this.fragContextChanged(r)?t!==ur&&(this.fragCurrent||t!==F)||(this.fragmentTracker.removeFragment(r),this.state=u):("payload"in e&&(this.log(`Loaded fragment ${r.sn} of level `+r.level),this.hls.trigger(R.FRAG_LOADED,e)),this._handleFragmentLoadComplete(e)))}).catch(e=>{this.state!==s&&this.state!==mr&&(this.warn(e),this.resetFragmentLoading(r))})}clearTrackerIfNeeded(i){var e,n=this["fragmentTracker"];if("APPENDING"===n.getState(i)){let e=i.type,t=this.getFwdBufferInfo(this.mediaBuffer,e),r=Math.max(i.duration,t?t.len:this.config.maxBufferLength);this.reduceMaxBufferLength(r)&&n.removeFragment(i)}else 0===(null==(e=this.mediaBuffer)?void 0:e.buffered.length)?n.removeAllFragments():n.hasParts(i.type)&&(n.detectPartialFragments({frag:i,part:null,stats:i.stats,id:i.type}),n.getState(i)===Wt)&&n.removeFragment(i)}checkLiveUpdate(e){var t;e.updated&&!e.live&&(t=e.fragments[e.fragments.length-1],this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})),e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,t,r=null){e-t&&(e={startOffset:e,endOffset:t,type:r},this.hls.trigger(R.BUFFER_FLUSHING,e))}_loadInitSegment(a,n){this._doFragLoad(a,n).then(e=>{if(e&&!this.fragContextChanged(a)&&this.levels)return e;throw new Error("init load aborted")}).then(i=>{let n=this["hls"],e=i["payload"],t=a.decryptdata;if(e&&0<e.byteLength&&t&&t.key&&t.iv&&"AES-128"===t.method){let r=self.performance.now();return this.decrypter.decrypt(new Uint8Array(e),t.key.buffer,t.iv.buffer).catch(e=>{throw n.trigger(R.ERROR,{type:C.MEDIA_ERROR,details:D.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:a}),e}).then(e=>{var t=self.performance.now();return n.trigger(R.FRAG_DECRYPTED,{frag:a,payload:e,stats:{tstart:r,tdecrypt:t}}),i.payload=e,i})}return i}).then(e=>{var{fragCurrent:t,hls:r,levels:i}=this;if(!i)throw new Error("init load aborted, missing levels");i=a.stats;this.state=u,n.fragmentError=0,a.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),e.frag===t&&r.trigger(R.FRAG_BUFFERED,{stats:i,frag:t,part:null,id:a.type}),this.tick()}).catch(e=>{this.state!==s&&this.state!==mr&&(this.warn(e),this.resetFragmentLoading(a))})}fragContextChanged(e){var t=this["fragCurrent"];return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId}fragBufferedComplete(e,t){var r=this.mediaBuffer||this.media;this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===x?"level":"track"} ${e.level} (frag:[${(null!=(t=e.startPTS)?t:NaN).toFixed(3)}-${(null!=(t=e.endPTS)?t:NaN).toFixed(3)}] > buffer:${r?function(t){let r="";var i=t.length;for(let e=0;e<i;e++)r+=`[${t.start(e).toFixed(3)}-${t.end(e).toFixed(3)}]`;return r}(O.getBuffered(r)):"(detached)"})`),this.state=u,r&&(!this.loadedmetadata&&e.type==x&&r.buffered.length&&(null==(t=this.fragCurrent)?void 0:t.sn)===(null==(e=this.fragPrevious)?void 0:e.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){var t,r,i=this["transmuxer"];i&&({frag:e,part:t,partsLoaded:r}=e,r=!r||0===r.length||r.some(e=>!e),e=new er(e.level,e.sn,e.stats.chunkCount+1,0,t?t.index:-1,!r),i.flush(e))}_handleFragmentLoadProgress(e){}_doFragLoad(i,n,a=null,s){var e,o,l=null==n?void 0:n.details;if(!this.levels||!l)throw new Error(`frag load aborted, missing level${l?"":" detail"}s`);let h=null;if(!i.encrypted||null!=(e=i.decryptdata)&&e.key?!i.encrypted&&l.encryptedFragments.length&&this.keyLoader.loadClear(i,l.encryptedFragments):(this.log(`Loading key for ${i.sn} of [${l.startSN}-${l.endSN}], ${"[stream-controller]"===this.logPrefix?"level":"track"} `+i.level),this.state=hr,this.fragCurrent=i,h=this.keyLoader.load(i).then(e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(R.KEY_LOADED,e),this.state===hr&&(this.state=u),e}),this.hls.trigger(R.KEY_LOADING,{frag:i}),null===this.fragCurrent&&(h=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),a=Math.max(i.start,a||0),this.config.lowLatencyMode&&"initSegment"!==i.sn){let r=l.partList;if(r&&s){a>i.end&&l.fragmentHint&&(i=l.fragmentHint);let e=this.getNextPart(r,i,a);if(-1<e){let t=r[e];return this.log(`Loading part sn: ${i.sn} p: ${t.index} cc: ${i.cc} of playlist [${l.startSN}-${l.endSN}] parts [0-${e}-${r.length-1}] ${"[stream-controller]"===this.logPrefix?"level":"track"}: ${i.level}, target: `+parseFloat(a.toFixed(3))),this.nextLoadPosition=t.start+t.duration,this.state=ur,o=h?h.then(e=>!e||this.fragContextChanged(e.frag)?null:this.doFragPartsLoad(i,t,n,s)).catch(e=>this.handleFragLoadError(e)):this.doFragPartsLoad(i,t,n,s).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(R.FRAG_LOADING,{frag:i,part:t,targetBufferTime:a}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):o}if(!i.url||this.loadedEndOfParts(r,a))return Promise.resolve(null)}}this.log(`Loading fragment ${i.sn} cc: ${i.cc} ${l?"of ["+l.startSN+"-"+l.endSN+"] ":""}${"[stream-controller]"===this.logPrefix?"level":"track"}: ${i.level}, target: `+parseFloat(a.toFixed(3))),M(i.sn)&&!this.bitrateTest&&(this.nextLoadPosition=i.start+i.duration),this.state=ur;let t=this.config.progressive,r;return r=t&&h?h.then(e=>!e||this.fragContextChanged(null==e?void 0:e.frag)?null:this.fragmentLoader.load(i,s)).catch(e=>this.handleFragLoadError(e)):Promise.all([this.fragmentLoader.load(i,t?s:void 0),h]).then(([e])=>(!t&&e&&s&&s(e),e)).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(R.FRAG_LOADING,{frag:i,targetBufferTime:a}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):r}doFragPartsLoad(o,r,l,h){return new Promise((i,e)=>{let t,n=[],a=null==(t=l.details)?void 0:t.partList,s=r=>{this.fragmentLoader.loadPart(o,r,h).then(e=>{var t=(n[r.index]=e).part,e=(this.hls.trigger(R.FRAG_LOADED,e),Lt(l,o.sn,r.index+1)||Rt(a,o.sn,r.index+1));if(!e)return i({frag:o,part:t,partsLoaded:n});s(e)}).catch(e)};s(r)})}handleFragLoadError(e){var t;return"data"in e?(t=e.data,e.data&&t.details===D.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(R.ERROR,t)):this.hls.trigger(R.ERROR,{type:C.OTHER_ERROR,details:D.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0}),null}_handleTransmuxerFlush(e){var t,r,i,n=this.getCurrentContext(e);n&&this.state===F?({frag:n,part:t,level:r}=n,i=self.performance.now(),n.stats.parsing.end=i,t&&(t.stats.parsing.end=i),this.updateLevelTiming(n,t,r,e.partial)):this.fragCurrent||this.state===s||this.state===mr||(this.state=u)}getCurrentContext(e){var{levels:t,fragCurrent:r}=this,{level:e,sn:i,part:n}=e;if(null==t||!t[e])return this.warn(`Levels object was unset while buffering fragment ${i} of level ${e}. The current chunk will not be buffered.`),null;let a=t[e],s=-1<n?Lt(a,i,n):null,o=s?s.fragment:null!=a&&a.details?(t=a.details).fragments[i-t.startSN]||((e=t.fragmentHint)&&e.sn===i?e:i<t.startSN&&r&&r.sn===i?r:null):null;return o?(r&&r!==o&&(o.stats=r.stats),{frag:o,part:s,level:a}):null}bufferFragmentData(t,r,i,n,a){if(t&&this.state===F){var{data1:s,data2:o}=t;let e=s;null!=(s=e=s&&o?Ie(s,o):e)&&s.length&&(o={type:t.type,frag:r,part:i,chunkMeta:n,parent:r.type,data:e},this.hls.trigger(R.BUFFER_APPENDING,o),t.dropped)&&t.independent&&!i&&!a&&this.flushBufferGap(r)}}flushBufferGap(e){var t,r,i=this.media;i&&(O.isBuffered(i,i.currentTime)?(t=i.currentTime,i=O.bufferInfo(i,t,0),r=e.duration,r=Math.min(2*this.config.maxFragLookUpTolerance,.25*r),i=Math.max(Math.min(e.start-r,i.end-r),t+r),e.start-i>r&&this.flushMainBuffer(i,e.start)):this.flushMainBuffer(0,e.start))}getFwdBufferInfo(e,t){var r=this.getLoadPosition();return M(r)?this.getFwdBufferInfoAtPos(e,r,t):null}getFwdBufferInfoAtPos(e,t,r){var i=this["config"]["maxBufferHole"],n=O.bufferInfo(e,t,i);if(0===n.len&&void 0!==n.nextStart){r=this.fragmentTracker.getBufferedFrag(t,r);if(r&&n.nextStart<r.end)return O.bufferInfo(e,t,Math.max(n.nextStart,i))}return n}getMaxBufferLength(e){var t=this["config"],e=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength;return Math.min(e,t.maxMaxBufferLength)}reduceMaxBufferLength(e){var t=this.config,e=e||t.maxBufferLength;return t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${t.maxMaxBufferLength}s`),!0)}getAppendedFrag(e,t=0){e=this.fragmentTracker.getAppendedFrag(e,x);return e&&"fragment"in e?e.fragment:e}getNextFragment(t,r){let i=r.fragments,n=i.length;if(!n)return null;let a=this["config"],e=i[0].start,s;if(r.live){let e=a.initialLiveManifestSize;if(n<e)return this.warn(`Not enough fragments to start playback (have: ${n}, need: ${e})`),null;r.PTSKnown||this.startFragRequested||-1!==this.startPosition||(s=this.getInitialLiveFragment(r,i),this.startPosition=s?this.hls.liveSyncPosition||s.start:t)}else t<=e&&(s=i[0]);if(!s){let e=a.lowLatencyMode?r.partEnd:r.fragmentEnd;s=this.getFragmentAtPosition(t,e,r)}return this.mapToInitFragWhenRequired(s)}isLoopLoading(e,t){var r=this.fragmentTracker.getState(e);return("OK"===r||r===Wt&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(t,e,r,i,n){var a=t.gap,e=this.getNextFragment(this.nextLoadPosition,e);if(null===e)return e;if(t=e,a&&t&&!t.gap&&r.nextStart){let e=this.getFwdBufferInfoAtPos(this.mediaBuffer||this.media,r.nextStart,i);if(null!==e&&r.len+e.len>=n)return this.log(`buffer full after gaps in "${i}" playlist starting at sn: `+t.sn),null}return t}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(r,i,n){let a=-1,s=!1,o=!0;for(let e=0,t=r.length;e<t;e++){var l=r[e];if(o=o&&!l.independent,-1<a&&n<l.start)break;var h=l.loaded;h?a=-1:(s||l.independent||o)&&l.fragment===i&&(a=e),s=h}return a}loadedEndOfParts(e,t){e=e[e.length-1];return e&&t>e.start&&e.loaded}getInitialLiveFragment(t,e){var r,i,n=this.fragPrevious;let a=null;if(n)t.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+n.programDateTime),a=function(t,r,i){if(null!==r&&Array.isArray(t)&&t.length&&M(r)&&!(r<(t[0].programDateTime||0)||r>=(t[t.length-1].endProgramDateTime||0))){i=i||0;for(let e=0;e<t.length;++e){var n=t[e];if(a=r,s=i,o=n,s=1e3*Math.min(i,o.duration+(o.deltaPTS||0)),(o.endProgramDateTime||0)-s>a)return n}var a,s,o}return null}(e,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),a||((r=n.sn+1)>=t.startSN&&r<=t.endSN&&(r=e[r-t.startSN],n.cc===r.cc)&&(a=r,this.log("Live playlist, switching playlist, load frag with next SN: "+a.sn)),a)||(a=(r=e,i=n.cc,Ot(r,e=>e.cc<i?1:e.cc>i?-1:0)))&&this.log("Live playlist, switching playlist, load frag with same CC: "+a.sn);else{let e=this.hls.liveSyncPosition;null!==e&&(a=this.getFragmentAtPosition(e,this.bitrateTest?t.fragmentEnd:t.edge,t))}return a}getFragmentAtPosition(e,t,r){var i=this["config"];let n=this["fragPrevious"],{fragments:a,endSN:s}=r;var o=r["fragmentHint"],l=i.maxFragLookUpTolerance,h=r.partList,i=!!(i.lowLatencyMode&&null!=h&&h.length&&o);let u;if(i&&o&&!this.bitrateTest&&(a=a.concat(o),s=o.sn),u=e<t?Ft(n,a,e,t-l<e?0:l):a[a.length-1]){let t=u.sn-r.startSN,e=this.fragmentTracker.getState(u);if((n="OK"===e||e===Wt&&u.gap?u:n)&&u.sn===n.sn&&(!i||h[0].fragment.sn>u.sn)&&n&&u.level===n.level){let e=a[1+t];u=u.sn<s&&"OK"!==this.fragmentTracker.getState(e)?e:null}}return u}synchronizeToLiveEdge(a){var{config:s,media:o}=this;if(o){let t=this.hls.liveSyncPosition,r=o.currentTime,e=a.fragments[0].start,i=a.edge,n=r>=e-s.maxFragLookUpTolerance&&r<=i;if(null!==t&&o.duration>t&&(r<t||!n)){let e=void 0!==s.liveMaxLatencyDuration?s.liveMaxLatencyDuration:s.liveMaxLatencyDurationCount*a.targetduration;(!n&&o.readyState<4||r<i-e)&&(this.loadedmetadata||(this.nextLoadPosition=t),o.readyState)&&(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${i}, reset currentTime to : `+t.toFixed(3)),o.currentTime=t)}}}alignPlaylists(t,r){let{levels:e,levelLastLoaded:i,fragPrevious:n}=this,a=null!==i?e[i]:null,s=t.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;var o=t.fragments[0].start,l=!r,h=t.alignedSliding&&M(o);if(l||!h&&!o){var u,l=n,h=a,d=t;if(h){var c=l,f=(l=d,h);if(f.details&&(l.endCC>l.startCC||c&&c.cc<l.startCC)){f=f.details.fragments;let e=(u=l.fragments).length&&f.length?(f=tr(f,u[0].cc))&&f.startPTS?f:void I.log("No frag in previous level to align on"):void I.log("No fragments to align");e&&M(e.start)&&(I.log("Adjusting PTS using last level due to CC increase within current level "+l.url),ir(e.start,l))}!d.alignedSliding&&h.details&&(c=d,(u=h.details).fragments.length)&&c.hasProgramDateTime&&u.hasProgramDateTime&&(f=u.fragments[0].programDateTime,u=((l=c.fragments[0].programDateTime)-f)/1e3+u.fragments[0].start)&&M(u)&&(I.log(`Adjusting PTS using programDateTime delta ${l-f}ms, sliding:${u.toFixed(3)} ${c.url} `),ir(u,c)),d.alignedSliding||!h.details||d.skippedSegments||Mt(h.details,d)}let e=t.fragments[0].start;return this.log(`Live playlist sliding: ${e.toFixed(2)} start-sn: ${r?r.startSN:"na"}->${t.startSN} prev-sn: ${n?n.sn:"na"} fragments: `+s),e}return o}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let r=this.startPosition;var i,n;-1!==(r=r<t?-1:r)&&-1!==this.lastCurrentTime||(null!==(n=((i=null!==this.startTimeOffset)?this:e).startTimeOffset)&&M(n)?(r=t+n,n<0&&(r+=e.totalduration),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Start time offset ${n} found in ${i?"multivariant":"media"} playlist, adjust startPosition to `+r),this.startPosition=r):e.live?r=this.hls.liveSyncPosition||t:this.startPosition=r=0,this.lastCurrentTime=r),this.nextLoadPosition=r}getLoadPosition(){var e=this["media"];let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===dr)||(this.state=u)}onFragmentOrKeyLoadError(t,r){if(r.chunkMeta&&!r.frag){let e=this.getCurrentContext(r.chunkMeta);e&&(r.frag=e.frag)}var i=r.frag;if(i&&i.type===t&&this.levels)if(this.fragContextChanged(i))this.warn(`Frag load error must match current frag to retry ${i.url} > `+(null==(e=this.fragCurrent)?void 0:e.url));else{var e=r.details===D.FRAG_GAP,n=(e&&this.fragmentTracker.fragBuffered(i,!0),r.errorAction),{action:a,retryCount:s=0,retryConfig:o}=n||{};if(n&&5===a&&o){this.resetStartWhenNotLoaded(null!=(a=this.levelLastLoaded)?a:i.level);let e=It(o,s);this.warn(`Fragment ${i.sn} of ${t} ${i.level} errored with ${r.details}, retrying loading ${s+1}/${o.maxNumRetry} in ${e}ms`),n.resolved=!0,this.retryDate=self.performance.now()+e,this.state=dr}else o&&n?(this.resetFragmentErrors(t),s<o.maxNumRetry?e||(n.resolved=!0):I.warn(r.details+` reached or exceeded max retry (${s})`)):2===(null==n?void 0:n.action)?this.state=vr:this.state=mr;this.tickImmediate()}}reduceLengthAndFlushBuffer(e){var t,r,i;return(this.state===F||this.state===fr)&&(t=e.parent,(r=(i=this.getFwdBufferInfo(this.mediaBuffer,t))&&.5<i.len)&&this.reduceMaxBufferLength(i.len),(i=!r)&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${t} buffer`),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),i)}resetFragmentErrors(e){e===_&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==s&&(this.state=u)}afterBufferFlushed(e,t,r){e&&(e=O.getBuffered(e),this.fragmentTracker.detectEvictedFragments(t,e,r),this.state===pr)&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=u}resetStartWhenNotLoaded(e){this.loadedmetadata||(this.startFragRequested=!1,null!=(e=this.levels?this.levels[e].details:null)&&e.live?(this.startPosition=-1,this.setStartPosition(e,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition)}resetWhenMissingContext(e){var t;this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(null!=(t=this.levelLastLoaded)?t:e.level),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(n,e,a,s){let t,o=a.details;if(o){if(Object.keys(n.elementaryStreams).reduce((e,t)=>{var r,i=n.elementaryStreams[t];return i?(r=i.endPTS-i.startPTS)<=0?(this.warn(`Could not parse fragment ${n.sn} ${t} duration reliably (${r})`),e||!1):(r=s?0:wt(o,n,i.startPTS,i.endPTS,i.startDTS,i.endDTS),this.hls.trigger(R.LEVEL_PTS_UPDATED,{details:o,level:a,drift:r,type:t,frag:n,start:i.startPTS,end:i.endPTS}),!0):e},!1))a.fragmentError=0;else if(null===(null==(t=this.transmuxer)?void 0:t.error)){let e=new Error(`Found no media in fragment ${n.sn} of level ${n.level} resetting transmuxer to fallback to playlist timing`);if(0===a.fragmentError&&(a.fragmentError++,n.gap=!0,this.fragmentTracker.removeFragment(n),this.fragmentTracker.fragBuffered(n,!0)),this.warn(e.message),this.hls.trigger(R.ERROR,{type:C.MEDIA_ERROR,details:D.FRAG_PARSING_ERROR,fatal:!1,error:e,frag:n,reason:`Found no media in msn ${n.sn} of level "${a.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=fr,this.hls.trigger(R.FRAG_PARSED,{frag:n,part:e})}else this.warn("level.details undefined")}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(null!=(e=null!=(e=this.levelLastLoaded)?e:null==(e=this.fragCurrent)?void 0:e.level)?e:0),this.resetLoadingState())}set state(e){var t=this._state;t!==e&&(this._state=e,this.log(t+"->"+e))}get state(){return this._state}}function xr(){return self.SourceBuffer||self.WebKitSourceBuffer}function d(e="",t=9e4){return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class br{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(t,e){this.cachedData&&(t=Ie(this.cachedData,t),this.cachedData=null);let r,i=ge(t,0),n=i?i.length:0;var a,s,o=this._audioTrack,l=this._id3Track,h=i?(e=>{var t=xe(e);for(let e=0;e<t.length;e++){var r=t[e];if(ye(r)){if(8===r.data.byteLength){var r=new Uint8Array(r.data),i=1&r[3];let e=(r[4]<<23)+(r[5]<<15)+(r[6]<<7)+r[7];return e/=45,i&&(e+=47721858.84),Math.round(e)}return}}})(i):void 0,u=t.length;for((null===this.basePTS||0===this.frameIndex&&M(h))&&(this.basePTS=_r(h,e,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),i&&0<i.length&&l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:ft,duration:Number.POSITIVE_INFINITY});n<u;){if(this.canParse(t,n)){let e=this.appendFrame(o,t,n);e?(this.frameIndex++,this.lastPTS=e.sample.pts,n+=e.length,r=n):n=u}else a=t,s=n,pe(a,s)&&ve(a,s+6)+10<=a.length-s?(i=ge(t,n),l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:ft,duration:Number.POSITIVE_INFINITY}),n+=i.length,r=n):n++;if(n===u&&r!==u){let e=fe(t,r);this.cachedData?this.cachedData=Ie(this.cachedData,e):this.cachedData=e}}return{audioTrack:o,videoTrack:d(),id3Track:l,textTrack:d()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:d(),id3Track:this._id3Track,textTrack:d()}}destroy(){}}let _r=(e,t,r)=>M(e)?90*e:9e4*t+(r?9e4*r.baseTime/r.timescale:0);function Tr(e,t){return 255===e[t]&&240==(246&e[t+1])}function Sr(e,t){return 1&e[t+1]?7:9}function wr(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function Er(e,t){return t+1<e.length&&Tr(e,t)}function Mr(e,t,r,i,n){e.samplerate||(t=function(e,t,r,i){let n,a,s,o;var l=navigator.userAgent.toLowerCase(),h=i,u=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],d=(n=1+((192&t[r+2])>>>6),(60&t[r+2])>>>2);if(!(u.length-1<d))return s=(1&t[r+2])<<2,s|=(192&t[r+3])>>>6,I.log(`manifest codec:${i}, ADTS type:${n}, samplingIndex:`+d),a=/firefox/i.test(l)?6<=d?(n=5,o=new Array(4),d-3):(n=2,o=new Array(2),d):-1!==l.indexOf("android")?(n=2,o=new Array(2),d):(n=5,o=new Array(4),i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&6<=d?d-3:((i&&-1!==i.indexOf("mp4a.40.2")&&(6<=d&&1==s||/vivaldi/i.test(l))||!i&&1==s)&&(n=2,o=new Array(2)),d)),o[0]=n<<3,o[0]|=(14&d)>>1,o[1]|=(1&d)<<7,o[1]|=s<<3,5===n&&(o[1]|=(14&a)>>1,o[2]=(1&a)<<7,o[2]|=8,o[3]=0),{config:o,samplerate:u[d],channelCount:s,codec:"mp4a.40."+n,manifestCodec:h};e.trigger(R.ERROR,{type:C.MEDIA_ERROR,details:D.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+d})}(t,r,i,n))&&(e.config=t.config,e.samplerate=t.samplerate,e.channelCount=t.channelCount,e.codec=t.codec,e.manifestCodec=t.manifestCodec,I.log(`parsed codec:${e.codec}, rate:${t.samplerate}, channels:`+t.channelCount))}function Ar(e){return 9216e4/e}function Lr(n,a,s,e,t){var o=e+t*Ar(n.samplerate),l=function(){var e=Sr(a,s);if(s+e<=a.length){var t=wr(a,s)-e;if(0<t)return{headerLength:e,frameLength:t}}}();let h;if(l){let{frameLength:e,headerLength:t}=l,r=t+e,i=Math.max(0,s+r-a.length);i?(h=new Uint8Array(r-t)).set(a.subarray(s+t,a.length),0):h=a.subarray(s+t,s+r);l={unit:h,pts:o};return i||n.samples.push(l),{sample:l,length:r,missing:i}}let r=a.length-s;return(h=new Uint8Array(r)).set(a.subarray(s,a.length),0),{sample:{unit:h,pts:o},length:r,missing:-1}}let Rr=/\/emsg[-/]ID3/i,Cr=null,Dr=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Ir=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Pr=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],kr=[0,1,1,4];function Or(e,t,r,i,n){var a;return!(r+24>t.length)&&(a=Fr(t,r))&&r+a.frameLength<=t.length?(i=i+n*(9e4*a.samplesPerFrame/a.sampleRate),n={unit:t.subarray(r,r+a.frameLength),pts:i,dts:i},e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(n),{sample:n,length:a.frameLength,missing:0}):void 0}function Fr(e,t){var r=e[t+1]>>3&3,i=e[t+1]>>1&3,n=e[t+2]>>4&15,a=e[t+2]>>2&3;if(1!=r&&0!=n&&15!=n&&3!=a){var s=e[t+2]>>1&1,o=e[t+3]>>6,n=1e3*Dr[14*(3==r?3-i:3==i?3:4)+n-1],a=Ir[3*(3==r?0:2==r?1:2)+a],l=3==o?1:2,r=Pr[r][i],h=kr[i],u=8*r*h,r=Math.floor(r*n/a+s)*h;if(null===Cr){let e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Cr=e?parseInt(e[1]):0}return Cr&&Cr<=87&&2==i&&224e3<=n&&0==o&&(e[t+3]=128|e[t+3]),{sampleRate:a,channelCount:l,frameLength:r,samplesPerFrame:u}}}function Nr(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])}function Br(e,t){return t+1<e.length&&Nr(e,t)}class Ur{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),t=Math.min(4,t);if(0===t)throw new Error("no bytes available");i.set(e.subarray(r,r+t)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*t,this.bytesAvailable-=t}skipBits(e){var t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e||(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord()),this.word<<=e,this.bitsAvailable-=e}readBits(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;if(32<e&&I.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,0<this.bitsAvailable)this.word<<=t;else{if(!(0<this.bytesAvailable))throw new Error("no bits available");this.loadWord()}return 0<(t=e-t)&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){var e=this.skipLZ();return this.readBits(e+1)-1}readEG(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(t){let r,i=8,n=8;for(let e=0;e<t;e++)0!==n&&(r=this.readEG(),n=(i+r+256)%256),i=0===n?i:n}readSPS(){let e,t,r,i=0,n=0,a=0,s=0;var o=this.readUByte.bind(this),l=this.readBits.bind(this),h=this.readUEG.bind(this),u=this.readBoolean.bind(this),d=this.skipBits.bind(this),c=this.skipEG.bind(this),f=this.skipUEG.bind(this),p=this.skipScalingList.bind(this),m=(o(),o());if(l(5),d(3),o(),f(),100===m||110===m||122===m||244===m||44===m||83===m||86===m||118===m||128===m){let e=h();if(3===e&&d(1),f(),f(),d(1),u())for(t=3!==e?8:12,r=0;r<t;r++)u()&&p(r<6?16:64)}f();m=h();if(0===m)h();else if(1===m)for(d(1),c(),c(),e=h(),r=0;r<e;r++)c();f(),d(1);m=h(),f=h(),l=l(1);0===l&&d(1),d(1),u()&&(i=h(),n=h(),a=h(),s=h());let g=[1,1];if(u()&&u())switch(o()){case 1:g=[1,1];break;case 2:g=[12,11];break;case 3:g=[10,11];break;case 4:g=[16,11];break;case 5:g=[40,33];break;case 6:g=[24,11];break;case 7:g=[20,11];break;case 8:g=[32,11];break;case 9:g=[80,33];break;case 10:g=[18,11];break;case 11:g=[15,11];break;case 12:g=[64,33];break;case 13:g=[160,99];break;case 14:g=[4,3];break;case 15:g=[3,2];break;case 16:g=[2,1];break;case 255:g=[o()<<8|o(),o()<<8|o()]}return{width:Math.ceil(16*(m+1)-2*i-2*n),height:(2-l)*(f+1)*16-(l?2:4)*(a+s),pixelRatio:g}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class Gr{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new lr(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(t,r,i){let n=t[r].unit;var e;n.length<=16||(e=(e=n.subarray(16,n.length-n.length%16)).buffer.slice(e.byteOffset,e.byteOffset+e.length),this.decryptBuffer(e).then(e=>{e=new Uint8Array(e);n.set(e,16),this.decrypter.isSync()||this.decryptAacSamples(t,r+1,i)}))}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32||(this.decryptAacSample(e,t,r),this.decrypter.isSync())))return}}getAvcEncryptedData(t){var e=16*Math.floor((t.length-48)/160)+16,r=new Int8Array(e);let i=0;for(let e=32;e<t.length-16;e+=160,i+=16)r.set(t.subarray(e,e+16),i);return r}getAvcDecryptedUnit(t,e){var r=new Uint8Array(e);let i=0;for(let e=32;e<t.length-16;e+=160,i+=16)t.set(r.subarray(i,i+16),e);return t}decryptAvcSample(t,r,i,n,a){let s=Oe(a.data),e=this.getAvcEncryptedData(s);this.decryptBuffer(e.buffer).then(e=>{a.data=this.getAvcDecryptedUnit(s,e),this.decrypter.isSync()||this.decryptAvcSamples(t,r,i+1,n)})}decryptAvcSamples(e,t,r,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length)return void i();for(var n=e[t].units;!(r>=n.length);r++){var a=n[r];if(!(a.data.length<=48||1!==a.type&&5!==a.type||(this.decryptAvcSample(e,t,r,i,a),this.decrypter.isSync())))return}}}}class zr{constructor(e,t,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=r}static probe(e){e=zr.syncOffset(e);return 0<e&&I.warn("MPEG2-TS detected but first sync word found @ offset "+e),-1!==e}static syncOffset(n){var a=n.length;let s=Math.min(940,n.length-188)+1,o=0;for(;o<s;){let t=!1,r=-1,i=0;for(let e=o;e<a;e+=188){if(71!==n[e]){if(i)return-1;break}if(i++,-1===r&&0!==(r=e)&&(s=Math.min(r+18612,n.length-188)+1),(t=t||0===Vr(n,e))&&1<i&&(0===r&&2<i||e+188>s))return r}o++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:Me[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,r,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=zr.createTrack("video"),this._audioTrack=zr.createTrack("audio",i),this._id3Track=zr.createTrack("id3"),this._txtTrack=zr.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r,this._duration=i}resetTimeStamp(){}resetContiguity(){var{_audioTrack:e,_avcTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}demux(n,e,a=!1,t=!1){let s;a||(this.sampleAes=null);var o=this._avcTrack,l=this._audioTrack,h=this._id3Track,u=this._txtTrack;let d=o.pid,c=o.pesData,f=l.pid,p=h.pid,m=l.pesData,g=h.pesData,v=null,y=this.pmtParsed,x=this._pmtId,r=n.length;if(this.remainderData&&(r=(n=Ie(this.remainderData,n)).length,this.remainderData=null),r<188&&!t)return this.remainderData=n,{audioTrack:l,videoTrack:o,id3Track:h,textTrack:u};var b,_,T=Math.max(0,zr.syncOffset(n));(r-=(r-T)%188)<n.byteLength&&!t&&(this.remainderData=new Uint8Array(n.buffer,r,n.buffer.byteLength-r));let S=0;for(let i=T;i<r;i+=188)if(71===n[i]){let t=!!(64&n[i+1]),e=Vr(n,i),r;if(1<(48&n[i+3])>>4){if((r=i+5+n[i+4])===i+188)continue}else r=i+4;switch(e){case d:t&&(c&&(s=Wr(c))&&this.parseAVCPES(o,u,s,!1),c={data:[],size:0}),c&&(c.data.push(n.subarray(r,i+188)),c.size+=i+188-r);break;case f:if(t){if(m&&(s=Wr(m)))switch(l.segmentCodec){case"aac":this.parseAACPES(l,s);break;case"mp3":this.parseMPEGPES(l,s)}m={data:[],size:0}}m&&(m.data.push(n.subarray(r,i+188)),m.size+=i+188-r);break;case p:t&&(g&&(s=Wr(g))&&this.parseID3PES(h,s),g={data:[],size:0}),g&&(g.data.push(n.subarray(r,i+188)),g.size+=i+188-r);break;case 0:t&&(r+=n[r]+1),x=this._pmtId=(b=n,_=r,(31&b[_+10])<<8|b[_+11]);break;case x:{t&&(r+=n[r]+1);let e=function(t,r,i,n){let a={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},e=r+3+((15&t[r+1])<<8|t[r+2])-4;for(r+=12+((15&t[r+10])<<8|t[r+11]);r<e;){let e=Vr(t,r);switch(t[r]){case 207:if(!n){I.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===a.audio&&(a.audio=e);break;case 21:-1===a.id3&&(a.id3=e);break;case 219:if(!n){I.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===a.avc&&(a.avc=e);break;case 3:case 4:!0!==i.mpeg&&!0!==i.mp3?I.log("MPEG audio found, not supported in this browser"):-1===a.audio&&(a.audio=e,a.segmentCodec="mp3");break;case 36:I.warn("Unsupported HEVC stream type found")}r+=5+((15&t[r+3])<<8|t[r+4])}return a}(n,r,this.typeSupported,a);0<(d=e.avc)&&(o.pid=d),0<(f=e.audio)&&(l.pid=f,l.segmentCodec=e.segmentCodec),0<(p=e.id3)&&(h.pid=p),null===v||y||(I.warn(`MPEG-TS PMT found at ${i} after unknown PID '${v}'. Backtracking to sync byte @${T} to parse all TS packets.`),v=null,i=T-188),y=this.pmtParsed=!0;break}case 17:case 8191:break;default:v=e}}else S++;if(0<S){let e=new Error(`Found ${S} TS packet/s that do not start with 0x47`);this.observer.emit(R.ERROR,R.ERROR,{type:C.MEDIA_ERROR,details:D.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message})}o.pesData=c,l.pesData=m,h.pesData=g;var i={audioTrack:l,videoTrack:o,id3Track:h,textTrack:u};return t&&this.extractRemainingSamples(i),i}flush(){var e=this["remainderData"];return this.remainderData=null,e=e?this.demux(e,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e}extractRemainingSamples(e){var{audioTrack:t,videoTrack:e,id3Track:r,textTrack:i}=e,n=e.pesData,a=t.pesData,s=r.pesData;let o;if(n&&(o=Wr(n))?(this.parseAVCPES(e,i,o,!0),e.pesData=null):e.pesData=n,a&&(o=Wr(a))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,o);break;case"mp3":this.parseMPEGPES(t,o)}t.pesData=null}else null!=a&&a.size&&I.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;s&&(o=Wr(s))?(this.parseID3PES(r,o),r.pesData=null):r.pesData=s}demuxSampleAes(e,t,r){e=this.demux(e,r,!0,!this.config.progressive),r=this.sampleAes=new Gr(this.observer,this.config,t);return this.decrypt(e,r)}decrypt(i,n){return new Promise(e=>{let{audioTrack:t,videoTrack:r}=i;t.samples&&"aac"===t.segmentCodec?n.decryptAacSamples(t.samples,0,()=>{r.samples?n.decryptAvcSamples(r.samples,0,0,()=>{e(i)}):e(i)}):r.samples&&n.decryptAvcSamples(r.samples,0,0,()=>{e(i)})})}destroy(){this._duration=0}parseAVCPES(a,t,s,e){var r=this.parseAVCNALu(a,s.data);let o,l=this.avcSample,h=!1;s.data=null,l&&r.length&&!a.audFound&&(jr(l,a),l=this.avcSample=Hr(!1,s.pts,s.dts,"")),r.forEach(n=>{var e,i;switch(n.type){case 1:{let t=!1,r=(o=!0,n.data);if(h&&4<r.length){let e=new Ur(r).readSliceType();2!==e&&4!==e&&7!==e&&9!==e||(t=!0)}t&&null!=(i=l)&&i.frame&&!l.key&&(jr(l,a),l=this.avcSample=null),(l=l||(this.avcSample=Hr(!0,s.pts,s.dts,""))).frame=!0,l.key=t;break}case 5:o=!0,null!=(e=l)&&e.frame&&!l.key&&(jr(l,a),l=this.avcSample=null),(l=l||(this.avcSample=Hr(!0,s.pts,s.dts,""))).key=!0,l.frame=!0;break;case 6:o=!0,ke(n.data,1,s.pts,t.samples);break;case 7:if(o=!0,h=!0,!a.sps){let e=n.data,t=new Ur(e).readSPS(),r=(a.width=t.width,a.height=t.height,a.pixelRatio=t.pixelRatio,a.sps=[e],a.duration=this._duration,e.subarray(1,4)),i="avc1.";for(let t=0;t<3;t++){let e=r[t].toString(16);e.length<2&&(e="0"+e),i+=e}a.codec=i}break;case 8:o=!0,a.pps||(a.pps=[n.data]);break;case 9:o=!1,a.audFound=!0,l&&jr(l,a),l=this.avcSample=Hr(!1,s.pts,s.dts,"");break;case 12:o=!0;break;default:o=!1,l&&(l.debug+="unknown NAL "+n.type+" ")}l&&o&&l.units.push(n)}),e&&l&&(jr(l,a),this.avcSample=null)}getLastNalUnit(e){let t,r,i=this.avcSample;if(null!=(t=i=i&&0!==i.units.length?i:e[e.length-1])&&t.units){let e=i.units;r=e[e.length-1]}return r}parseAVCNALu(e,r){let t=r.byteLength,i=e.naluState||0;var n=i,a=[];let s,o,l,h=0,u=-1,d=0;for(-1===i&&(u=0,d=31&r[0],i=0,h=1);h<t;)if(s=r[h++],i)if(1!==i)if(s)if(1===s){if(0<=u){let e={data:r.subarray(u,h-i-1),type:d};a.push(e)}else{let t=this.getLastNalUnit(e.samples);if(t&&(n&&h<=4-n&&t.state&&(t.data=t.data.subarray(0,t.data.byteLength-n)),0<(o=h-i-1))){let e=new Uint8Array(t.data.byteLength+o);e.set(t.data,0),e.set(r.subarray(0,o),t.data.byteLength),t.data=e,t.state=0}}i=h<t?(l=31&r[h],u=h,d=l,0):-1}else i=0;else i=3;else i=s?0:2;else i=s?0:1;if(0<=u&&0<=i){let e={data:r.subarray(u,t),type:d,state:i};a.push(e)}if(0===a.length){let t=this.getLastNalUnit(e.samples);if(t){let e=new Uint8Array(t.data.byteLength+r.byteLength);e.set(t.data,0),e.set(r,t.data.byteLength),t.data=e}}return e.naluState=i,a}parseAACPES(i,e){let n=0;var r,a=this.aacOverFlow;let s,o,t,l=e.data;if(a){this.aacOverFlow=null;let t=a.missing,r=a.sample.unit.byteLength;if(-1===t){let e=new Uint8Array(r+l.byteLength);e.set(a.sample.unit,0),e.set(l,r),l=e}else{let e=r-t;a.sample.unit.set(l.subarray(0,t),e),i.samples.push(a.sample),n=a.missing}}for(s=n,o=l.length;s<o-1&&!Er(l,s);s++);if(s!==n){let e=s<o-1,t=(r=e?"AAC PES did not start with ADTS header,offset:"+s:"No ADTS header found in AAC PES",new Error(r));if(I.warn("parsing error: "+r),this.observer.emit(R.ERROR,R.ERROR,{type:C.MEDIA_ERROR,details:D.FRAG_PARSING_ERROR,fatal:!1,levelRetry:e,error:t,reason:r}),!e)return}if(Mr(i,this.observer,l,s,this.audioCodec),void 0!==e.pts)t=e.pts;else{if(!a)return void I.warn("[tsdemuxer]: AAC PES unknown PTS");{let e=Ar(i.samplerate);t=a.sample.pts+e}}let h,u=0;for(;s<o;){if(h=Lr(i,l,s,t,u),s+=h.length,h.missing){this.aacOverFlow=h;break}for(u++;s<o-1&&!Er(l,s);s++);}}parseMPEGPES(t,e){var r=e.data,i=r.length;let n=0,a=0;var s=e.pts;if(void 0!==s)for(;a<i;)if(Br(r,a)){let e=Or(t,r,a,s,n);if(!e)break;a+=e.length,n++}else a++;else I.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseID3PES(e,t){void 0===t.pts?I.warn("[tsdemuxer]: ID3 PES unknown PTS"):(t=L({},t,{type:this._avcTrack?pt:ft,duration:Number.POSITIVE_INFINITY}),e.samples.push(t))}}function Hr(e,t,r,i){return{key:e,frame:!1,pts:t,dts:r,units:[],debug:i,length:0}}function Vr(e,t){return((31&e[t+1])<<8)+e[t+2]}function Wr(e){let i,t,n,a,s,o=0;var l=e.data;if(!e||0===e.size)return null;for(;l[0].length<19&&1<l.length;){let e=new Uint8Array(l[0].length+l[1].length);e.set(l[0]),e.set(l[1],l[0].length),l[0]=e,l.splice(1,1)}if(1!==((i=l[0])[0]<<16)+(i[1]<<8)+i[2])return null;{if((t=(i[4]<<8)+i[5])&&t>e.size-6)return null;var h=i[7];192&h&&(a=536870912*(14&i[9])+4194304*(255&i[10])+16384*(254&i[11])+128*(255&i[12])+(254&i[13])/2,64&h?(s=536870912*(14&i[14])+4194304*(255&i[15])+16384*(254&i[16])+128*(255&i[17])+(254&i[18])/2,54e5<a-s&&(I.warn(Math.round((a-s)/9e4)+"s delta between PTS and DTS, align them"),a=s)):s=a);let r=(n=i[8])+9;if(e.size<=r)return null;e.size-=r;var u=new Uint8Array(e.size);for(let t=0,e=l.length;t<e;t++){let e=(i=l[t]).byteLength;if(r){if(r>e){r-=e;continue}i=i.subarray(r),e-=r,r=0}u.set(i,o),o+=e}return t&&(t-=n+3),{data:u,pts:a,dts:s,len:t}}}function jr(t,e){if(t.units.length&&t.frame){if(void 0===t.pts){var r=e.samples,i=r.length;if(!i)return e.dropped++;{let e=r[i-1];t.pts=e.pts,t.dts=e.dts}}e.samples.push(t)}t.debug.length&&I.log(t.pts+"/"+t.dts+":"+t.debug)}class Yr{static getSilentFrame(e,t){return"mp4a.40.2"===e?1===t?new Uint8Array([0,200,0,128,35,128]):2===t?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):void 0:1===t?new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]):2===t||3===t?new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]):void 0}}let $r=Math.pow(2,32)-1;class N{static init(){let e;for(e in N.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},N.types)N.types.hasOwnProperty(e)&&(N.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),t=(N.HDLR_TYPES={video:t,audio:r},new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])),r=new Uint8Array([0,0,0,0,0,0,0,0]),r=(N.STTS=N.STSC=N.STCO=r,N.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),N.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),N.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),N.STSD=new Uint8Array([0,0,0,0,0,0,0,1]),new Uint8Array([105,115,111,109])),i=new Uint8Array([97,118,99,49]),n=new Uint8Array([0,0,0,1]);N.FTYP=N.box(N.types.ftyp,r,n,r,i),N.DINF=N.box(N.types.dinf,N.box(N.types.dref,t))}static box(e,...t){let r=8,i=t.length;for(var n=i;i--;)r+=t[i].byteLength;var a=new Uint8Array(r);for(a[0]=r>>24&255,a[1]=r>>16&255,a[2]=r>>8&255,a[3]=255&r,a.set(e,4),i=0,r=8;i<n;i++)a.set(t[i],r),r+=t[i].byteLength;return a}static hdlr(e){return N.box(N.types.hdlr,N.HDLR_TYPES[e])}static mdat(e){return N.box(N.types.mdat,e)}static mdhd(e,t){t*=e;var r=Math.floor(t/(1+$r)),t=Math.floor(t%(1+$r));return N.box(N.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t,85,196,0,0]))}static mdia(e){return N.box(N.types.mdia,N.mdhd(e.timescale,e.duration),N.hdlr(e.type),N.minf(e))}static mfhd(e){return N.box(N.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?N.box(N.types.minf,N.box(N.types.smhd,N.SMHD),N.DINF,N.stbl(e)):N.box(N.types.minf,N.box(N.types.vmhd,N.VMHD),N.DINF,N.stbl(e))}static moof(e,t,r){return N.box(N.types.moof,N.mfhd(e),N.traf(r,t))}static moov(e){let t=e.length;for(var r=[];t--;)r[t]=N.trak(e[t]);return N.box.apply(null,[N.types.moov,N.mvhd(e[0].timescale,e[0].duration)].concat(r).concat(N.mvex(e)))}static mvex(e){let t=e.length;for(var r=[];t--;)r[t]=N.trex(e[t]);return N.box.apply(null,[N.types.mvex,...r])}static mvhd(e,t){t*=e;var r=Math.floor(t/(1+$r)),t=Math.floor(t%(1+$r)),e=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return N.box(N.types.mvhd,e)}static sdtp(e){var t=e.samples||[],r=new Uint8Array(4+t.length);let i,n;for(i=0;i<t.length;i++)n=t[i].flags,r[i+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return N.box(N.types.sdtp,r)}static stbl(e){return N.box(N.types.stbl,N.stsd(e),N.box(N.types.stts,N.STTS),N.box(N.types.stsc,N.STSC),N.box(N.types.stsz,N.STSZ),N.box(N.types.stco,N.STCO))}static avc1(e){let t,r,i,n=[],a=[];for(t=0;t<e.sps.length;t++)r=e.sps[t],i=r.byteLength,n.push(i>>>8&255),n.push(255&i),n=n.concat(Array.prototype.slice.call(r));for(t=0;t<e.pps.length;t++)r=e.pps[t],i=r.byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(r));var s=N.box(N.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|e.sps.length].concat(n).concat([e.pps.length]).concat(a))),o=e.width,l=e.height,h=e.pixelRatio[0],u=e.pixelRatio[1];return N.box(N.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,N.box(N.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),N.box(N.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,255&h,u>>24,u>>16&255,u>>8&255,255&u])))}static esds(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static mp4a(e){var t=e.samplerate;return N.box(N.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]),N.box(N.types.esds,N.esds(e)))}static mp3(e){var t=e.samplerate;return N.box(N.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]))}static stsd(e){return"audio"===e.type?"mp3"===e.segmentCodec&&"mp3"===e.codec?N.box(N.types.stsd,N.STSD,N.mp3(e)):N.box(N.types.stsd,N.STSD,N.mp4a(e)):N.box(N.types.stsd,N.STSD,N.avc1(e))}static tkhd(e){var t=e.id,r=e.duration*e.timescale,i=e.width,e=e.height,n=Math.floor(r/(1+$r)),r=Math.floor(r%(1+$r));return N.box(N.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,e>>8&255,255&e,0,0]))}static traf(e,t){var r=N.sdtp(e),i=e.id,n=Math.floor(t/(1+$r)),t=Math.floor(t%(1+$r));return N.box(N.types.traf,N.box(N.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),N.box(N.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,t>>24,t>>16&255,t>>8&255,255&t])),N.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,N.box(N.types.trak,N.tkhd(e),N.mdia(e))}static trex(e){e=e.id;return N.box(N.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){var r=e.samples||[],i=r.length,n=12+16*i,a=new Uint8Array(n);let s,o,l,h,u,d;for(a.set(["video"===e.type?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i,(t+=8+n)>>>24&255,t>>>16&255,t>>>8&255,255&t],0),s=0;s<i;s++)l=(o=r[s]).duration,h=o.size,u=o.flags,d=o.cts,a.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,h>>>24&255,h>>>16&255,h>>>8&255,255&h,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.paddingValue<<1|u.isNonSync,61440&u.degradPrio,15&u.degradPrio,d>>>24&255,d>>>16&255,d>>>8&255,255&d],12+16*s);return N.box(N.types.trun,a)}static initSegment(e){N.types||N.init();var e=N.moov(e),t=new Uint8Array(N.FTYP.byteLength+e.byteLength);return t.set(N.FTYP),t.set(e,N.FTYP.byteLength),t}}function qr(e,t,r=1,i=!1){e=e*t*r;return i?Math.round(e):e}function Kr(e,t=!1){return qr(e,1e3,1/9e4,t)}N.types=void 0,N.HDLR_TYPES=void 0,N.STTS=void 0,N.STSC=void 0,N.STCO=void 0,N.STSZ=void 0,N.VMHD=void 0,N.SMHD=void 0,N.STSD=void 0,N.FTYP=void 0,N.DINF=void 0;let Xr,Jr=null,Zr=null;class Qr{constructor(e,t,r,i=0){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,null===Jr){let e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Jr=e?parseInt(e[1]):0}if(null===Zr){let e=navigator.userAgent.match(/Safari\/(\d+)/i);Zr=e?parseInt(e[1]):0}}destroy(){}resetTimeStamp(e){I.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){I.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){I.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}getVideoStartPts(e){let i=!1;e=e.reduce((e,t)=>{var r=t.pts-e;return r<-4294967296?(i=!0,B(e,t.pts)):0<r?e:t.pts},e[0].pts);return i&&I.debug("PTS rollover detected"),e}remux(n,a,e,t,s,o,r,l){let h,u,d,i,c,f,p=s,m=s;var g=-1<n.pid,v=-1<a.pid,y=a.samples.length,x=0<n.samples.length,b=r&&0<y||1<y;if((!g||x)&&(!v||b)||this.ISGenerated||r){this.ISGenerated||(d=this.generateIS(n,a,s,o));let t=this.isVideoContiguous,r,i=-1;if(b&&(i=function(t){for(let e=0;e<t.length;e++)if(t[e].key)return e;return-1}(a.samples),!t)&&this.config.forceKeyFrameOnDiscontinuity)if(f=!0,0<i){I.warn(`[mp4-remuxer]: Dropped ${i} out of ${y} video samples due to a missing keyframe`);let e=this.getVideoStartPts(a.samples);a.samples=a.samples.slice(i),a.dropped+=i,m+=(a.samples[0].pts-e)/a.inputTimeScale,r=m}else-1===i&&(I.warn(`[mp4-remuxer]: No keyframe found out of ${y} video samples`),f=!1);if(this.ISGenerated){if(x&&b){let e=this.getVideoStartPts(a.samples),t=(B(n.samples[0].pts,e)-e)/a.inputTimeScale;p+=Math.max(0,t),m+=Math.max(0,-t)}if(x){if(n.samplerate||(I.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(n,a,s,o)),u=this.remuxAudio(n,p,this.isAudioContiguous,o,v||b||l===_?m:void 0),b){let e=u?u.endPTS-u.startPTS:0;a.inputTimeScale||(I.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(n,a,s,o)),h=this.remuxVideo(a,m,t,e)}}else b&&(h=this.remuxVideo(a,m,t,0));h&&(h.firstKeyFrame=i,h.independent=-1!==i,h.firstKeyFramePTS=r)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(e.samples.length&&(c=ei(e,s,this._initPTS,this._initDTS)),t.samples.length)&&(i=ti(t,s,this._initPTS)),{audio:u,video:h,initSegment:d,independent:f,text:i,id3:c}}generateIS(e,t,r,i){var n=e.samples,a=t.samples,s=this.typeSupported,o={},l=this._initPTS;let h,u,d,c=!l||i,f="audio/mp4";if(c&&(h=u=1/0),e.config&&n.length&&("mp3"===(e.timescale=e.samplerate,e.segmentCodec)&&(s.mpeg?(f="audio/mpeg",e.codec=""):s.mp3&&(e.codec="mp3")),o.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&s.mpeg?new Uint8Array(0):N.initSegment([e]),metadata:{channelCount:e.channelCount}},c)&&(d=e.inputTimeScale,l&&d===l.timescale?c=!1:h=u=n[0].pts-Math.round(d*r)),t.sps&&t.pps&&a.length&&(t.timescale=t.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:N.initSegment([t]),metadata:{width:t.width,height:t.height}},c))if(d=t.inputTimeScale,l&&d===l.timescale)c=!1;else{let e=this.getVideoStartPts(a),t=Math.round(d*r);u=Math.min(u,B(a[0].dts,e)-t),h=Math.min(h,e-t)}if(Object.keys(o).length)return this.ISGenerated=!0,c?(this._initPTS={baseTime:h,timescale:d},this._initDTS={baseTime:u,timescale:d}):h=d=void 0,{tracks:o,initPTS:h,timescale:d}}remuxVideo(e,t,r,l){let h=e.inputTimeScale,u=e.samples,d=[],i=u.length,n=this._initPTS,a,s,o=this.nextAvcDts,c=8,f=this.videoSampleDuration,p=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,g=!1;r&&null!==o||(o=t*h-(u[0].pts-B(u[0].dts,u[0].pts)));var v=n.baseTime*h/n.timescale;for(let t=0;t<i;t++){let e=u[t];e.pts=B(e.pts-v,o),e.dts=B(e.dts-v,o),e.dts<u[0<t?t-1:t].dts&&(g=!0)}g&&u.sort(function(e,t){var r=e.dts-t.dts,e=e.pts-t.pts;return r||e}),a=u[0].dts;var t=u[u.length-1].dts-a,y=t?Math.round(t/(i-1)):f||e.inputTimeScale/30;if(r){let t=a-o,e=t>y,r=t<-1;if((e||r)&&(e?I.warn(`AVC: ${Kr(t,!0)} ms (${t}dts) hole between fragments detected, filling it`):I.warn(`AVC: ${Kr(-t,!0)} ms (${t}dts) overlapping between fragments detected`),!r||o>=u[0].pts)){a=o;let e=u[0].pts-t;u[0].dts=a,u[0].pts=e,I.log(`Video: First PTS/DTS adjusted: ${Kr(e,!0)}/${Kr(a,!0)}, delta: ${Kr(t,!0)} ms`)}}a=Math.max(0,a);let x=0,b=0;for(let n=0;n<i;n++){let e=u[n],t=e.units,r=t.length,i=0;for(let e=0;e<r;e++)i+=t[e].data.length;b+=i,x+=r,e.length=i,e.dts=Math.max(e.dts,a),p=Math.min(e.pts,p),m=Math.max(e.pts,m)}s=u[i-1].dts;t=b+4*x+8;let _;try{_=new Uint8Array(t)}catch(e){return void this.observer.emit(R.ERROR,R.ERROR,{type:C.MUX_ERROR,details:D.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:t,reason:"fail allocating video mdat "+t})}var T=new DataView(_.buffer);T.setUint32(0,t),_.set(N.types.mdat,4);let S=!1,w=Number.POSITIVE_INFINITY,E=Number.POSITIVE_INFINITY,M=Number.NEGATIVE_INFINITY,A=Number.NEGATIVE_INFINITY;for(let o=0;o<i;o++){let n=u[o],a=n.units,e,s=0;for(let i=0,e=a.length;i<e;i++){let e=a[i],t=e.data,r=e.data.byteLength;T.setUint32(c,r),c+=4,_.set(t,c),c+=r,s+=4+r}if(o<i-1)f=u[o+1].dts-n.dts,e=u[o+1].pts-n.pts;else{let r=this.config,i=0<o?n.dts-u[o-1].dts:y;if(e=0<o?n.pts-u[o-1].pts:y,r.stretchShortVideoTrack&&null!==this.nextAudioPts){let e=Math.floor(r.maxBufferHole*h),t=(l?p+l*h:this.nextAudioPts)-n.pts;t>e?((f=t-i)<0?f=i:S=!0,I.log(`[mp4-remuxer]: It is approximately ${t/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=i}else f=i}let t=Math.round(n.pts-n.dts);w=Math.min(w,f),M=Math.max(M,f),E=Math.min(E,e),A=Math.max(A,e),d.push(new ri(n.key,f,s,t))}if(d.length)if(Jr){if(Jr<70){let e=d[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(Zr&&A-E<M-w&&y/M<.025&&0===d[0].cts){I.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let n=a;for(let i=0,e=d.length;i<e;i++){let t=n+d[i].duration,r=n+d[i].cts;if(i<e-1){let e=t+d[i+1].cts;d[i].duration=e-r}else d[i].duration=i?d[i-1].duration:y;d[i].cts=0,n=t}}f=S||!f?y:f,this.nextAvcDts=o=s+f,this.videoSampleDuration=f,this.isVideoContiguous=!0;r={data1:N.moof(e.sequenceNumber++,a,L({},e,{samples:d})),data2:_,startPTS:p/h,endPTS:(m+f)/h,startDTS:a/h,endDTS:o/h,type:"video",hasAudio:!1,hasVideo:!0,nb:d.length,dropped:e.dropped};return e.samples=[],e.dropped=0,r}remuxAudio(o,e,a,t,r){let l=o.inputTimeScale,s=l/(o.samplerate||l),h="aac"===o.segmentCodec?1024:1152,u=h*s,i=this._initPTS,d="mp3"===o.segmentCodec&&this.typeSupported.mpeg,c=[],f=void 0!==r,p=o.samples,m=d?0:8,g=this.nextAudioPts||-1,n=e*l,v=i.baseTime*l/i.timescale;if(this.isAudioContiguous=a=a||p.length&&0<g&&(t&&Math.abs(n-g)<9e3||Math.abs(B(p[0].pts-v,n)-g)<20*u),p.forEach(function(e){e.pts=B(e.pts-v,n)}),!a||g<0){if(!(p=p.filter(e=>0<=e.pts)).length)return;g=0===r?0:t&&!f?Math.max(0,n):p[0].pts}if("aac"===o.segmentCodec){let s=this.config.maxAudioFramesDrift;for(let n=0,a=g;n<p.length;n++){let r=p[n],e=r.pts,i=e-a,t=Math.abs(1e3*i/l);if(i<=-s*u&&f)0===n&&(I.warn(`Audio frame @ ${(e/l).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*i/l)} ms.`),this.nextAudioPts=g=a=e);else if(i>=s*u&&t<1e4&&f){let t=Math.round(i/u);(a=e-t*u)<0&&(t--,a+=u),0===n&&(this.nextAudioPts=g=a),I.warn(`[mp4-remuxer]: Injecting ${t} audio frame @ ${(a/l).toFixed(3)}s due to ${Math.round(1e3*i/l)} ms gap.`);for(let e=0;e<t;e++){let e=Math.max(a,0),t=Yr.getSilentFrame(o.manifestCodec||o.codec,o.channelCount);t||(I.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),t=r.unit.subarray()),p.splice(n,0,{unit:t,pts:e}),a+=u,n++}}r.pts=a,a+=u}}let y,x=null,b=null,_=0,T=p.length;for(;T--;)_+=p[T].unit.byteLength;for(let n=0,e=p.length;n<e;n++){let e=p[n],t=e.unit,r=e.pts;if(null!==b)c[n-1].duration=Math.round((r-b)/s);else{if(a&&"aac"===o.segmentCodec&&(r=g),x=r,!(0<_))return;_+=m;try{y=new Uint8Array(_)}catch(o){return void this.observer.emit(R.ERROR,R.ERROR,{type:C.MUX_ERROR,details:D.REMUX_ALLOC_ERROR,fatal:!1,error:o,bytes:_,reason:"fail allocating audio mdat "+_})}d||(new DataView(y.buffer).setUint32(0,_),y.set(N.types.mdat,4))}y.set(t,m);let i=t.byteLength;m+=i,c.push(new ri(!0,h,i,0)),b=r}var S,e=c.length;if(e)return this.nextAudioPts=g=b+s*c[c.length-1].duration,r=d?new Uint8Array(0):N.moof(o.sequenceNumber++,x/s,L({},o,{samples:c})),o.samples=[],t=x/l,S=g/l,r={data1:r,data2:y,startPTS:t,endPTS:S,startDTS:t,endDTS:S,type:"audio",hasAudio:!0,hasVideo:!1,nb:e},this.isAudioContiguous=!0,r}remuxEmptyAudio(e,t,r,i){var n=e.inputTimeScale,a=n/(e.samplerate||n),s=this.nextAudioPts,o=this._initDTS,o=9e4*o.baseTime/o.timescale,l=(null!==s?s:i.startDTS*n)+o,s=i.endDTS*n+o,h=1024*a,u=Math.ceil((s-l)/h),d=Yr.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(I.warn("[mp4-remuxer]: remux empty Audio"),d){var c=[];for(let t=0;t<u;t++){let e=l+t*h;c.push({unit:d,pts:e,dts:e})}return e.samples=c,this.remuxAudio(e,t,r,!1)}I.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")}}function B(e,t){var r;if(null!==t)for(r=t<e?-8589934592:8589934592;4294967296<Math.abs(e-t);)e+=r;return e}function ei(r,i,n,a){let e=r.samples.length;if(e){var s=r.inputTimeScale;for(let t=0;t<e;t++){let e=r.samples[t];e.pts=B(e.pts-n.baseTime*s/n.timescale,i*s)/s,e.dts=B(e.dts-a.baseTime*s/a.timescale,i*s)/s}var t=r.samples;return r.samples=[],{samples:t}}}function ti(r,i,n){let e=r.samples.length;if(e){var a=r.inputTimeScale;for(let t=0;t<e;t++){let e=r.samples[t];e.pts=B(e.pts-n.baseTime*a/n.timescale,i*a)/a}r.samples.sort((e,t)=>e.pts-t.pts);var t=r.samples;return r.samples=[],{samples:t}}}class ri{constructor(e,t,r,i){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=r,this.cts=i,this.flags=new ii(e)}}class ii{constructor(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1}}function ni(e,t){e=null==e?void 0:e.codec;return e&&4<e.length?e:"hvc1"===e||"hev1"===e?"hvc1.1.6.L120.90":"av01"===e?"av01.0.04M.08":"avc1"===e||t===S?"avc1.42e01e":"mp4a.40.5"}try{Xr=self.performance.now.bind(self.performance)}catch(i){I.debug("Unable to use Performance API on this environment"),Xr="undefined"!=typeof self&&self.Date.now}let ai=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,i){var n=this.videoTrack=d("video",1),a=this.audioTrack=d("audio",1),s=this.txtTrack=d("text",1);if(this.id3Track=d("id3",1),this.timeOffset=0,null!=e&&e.byteLength){var o=Ce(e);if(o.video){let{id:e,timescale:t,codec:r}=o.video;n.id=e,n.timescale=s.timescale=t,n.codec=r}if(o.audio){let{id:e,timescale:t,codec:r}=o.audio;a.id=e,a.timescale=t,a.codec=r}s.id=Me.text,n.sampleDuration=0,n.duration=a.duration=i}}resetContiguity(){this.remainderData=null}static probe(e){return 0<P(e=16384<e.length?e.subarray(0,16384):e,["moof"]).length}demux(t,e){this.timeOffset=e;let r=t;var i,n,a=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Ie(this.remainderData,t));t=r,i={valid:null,remainder:null},(n=P(t,["moof"]))&&(n.length<2?i.remainder=t:(n=n[n.length-1],i.valid=fe(t,0,n.byteOffset-8),i.remainder=fe(t,n.byteOffset-8)));let e=i;this.remainderData=e.remainder,a.samples=e.valid||new Uint8Array}else a.samples=r;t=this.extractID3Track(a,e);return s.samples=Pe(e,a),{videoTrack:a,audioTrack:this.audioTrack,id3Track:t,textTrack:this.txtTrack}}flush(){var e=this.timeOffset,t=this.videoTrack,r=this.txtTrack,i=(t.samples=this.remainderData||new Uint8Array,this.remainderData=null,this.extractID3Track(t,this.timeOffset));return r.samples=Pe(e,t),{videoTrack:t,audioTrack:d(),id3Track:i,textTrack:d()}}extractID3Track(e,i){let n=this.id3Track;return e.samples.length&&(e=P(e.samples,["emsg"]))&&e.forEach(e=>{var r=function(r){let e=r[0],i="",n="",a=0,t=0,s=0,o=0,l=0,h=0;if(0===e){for(;"\0"!==p(r.subarray(h,h+1));)i+=p(r.subarray(h,h+1)),h+=1;for(i+=p(r.subarray(h,h+1)),h+=1;"\0"!==p(r.subarray(h,h+1));)n+=p(r.subarray(h,h+1)),h+=1;n+=p(r.subarray(h,h+1)),h+=1,a=E(r,12),t=E(r,16),o=E(r,20),l=E(r,24),h=28}else if(1===e){h+=4,a=E(r,h);let e=E(r,h+=4),t=E(r,h+=4);for(h+=4,s=2**32*e+t,Number.isSafeInteger(s)||(s=Number.MAX_SAFE_INTEGER,I.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=E(r,h),h+=4,l=E(r,h),h+=4;"\0"!==p(r.subarray(h,h+1));)i+=p(r.subarray(h,h+1)),h+=1;for(i+=p(r.subarray(h,h+1)),h+=1;"\0"!==p(r.subarray(h,h+1));)n+=p(r.subarray(h,h+1)),h+=1;n+=p(r.subarray(h,h+1)),h+=1}return{schemeIdUri:i,value:n,timeScale:a,presentationTime:s,presentationTimeDelta:t,eventDuration:o,id:l,payload:r.subarray(h,r.byteLength)}}(e);if(Rr.test(r.schemeIdUri)){let e=M(r.presentationTime)?r.presentationTime/r.timeScale:i+r.presentationTimeDelta/r.timeScale,t=4294967295===r.eventDuration?Number.POSITIVE_INFINITY:r.eventDuration/r.timeScale;t<=.001&&(t=Number.POSITIVE_INFINITY);r=r.payload;n.samples.push({data:r,len:r.byteLength,dts:e,pts:e,type:pt,duration:t})}}),n}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}},remux:class{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,r,i){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(function(e,t){if(e&&t){let i=t.keyId;i&&t.isCommonEncryption&&P(e,["moov","trak"]).forEach(e=>{e=P(e,["mdia","minf","stbl","stsd"])[0].subarray(8);let t=P(e,["enca"]),r=0<t.length;(t=r?t:P(e,["encv"])).forEach(e=>{P(r?e.subarray(28):e.subarray(78),["sinf"]).forEach(e=>{var t=De(e);if(t){let e=t.subarray(8,24);e.some(e=>0!==e)||(I.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${f(e)} -> `+f(i)),t.set(i,8))}})})})}return e}(e,i)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:r}=this;var i,n;null!=e&&e.byteLength?(i=this.initData=Ce(e),t=t||ni(i.audio,T),r=r||ni(i.video,S),n={},i.audio&&i.video?n.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:i.audio?n.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?n.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:I.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=n):(this.initTracks=void 0,this.initData=void 0)}remux(r,i,n,a,s,o){let e,l,{initPTS:h,lastEndTime:u}=this;var d={audio:void 0,video:void 0,text:a,id3:n,initSegment:void 0},i=(M(u)||(u=this.lastEndTime=s||0),i.samples);if(null!=i&&i.length){var c={initPTS:void 0,timescale:1};let t=this.initData;if(null!=(e=t)&&e.length||(this.generateInitSegment(i),t=this.initData),null!=(l=t)&&l.length){this.emitInitSegment&&(c.tracks=this.initTracks,this.emitInitSegment=!1);var f,p,m,g=function(e,t){let r=0,i=0,n=0;var a=P(e,["moof","traf"]);for(let e=0;e<a.length;e++){var s=a[e],o=P(s,["tfhd"])[0],l=t[E(o,4)];if(l){var h=l.default,u=E(o,0)|(null==h?void 0:h.flags);let t=null==h?void 0:h.duration;8&u&&(t=E(o,2&u?12:8));var d=l.timescale||9e4,c=P(s,["trun"]);for(let e=0;e<c.length;e++)!(r=function(t){var r=E(t,0);let i=8,n=(1&r&&(i+=4),4&r&&(i+=4),0);var a=E(t,4);for(let e=0;e<a;e++)256&r&&(n+=E(t,i),i+=4),512&r&&(i+=4),1024&r&&(i+=4),2048&r&&(i+=4);return n}(c[e]))&&t&&(r=t*E(c[e],4)),l.type===S?i+=r/d:l.type===T&&(n+=r/d)}}if(0!==i||0!==n)return i||n;{let r=0,i=P(e,["sidx"]);for(let t=0;t<i.length;t++){let e=function(t){var r=[],e=t[0];let i=8;var n=E(t,i);i=(i+=4)+(0===e?8:16)+2;let a=t.length+0,s=Ae(t,i);i+=2;for(let e=0;e<s;e++){var o=i;let e=E(t,o);o+=4;var l=2147483647&e;if(1==(2147483648&e)>>>31)return I.warn("SIDX has hierarchical references (not supported)"),null;var h=E(t,o);o+=4,r.push({referenceSize:l,subsegmentDuration:h,info:{duration:h/n,start:a,end:a+l-1}}),a+=l,o+=4,i=o}return{earliestPresentationTime:0,timescale:n,version:e,referencesCount:s,references:r}}(i[t]);null!=e&&e.references&&(r+=e.references.reduce((e,t)=>e+t.info.duration||0,0))}return r}}(i,t),v=(f=t,P(i,["moof","traf"]).reduce((e,t)=>{let n=P(t,["tfdt"])[0],a=n[0],r=P(t,["tfhd"]).reduce((r,e)=>{var e=E(e,4),i=f[e];if(i){let e=E(n,4);if(1===a){if(e===we)return I.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),r;e=(e*=1+we)+E(n,8)}let t=e/(i.timescale||9e4);if(isFinite(t)&&(null===r||t<r))return t}return r},null);return null!==r&&isFinite(r)&&(null===e||r<e)?r:e},null)),v=null===v?s:v,y=(y=h,x=v,b=s,(null===y||(_=Math.max(g,1),x=x-y.baseTime/y.timescale,Math.abs(x-b)>_)||c.timescale!==h.timescale&&o)&&(c.initPTS=v-s,h&&1===h.timescale&&I.warn("Adjusting initPTS by "+(c.initPTS-h.baseTime)),this.initPTS=h={baseTime:c.initPTS,timescale:1}),r?v-h.baseTime/h.timescale:u),x=y+g,b=(p=t,m=h.baseTime/h.timescale,P(i,["moof","traf"]).forEach(t=>{P(t,["tfhd"]).forEach(e=>{e=E(e,4),e=p[e];if(e){let n=e.timescale||9e4;P(t,["tfdt"]).forEach(r=>{let e=r[0],i=E(r,4);if(0===e)i-=m*n,Re(r,4,i=Math.max(i,0));else{i=(i=(i*=Math.pow(2,32))+E(r,8))-m*n,i=Math.max(i,0);let e=Math.floor(i/(1+we)),t=Math.floor(i%(1+we));Re(r,4,e),Re(r,8,t)}})}})}),0<g?this.lastEndTime=x:(I.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp()),!!t.audio),_=!!t.video;let e="";b&&(e+="audio"),_&&(e+="video");o={data1:i,startPTS:y,startDTS:y,endPTS:x,endDTS:x,type:e,hasAudio:b,hasVideo:_,nb:1,dropped:0};d.audio="audio"===o.type?o:void 0,d.video="audio"!==o.type?o:void 0,d.initSegment=c,d.id3=ei(n,s,h,h),a.samples.length&&(d.text=ti(a,s,h))}else I.warn("[passthrough-remuxer.ts]: Failed to generate initSegment.")}return d}}},{demux:zr,remux:Qr},{demux:class extends br{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(t){if(t){let e=(ge(t,0)||[]).length;for(var r,i,n,a,s=t.length;e<s;e++)if(r=t,i=e,a=n=void 0,!Er(r,i)||i+(a=Sr(r,i))>=r.length?void 0:!((n=wr(r,i))<=a)&&((a=i+n)===r.length||Er(r,a)))return I.log("ADTS sync word found !"),!0}return!1}canParse(e,t){return(t=t)+5<(e=e).length&&Tr(e,t)&&wr(e,t)<=e.length-t}appendFrame(e,t,r){Mr(e,this.observer,t,r,e.manifestCodec);e=Lr(e,t,r,this.basePTS,this.frameIndex);if(e&&0===e.missing)return e}},remux:Qr},{demux:class extends br{resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(t){if(t){let e=(ge(t,0)||[]).length;for(var r=t.length;e<r;e++)if(function(t,r){if(r+1<t.length&&Nr(t,r)){var i=Fr(t,r);let e=4;r=r+(e=null!=i&&i.frameLength?i.frameLength:e);return r===t.length||Br(t,r)}}(t,e))return I.log("MPEG Audio sync word found !"),!0}return!1}canParse(e,t){return Nr(e,t)&&4<=e.length-t}appendFrame(e,t,r){if(null!==this.basePTS)return Or(e,t,r,this.basePTS,this.frameIndex)}},remux:Qr}];class si{constructor(e,t,r,i,n){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.vendor=i,this.id=n}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,r,i,t){var n=i.transmuxing;n.executeStart=Xr();let a=new Uint8Array(e);var{currentTransmuxState:e,transmuxConfig:s}=this,{contiguous:t,discontinuity:e,trackSwitch:o,accurateTimeOffset:l,timeOffset:h,initSegmentChange:u}=(t&&(this.currentTransmuxState=t),t||e),{audioCodec:s,videoCodec:d,defaultInitPts:c,duration:f,initSegmentData:p}=s,m=function(e){let t=null;return t=0<e.byteLength&&null!=r&&null!=r.key&&null!==r.iv&&null!=r.method?r:t}(a);if(m&&"AES-128"===m.method){let t=this.getDecrypter();if(!t.isSync())return this.decryptionPromise=t.webCryptoDecrypt(a,m.key.buffer,m.iv.buffer).then(e=>{e=this.push(e,null,i);return this.decryptionPromise=null,e}),this.decryptionPromise;{let e=t.softwareDecrypt(a,m.key.buffer,m.iv.buffer);if(!(e=-1<i.part?t.flush():e))return n.executeEnd=Xr(),oi(i);a=new Uint8Array(e)}}var g=this.needsProbing(e,o);if(g){let e=this.configureTransmuxer(a);if(e)return I.warn("[transmuxer] "+e.message),this.observer.emit(R.ERROR,R.ERROR,{type:C.MEDIA_ERROR,details:D.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),n.executeEnd=Xr(),oi(i)}(e||o||u||g)&&this.resetInitSegment(p,s,d,f,r),(e||u||g)&&this.resetInitialTimestamp(c),t||this.resetContiguity();o=this.transmux(a,m,h,l,i),p=this.currentTransmuxState;return p.contiguous=!0,p.discontinuity=!1,p.trackSwitch=!1,n.executeEnd=Xr(),o}flush(t){let e=t.transmuxing;e.executeStart=Xr();var{decrypter:r,currentTransmuxState:i,decryptionPromise:n}=this;if(n)return n.then(()=>this.flush(t));let a=[],s=i["timeOffset"];if(r){let e=r.flush();e&&a.push(this.push(e,null,t))}var{demuxer:n,remuxer:i}=this;return n&&i?li(r=n.flush(s))?r.then(e=>(this.flushRemux(a,e,t),a)):(this.flushRemux(a,r,t),a):(e.executeEnd=Xr(),[oi(t)])}flushRemux(e,t,r){var{audioTrack:t,videoTrack:i,id3Track:n,textTrack:a}=t,{accurateTimeOffset:s,timeOffset:o}=this.currentTransmuxState,t=(I.log(`[transmuxer.ts]: Flushed fragment ${r.sn}${-1<r.part?" p: "+r.part:""} of level `+r.level),this.remuxer.remux(t,i,n,a,o,s,!0,this.id));e.push({remuxResult:t,chunkMeta:r}),r.transmuxing.executeEnd=Xr()}resetInitialTimestamp(e){var{demuxer:t,remuxer:r}=this;t&&r&&(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){var{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,i,n){var{demuxer:a,remuxer:s}=this;a&&s&&(a.resetInitSegment(e,t,r,i),s.resetInitSegment(e,t,r,n))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,i,n){return t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,r,i,n):this.transmuxUnencrypted(e,r,i,n)}transmuxUnencrypted(e,t,r,i){var{audioTrack:e,videoTrack:n,id3Track:a,textTrack:s}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(e,n,a,s,t,r,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,r,i,n){return this.demuxer.demuxSampleAes(e,t,r).then(e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,r,i,!1,this.id),chunkMeta:n}))}configureTransmuxer(r){var{config:e,observer:t,typeSupported:i,vendor:n}=this;let a;for(let e=0,t=ai.length;e<t;e++)if(ai[e].demux.probe(r)){a=ai[e];break}if(!a)return new Error("Failed to find demuxer by probing fragment data");var s=this.demuxer,o=this.remuxer,l=a.remux,h=a.demux;o&&o instanceof l||(this.remuxer=new l(t,e,i,n)),s&&s instanceof h||(this.demuxer=new h(t,e,i),this.probe=h.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e=e||(this.decrypter=new lr(this.config))}}let oi=e=>({remuxResult:{},chunkMeta:e});function li(e){return"then"in e&&e.then instanceof Function}class hi{constructor(e,t,r,i,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=i,this.defaultInitPts=n||null}}class ui{constructor(e,t,r,i,n,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=i,this.timeOffset=n,this.initSegmentChange=a}}var di,U,e={exports:{}};function ci(){}function fi(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function pi(e,t,r,i,n){if("function"!=typeof r)throw new TypeError("The listener must be a function");r=new fi(r,i||e,n),i=U?U+t:t;return e._events[i]?e._events[i].fn?e._events[i]=[e._events[i],r]:e._events[i].push(r):(e._events[i]=r,e._eventsCount++),e}function mi(e,t){0==--e._eventsCount?e._events=new ci:delete e._events[t]}function r(){this._events=new ci,this._eventsCount=0}t=e,di=Object.prototype.hasOwnProperty,U="~",Object.create&&(ci.prototype=Object.create(null),(new ci).__proto__||(U=!1)),r.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)di.call(e,t)&&r.push(U?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},r.prototype.listeners=function(e){var e=U?U+e:e,t=this._events[e];if(!t)return[];if(t.fn)return[t.fn];for(var r=0,i=t.length,n=new Array(i);r<i;r++)n[r]=t[r].fn;return n},r.prototype.listenerCount=function(e){e=U?U+e:e,e=this._events[e];return e?e.fn?1:e.length:0},r.prototype.emit=function(e,t,r,i,n,a){var s=U?U+e:e;if(!this._events[s])return!1;var o,l=this._events[s],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,i),!0;case 5:return l.fn.call(l.context,t,r,i,n),!0;case 6:return l.fn.call(l.context,t,r,i,n,a),!0}for(c=1,o=new Array(h-1);c<h;c++)o[c-1]=arguments[c];l.fn.apply(l.context,o)}else for(var u,d=l.length,c=0;c<d;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),h){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,r);break;case 4:l[c].fn.call(l[c].context,t,r,i);break;default:if(!o)for(u=1,o=new Array(h-1);u<h;u++)o[u-1]=arguments[u];l[c].fn.apply(l[c].context,o)}return!0},r.prototype.on=function(e,t,r){return pi(this,e,t,r,!1)},r.prototype.once=function(e,t,r){return pi(this,e,t,r,!0)},r.prototype.removeListener=function(e,t,r,i){e=U?U+e:e;if(this._events[e])if(t){var n=this._events[e];if(n.fn)n.fn!==t||i&&!n.once||r&&n.context!==r||mi(this,e);else{for(var a=0,s=[],o=n.length;a<o;a++)(n[a].fn!==t||i&&!n[a].once||r&&n[a].context!==r)&&s.push(n[a]);s.length?this._events[e]=1===s.length?s[0]:s:mi(this,e)}}else mi(this,e);return this},r.prototype.removeAllListeners=function(e){return e?(e=U?U+e:e,this._events[e]&&mi(this,e)):(this._events=new ci,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=U,t.exports=r.EventEmitter=r;var gi=(t=e.exports)&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;let vi=He()||{isTypeSupported:()=>!1};class yi{constructor(e,t,r,i){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;let n=e.config;this.hls=e,this.id=t,this.useWorker=!!n.enableWorker,this.onTransmuxComplete=r,this.onFlush=i;var a,r=(e,t)=>{(t=t||{}).frag=this.frag,t.id=this.id,e===R.ERROR&&(this.error=t.error),this.hls.trigger(e,t)},i=(this.observer=new gi,this.observer.on(R.FRAG_DECRYPTED,r),this.observer.on(R.ERROR,r),{mp4:vi.isTypeSupported("video/mp4"),mpeg:vi.isTypeSupported("audio/mpeg"),mp3:vi.isTypeSupported('audio/mp4; codecs="mp3"')}),r=navigator.vendor;if(this.useWorker&&"undefined"!=typeof Worker&&(n.workerPath||"function"==typeof __HLS_WORKER_BUNDLE__))try{n.workerPath?(I.log(`loading Web Worker ${n.workerPath} for "${t}"`),this.workerContext=function(e){e=new self.URL(e,self.location.href).href;return{worker:new self.Worker(e),scriptURL:e}}(n.workerPath)):(I.log(`injecting Web Worker for "${t}"`),this.workerContext=(a=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),a=self.URL.createObjectURL(a),{worker:new self.Worker(a),objectURL:a})),this.onwmsg=e=>this.onWorkerMessage(e);let e=this.workerContext["worker"];e.addEventListener("message",this.onwmsg),e.onerror=e=>{e=new Error(`${e.message}  (${e.filename}:${e.lineno})`);n.enableWorker=!1,I.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(R.ERROR,{type:C.OTHER_ERROR,details:D.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:e})},e.postMessage({cmd:"init",typeSupported:i,vendor:r,id:t,config:JSON.stringify(n)})}catch(e){I.warn(`Error setting up "${t}" Web Worker, fallback to inline`,e),this.resetWorker(),this.error=null,this.transmuxer=new si(this.observer,i,n,r,t)}else this.transmuxer=new si(this.observer,i,n,r,t)}resetWorker(){var e,t;this.workerContext&&({worker:e,objectURL:t}=this.workerContext,t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null)}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{let e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}let e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(t,r,i,n,a,e,s,o,l,h){var u=(l.transmuxing.start=self.performance.now(),this)["transmuxer"],d=(e||a).start,c=a.decryptdata,f=this.frag,p=!(f&&a.cc===f.cc),m=!(f&&l.level===f.level),g=f?l.sn-f.sn:-1,v=this.part?l.part-this.part.index:-1,y=0==g&&1<l.id&&l.id===(null==f?void 0:f.stats.chunkCount),y=!m&&(1==g||0==g&&(1==v||y&&v<=0)),x=self.performance.now(),x=((m||g||0===a.stats.parsing.start)&&(a.stats.parsing.start=x),!e||!v&&y||(e.stats.parsing.start=x),!(f&&(null==(g=a.initSegment)?void 0:g.url)===(null==(v=f.initSegment)?void 0:v.url))),g=new ui(p,y,o,m,d,x);if(!y||p||x){I.log(`[transmuxer-interface, ${a.type}]: Starting new transmux session for sn: ${l.sn} p: ${l.part} level: ${l.level} id: ${l.id}
        discontinuity: ${p}
        trackSwitch: ${m}
        contiguous: ${y}
        accurateTimeOffset: ${o}
        timeOffset: ${d}
        initSegmentChange: `+x);let e=new hi(i,n,r,s,h);this.configureTransmuxer(e)}if(this.frag=a,this.part=e,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:t,decryptdata:c,chunkMeta:l,state:g},t instanceof ArrayBuffer?[t]:[]);else if(u){let e=u.push(t,c,l,g);li(e)?(u.async=!0,e.then(e=>{this.handleTransmuxComplete(e)}).catch(e=>{this.transmuxerError(e,l,"transmuxer-interface push error")})):(u.async=!1,this.handleTransmuxComplete(e))}}flush(t){t.transmuxing.start=self.performance.now();var r=this["transmuxer"];if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:t});else if(r){let e=r.flush(t);li(e)||r.async?(e=li(e)?e:Promise.resolve(e)).then(e=>{this.handleFlushResult(e,t)}).catch(e=>{this.transmuxerError(e,t,"transmuxer-interface flush error")}):this.handleFlushResult(e,t)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(R.ERROR,{type:C.MEDIA_ERROR,details:D.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(e=>{this.handleTransmuxComplete(e)}),this.onFlush(t)}onWorkerMessage(e){var t=e.data,r=this.hls;switch(t.event){case"init":{let e,t=null==(e=this.workerContext)?void 0:e.objectURL;t&&self.URL.revokeObjectURL(t);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":I[t.data.logType]&&I[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}}configureTransmuxer(e){var t=this["transmuxer"];this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class xi{constructor(e,t,r,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=i}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,r){let{config:t,media:i,stalled:n}=this;if(null!==i){var{currentTime:a,seeking:s}=i,o=this.seeking&&!s,l=!this.seeking&&s;if(this.seeking=s,a!==e){if(this.moved=!0,null!==n){if(this.stallReported){let e=self.performance.now()-n;I.warn(`playback not stuck anymore @${a}, after ${Math.round(e)}ms`),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}else if(l||o)this.stalled=null;else if(!(i.paused&&!s||i.ended||0===i.playbackRate)&&O.getBuffered(i).length){var l=O.bufferInfo(i,a,0),e=0<l.len,o=l.nextStart||0;if(e||o){if(s){let e=2<l.len,t=!o||r&&r.start<=a||2<o-a&&!this.fragmentTracker.getPartialFragment(a);if(e||t)return;this.moved=!1}if(!this.moved&&null!==this.stalled){let e=Math.max(o,l.start||0)-a,t=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,r=null!=t&&null!=(o=t.details)&&o.live?2*t.details.targetduration:2,i=this.fragmentTracker.getPartialFragment(a);if(0<e&&(e<=r||i))return void this._trySkipBufferHole(i)}e=self.performance.now();null===n?this.stalled=e:(r=e-n,!s&&250<=r&&(this._reportStall(l),!this.media)||(o=O.bufferInfo(i,a,t.maxBufferHole),this._tryFixBufferStall(o,r)))}}}}_tryFixBufferStall(e,t){var{config:r,fragmentTracker:i,media:n}=this;null!==n&&(n=n.currentTime,!(i=i.getPartialFragment(n))||!this._trySkipBufferHole(i)&&this.media)&&(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-n<r.maxBufferHole)&&t>1e3*r.highBufferWatchdogPeriod&&(I.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(t){let{hls:r,media:i,stallReported:e}=this;if(!e&&i){this.stallReported=!0;let e=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${JSON.stringify(t)})`);I.warn(e.message),r.trigger(R.ERROR,{type:C.MEDIA_ERROR,details:D.BUFFER_STALLED_ERROR,fatal:!1,error:e,buffer:t.len})}}_trySkipBufferHole(a){let{config:i,hls:s,media:o}=this;if(null!==o){let r=o.currentTime,e=O.bufferInfo(o,r,0),n=r<e.start?e.start:e.nextStart;if(n){var t=e.len<=i.maxBufferHole,l=0<e.len&&e.len<1&&o.readyState<3,h=n-r;if(0<h&&(t||l)){if(h>i.maxBufferHole){let i=this["fragmentTracker"],t=!1;if(0===r){let e=i.getAppendedFrag(0,x);e&&n<e.end&&(t=!0)}if(!t){let e=a||i.getAppendedFrag(r,x);if(e){let t=!1,r=e.end;for(;r<n;){let e=i.getPartialFragment(r);if(!e){t=!0;break}r+=e.duration}if(t)return 0}}}let t=Math.max(n+.05,r+.1);if(I.warn(`skipping hole, adjusting currentTime from ${r} to `+t),this.moved=!0,this.stalled=null,o.currentTime=t,a&&!a.gap){let e=new Error(`fragment loaded with buffer holes, seeking from ${r} to `+t);s.trigger(R.ERROR,{type:C.MEDIA_ERROR,details:D.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:e,reason:e.message,frag:a})}return t}}}return 0}_tryNudgeBuffer(){let{config:t,hls:r,media:e,nudgeRetry:i}=this;if(null!==e){var n=e.currentTime;if(this.nudgeRetry++,i<t.nudgeMaxRetry){var a=n+(i+1)*t.nudgeOffset,s=new Error(`Nudging 'currentTime' from ${n} to `+a);I.warn(s.message),e.currentTime=a,r.trigger(R.ERROR,{type:C.MEDIA_ERROR,details:D.BUFFER_NUDGE_ON_STALL,error:s,fatal:!1})}else{let e=new Error(`Playhead still not moving while enough data buffered @${n} after ${t.nudgeMaxRetry} nudges`);I.error(e.message),r.trigger(R.ERROR,{type:C.MEDIA_ERROR,details:D.BUFFER_STALLED_ERROR,error:e,fatal:!0})}}}}class bi extends yr{constructor(e,t,r){super(e,t,r,"[stream-controller]",x),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){var e=this["hls"];e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.LEVEL_LOADING,this.onLevelLoading,this),e.on(R.LEVEL_LOADED,this.onLevelLoaded,this),e.on(R.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(R.ERROR,this.onError,this),e.on(R.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(R.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(R.BUFFER_CREATED,this.onBufferCreated,this),e.on(R.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(R.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){var e=this["hls"];e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.LEVEL_LOADED,this.onLevelLoaded,this),e.off(R.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(R.ERROR,this.onError,this),e.off(R.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(R.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(R.BUFFER_CREATED,this.onBufferCreated,this),e.off(R.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(R.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(R.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),this.onMediaDetaching()}startLoad(e){if(this.levels){var{lastCurrentTime:t,hls:r}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=r.startLevel;-1===e&&(r.config.testBandwidth&&1<this.levels.length?(e=0,this.bitrateTest=!0):e=r.nextAutoLevel),this.level=r.nextLoadLevel=e,this.loadedmetadata=!1}0<t&&-1===e&&(this.log("Override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=u,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=s}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case vr:{var i;let{levels:e,level:t}=this,r=null==e||null==(i=e[t])?void 0:i.details;if(r&&(!r.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(r))break;this.state=u;break}if(this.hls.nextLoadLevel===this.level)break;this.state=u;break}case dr:{var r;let e=self.performance.now(),t=this.retryDate;(!t||e>=t||null!=(r=this.media)&&r.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=u)}}this.state===u&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){let{hls:e,levelLastLoaded:t,levels:r,media:i}=this,{config:n,nextLoadLevel:a}=e;if(null!==t&&(i||!this.startFragRequested&&n.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&null!=r&&r[a]){var s=r[a],o=this.getMainFwdBufferInfo();if(null!==o){var l=this.getLevelDetails();if(l&&this._streamEnded(o,l)){let e={};this.altAudio&&(e.type="video"),this.hls.trigger(R.BUFFER_EOS,e),void(this.state=pr)}else{e.loadLevel!==a&&-1===e.manualLevel&&this.log(`Adapting to level ${a} from level `+this.level),this.level=e.nextLoadLevel=a;l=s.details;if(!l||this.state===vr||l.live&&this.levelLastLoaded!==a)this.level=a,this.state=vr;else{var h=o.len,u=this.getMaxBufferLength(s.maxBitrate);if(!(u<=h)){this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);h=this.backtrackFragment?this.backtrackFragment.start:o.end;let i=this.getNextFragment(h,l);if(this.couldBacktrack&&!this.fragPrevious&&i&&"initSegment"!==i.sn&&"OK"!==this.fragmentTracker.getState(i)){let e,t=(null!=(e=this.backtrackFragment)?e:i).sn-l.startSN,r=l.fragments[t-1];r&&i.cc===r.cc&&(i=r,this.fragmentTracker.removeFragment(r))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(i&&this.isLoopLoading(i,h)){if(!i.gap){let e=this.audioOnly&&!this.altAudio?T:S,t=(e==S?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,x)}i=this.getNextFragmentLoopLoading(i,l,o,x,u)}i&&(!i.initSegment||i.initSegment.data||this.bitrateTest||(i=i.initSegment),this.loadFragment(i,s,h))}}}}}}loadFragment(e,t,r){var i=this.fragmentTracker.getState(e);this.fragCurrent=e,i===Vt||i===Wt?"initSegment"===e.sn?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,r)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,x)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){let{levels:i,media:e}=this;if(null!=e&&e.readyState){let r;var n=this.getAppendedFrag(e.currentTime),n=(n&&1<n.start&&this.flushMainBuffer(0,n.start-1),this.getLevelDetails());if(null!=n&&n.live){let e=this.getMainFwdBufferInfo();if(!e||e.len<2*n.targetduration)return}if(!e.paused&&i){let e=i[this.hls.nextLoadLevel],t=this.fragLastKbps;r=t&&this.fragCurrent?this.fragCurrent.duration*e.maxBitrate/(1e3*t)+1:0}else r=0;n=this.getBufferedFrag(e.currentTime+r);if(n){let i=this.followingBufferedFrag(n);if(i){this.abortCurrentFrag();let e=i.maxStartPTS||i.start,t=i.duration,r=Math.max(n.end,e+Math.min(Math.max(t-this.config.maxFragLookUpTolerance,.5*t),.75*t));this.flushMainBuffer(r,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){var e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case hr:case ur:case dr:case F:case fr:this.state=u}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);e=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),e.addEventListener("playing",this.onvplaying),e.addEventListener("seeked",this.onvseeked),this.gapController=new xi(this.config,e,this.fragmentTracker,this.hls)}onMediaDetaching(){var e=this["media"];e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){var e=this.media,e=e?e.currentTime:null,e=(M(e)&&this.log("Media seeked to "+e.toFixed(3)),this.getMainFwdBufferInfo());null!==e&&0!==e.len?this.tick():this.warn(`Main forward buffer length on "seeked" event ${e?e.len:"empty"})`)}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(R.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1}onManifestParsed(e,t){let r,i=!1,n=!1;var a;t.levels.forEach(e=>{(r=e.audioCodec)&&(-1!==r.indexOf("mp4a.40.2")&&(i=!0),-1!==r.indexOf("mp4a.40.5"))&&(n=!0)}),this.audioCodecSwitch=i&&n&&!("function"==typeof(null==(a=xr())||null==(a=a.prototype)?void 0:a.changeType)),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){var r=this["levels"];r&&this.state===u&&(!(r=r[t.level]).details||r.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(r.details))&&(this.state=vr)}onLevelLoaded(e,t){var r=this["levels"],i=t.level,n=t.details,a=n.totalduration;if(r){this.log(`Level ${i} loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""}, cc [${n.startCC}, ${n.endCC}] duration:`+a);a=r[i],r=this.fragCurrent;!r||this.state!==ur&&this.state!==dr||r.level===t.level&&r.urlId===a.urlId||!r.loader||this.abortCurrentFrag();let e=0;if(n.live||null!=(t=a.details)&&t.live){if(this.checkLiveUpdate(n),n.deltaUpdateFailed)return;e=this.alignPlaylists(n,a.details)}if(a.details=n,this.levelLastLoaded=i,this.hls.trigger(R.LEVEL_UPDATED,{details:n,level:i}),this.state===vr){if(this.waitForCdnTuneIn(n))return;this.state=u}this.startFragRequested?n.live&&this.synchronizeToLiveEdge(n):this.setStartPosition(n,e),this.tick()}else this.warn("Levels were reset while loading level "+i)}_handleFragmentLoadProgress(e){var t,r,i,n,a,s,o,{frag:e,part:l,payload:h}=e,u=this["levels"];u?(t=(u=u[e.level]).details)?(r=u.videoCodec,i=t.PTSKnown||!t.live,n=null==(n=e.initSegment)?void 0:n.data,u=this._getAudioCodec(u),a=this.transmuxer=this.transmuxer||new yi(this.hls,x,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),o=-1!==(s=l?l.index:-1),s=new er(e.level,e.sn,e.stats.chunkCount,h.byteLength,s,o),o=this.initPTS[e.cc],a.push(h,n,u,r,e,l,t.totalduration,i,s,o)):(this.warn(`Dropping fragment ${e.sn} of level ${e.level} after level details were reset`),this.fragmentTracker.removeFragment(e)):this.warn(`Levels were reset while fragment load was in progress. Fragment ${e.sn} of level ${e.level} will not be buffered`)}onAudioTrackSwitching(e,t){var r=this.altAudio;if(!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;let e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();let e=this.hls;r&&(e.trigger(R.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),e.trigger(R.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){t=t.id,t=!!this.hls.audioTracks[t].url;if(t){let e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=t,this.tick()}onBufferCreated(e,t){var r=t.tracks;let i,n,a=!1;for(let t in r){let e=r[t];if("main"===e.id){if(n=t,i=e,"video"===t){let e=r[t];e&&(this.videoBuffer=e.buffer)}}else a=!0}a&&i?(this.log(`Alternate track found, use ${n}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){var r,{frag:t,part:i}=t;t&&t.type!==x||(this.fragContextChanged(t)?(this.warn(`Fragment ${t.sn}${i?" p: "+i.index:""} of level ${t.level} finished buffering, but was aborted. state: `+this.state),this.state===fr&&(this.state=u)):(r=(i||t).stats,this.fragLastKbps=Math.round(8*r.total/(r.buffering.end-r.loading.first)),"initSegment"!==t.sn&&(this.fragPrevious=t),this.fragBufferedComplete(t,i)))}onError(e,t){var r;if(t.fatal)this.state=mr;else switch(t.details){case D.FRAG_GAP:case D.FRAG_PARSING_ERROR:case D.FRAG_DECRYPT_ERROR:case D.FRAG_LOAD_ERROR:case D.FRAG_LOAD_TIMEOUT:case D.KEY_LOAD_ERROR:case D.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(x,t);break;case D.LEVEL_LOAD_ERROR:case D.LEVEL_LOAD_TIMEOUT:case D.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==vr||(null==(r=t.context)?void 0:r.type)!==nt||(this.state=u);break;case D.BUFFER_FULL_ERROR:t.parent&&"main"===t.parent&&this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case D.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}checkBuffer(){let{media:e,gapController:t}=this;if(e&&t&&e.readyState){if(this.loadedmetadata||!O.getBuffered(e).length){let e=this.state!==u?this.fragCurrent:null;t.poll(this.lastCurrentTime,e)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=u,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==T||this.audioOnly&&!this.altAudio){let e=(t===S?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(e,t,x)}}onLevelsUpdated(e,t){this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){var t=this["media"];if(t){var r,i=t.currentTime;let e=this.startPosition;0<=e&&i<e&&(t.seeking?this.log(`could not seek to ${e}, already seeking at `+i):(0<(r=((r=O.getBuffered(t)).length?r.start(0):0)-e)&&(r<this.config.maxBufferHole||r<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${r} to match buffer start`),e+=r,this.startPosition=e),this.log(`seek to target start position ${e} from current time `+i),t.currentTime=e))}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(i,n){i.bitrateTest=!0,this._doFragLoad(i,n).then(e=>{var t,r=this["hls"];e&&!this.fragContextChanged(i)&&(n.fragmentError=0,this.state=u,this.startFragRequested=!1,this.bitrateTest=!1,(t=i.stats).parsing.start=t.parsing.end=t.buffering.start=t.buffering.end=self.performance.now(),r.trigger(R.FRAG_LOADED,e),i.bitrateTest=!1)})}_handleTransmuxComplete(e){var o;let d="main",c=this["hls"],{remuxResult:f,chunkMeta:p}=e,m=this.getCurrentContext(p);if(m){let{frag:l,part:h,level:r}=m,{video:u,text:t,id3:i,initSegment:n}=f,a=r["details"],s=this.altAudio?void 0:f.audio;if(this.fragContextChanged(l))this.fragmentTracker.removeFragment(l);else{if(this.state=F,n){if(null!=n&&n.tracks){let e=l.initSegment||l;this._bufferInitSegment(r,n.tracks,e,p),c.trigger(R.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:d,tracks:n.tracks})}let e=n.initPTS,t=n.timescale;M(e)&&(this.initPTS[l.cc]={baseTime:e,timescale:t},c.trigger(R.INIT_PTS_FOUND,{frag:l,id:d,initPTS:e,timescale:t}))}if(u&&a&&"initSegment"!==l.sn){let e=a.fragments[l.sn-1-a.startSN],s=l.sn===a.startSN,o=!e||l.cc>e.cc;if(!1!==f.independent){let{startPTS:i,endPTS:n,startDTS:e,endDTS:a}=u;if(h)h.elementaryStreams[u.type]={startPTS:i,endPTS:n,startDTS:e,endDTS:a};else if(u.firstKeyFrame&&u.independent&&1===p.id&&!o&&(this.couldBacktrack=!0),u.dropped&&u.independent){let e=this.getMainFwdBufferInfo(),t=(e?e.end:this.getLoadPosition())+this.config.maxBufferHole,r=u.firstKeyFramePTS||i;if(!s&&t<r-this.config.maxBufferHole&&!o)return void this.backtrack(l);o&&(l.gap=!0),l.setElementaryStreamInfo(u.type,l.start,n,l.start,a,!0)}l.setElementaryStreamInfo(u.type,i,n,e,a),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(u,l,h,p,s||o)}else{if(!s&&!o)return void this.backtrack(l);l.gap=!0}}if(s){let{startPTS:e,endPTS:t,startDTS:r,endDTS:i}=s;h&&(h.elementaryStreams[T]={startPTS:e,endPTS:t,startDTS:r,endDTS:i}),l.setElementaryStreamInfo(T,e,t,r,i),this.bufferFragmentData(s,l,h,p)}if(a&&null!=i&&null!=(o=i.samples)&&o.length){let e={id:d,frag:l,details:a,samples:i.samples};c.trigger(R.FRAG_PARSING_METADATA,e)}if(a&&t){let e={id:d,frag:l,details:a,samples:t.samples};c.trigger(R.FRAG_PARSING_USERDATA,e)}}}else this.resetWhenMissingContext(p)}_bufferInitSegment(r,i,n,a){if(this.state===F){this.audioOnly=!!i.audio&&!i.video,this.altAudio&&!this.audioOnly&&delete i.audio;var{audio:s,video:e,audiovideo:t}=i;if(s){let e=r.audioCodec,t=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(e=e&&(-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==s.metadata.channelCount)&&-1===t.indexOf("firefox")&&(e="mp4a.40.5"),-1!==t.indexOf("android")&&"audio/mpeg"!==s.container&&(e="mp4a.40.2",this.log("Android: force audio codec to "+e)),r.audioCodec&&r.audioCodec!==e&&this.log(`Swapping manifest audio codec "${r.audioCodec}" for "${e}"`),s.levelCodec=e,s.id="main",this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${e||""}/${r.audioCodec||""}/${s.codec}]`)}e&&(e.levelCodec=r.videoCodec,e.id="main",this.log(`Init video buffer, container:${e.container}, codecs[level/parsed]=[${r.videoCodec||""}/${e.codec}]`)),t&&this.log(`Init audiovideo buffer, container:${t.container}, codecs[level/parsed]=[${r.attrs.CODECS||""}/${t.codec}]`),this.hls.trigger(R.BUFFER_CODECS,i),Object.keys(i).forEach(e=>{var t=i[e].initSegment;null!=t&&t.byteLength&&this.hls.trigger(R.BUFFER_APPENDING,{type:e,data:t,frag:n,part:null,chunkMeta:a,parent:n.type})}),this.tick()}}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer||this.media,x)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=u}checkFragmentChanged(){let e=this.media,r=null;if(e&&1<e.readyState&&!1===e.seeking){var t=e.currentTime;if(O.isBuffered(e,t)?r=this.getAppendedFrag(t):O.isBuffered(e,t+.1)&&(r=this.getAppendedFrag(t+.1)),r){this.backtrackFragment=null;let e=this.fragPlaying,t=r.level;e&&r.sn===e.sn&&e.level===t&&r.urlId===e.urlId||(this.fragPlaying=r,this.hls.trigger(R.FRAG_CHANGED,{frag:r}),e&&e.level===t)||this.hls.trigger(R.LEVEL_SWITCHED,{level:t})}}}get nextLevel(){var e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){let e=this.media;if(e){var t=e.currentTime,r=this.currentFrag;if(r&&M(t)&&M(r.programDateTime)){let e=r.programDateTime+1e3*(t-r.start);return new Date(e)}}return null}get currentLevel(){var e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){var e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class _i{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class Ti{constructor(e,t,r,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new _i(e),this.fast_=new _i(t),this.defaultTTFB_=i,this.ttfb_=new _i(e)}update(e,t){var{slow_:r,fast_:i,ttfb_:n}=this;r.halfLife!==e&&(this.slow_=new _i(e,r.getEstimate(),r.getTotalWeight())),i.halfLife!==t&&(this.fast_=new _i(t,i.getEstimate(),i.getTotalWeight())),n.halfLife!==e&&(this.ttfb_=new _i(e,n.getEstimate(),n.getTotalWeight()))}sample(e,t){e=(e=Math.max(e,this.minDelayMs_))/1e3,t=8*t/e;this.fast_.sample(e,t),this.slow_.sample(e,t)}sampleTTFB(e){var t=e/1e3,t=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(t,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}class Si{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){var{chunks:e,dataLength:a}=this;return e.length?(e=1===e.length?e[0]:function(t){var r=new Uint8Array(a);let i=0;for(let e=0;e<t.length;e++){var n=t[e];r.set(n,i),i+=n.length}return r}(e),this.reset(),e):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}function wi(t,r){if(t.length===r.length){for(let e=0;e<t.length;e++)if(!function(t,r){var e=t["STABLE-RENDITION-ID"];return e?e===r["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some(e=>t[e]!==r[e])}(t[e].attrs,r[e].attrs))return;return 1}}class Ei{constructor(i){this.buffered=void 0;let t=(e,t,r)=>{if((t>>>=0)>r-1)throw new DOMException(`Failed to execute '${e}' on 'TimeRanges': The index provided (${t}) is greater than the maximum bound (${r})`);return i[t][e]};this.buffered={get length(){return i.length},end:e=>t("end",e,i.length),start:e=>t("start",e,i.length)}}}function Mi(t){var r=[];for(let e=0;e<t.length;e++){var i=t[e];"subtitles"!==i.kind&&"captions"!==i.kind||!i.label||r.push(t[e])}return r}class Ai{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t){var r=this.queues[t];r.push(e),1===r.length&&this.buffers[t]&&this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t;var r=new Promise(e=>{t=e}),i={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(i,e),r}executeNext(t){let{buffers:e,queues:r}=this,i=e[t],n=r[t];if(n.length){let e=n[0];try{e.execute()}catch(r){I.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),e.onError(r),null!=i&&i.updating||(n.shift(),this.executeNext(t))}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}function Li(e){let t=e;return Di.hasOwnProperty(e)&&(t=Di[e]),String.fromCharCode(t)}let Ri=He(),Ci=/([ha]vc.)(?:\.[^.,]+)+/,Di={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Ii={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Pi={17:2,18:4,21:6,22:8,23:10,19:13,20:15},ki={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Oi={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Fi=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Ni{constructor(){this.time=null,this.verboseLevel=0}log(e,t){this.verboseLevel>=e&&(t="function"==typeof t?t():t,I.log(this.time+` [${e}] `+t))}}function Bi(t){var r=[];for(let e=0;e<t.length;e++)r.push(t[e].toString(16));return r}class Ui{constructor(e,t,r,i,n){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=r||!1,this.background=i||"black",this.flash=n||!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(t){var r=["foreground","underline","italics","background","flash"];for(let e=0;e<r.length;e++){var i=r[e];t.hasOwnProperty(i)&&(this[i]=t[i])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Gi{constructor(e,t,r,i,n,a){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new Ui(t,r,i,n,a)}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class zi{constructor(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(let e=0;e<100;e++)this.chars.push(new Gi);this.logger=e,this.pos=0,this.currPenState=new Ui}equals(t){let r=!0;for(let e=0;e<100;e++)if(!this.chars[e].equals(t.chars[e])){r=!1;break}return r}copy(t){for(let e=0;e<100;e++)this.chars[e].copy(t.chars[e])}isEmpty(){let t=!0;for(let e=0;e<100;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):100<this.pos&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=100)}moveCursor(e){var t=this.pos+e;if(1<e)for(let e=this.pos+1;e<t+1;e++)this.chars[e].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){144<=e&&this.backSpace();let t=Li(e);100<=this.pos?this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<100;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){var t=[];let r=!0;for(let e=0;e<100;e++){var i=this.chars[e].uchar;" "!==i&&(r=!1),t.push(i)}return r?"":t.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Hi{constructor(t){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(let e=0;e<15;e++)this.rows.push(new zi(t));this.logger=t,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}reset(){for(let e=0;e<15;e++)this.rows[e].clear();this.currRow=14}equals(t){let r=!0;for(let e=0;e<15;e++)if(!this.rows[e].equals(t.rows[e])){r=!1;break}return r}copy(t){for(let e=0;e<15;e++)this.rows[e].copy(t.rows[e])}isEmpty(){let t=!0;for(let e=0;e<15;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(r){this.logger.log(2,()=>"pacData = "+JSON.stringify(r));let n=r.row-1;if(this.nrRollUpRows&&n<this.nrRollUpRows-1&&(n=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==n){for(let e=0;e<15;e++)this.rows[e].clear();let r=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){let e=i.rows[r].cueStartTime,t=this.logger.time;if(e&&null!==t&&e<t)for(let e=0;e<this.nrRollUpRows;e++)this.rows[n-this.nrRollUpRows+e+1].copy(i.rows[r+e])}}this.currRow=n;let i=this.rows[this.currRow];if(null!==r.indent){let e=r.indent,t=Math.max(e-1,0);i.setCursor(r.indent),r.color=i.chars[t].penState.foreground}let e={foreground:r.color,underline:r.underline,italics:r.italics,background:"black",flash:!1};this.setPen(e)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){var e;null===this.nrRollUpRows?this.logger.log(3,"roll_up but nrRollUpRows not set yet"):(this.logger.log(1,()=>this.getDisplayText()),e=this.currRow+1-this.nrRollUpRows,(e=this.rows.splice(e,1)[0]).clear(),this.rows.splice(this.currRow,0,e),this.logger.log(2,"Rolling up"))}getDisplayText(t){t=t||!1;var r=[];let e="",i;for(let e=0;e<15;e++){var n=this.rows[e].getTextString();n&&(i=e+1,r.push(t?"Row "+i+": '"+n+"'":n.trim()))}return e=0<r.length?t?"["+r.join(" | ")+"]":r.join("\n"):e}getTextAndFormat(){return this.rows}}class Vi{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Hi(r),this.nonDisplayedMemory=new Hi(r),this.lastOutputScreen=new Hi(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(t){for(let e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);let e=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>e+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory)&&this.outputDataUpdate()}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){var e;this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode&&(e=this.displayedMemory,this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())),this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){var t={flash:!1};t.underline=e%2==1,t.italics=46<=e,t.italics?t.foreground="white":(e=Math.floor(e/2)-16,t.foreground=["white","green","blue","cyan","red","yellow","magenta"][e]),this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){var t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){!this.outputFilter||this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e)}}class Wi{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var i=new Ni;this.channels=[null,new Vi(e,t,i),new Vi(e+1,r,i)],this.cmdHistory={a:null,b:null},this.logger=i}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){let r,i,n,a=!1;this.logger.time=e;for(let e=0;e<t.length;e+=2)if(i=127&t[e],n=127&t[e+1],0!=i||0!=n){if(this.logger.log(3,"["+Bi([t[e],t[e+1]])+"] -> ("+Bi([i,n])+")"),!(r=(r=(r=(r=this.parseCmd(i,n))||this.parseMidrow(i,n))||this.parsePAC(i,n))||this.parseBackgroundAttributes(i,n))&&(a=this.parseChars(i,n))){let e=this.currentChannel;e&&0<e?this.channels[e].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}r||a||this.logger.log(2,"Couldn't parse cleaned data "+Bi([i,n])+" orig: "+Bi([t[e],t[e+1]]))}}parseCmd(e,t){var r,i,n=this["cmdHistory"];return((20===e||28===e||21===e||29===e)&&32<=t&&t<=47||(23===e||31===e)&&33<=t&&t<=35)&&(Yi(e,t,n)?(ji(null,null,n),this.logger.log(3,"Repeated command ("+Bi([e,t])+") is dropped")):(i=this.channels[r=20===e||21===e||23===e?1:2],20===e||21===e||28===e||29===e?32===t?i.ccRCL():33===t?i.ccBS():34===t?i.ccAOF():35===t?i.ccAON():36===t?i.ccDER():37===t?i.ccRU(2):38===t?i.ccRU(3):39===t?i.ccRU(4):40===t?i.ccFON():41===t?i.ccRDC():42===t?i.ccTR():43===t?i.ccRTD():44===t?i.ccEDM():45===t?i.ccCR():46===t?i.ccENM():47===t&&i.ccEOC():i.ccTO(t-32),ji(e,t,n),this.currentChannel=r),!0)}parseMidrow(e,t){var r;return(17===e||25===e)&&32<=t&&t<=47&&((r=17===e?1:2)!==this.currentChannel?(this.logger.log(0,"Mismatch channel in midrow parsing"),!1):!!(r=this.channels[r])&&(r.ccMIDROW(t),this.logger.log(3,"MIDROW ("+Bi([e,t])+")"),!0))}parsePAC(e,t){var r,i,n,a=this.cmdHistory;return((17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127||(16===e||24===e)&&64<=t&&t<=95)&&(Yi(e,t,a)?(ji(null,null,a),!0):(r=e<=23?1:2,i=(64<=t&&t<=95?1==r?Ii:ki:1==r?Pi:Oi)[e],!!(n=this.channels[r])&&(n.setPAC(this.interpretPAC(i,t)),ji(e,t,a),this.currentChannel=r,!0)))}interpretPAC(e,t){e={color:null,italics:!1,indent:null,underline:!1,row:e},t=95<t?t-96:t-64;return e.underline=1==(1&t),t<=13?e.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(t/2)]:t<=15?(e.italics=!0,e.color="white"):e.indent=4*Math.floor((t-16)/2),e}parseChars(t,r){let e,i=null,n=null;var a;if(17<=(n=25<=t?(e=2,t-8):(e=1,t))&&n<=19?(a=17===n?r+80:18===n?r+112:r+144,this.logger.log(2,"Special char '"+Li(a)+"' in channel "+e),i=[a]):32<=t&&t<=127&&(i=0===r?[t]:[t,r]),i){let e=Bi(i);this.logger.log(3,"Char codes =  "+e.join(",")),ji(t,r,this.cmdHistory)}return i}parseBackgroundAttributes(e,t){var r,i;return((16===e||24===e)&&32<=t&&t<=47||(23===e||31===e)&&45<=t&&t<=47)&&(i={},16===e||24===e?(r=Math.floor((t-32)/2),i.background=Fi[r],t%2==1&&(i.background=i.background+"_semi")):45===t?i.background="transparent":(i.foreground="black",47===t&&(i.underline=!0)),this.channels[e<=23?1:2].setBkgData(i),ji(e,t,this.cmdHistory),!0)}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}}cueSplitAtTime(t){for(let e=0;e<this.channels.length;e++){var r=this.channels[e];r&&r.cueSplitAtTime(t)}}}function ji(e,t,r){r.a=e,r.b=t}function Yi(e,t,r){return r.a===e&&r.b===t}class $i{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var qi=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;let x=["","lr","rl"],t=["start","middle","end","left","right"];function b(e,t){return"string"==typeof t&&!!Array.isArray(e)&&(t=t.toLowerCase(),!!~e.indexOf(t))&&t}function _(e){return b(t,e)}function T(r){let e=1;for(;e<arguments.length;e++){let t=arguments[e];for(let e in t)r[e]=t[e]}return r}function e(e,t,r){var i=this,n={enumerable:!0};i.hasBeenReset=!1;let a="",s=!1,o=e,l=t,h=r,u=null,d="",c=!0,f="auto",p="start",m=50,g="middle",v=50,y="middle";Object.defineProperty(i,"id",T({},n,{get:function(){return a},set:function(e){a=""+e}})),Object.defineProperty(i,"pauseOnExit",T({},n,{get:function(){return s},set:function(e){s=!!e}})),Object.defineProperty(i,"startTime",T({},n,{get:function(){return o},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");o=e,this.hasBeenReset=!0}})),Object.defineProperty(i,"endTime",T({},n,{get:function(){return l},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");l=e,this.hasBeenReset=!0}})),Object.defineProperty(i,"text",T({},n,{get:function(){return h},set:function(e){h=""+e,this.hasBeenReset=!0}})),Object.defineProperty(i,"region",T({},n,{get:function(){return u},set:function(e){u=e,this.hasBeenReset=!0}})),Object.defineProperty(i,"vertical",T({},n,{get:function(){return d},set:function(e){e=e;e=b(x,e);if(!1===e)throw new SyntaxError("An invalid or illegal string was specified.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(i,"snapToLines",T({},n,{get:function(){return c},set:function(e){c=!!e,this.hasBeenReset=!0}})),Object.defineProperty(i,"line",T({},n,{get:function(){return f},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");f=e,this.hasBeenReset=!0}})),Object.defineProperty(i,"lineAlign",T({},n,{get:function(){return p},set:function(e){e=_(e);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");p=e,this.hasBeenReset=!0}})),Object.defineProperty(i,"position",T({},n,{get:function(){return m},set:function(e){if(e<0||100<e)throw new Error("Position must be between 0 and 100.");m=e,this.hasBeenReset=!0}})),Object.defineProperty(i,"positionAlign",T({},n,{get:function(){return g},set:function(e){e=_(e);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");g=e,this.hasBeenReset=!0}})),Object.defineProperty(i,"size",T({},n,{get:function(){return v},set:function(e){if(e<0||100<e)throw new Error("Size must be between 0 and 100.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(i,"align",T({},n,{get:function(){return y},set:function(e){e=_(e);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");y=e,this.hasBeenReset=!0}})),i.displayState=void 0}return e.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},e}();class Ki{decode(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Xi(e){function t(e,t,r,i){return 3600*(0|e)+60*(0|t)+(0|r)+parseFloat(i||0)}e=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return e?59<parseFloat(e[2])?t(e[2],e[3],0,e[4]):t(e[1],e[2],e[3],e[4]):null}class Ji{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(t,r,i){for(let e=0;e<i.length;++e)if(r===i[e]){this.set(t,r);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){t=parseFloat(t);if(0<=t&&t<=100)return this.set(e,t),!0}return!1}}function Zi(e,r,i,t){var n=t?e.split(t):[e];for(let t in n)if("string"==typeof n[t]){let e=n[t].split(i);2===e.length&&r(e[0],e[1])}}let Qi=new qi(0,0,""),en="middle"===Qi.align?"middle":"center";function tn(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class rn{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Ki,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){let i=this;function n(){let e=i.buffer,t=0;for(e=tn(e);t<e.length&&"\r"!==e[t]&&"\n"!==e[t];)++t;var r=e.slice(0,t);return"\r"===e[t]&&++t,"\n"===e[t]&&++t,i.buffer=e.slice(t),r}e&&(i.buffer+=i.decoder.decode(e,{stream:!0}));try{let t="";if("INITIAL"===i.state){if(!/\r\n|\n/.test(i.buffer))return this;var a=(t=n()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(null==a||!a[0])throw new Error("Malformed WebVTT signature.");i.state="HEADER"}let r=!1;for(;i.buffer;){if(!/\r\n|\n/.test(i.buffer))return this;switch(r?r=!1:t=n(),i.state){case"HEADER":/:/.test(t)?Zi(t,function(e,t){},/:/):t||(i.state="ID");continue;case"NOTE":t||(i.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(t)){i.state="NOTE";break}if(!t)continue;if(i.cue=new qi(0,0,""),i.state="CUE",-1===t.indexOf("--\x3e")){i.cue.id=t;continue}case"CUE":if(!i.cue){i.state="BADCUE";continue}try{!function(r,n,a){let t=r;function e(){var e=Xi(r);if(null===e)throw new Error("Malformed timestamp: "+t);return r=r.replace(/^[^\sa-zA-Z-]+/,""),e}function i(){r=r.replace(/^\s+/,"")}if(i(),n.startTime=e(),i(),"--\x3e"!==r.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+t);r=r.slice(3),i(),n.endTime=e(),i();{var s=r;let i=new Ji,e=(Zi(s,function(t,r){let e;switch(t){case"region":for(let e=a.length-1;0<=e;e--)if(a[e].id===r){i.set(t,a[e].region);break}break;case"vertical":i.alt(t,r,["rl","lr"]);break;case"line":e=r.split(","),i.integer(t,e[0]),i.percent(t,e[0])&&i.set("snapToLines",!1),i.alt(t,e[0],["auto"]),2===e.length&&i.alt("lineAlign",e[1],["start",en,"end"]);break;case"position":e=r.split(","),i.percent(t,e[0]),2===e.length&&i.alt("positionAlign",e[1],["start",en,"end","line-left","line-right","auto"]);break;case"size":i.percent(t,r);break;case"align":i.alt(t,r,["start",en,"end","left","right"])}},/:/,/\s/),n.region=i.get("region",null),n.vertical=i.get("vertical",""),i.get("line","auto")),t=("auto"===e&&-1===Qi.line&&(e=-1),n.line=e,n.lineAlign=i.get("lineAlign","start"),n.snapToLines=i.get("snapToLines",!0),n.size=i.get("size",100),n.align=i.get("align",en),i.get("position","auto"));"auto"===t&&50===Qi.position&&(t="start"===n.align||"left"===n.align?0:"end"===n.align||"right"===n.align?100:50),n.position=t}}(t,i.cue,i.regionList)}catch(e){i.cue=null,i.state="BADCUE";continue}i.state="CUETEXT";continue;case"CUETEXT":{let e=-1!==t.indexOf("--\x3e");if(!t||e&&(r=!0)){i.oncue&&i.cue&&i.oncue(i.cue),i.cue=null,i.state="ID";continue}if(null===i.cue)continue;i.cue.text&&(i.cue.text+="\n"),i.cue.text+=t}continue;case"BADCUE":t||(i.state="ID")}}}catch(e){"CUETEXT"===i.state&&i.cue&&i.oncue&&i.oncue(i.cue),i.cue=null,i.state="INITIAL"===i.state?"BADWEBVTT":"BADCUE"}return this}flush(){var t=this;try{if(!t.cue&&"HEADER"!==t.state||(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state||"BADWEBVTT"===t.state)throw new Error("Malformed WebVTT signature.")}catch(e){t.onparsingerror&&t.onparsingerror(e)}return t.onflush&&t.onflush(),this}}function nn(e,t,r=0){return e.slice(r,r+t.length)===t}function an(e){let t=5381,r=e.length;for(;r;)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()}let sn=/\r\n|\n\r|\n|\r/g;function on(e,t,r){return an(e.toString())+an(t.toString())+an(r)}let ln=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,hn=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,un={left:"start",center:"center",right:"end",start:"start",end:"end"};function dn(e,t,r,i){var n=P(new Uint8Array(e),["mdat"]);if(0===n.length)return i(new Error("Could not parse IMSC1 mdat"));let a=n.map(e=>w(e)),s=([n,t=1]=[t.baseTime,t.timescale],qr(n,1,1/t,!1));try{a.forEach(e=>r(function(e,a){let t=new DOMParser,r=t.parseFromString(e,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");let i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},s=Object.keys(i).reduce((e,t)=>(e[t]=r.getAttribute("ttp:"+t)||i[t],e),{}),o="preserve"!==r.getAttribute("xml:space"),l=fn(cn(r,"styling","style")),h=fn(cn(r,"layout","region")),n=cn(r,"body","[begin]");return[].map.call(n,e=>{var t=function i(e,n){return[].slice.call(e.childNodes).reduce((e,t,r)=>{return"br"===t.nodeName&&r?e+"\n":null!=(r=t.childNodes)&&r.length?i(t,n):n?e+t.textContent.trim().replace(/\s+/g," "):e+t.textContent},"")}(e,o);if(!t||!e.hasAttribute("begin"))return null;var r=gn(e.getAttribute("begin"),s),i=gn(e.getAttribute("dur"),s);let n=gn(e.getAttribute("end"),s);if(null===r)throw mn(e);if(null===n){if(null===i)throw mn(e);n=r+i}i=new qi(r-a,n-a,t),i.id=on(i.startTime,i.endTime,i.text),r=function(i,n,e){let a="http://www.w3.org/ns/ttml#styling",s=null;var t=null!=i&&i.hasAttribute("style")?i.getAttribute("style"):null;return t&&e.hasOwnProperty(t)&&(s=e[t]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((e,t)=>{var r=pn(n,a,t)||pn(i,a,t)||pn(s,a,t);return r&&(e[t]=r),e},{})}(h[e.getAttribute("region")],l[e.getAttribute("style")],l),t=r.textAlign;if(t){let e=un[t];e&&(i.lineAlign=e),i.align=t}return L(i,r),i}).filter(e=>null!==e)}(e,s)))}catch(e){i(e)}}function cn(e,t,r){e=e.getElementsByTagName(t)[0];return e?[].slice.call(e.querySelectorAll(r)):[]}function fn(e){return e.reduce((e,t)=>{var r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function pn(e,t,r){return e&&e.hasAttributeNS(t,r)?e.getAttributeNS(t,r):null}function mn(e){return new Error("Could not parse ttml timestamp "+e)}function gn(e,t){if(!e)return null;let r=Xi(e);return null===r&&(ln.test(e)?r=(i=e,n=t,i=ln.exec(i),a=(0|i[4])+(0|i[5])/n.subFrameRate,3600*(0|i[1])+60*(0|i[2])+(0|i[3])+a/n.frameRate):hn.test(e)&&(r=function(e,t){var e=hn.exec(e),r=Number(e[1]);switch(e[2]){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/t.frameRate;case"t":return r/t.tickRate}return r}(e,t))),r;var i,n,a}class vn{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){var e=this["hls"];e.on(R.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.BUFFER_CODECS,this.onBufferCodecs,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){var e=this["hls"];e.off(R.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.BUFFER_CODECS,this.onBufferCodecs,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){t=this.hls.levels[t.droppedLevel];this.isLevelAllowed(t)&&this.restrictedLevels.push({bitrate:t.bitrate,height:t.height,width:t.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null}onManifestParsed(e,t){var r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){var e,t;this.media&&0<this.mediaHeight&&0<this.mediaWidth&&(e=this.hls.levels).length&&((t=this.hls).autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping)}getMaxLevel(r){var e=this.hls.levels;return e.length?(e=e.filter((e,t)=>this.isLevelAllowed(e)&&t<=r),this.clientRect=null,vn.getMaxLevelByMediaSize(e,this.mediaWidth,this.mediaHeight)):-1}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){var e,t,r;return this.clientRect||(t={width:0,height:0},(e=this.media)&&(r=e.getBoundingClientRect(),t.width=r.width,t.height=r.height,t.width||t.height||(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)),this.clientRect=t)}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(e){}return e}isLevelAllowed(t){return!this.restrictedLevels.some(e=>t.bitrate===e.bitrate&&t.width===e.width&&t.height===e.height)}static getMaxLevelByMediaSize(t,r,i){if(null==t||!t.length)return-1;let n=t.length-1;for(let e=0;e<t.length;e+=1){var a=t[e];if((a.width>=r||a.height>=i)&&(!(s=t[e+1])||a.width!==s.width||a.height!==s.height)){n=e;break}}var s;return n}}class yn{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=yn.CDMCleanupPromise?[yn.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=I.debug.bind(I,"[eme]"),this.log=I.log.bind(I,"[eme]"),this.warn=I.warn.bind(I,"[eme]"),this.error=I.error.bind(I,"[eme]"),this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();var e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(R.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(R.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(R.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(R.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(R.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(R.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){var{drmSystems:t,widevineLicenseUrl:r}=this.config,t=t[e];if(t)return t.licenseUrl;if(e===c.WIDEVINE&&r)return r;throw new Error(`no license server URL configured for key-system "${e}"`)}getServerCertificateUrl(e){var t=this.config["drmSystems"],t=t[e];if(t)return t.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){let t=this.hls.levels,r=(e,t,r)=>!!e&&r.indexOf(e)===t,s=t.map(e=>e.audioCodec).filter(r),o=t.map(e=>e.videoCodec).filter(r);return s.length+o.length===0&&o.push("avc1.42e01e"),new Promise((i,n)=>{let a=t=>{let r=t.shift();this.getMediaKeysPromise(r,s,o).then(e=>i({keySystem:r,mediaKeys:e})).catch(e=>{t.length?a(t):n(e instanceof G?e:new G({type:C.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_NO_ACCESS,error:e,fatal:!0},e.message))})};a(e)})}requestMediaKeySystemAccess(e,t){var r=this.config["requestMediaKeySystemAccessFunc"];if("function"==typeof r)return r(e,t);{let e="Configured requestMediaKeySystemAccess is not a function "+r;return null===ce&&"http:"===self.location.protocol&&(e="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(e))}}getMediaKeysPromise(i,e,t){let r=function(e,t,r,i){let n;switch(e){case c.FAIRPLAY:n=["cenc","sinf"];break;case c.WIDEVINE:case c.PLAYREADY:n=["cenc"];break;case c.CLEARKEY:n=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+e)}return a=n,r=r,[{initDataTypes:a,persistentState:(s=i).persistentState||"not-allowed",distinctiveIdentifier:s.distinctiveIdentifier||"not-allowed",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:t.map(e=>({contentType:`audio/mp4; codecs="${e}"`,robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null})),videoCapabilities:r.map(e=>({contentType:`video/mp4; codecs="${e}"`,robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null}))}];var a,s}(i,e,t,this.config.drmSystemOptions),n=this.keySystemAccessPromises[i],a=null==n?void 0:n.keySystemAccess;if(a)return a.then(()=>n.mediaKeys);{this.log(`Requesting encrypted media "${i}" key-system access with config: `+JSON.stringify(r)),a=this.requestMediaKeySystemAccess(i,r);let t=this.keySystemAccessPromises[i]={keySystemAccess:a};return a.catch(e=>{this.log(`Failed to obtain access to key-system "${i}": `+e)}),a.then(e=>{this.log(`Access for key-system "${e.keySystem}" obtained`);let r=this.fetchServerCertificate(i);return this.log(`Create media-keys for "${i}"`),t.mediaKeys=e.createMediaKeys().then(t=>(this.log(`Media-keys created for "${i}"`),r.then(e=>e?this.setMediaKeysServerCertificate(t,i,e):t))),t.mediaKeys.catch(e=>{this.error(`Failed to create media-keys for "${i}"}: `+e)}),t.mediaKeys})}}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: `+f(e.keyId||[]));var i=r.createSession(),e={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(e),e}renewKeySession(e){var t,r,i=e.decryptdata;i.pssh?(t=this.createMediaKeySessionContext(e),r=this.getKeyIdString(i),this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(t,"cenc",i.pssh,"expired")):this.warn("Could not renew expired session. Missing pssh initData."),this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return f(e.keyId)}updateKeySession(e,t){var r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyID ${f((null==(e=e.decryptdata)?void 0:e.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),r.update(t)}selectKeySystemFormat(e){var t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats `+t.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(n){return new Promise((r,i)=>{let t=de(this.config),e=n.map(le).filter(e=>!!e&&-1!==t.indexOf(e));return this.getKeySystemSelectionPromise(e).then(({keySystem:e})=>{var t=ue(e);t?r(t):i(new Error(`Unable to find format for key-system "${e}"`))}).catch(i)})}loadKey(e){let i=e.keyInfo.decryptdata,t=this.getKeyIdString(i),n=`(keyId: ${t} format: "${i.keyFormat}" method: ${i.method} uri: ${i.uri})`,r=(this.log("Starting session for key "+n),this.keyIdToKeySessionPromise[t]);return r||(r=this.keyIdToKeySessionPromise[t]=this.getKeySystemForKeyPromise(i).then(({keySystem:t,mediaKeys:r})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key `+n),this.attemptSetMediaKeys(t,r).then(()=>{this.throwIfDestroyed();var e=this.createMediaKeySessionContext({keySystem:t,mediaKeys:r,decryptdata:i});return this.generateRequestWithPreferredKeySession(e,"cenc",i.pssh,"playlist-key")})))).catch(e=>this.handleError(e)),r}throwIfDestroyed(e=0){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof G?this.hls.trigger(R.ERROR,e.data):this.hls.trigger(R.ERROR,{type:C.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(r){let e=this.getKeyIdString(r),t=this.keyIdToKeySessionPromise[e];if(t)return t;{let e=le(r.keyFormat),t=e?[e]:de(this.config);return this.attemptKeySystemAccess(t)}}getKeySystemSelectionPromise(e){if(0===(e=e.length?e:de(this.config)).length)throw new G({type:C.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(e)}_onMediaEncrypted(e){let{initDataType:h,initData:u}=e;if(this.debug(`"${e.type}" event: init data type: "${h}"`),null!==u){let o,l;if("sinf"===h&&this.config.drmSystems[c.FAIRPLAY]){let r=p(new Uint8Array(u));try{let e=re(JSON.parse(r).sinf),t=De(new Uint8Array(e));if(!t)return;o=t.subarray(8,24),l=c.FAIRPLAY}catch(e){return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{let e=function(t){if(!(t instanceof ArrayBuffer)||t.byteLength<32)return null;var r={version:0,systemId:"",kids:null,data:null},e=new DataView(t),i=e.getUint32(0);if(t.byteLength!==i&&44<i)return null;if(1886614376!==e.getUint32(4))return null;if(r.version=e.getUint32(8)>>>24,1<r.version)return null;r.systemId=f(new Uint8Array(t,12,16));var n=e.getUint32(28);if(0===r.version){if(i-32<n)return null;r.data=new Uint8Array(t,32,n)}else if(1===r.version){r.kids=[];for(let e=0;e<n;e++)r.kids.push(new Uint8Array(t,32+16*e,16))}return r}(u);if(null===e)return;0===e.version&&e.systemId===he&&e.data&&(o=e.data.subarray(8,24)),l=function(){if(e.systemId===he)return c.WIDEVINE}()}if(l&&o){let n=f(o),{keyIdToKeySessionPromise:i,mediaKeySessions:a}=this,s=i[n];for(let r=0;r<a.length;r++){let e=a[r],t=e.decryptdata;if(!t.pssh&&t.keyId){var d=f(t.keyId);if(n===d||-1!==t.uri.replace(/-/g,"").indexOf(n)){s=i[d],delete i[d],t.pssh=new Uint8Array(u),t.keyId=o,s=i[n]=s.then(()=>this.generateRequestWithPreferredKeySession(e,h,u,"encrypted-event-key-match"));break}}}(s=s||(i[n]=this.getKeySystemSelectionPromise([l]).then(({keySystem:t,mediaKeys:r})=>{var e;this.throwIfDestroyed();let i=new Ne("ISO-23001-7",n,null!=(e=ue(t))?e:"");return i.pssh=new Uint8Array(u),i.keyId=o,this.attemptSetMediaKeys(t,r).then(()=>{this.throwIfDestroyed();var e=this.createMediaKeySessionContext({decryptdata:i,keySystem:t,mediaKeys:r});return this.generateRequestWithPreferredKeySession(e,h,u,"encrypted-event-no-match")})}))).catch(e=>this.handleError(e))}}}_onWaitingForKey(e){this.log(`"${e.type}" event`)}attemptSetMediaKeys(e,t){let r=this.setMediaKeysQueue.slice(),i=(this.log(`Setting media-keys for "${e}"`),Promise.all(r).then(()=>{if(this.media)return this.media.setMediaKeys(t);throw new Error("Attempted to set mediaKeys without media element attached")}));return this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(e=>-1===r.indexOf(e))})}generateRequestWithPreferredKeySession(i,t,r,e){var n=null==(n=this.config.drmSystems)||null==(n=n[i.keySystem])?void 0:n.generateRequest;if(n)try{let e=n.call(this.hls,t,r,i);if(!e)throw new Error("Invalid response from configured generateRequest filter");t=e.initDataType,r=i.decryptdata.pssh=e.initData?new Uint8Array(e.initData):null}catch(i){if(this.warn(i.message),null!=(n=this.hls)&&n.config.debug)throw i}if(null===r)return this.log(`Skipping key-session request for "${e}" (no initData)`),Promise.resolve(i);let a=this.getKeyIdString(i.decryptdata),s=(this.log(`Generating key-session request for "${e}": ${a} (init data type: ${t} length: ${r?r.byteLength:null})`),new gi),o=(i.mediaKeysSession.onmessage=e=>{var t,r=i.mediaKeysSession;r?({messageType:e,message:t}=e,this.log(`"${e}" message event for session "${r.sessionId}" message size: `+t.byteLength),"license-request"===e||"license-renewal"===e?this.renewLicense(i,t).catch(e=>{this.handleError(e),s.emit("error",e)}):"license-release"===e?i.keySystem===c.FAIRPLAY&&(this.updateKeySession(i,ie("acknowledged")),this.removeSession(i)):this.warn(`unhandled media key message type "${e}"`)):s.emit("error",new Error("invalid state"))},i.mediaKeysSession.onkeystatuseschange=e=>{var t;i.mediaKeysSession?(this.onKeyStatusChange(i),t=i.keyStatus,s.emit("keyStatus",t),"expired"===t&&(this.warn(i.keySystem+" expired for key "+a),this.renewKeySession(i))):s.emit("error",new Error("invalid state"))},new Promise((t,r)=>{s.on("error",r),s.on("keyStatus",e=>{e.startsWith("usable")?t():"output-restricted"===e?r(new G({type:C.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===e?r(new G({type:C.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${e}"`)):"expired"===e?r(new Error("key expired while generating request")):this.warn(`unhandled key status change "${e}"`)})}));return i.mediaKeysSession.generateRequest(t,r).then(()=>{var e;this.log(`Request generated for key-session "${null==(e=i.mediaKeysSession)?void 0:e.sessionId}" keyId: `+a)}).catch(e=>{throw new G({type:C.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_NO_SESSION,error:e,fatal:!1},"Error generating key-session request: "+e)}).then(()=>o).catch(e=>{throw s.removeAllListeners(),this.removeSession(i),e}).then(()=>(s.removeAllListeners(),i))}onKeyStatusChange(r){r.mediaKeysSession.keyStatuses.forEach((e,t)=>{this.log(`key status change "${e}" for keyStatuses keyId: ${f("buffer"in t?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t))} session keyId: ${f(new Uint8Array(r.decryptdata.keyId||[]))} uri: `+r.decryptdata.uri),r.keyStatus=e})}fetchServerCertificate(o){let i=this.config,l=new i.loader(i),h=this.getServerCertificateUrl(o);return h?(this.log(`Fetching serverCertificate for "${o}"`),new Promise((n,a)=>{let s={responseType:"arraybuffer",url:h},e=i.certLoadPolicy.default,t={loadPolicy:e,timeout:e.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},r={onSuccess:(e,t,r,i)=>{n(e.data)},onError:(e,t,r,i)=>{a(new G({type:C.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:m({url:s.url,data:void 0},e)},`"${o}" certificate request failed (${h}). Status: ${e.code} (${e.text})`))},onTimeout:(e,t,r)=>{a(new G({type:C.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:{url:s.url,data:void 0}},`"${o}" certificate request timed out (${h})`))},onAbort:(e,t,r)=>{a(new Error("aborted"))}};l.load(s,t,r)})):Promise.resolve()}setMediaKeysServerCertificate(i,n,a){return new Promise((t,r)=>{i.setServerCertificate(a).then(e=>{this.log(`setServerCertificate ${e?"success":"not supported by CDM"} (${null==a?void 0:a.byteLength}) on "${n}"`),t(i)}).catch(e=>{r(new G({type:C.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))})})}renewLicense(t,e){return this.requestLicense(t,new Uint8Array(e)).then(e=>this.updateKeySession(t,new Uint8Array(e)).catch(e=>{throw new G({type:C.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:e,fatal:!0},e.message)}))}setupLicenseXHR(t,r,i,n){let a=this.config.licenseXhrSetup;return a?Promise.resolve().then(()=>{if(i.decryptdata)return a.call(this.hls,t,r,i,n);throw new Error("Key removed")}).catch(e=>{if(i.decryptdata)return t.open("POST",r,!0),a.call(this.hls,t,r,i,n);throw e}).then(e=>(t.readyState||t.open("POST",r,!0),{xhr:t,licenseChallenge:e||n})):(t.open("POST",r,!0),Promise.resolve({xhr:t,licenseChallenge:n}))}requestLicense(s,o){let e=this.config.keyLoadPolicy.default;return new Promise((r,i)=>{let n=this.getLicenseServerUrl(s.keySystem),a=(this.log("Sending license request to URL: "+n),new XMLHttpRequest);a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!s.mediaKeysSession)return i(new Error("invalid state"));if(4===a.readyState)if(200===a.status){this._requestLicenseFailureCount=0;let e=a.response,t=(this.log("License received "+(e instanceof ArrayBuffer?e.byteLength:e)),this.config.licenseResponseCallback);if(t)try{e=t.call(this.hls,a,n,s)}catch(e){this.error(e)}r(e)}else{var t=e.errorRetry,t=t?t.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>t||400<=a.status&&a.status<500)i(new G({type:C.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:{url:n,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${n}). Status: ${a.status} (${a.statusText})`));else{let e=t-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${e} attempts left`),this.requestLicense(s,o).then(r,i)}}},s.licenseXhr&&s.licenseXhr.readyState!==XMLHttpRequest.DONE&&s.licenseXhr.abort(),s.licenseXhr=a,this.setupLicenseXHR(a,n,s,o).then(({xhr:e,licenseChallenge:t})=>{e.send(t)})})}onMediaAttached(e,t){this.config.emeEnabled&&(t=t.media,(this.media=t).addEventListener("encrypted",this.onMediaEncrypted),t.addEventListener("waitingforkey",this.onWaitingForKey))}onMediaDetached(){let t=this.media,e=this.mediaKeySessions,r=(t&&(t.removeEventListener("encrypted",this.onMediaEncrypted),t.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Ne.clearKeyUriToKeyIdMap(),e.length);yn.CDMCleanupPromise=Promise.all(e.map(e=>this.removeSession(e)).concat(null==t?void 0:t.setMediaKeys(null).catch(e=>{this.log(`Could not clear media keys: ${e}. media.src: `+(null==t?void 0:t.src))}))).then(()=>{r&&(this.log("finished closing key sessions and clearing media keys"),e.length=0)}).catch(e=>{this.log(`Could not close sessions and clear media keys: ${e}. media.src: `+(null==t?void 0:t.src))})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(t&&this.config.emeEnabled&&!this.keyFormatPromise){let e=t.reduce((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e),[]);this.log("Selecting key-system from session-keys "+e.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){let{mediaKeysSession:t,licenseXhr:r}=e;if(t)return this.log("Remove licenses and keys and close session "+t.sessionId),t.onmessage=null,t.onkeystatuseschange=null,r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0,-1<(e=this.mediaKeySessions.indexOf(e))&&this.mediaKeySessions.splice(e,1),t.remove().catch(e=>{this.log("Could not remove session: "+e)}).then(()=>t.close()).catch(e=>{this.log("Could not close session: "+e)})}}yn.CDMCleanupPromise=void 0;class G extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),(this.data=e).err=e.error}}class xn{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:"m",su:!this.initialized})}catch(e){I.warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=e=>{try{var t=e.frag,r=this.hls.levels[t.level],i=this.getObjectType(t),n={d:1e3*t.duration,ot:i};"v"!==i&&"a"!==i&&"av"!=i||(n.br=r.bitrate/1e3,n.tb=this.getTopBandwidth(i)/1e3,n.bl=this.getBufferLength(i)),this.apply(e,n)}catch(e){I.warn("Could not generate segment CMCD data.",e)}},this.hls=e;var e=this.config=e.config,t=e["cmcd"];null!=t&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=t.sessionId||xn.uuid(),this.cid=t.contentId,this.useHeaders=!0===t.useHeaders,this.registerListeners())}registerListeners(){var e=this.hls;e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHED,this.onMediaDetached,this),e.on(R.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){var e=this.hls;e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHED,this.onMediaDetached,this),e.off(R.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r;this.audioBuffer=null==(r=t.tracks.audio)?void 0:r.buffer,this.videoBuffer=null==(r=t.tracks.video)?void 0:r.buffer}createData(){var e;return{v:1,sf:"h",sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(t,r={}){L(r,this.createData());let e="i"===r.ot||"v"===r.ot||"av"===r.ot;if(this.starved&&e&&(r.bs=!0,r.su=!0,this.starved=!1),null==r.su&&(r.su=this.buffering),this.useHeaders){let e=xn.toHeaders(r);Object.keys(e).length&&(t.headers||(t.headers={}),L(t.headers,e))}else{let e=xn.toQuery(r);e&&(t.url=xn.appendQueryToUri(t.url,e))}}getObjectType(e){var t=e["type"];return"subtitle"===t?"tt":"initSegment"===e.sn?"i":"audio"===t?"a":"main"===t?this.hls.audioTracks.length?"v":"av":void 0}getTopBandwidth(e){let r,t=0;var i=this.hls;if("a"===e)r=i.audioTracks;else{let e=i.maxAutoLevel,t=-1<e?e+1:i.levels.length;r=i.levels.slice(0,t)}for(let e of r)e.bitrate>t&&(t=e.bitrate);return 0<t?t:NaN}getBufferLength(e){var t=this.hls.media,e="a"===e?this.audioBuffer:this.videoBuffer;return e&&t?1e3*O.bufferInfo(e,t.currentTime,this.config.maxBufferHole).len:NaN}createPlaylistLoader(){let e=this.config["pLoader"],i=this.applyPlaylistData,t=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new t(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,t,r){i(e),this.loader.load(e,t,r)}}}createFragmentLoader(){let e=this.config["fLoader"],i=this.applyFragmentData,t=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new t(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,t,r){i(e),this.loader.load(e,t,r)}}}static uuid(){var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}static serialize(e){let i=[],t=e=>Math.round(e),r=e=>100*t(e/100),n={br:t,d:t,bl:r,dl:r,mtp:r,nor:e=>encodeURIComponent(e),rtp:r,tb:t},a=Object.keys(e||{}).sort();for(let r of a){let t=e[r];if((s=t,!Number.isNaN(s)&&null!=s&&""!==s&&!1!==s)&&!("v"===r&&1===t||"pr"==r&&1===t)){let e=n[r];s=typeof(t=e?e(t):t),s="ot"===r||"sf"===r||"st"===r?r+"="+t:"boolean"==s?r:"number"==s?r+"="+t:r+"="+JSON.stringify(t);i.push(s)}}var s;return i.join(",")}static toHeaders(t){let r=Object.keys(t),i={},n=["Object","Request","Session","Status"],a=[{},{},{},{}],s={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(let e of r)a[null!=s[e]?s[e]:1][e]=t[e];for(let t=0;t<a.length;t++){let e=xn.serialize(a[t]);e&&(i["CMCD-"+n[t]]=e)}return i}static toQuery(e){return"CMCD="+encodeURIComponent(xn.serialize(e))}static appendQueryToUri(e,t){var r;return t?(r=e.includes("?")?"&":"?",e+r+t):e}}function bn(t,i,n,a){t&&Object.keys(i).forEach(r=>{var e=t.filter(e=>e.groupId===r).map(e=>{var t=L({},e);return t.details=void 0,t.attrs=new A(t.attrs),t.url=t.attrs.URI=_n(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",n),t.groupId=t.attrs["GROUP-ID"]=i[r],t.attrs["PATHWAY-ID"]=a,t});t.push(...e)})}function _n(e,t,r,i){let{HOST:n,PARAMS:a,[r]:s}=i,o,l=(t&&(o=null==s?void 0:s[t])&&(e=o),new self.URL(e));return n&&!o&&(l.host=n),a&&Object.keys(a).sort().forEach(e=>{e&&l.searchParams.set(e,a[e])}),l.href}let Tn=/^age:\s*[\d.]+\s*$/im;class Sn{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new X,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}abortInternal(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState)&&(this.stats.aborted=!0,e.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){let{config:e,context:n}=this;if(e){let t=this.loader=new self.XMLHttpRequest,r=this.stats,i=(r.loading.first=0,r.loaded=0,r.aborted=!1,this.xhrSetup);i?Promise.resolve().then(()=>{if(!this.stats.aborted)return i(t,n.url)}).catch(e=>(t.open("GET",n.url,!0),i(t,n.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(t,n,e)}).catch(e=>{this.callbacks.onError({code:t.status,text:e.message},n,t,r)}):this.openAndSendXhr(t,n,e)}}openAndSendXhr(t,e,r){t.readyState||t.open("GET",e.url,!0);var i=this.context.headers,{maxTimeToFirstByteMs:n,maxLoadTimeMs:a}=r.loadPolicy;if(i)for(let e in i)t.setRequestHeader(e,i[e]);e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,self.clearTimeout(this.requestTimeout),r.timeout=n&&M(n)?n:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),t.send()}readystatechange(){var{context:n,loader:a,stats:s}=this;if(n&&a){let e=a.readyState,t=this.config;if(!s.aborted&&2<=e&&(0===s.loading.first&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),t.timeout!==t.loadPolicy.maxLoadTimeMs)&&(self.clearTimeout(this.requestTimeout),t.timeout=t.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),t.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start))),4===e)){self.clearTimeout(this.requestTimeout),a.onreadystatechange=null,a.onprogress=null;let r=a.status,i="text"!==a.responseType;if(200<=r&&r<300&&(i&&a.response||null!==a.responseText)){s.loading.end=Math.max(self.performance.now(),s.loading.first);let e=i?a.response:a.responseText,t="arraybuffer"===a.responseType?e.byteLength:e.length;s.loaded=s.total=t,s.bwEstimate=8e3*s.total/(s.loading.end-s.loading.first),this.callbacks&&((o=this.callbacks.onProgress)&&o(s,n,e,a),this.callbacks&&(o={url:a.responseURL,data:e,code:r},this.callbacks.onSuccess(o,s,n,a)))}else{var o=t.loadPolicy.errorRetry;kt(o,s.retry,!1,r)?this.retry(o):(I.error(r+" while loading "+n.url),this.callbacks.onError({code:r,text:a.statusText},n,a,s))}}}}loadtimeout(){var e=null==(e=this.config)?void 0:e.loadPolicy.timeoutRetry;if(kt(e,this.stats.retry,!0))this.retry(e);else{I.warn("timeout while loading "+this.context.url);let e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){var{context:t,stats:r}=this;this.retryDelay=It(e,r.retry),r.retry++,I.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;var t;return this.loader&&Tn.test(this.loader.getAllResponseHeaders())&&(t=this.loader.getResponseHeader("age"),e=t?parseFloat(t):null),e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}let wn=/(\d+)-(\d+)\/(\d+)/;class En{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Mn,this.controller=new self.AbortController,this.stats=new X}destroy(){this.loader=this.callbacks=null,this.abortInternal()}abortInternal(){var e=this.response;null!=e&&e.ok||(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(i,n,a){let s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();let e=function(e,t){t={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(L({},e.headers))};return e.rangeEnd&&t.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)),t}(i,this.controller.signal),o=a.onProgress,t="arraybuffer"===i.responseType,l=t?"byteLength":"length",{maxTimeToFirstByteMs:r,maxLoadTimeMs:h}=n.loadPolicy;this.context=i,this.config=n,this.callbacks=a,this.request=this.fetchSetup(i,e),self.clearTimeout(this.requestTimeout),n.timeout=r&&M(r)?r:h,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),a.onTimeout(s,i,this.response)},n.timeout),self.fetch(this.request).then(r=>{this.response=this.loader=r;var e=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),n.timeout=h,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),a.onTimeout(s,i,this.response)},h-(e-s.loading.start)),r.ok)return s.loading.first=e,s.total=function(e){var t=e.get("Content-Range");if(t){let e=function(e){e=wn.exec(e);if(e)return parseInt(e[2])-parseInt(e[1])+1}(t);if(M(e))return e}t=e.get("Content-Length");if(t)return parseInt(t)}(r.headers)||s.total,o&&M(n.highWaterMark)?this.loadProgressively(r,s,i,n.highWaterMark,o):t?r.arrayBuffer():"json"===i.responseType?r.json():r.text();{let{status:e,statusText:t}=r;throw new An(t||"fetch, bad network response",e,r)}}).then(e=>{var t=this["response"],r=(self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first),e[l]),r=(r&&(s.loaded=s.total=r),{url:t.url,data:e,code:t.status});o&&!M(n.highWaterMark)&&o(s,i,e,t),a.onSuccess(r,s,i,t)}).catch(e=>{var t,r;self.clearTimeout(this.requestTimeout),s.aborted||(t=e&&e.code||0,r=e?e.message:null,a.onError({code:t,text:r},i,e?e.details:null,s))})}getCacheAge(){let e=null;var t;return this.response&&(t=this.response.headers.get("age"),e=t?parseFloat(t):null),e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(r,i,n,a=0,s){let o=new Si,e=r.body.getReader(),l=()=>e.read().then(e=>{var t;return e.done?(o.dataLength&&s(i,n,o.flush(),r),Promise.resolve(new ArrayBuffer(0))):(t=(e=e.value).length,i.loaded+=t,t<a||o.dataLength?(o.push(e),o.dataLength>=a&&s(i,n,o.flush(),r)):s(i,n,e,r),l())}).catch(()=>Promise.reject());return l()}}function Mn(e,t){return new self.Request(e.url,t)}class An extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}let Ln=/\s/,Rn={newCue(i,n,a,e){var s=[];let o,l,h,u,d;var c,f=self.VTTCue||self.TextTrackCue;for(let r=0;r<e.rows.length;r++)if(o=e.rows[r],h=!0,u=0,d="",!o.isEmpty()){for(let e=0;e<o.chars.length;e++)Ln.test(o.chars[e].uchar)&&h?u++:(d+=o.chars[e].uchar,h=!1);(o.cueStartTime=n)===a&&(a+=1e-4),16<=u?u--:u++;let e=tn(d.trim()),t=on(n,a,e);null!=i&&null!=(c=i.cues)&&c.getCueById(t)||((l=new f(n,a,e)).id=t,l.line=r+1,l.align="left",l.position=10+Math.min(80,10*Math.floor(8*u/32)),s.push(l))}return i&&s.length&&(s.sort((e,t)=>"auto"===e.line||"auto"===t.line?0:8<e.line&&8<t.line?t.line-e.line:e.line-t.line),s.forEach(e=>ut(i,e))),s}},Cn=m(m({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Sn,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0;e=(this.hls=e).config;this.bwEstimator=new Ti(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate),this.registerListeners()}registerListeners(){var e=this["hls"];e.on(R.FRAG_LOADING,this.onFragLoading,this),e.on(R.FRAG_LOADED,this.onFragLoaded,this),e.on(R.FRAG_BUFFERED,this.onFragBuffered,this),e.on(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(R.LEVEL_LOADED,this.onLevelLoaded,this)}unregisterListeners(){var e=this["hls"];e.off(R.FRAG_LOADING,this.onFragLoading,this),e.off(R.FRAG_LOADED,this.onFragLoaded,this),e.off(R.FRAG_BUFFERED,this.onFragBuffered,this),e.off(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(R.LEVEL_LOADED,this.onLevelLoaded,this)}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}onFragLoading(e,t){var r=t.frag;this.ignoreFragment(r)||(this.fragCurrent=r,this.partCurrent=null!=(r=t.part)?r:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}onLevelSwitching(e,t){this.clearTimer()}getTimeToLoadFrag(e,t,r,i){return e+r/t+(i?this.lastLevelLoadSec:0)}onLevelLoaded(e,t){var r=this.hls.config,{total:i,bwEstimate:n}=t.stats;M(i)&&M(n)&&(this.lastLevelLoadSec=8*i/n),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)}_abandonRulesCheck(){let{fragCurrent:i,partCurrent:n,hls:a}=this,{autoLevelEnabled:e,media:t}=a;if(i&&t){var s=performance.now(),o=(n||i).stats,l=(n||i).duration,s=s-o.loading.start;if(o.aborted||o.loaded&&o.loaded===o.total||0===i.level)this.clearTimer(),this._nextAutoLevel=-1;else if(e&&!t.paused&&t.playbackRate&&t.readyState){var h=a.mainForwardBufferInfo;if(null!==h){var u=this.bwEstimator.getEstimateTTFB(),d=Math.abs(t.playbackRate);if(!(s<=Math.max(u,l/(2*d)*1e3))){var c=h.len/d;if(!(2*l/d<=c)){var h=o.loading.first?o.loading.first-o.loading.start:-1,d=o.loaded&&-1<h,f=this.bwEstimator.getEstimate(),{levels:p,minAutoLevel:m}=a,g=p[i.level],g=o.total||Math.max(o.loaded,Math.round(l*g.maxBitrate/8));let e=s-h;e<1&&d&&(e=Math.min(s,8*o.loaded/f));var v=d?1e3*o.loaded/e:0,g=v?(g-o.loaded)/v:8*g/f+u/1e3;if(!(g<=c)){var y=v?8*v:f;let t,r=Number.POSITIVE_INFINITY;for(t=i.level-1;t>m;t--){let e=p[t].maxBitrate;if((r=this.getTimeToLoadFrag(u/1e3,y,l*e,!p[t].details))<c)break}r>=g||r>10*l||(a.nextLoadLevel=t,d?this.bwEstimator.sample(s-Math.min(u,h),o.loaded):this.bwEstimator.sampleTTFB(s),this.clearTimer(),I.warn(`[abr] Fragment ${i.sn}${n?" part "+n.index:""} of level ${i.level} is loading too slowly;
      Time to underbuffer: ${c.toFixed(3)} s
      Estimated load time for current fragment: ${g.toFixed(3)} s
      Estimated load time for down switch fragment: ${r.toFixed(3)} s
      TTFB estimate: ${h}
      Current BW estimate: ${M(f)?(f/1024).toFixed(3):"Unknown"} Kb/s
      New BW estimate: ${(this.bwEstimator.getEstimate()/1024).toFixed(3)} Kb/s
      Aborting and switching to level `+t),i.loader&&(this.fragCurrent=this.partCurrent=null,i.abortRequests()),a.trigger(R.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:n,stats:o}))}}}}}}}onFragLoaded(e,{frag:n,part:a}){var s=(a||n).stats;if(n.type===x&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(n)){if(this.clearTimer(),this.lastLoadedFragLevel=n.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){let e=(a||n).duration,t=this.hls.levels[n.level],r=(t.loaded?t.loaded.bytes:0)+s.loaded,i=(t.loaded?t.loaded.duration:0)+e;t.loaded={bytes:r,duration:i},t.realBitrate=Math.round(8*r/i)}if(n.bitrateTest){let e={stats:s,frag:n,part:a,id:n.type};this.onFragBuffered(R.FRAG_BUFFERED,e),n.bitrateTest=!1}}}onFragBuffered(e,t){var r,{frag:t,part:i}=t,i=(null!=i&&i.stats.loaded?i:t).stats;i.aborted||this.ignoreFragment(t)||(r=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB()),this.bwEstimator.sample(r,i.loaded),i.bwEstimate=this.bwEstimator.getEstimate(),t.bitrateTest?this.bitrateTestDelay=r/1e3:this.bitrateTestDelay=0)}ignoreFragment(e){return e.type!==x||"initSegment"===e.sn}clearTimer(){self.clearInterval(this.timer)}get nextAutoLevel(){let t=this._nextAutoLevel,e=this.bwEstimator;if(-1!==t&&!e.canEstimate())return t;let r=this.getNextABRAutoLevel();if(-1!==t){let e=this.hls.levels;if(e.length>Math.max(t,r)&&e[t].loadError<=e[r].loadError)return t}return r=-1!==t?Math.min(t,r):r}getNextABRAutoLevel(){let{fragCurrent:e,partCurrent:t,hls:r}=this,{maxAutoLevel:i,config:n,minAutoLevel:a,media:s}=r,o=t?t.duration:e?e.duration:0,l=s&&0!==s.playbackRate?Math.abs(s.playbackRate):1,h=this.bwEstimator?this.bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,u=r.mainForwardBufferInfo,d=(u?u.len:0)/l;var c=this.findBestLevel(h,a,i,d,n.abrBandWidthFactor,n.abrBandWidthUpFactor);if(0<=c)return c;I.trace(`[abr] ${d?"rebuffering expected":"buffer is empty"}, finding optimal quality level`);let f=o?Math.min(o,n.maxStarvationDelay):n.maxStarvationDelay,p=n.abrBandWidthFactor,m=n.abrBandWidthUpFactor;if(!d){let e=this.bitrateTestDelay;e&&(f=(o?Math.min(o,n.maxLoadingDelay):n.maxLoadingDelay)-e,I.trace(`[abr] bitrate test took ${Math.round(1e3*e)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),p=m=1)}return c=this.findBestLevel(h,a,i,d+f,p,m),Math.max(c,0)}findBestLevel(n,e,t,a,s,o){var r;let{fragCurrent:i,partCurrent:l,lastLoadedFragLevel:h}=this,u=this.hls["levels"],d=u[h],c=!(null==d||null==(r=d.details)||!r.live),f=null==d?void 0:d.codecSet,p=l?l.duration:i?i.duration:0,m=this.bwEstimator.getEstimateTTFB()/1e3,g=e,v=-1;for(let i=t;i>=e;i--){let r=u[i];if(!r||f&&r.codecSet!==f)r&&(g=Math.min(i,g),v=Math.max(i,v));else{-1!==v&&I.trace(`[abr] Skipped level(s) ${g}-${v} with CODECS:"${u[v].attrs.CODECS}"; not compatible with "${d.attrs.CODECS}"`);let e=r.details,t=(l?null==e?void 0:e.partTarget:null==e?void 0:e.averagetargetduration)||p;var y=i<=h?s*n:o*n,x=u[i].maxBitrate,b=this.getTimeToLoadFrag(m,y,x*t,void 0===e);if(I.trace(`[abr] level:${i} adjustedbw-bitrate:${Math.round(y-x)} avgDuration:${t.toFixed(1)} maxFetchDuration:${a.toFixed(1)} fetchDuration:`+b.toFixed(1)),x<y&&(0===b||!M(b)||c&&!this.bitrateTestDelay||b<a))return i}}return-1}set nextAutoLevel(e){this._nextAutoLevel=e}},bufferController:class{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=()=>{var{media:e,mediaSource:t}=this;I.log("[buffer-controller]: Media source opened"),e&&(e.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(R.MEDIA_ATTACHED,{media:e})),t&&t.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{I.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=()=>{I.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=()=>{var{media:e,_objectUrl:t}=this;e&&e.src!==t&&I.error(`Media element src was set while attaching MediaSource (${t} > ${e.src})`)},this.hls=e,this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return 0<this.getSourceBufferTypes().length||0<Object.keys(this.pendingTracks).length}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}registerListeners(){var e=this["hls"];e.on(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.BUFFER_RESET,this.onBufferReset,this),e.on(R.BUFFER_APPENDING,this.onBufferAppending,this),e.on(R.BUFFER_CODECS,this.onBufferCodecs,this),e.on(R.BUFFER_EOS,this.onBufferEos,this),e.on(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(R.FRAG_PARSED,this.onFragParsed,this),e.on(R.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){var e=this["hls"];e.off(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.BUFFER_RESET,this.onBufferReset,this),e.off(R.BUFFER_APPENDING,this.onBufferAppending,this),e.off(R.BUFFER_CODECS,this.onBufferCodecs,this),e.off(R.BUFFER_EOS,this.onBufferEos,this),e.off(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(R.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(R.FRAG_PARSED,this.onFragParsed,this),e.off(R.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new Ai(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let r=2;(!t.audio||t.video)&&t.altAudio||(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,I.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")}onMediaAttaching(e,t){t=this.media=t.media;if(t&&Ri){let e=this.mediaSource=new Ri;e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),t.src=self.URL.createObjectURL(e),this._objectUrl=t.src,t.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){var{media:e,mediaSource:t,_objectUrl:r}=this;if(t){if(I.log("[buffer-controller]: media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(e){I.warn(`[buffer-controller]: onMediaDetaching: ${e.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),e.src===r?(e.removeAttribute("src"),e.load()):I.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(R.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{var t=this.sourceBuffer[e];try{t&&(this.removeBufferListeners(e),this.mediaSource&&this.mediaSource.removeSourceBuffer(t),this.sourceBuffer[e]=void 0)}catch(t){I.warn(`[buffer-controller]: Failed to reset the ${e} buffer`,t)}}),this._initSourceBuffer()}onBufferCodecs(e,u){let t=this.getSourceBufferTypes().length;Object.keys(u).forEach(r=>{if(t){let t=this.tracks[r];if(t&&"function"==typeof t.buffer.changeType){var{id:i,codec:n,levelCodec:a,container:s,metadata:o}=u[r],l=(t.levelCodec||t.codec).replace(Ci,"$1"),h=(a||n).replace(Ci,"$1");if(l!==h){let e=s+";codecs="+(a||n);this.appendChangeType(r,e),I.log(`[buffer-controller]: switching codec ${l} to `+h),this.tracks[r]={buffer:t.buffer,codec:n,container:s,levelCodec:a,metadata:o,id:i}}}}else this.pendingTracks[r]=u[r]}),t||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())}appendChangeType(t,r){let i=this["operationQueue"],e={execute:()=>{var e=this.sourceBuffer[t];e&&(I.log(`[buffer-controller]: changing ${t} sourceBuffer type to `+r),e.changeType(r)),i.shiftAndExecuteNext(t)},onStart:()=>{},onComplete:()=>{},onError:e=>{I.warn(`[buffer-controller]: Failed to change ${t} SourceBuffer type`,e)}};i.append(e,t)}onBufferAppending(e,t){let{hls:r,operationQueue:i,tracks:n}=this,{data:a,type:s,frag:o,part:l,chunkMeta:h}=t,u=h.buffering[s],d=self.performance.now(),c=(u.start=d,o.stats.buffering),f=l?l.stats.buffering:null;0===c.start&&(c.start=d),f&&0===f.start&&(f.start=d);t=n.audio;let p=!1,m=("audio"===s&&"audio/mpeg"===(null==t?void 0:t.container)&&(p=!this.lastMpegAudioChunk||1===h.id||this.lastMpegAudioChunk.sn!==h.sn,this.lastMpegAudioChunk=h),o.start),g={execute:()=>{var e,t;u.executeStart=self.performance.now(),p&&(e=this.sourceBuffer[s])&&(t=m-e.timestampOffset,.1<=Math.abs(t))&&(I.log(`[buffer-controller]: Updating audio SourceBuffer timestampOffset to ${m} (delta: ${t}) sn: ${o.sn})`),e.timestampOffset=m),this.appendExecutor(a,s)},onStart:()=>{},onComplete:()=>{let e=self.performance.now();u.executeEnd=u.end=e,0===c.first&&(c.first=e),f&&0===f.first&&(f.first=e);var t=this["sourceBuffer"],r={};for(let e in t)r[e]=O.getBuffered(t[e]);this.appendError=0,this.hls.trigger(R.BUFFER_APPENDED,{type:s,frag:o,part:l,chunkMeta:h,parent:o.type,timeRanges:r})},onError:e=>{I.error(`[buffer-controller]: Error encountered while trying to append to the ${s} SourceBuffer`,e);var t={type:C.MEDIA_ERROR,parent:o.type,details:D.BUFFER_APPEND_ERROR,frag:o,part:l,chunkMeta:h,error:e,err:e,fatal:!1};e.code===DOMException.QUOTA_EXCEEDED_ERR?t.details=D.BUFFER_FULL_ERROR:(this.appendError++,t.details=D.BUFFER_APPEND_ERROR,this.appendError>r.config.appendErrorMaxRetry&&(I.error(`[buffer-controller]: Failed ${r.config.appendErrorMaxRetry} times to append segment in sourceBuffer`),t.fatal=!0)),r.trigger(R.ERROR,t)}};i.append(g,s)}onBufferFlushing(e,r){let t=this["operationQueue"],i=t=>({execute:this.removeExecutor.bind(this,t,r.startOffset,r.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(R.BUFFER_FLUSHED,{type:t})},onError:e=>{I.warn(`[buffer-controller]: Failed to remove from ${t} SourceBuffer`,e)}});r.type?t.append(i(r.type),r.type):this.getSourceBufferTypes().forEach(e=>{t.append(i(e),e)})}onFragParsed(e,t){let{frag:r,part:i}=t,n=[],a=(i||r).elementaryStreams;a[J]?n.push("audiovideo"):(a[T]&&n.push("audio"),a[S]&&n.push("video")),0===n.length&&I.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: `+r.sn),this.blockBuffers(()=>{var e=self.performance.now(),e=(r.stats.buffering.end=e,i&&(i.stats.buffering.end=e),(i||r).stats);this.hls.trigger(R.FRAG_BUFFERED,{frag:r,part:i,stats:e,id:r.type})},n)}onFragChanged(e,t){this.flushBackBuffer()}onBufferEos(e,i){this.getSourceBufferTypes().reduce((e,t)=>{var r=this.sourceBuffer[t];return!r||i.type&&i.type!==t||(r.ending=!0,r.ended)||(r.ended=!0,I.log(`[buffer-controller]: ${t} sourceBuffer now EOS`)),e&&!(r&&!r.ended)},!0)&&(I.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(e=>{e=this.sourceBuffer[e];e&&(e.ending=!1)});var e=this["mediaSource"];e&&"open"===e.readyState?(I.log("[buffer-controller]: Calling mediaSource.endOfStream()"),e.endOfStream()):e&&I.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+e.readyState)}))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}flushBackBuffer(){let{hls:s,details:o,media:t,sourceBuffer:l}=this;if(t&&null!==o){var r=this.getSourceBufferTypes();if(r.length){var h=o.live&&null!==s.config.liveBackBufferLength?s.config.liveBackBufferLength:s.config.backBufferLength;if(M(h)&&!(h<0)){let i=t.currentTime,n=o.levelTargetDuration,e=Math.max(h,n),a=Math.floor(i/n)*n-e;r.forEach(t=>{var r=l[t];if(r){let e=O.getBuffered(r);if(0<e.length&&a>e.start(0)){if(s.trigger(R.BACK_BUFFER_REACHED,{bufferEnd:a}),o.live)s.trigger(R.LIVE_BACK_BUFFER_REACHED,{bufferEnd:a});else if(r.ended&&e.end(e.length-1)-i<2*n)return void I.info(`[buffer-controller]: Cannot flush ${t} back buffer while SourceBuffer is in ended state`);s.trigger(R.BUFFER_FLUSHING,{startOffset:0,endOffset:a,type:t})}}})}}}}updateMediaElementDuration(){var e,t,r,i,n,a;this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState&&({details:e,hls:t,media:n,mediaSource:r}=this,i=e.fragments[0].start+e.totalduration,n=n.duration,a=M(r.duration)?r.duration:0,e.live&&t.config.liveDurationInfinity?(I.log("[buffer-controller]: Media Source duration is set to Infinity"),r.duration=1/0,this.updateSeekableRange(e)):(a<i&&n<i||!M(n))&&(I.log("[buffer-controller]: Updating Media Source duration to "+i.toFixed(3)),r.duration=i))}updateSeekableRange(e){var t=this.mediaSource,r=e.fragments;r.length&&e.live&&null!=t&&t.setLiveSeekableRange&&(r=Math.max(0,r[0].start),e=Math.max(r,r+e.totalduration),t.setLiveSeekableRange(r,e))}checkPendingTracks(){let{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:r}=this,i=Object.keys(r).length;if(i&&!e||2===i){this.createSourceBuffers(r),this.pendingTracks={};let e=this.getSourceBufferTypes();if(e.length)this.hls.trigger(R.BUFFER_CREATED,{tracks:this.tracks}),e.forEach(e=>{t.executeNext(e)});else{let e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(R.ERROR,{type:C.MEDIA_ERROR,details:D.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}}createSourceBuffers(e){var r,{sourceBuffer:i,mediaSource:n}=this;if(!n)throw Error("createSourceBuffers called when mediaSource was null");for(r in e)if(!i[r]){var a=e[r];if(!a)throw Error(`source buffer exists for track ${r}, however track does not`);var s=a.levelCodec||a.codec,o=a.container+";codecs="+s;I.log(`[buffer-controller]: creating sourceBuffer(${o})`);try{let e=i[r]=n.addSourceBuffer(o),t=r;this.addBufferListener(t,"updatestart",this._onSBUpdateStart),this.addBufferListener(t,"updateend",this._onSBUpdateEnd),this.addBufferListener(t,"error",this._onSBUpdateError),this.tracks[r]={buffer:e,codec:s,container:a.container,levelCodec:a.levelCodec,metadata:a.metadata,id:a.id}}catch(e){I.error("[buffer-controller]: error while trying to add sourceBuffer: "+e.message),this.hls.trigger(R.ERROR,{type:C.MEDIA_ERROR,details:D.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,mimeType:o})}}}_onSBUpdateStart(e){var t=this["operationQueue"];t.current(e).onStart()}_onSBUpdateEnd(e){var t=this["operationQueue"];t.current(e).onComplete(),t.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){var r=new Error(e+" SourceBuffer error"),r=(I.error("[buffer-controller]: "+r,t),this.hls.trigger(R.ERROR,{type:C.MEDIA_ERROR,details:D.BUFFER_APPENDING_ERROR,error:r,fatal:!1}),this.operationQueue.current(e));r&&r.onError(t)}removeExecutor(e,t,r){var{media:i,mediaSource:n,operationQueue:a,sourceBuffer:s}=this,s=s[e];i&&n&&s?(i=M(i.duration)?i.duration:1/0,n=M(n.duration)?n.duration:1/0,(t=Math.max(0,t))<(r=Math.min(r,i,n))&&!s.ending?(s.ended=!1,I.log(`[buffer-controller]: Removing [${t},${r}] from the ${e} SourceBuffer`),s.remove(t,r)):a.shiftAndExecuteNext(e)):(I.warn(`[buffer-controller]: Attempting to remove from the ${e} SourceBuffer, but it does not exist`),a.shiftAndExecuteNext(e))}appendExecutor(e,t){var{operationQueue:r,sourceBuffer:i}=this,i=i[t];i?(i.ended=!1,i.appendBuffer(e)):(I.warn(`[buffer-controller]: Attempting to append to the ${t} SourceBuffer, but it does not exist`),r.shiftAndExecuteNext(t))}blockBuffers(t,i=this.getSourceBufferTypes()){if(i.length){let r=this["operationQueue"],e=i.map(e=>r.appendBlocker(e));Promise.all(e).then(()=>{t(),i.forEach(e=>{var t=this.sourceBuffer[e];null!=t&&t.updating||r.shiftAndExecuteNext(e)})})}else I.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(t)}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,r){var i=this.sourceBuffer[e];i&&(r=r.bind(this,e),this.listeners[e].push({event:t,listener:r}),i.addEventListener(t,r))}removeBufferListeners(e){let t=this.sourceBuffer[e];t&&this.listeners[e].forEach(e=>{t.removeEventListener(e.event,e.listener)})}},capLevelController:vn,errorController:class{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=I.log.bind(I,"[info]:"),this.warn=I.warn.bind(I,"[warning]:"),this.error=I.error.bind(I,"[error]:"),this.registerListeners()}registerListeners(){var e=this.hls;e.on(R.ERROR,this.onError,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){var e=this.hls;e&&(e.off(R.ERROR,this.onError,this),e.off(R.ERROR,this.onErrorOut,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){this.playlistError=0}stopLoad(){}getVariantLevelIndex(e){return(null==e?void 0:e.type)===x?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,r){if(!r.fatal){var t,i=this.hls,n=r.context;switch(r.details){case D.FRAG_LOAD_ERROR:case D.FRAG_LOAD_TIMEOUT:case D.KEY_LOAD_ERROR:case D.KEY_LOAD_TIMEOUT:return void(r.errorAction=this.getFragRetryOrSwitchAction(r));case D.FRAG_PARSING_ERROR:if(null!=(t=r.frag)&&t.gap)return void(r.errorAction={action:0,flags:0});case D.FRAG_GAP:case D.FRAG_DECRYPT_ERROR:return r.errorAction=this.getFragRetryOrSwitchAction(r),void(r.errorAction.action=2);case D.LEVEL_EMPTY_ERROR:case D.LEVEL_PARSING_ERROR:{let e=r.parent===x?r.level:i.loadLevel;r.details===D.LEVEL_EMPTY_ERROR&&null!=(t=r.context)&&null!=(t=t.levelDetails)&&t.live?r.errorAction=this.getPlaylistRetryOrSwitchAction(r,e):(r.levelRetry=!1,r.errorAction=this.getLevelSwitchAction(r,e))}return;case D.LEVEL_LOAD_ERROR:case D.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==n?void 0:n.level)&&(r.errorAction=this.getPlaylistRetryOrSwitchAction(r,n.level)));case D.AUDIO_TRACK_LOAD_ERROR:case D.AUDIO_TRACK_LOAD_TIMEOUT:case D.SUBTITLE_LOAD_ERROR:case D.SUBTITLE_TRACK_LOAD_TIMEOUT:if(n){let e=i.levels[i.loadLevel];if(e&&(n.type===v&&n.groupId===e.audioGroupId||n.type===y&&n.groupId===e.textGroupId))return r.errorAction=this.getPlaylistRetryOrSwitchAction(r,i.loadLevel),r.errorAction.action=2,void(r.errorAction.flags=1)}return;case D.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{let e=i.levels[i.loadLevel],t=null==e?void 0:e.attrs["HDCP-LEVEL"];t&&(r.errorAction={action:2,flags:2,hdcpLevel:t})}return;case D.BUFFER_ADD_CODEC_ERROR:case D.REMUX_ALLOC_ERROR:return void(r.errorAction=this.getLevelSwitchAction(r,null!=(t=r.level)?t:i.loadLevel));case D.INTERNAL_EXCEPTION:case D.BUFFER_APPENDING_ERROR:case D.BUFFER_APPEND_ERROR:case D.BUFFER_FULL_ERROR:case D.LEVEL_SWITCH_ERROR:case D.BUFFER_STALLED_ERROR:case D.BUFFER_SEEK_OVER_HOLE:case D.BUFFER_NUDGE_ON_STALL:return void(r.errorAction={action:0,flags:0})}if(r.type===C.KEY_SYSTEM_ERROR){let e=this.getVariantLevelIndex(r.frag);r.levelRetry=!1,r.errorAction=this.getLevelSwitchAction(r,e)}}}getPlaylistRetryOrSwitchAction(e,t){var r=Dt(this.hls.config.playlistLoadPolicy,e),i=this.playlistError++,n=null==(n=e.response)?void 0:n.code;return kt(r,i,Ct(e),n)?{action:5,flags:0,retryConfig:r,retryCount:i}:(n=this.getLevelSwitchAction(e,t),r&&(n.retryConfig=r,n.retryCount=i),n)}getFragRetryOrSwitchAction(t){let e=this.hls,r=this.getVariantLevelIndex(t.frag),i=e.levels[r],{fragLoadPolicy:n,keyLoadPolicy:a}=e.config,s=Dt(t.details.startsWith("key")?a:n,t),o=e.levels.reduce((e,t)=>e+t.fragmentError,0);if(i){t.details!==D.FRAG_GAP&&i.fragmentError++;let e=null==(l=t.response)?void 0:l.code;if(kt(s,o,Ct(t),e))return{action:5,flags:0,retryConfig:s,retryCount:o}}var l=this.getLevelSwitchAction(t,r);return s&&(l.retryConfig=s,l.retryCount=o),l}getLevelSwitchAction(i,e){let r=this.hls;null==e&&(e=r.loadLevel);var n,a=this.hls.levels[e];if(a&&(a.loadError++,r.autoLevelEnabled)){let t=-1;var{levels:s,loadLevel:o,minAutoLevel:l,maxAutoLevel:h}=r,u=null==(n=i.frag)?void 0:n.type,{type:d,groupId:c}=null!=(e=i.context)?e:{};for(let e=s.length;e--;){let r=(e+o)%s.length;if(r!==o&&r>=l&&r<=h&&0===s[r].loadError){let e=s[r];if(i.details===D.FRAG_GAP&&i.frag){let t=s[r].details;if(t){let e=Ft(i.frag,t.fragments,i.frag.start);if(null!=e&&e.gap)continue}}else{if(d===v&&c===e.audioGroupId||d===y&&c===e.textGroupId)continue;if(u===_&&a.audioGroupId===e.audioGroupId||u===at&&a.textGroupId===e.textGroupId)continue}t=r;break}}if(-1<t&&r.loadLevel!==t)return i.levelRetry=!0,{action:2,flags:this.playlistError=0,nextAutoLevel:t}}return{action:2,flags:1}}onErrorOut(e,t){var r;switch(null==(r=t.errorAction)?void 0:r.action){case 0:break;case 2:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===D.FRAG_GAP||(t.fatal=!0)}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){var t=this.hls,r=e.errorAction;if(r){var{flags:i,hdcpLevel:n,nextAutoLevel:a}=r;switch(i){case 0:this.switchLevel(e,a);break;case 1:r.resolved||(r.resolved=this.redundantFailover(e));break;case 2:n&&(t.maxHdcpLevel=bt[bt.indexOf(n)-1],r.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`)}r.resolved||this.switchLevel(e,a)}}switchLevel(e,t){void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after `+e.details),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}redundantFailover(i){var{hls:n,penalizedRenditions:a}=this,s=i.parent===x?i.level:n.loadLevel,o=n.levels[s],l=o.url.length,h=(i.frag||o).urlId;o.urlId!==h||i.frag&&!o.details||this.penalizeRendition(o,i);for(let r=1;r<l;r++){let t=(h+r)%l,e=a[t];if(!e||function(t,r,e){if(3e5<performance.now()-t.lastErrorPerfMs)return 1;var i=t.details;if(r.details===D.FRAG_GAP&&i&&r.frag){let e=r.frag.start,t=Ft(null,i.fragments,e);if(t&&!t.gap)return 1}if(e&&t.errors.length<e.errors.length){let e=t.errors[t.errors.length-1];if(i&&e.frag&&r.frag&&Math.abs(e.frag.start-r.frag.start)>3*i.targetduration)return 1}}(e,i,a[h]))return this.warn(`Switching to Redundant Stream ${1+t}/${l}: "${o.url[t]}" after `+i.details),this.playlistError=0,n.levels.forEach(e=>{e.urlId=t}),n.nextLoadLevel=s,!0}return!1}penalizeRendition(e,t){var r=this["penalizedRenditions"],i=r[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};i.lastErrorPerfMs=performance.now(),i.errors.push(t),i.details=e.details,r[e.urlId]=i}},fpsController:class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(R.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(R.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){var r=this.hls.config;if(r.capLevelOnFPSDrop){let e=t.media instanceof self.HTMLVideoElement?t.media:null;(this.media=e)&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}checkFPS(e,a,s){var o,l=performance.now();if(a){if(this.lastTime){let e=l-this.lastTime,t=s-this.lastDroppedFrames,r=a-this.lastDecodedFrames,i=1e3*t/e,n=this.hls;n.trigger(R.FPS_DROP,{currentDropped:t,currentDecoded:r,totalDroppedFrames:s}),0<i&&t>n.config.fpsDroppedMonitoringThreshold*r&&(o=n.currentLevel,I.warn("drop FPS ratio greater than max allowed value for currentLevel: "+o),0<o)&&(-1===n.autoLevelCapping||n.autoLevelCapping>=o)&&(--o,n.trigger(R.FPS_DROP_LEVEL_CAPPING,{level:o,droppedLevel:n.currentLevel}),n.autoLevelCapping=o,this.streamController.nextLevelSwitch())}this.lastTime=l,this.lastDroppedFrames=s,this.lastDecodedFrames=a}}checkFPSInterval(){var e,t=this.media;t&&(this.isVideoPlaybackQualityAvailable?(e=t.getVideoPlaybackQuality(),this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)):this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount))}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:ce,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:Rn,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends yr{constructor(e,t,r){super(e,t,r,"[subtitle-stream-controller]",at),this.levels=[],this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null}_registerListeners(){var e=this["hls"];e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.LEVEL_LOADED,this.onLevelLoaded,this),e.on(R.ERROR,this.onError,this),e.on(R.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(R.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(R.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(R.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(R.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){var e=this["hls"];e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.LEVEL_LOADED,this.onLevelLoaded,this),e.off(R.ERROR,this.onError,this),e.off(R.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(R.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(R.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(R.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(R.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(R.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=u,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,r){var{frag:r,success:i}=r;if(this.fragPrevious=r,this.state=u,i){var n=this.tracksBuffered[this.currentTrackId];if(n){let t;var a=r.start;for(let e=0;e<n.length;e++)if(a>=n[e].start&&a<=n[e].end){t=n[e];break}i=r.start+r.duration;t?t.end=i:(t={start:a,end:i},n.push(t)),this.fragmentTracker.fragBuffered(r)}}}onBufferFlushing(e,t){var{startOffset:i,endOffset:n}=t;if(0===i&&n!==Number.POSITIVE_INFINITY){let r=n-1;r<=0||(t.endOffsetSubtitles=Math.max(0,r),this.tracksBuffered.forEach(t=>{for(let e=0;e<t.length;)if(t[e].end<=r)t.shift();else{if(!(t[e].start<r))break;t[e].start=r,e++}}),this.fragmentTracker.removeFragmentsInRange(i,r,at))}}onFragBuffered(e,t){this.loadedmetadata||t.frag.type!==x||null!=(t=this.media)&&t.buffered.length&&(this.loadedmetadata=!0)}onError(e,t){t=t.frag;(null==t?void 0:t.type)===at&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==s)&&(this.state=u)}onSubtitleTracksUpdated(e,{subtitleTracks:t}){wi(this.levels,t)?this.levels=t.map(e=>new Tt(e)):(this.tracksBuffered=[],this.levels=t.map(e=>{e=new Tt(e);return this.tracksBuffered[e.id]=[],e}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,at),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){this.currentTrackId=t.id,this.levels.length&&-1!==this.currentTrackId?(null!=(t=this.levels[this.currentTrackId])&&t.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,t&&this.setInterval(500)):this.clearInterval()}onSubtitleTrackLoaded(e,t){var{details:i,id:t}=t,{currentTrackId:r,levels:n}=this;if(n.length){var a=n[r];if(!(t>=n.length||t!==r)&&a){this.mediaBuffer=this.mediaBufferTimeRanges;let r=0;if(i.live||null!=(n=a.details)&&n.live){let e=this.mainDetails;if(i.deltaUpdateFailed||!e)return;let t=e.fragments[0];a.details?0===(r=this.alignPlaylists(i,a.details))&&t&&At(i,r=t.start):i.hasProgramDateTime&&e.hasProgramDateTime?(nr(i,e),r=i.fragments[0].start):t&&At(i,r=t.start)}a.details=i,this.levelLastLoaded=t,this.startFragRequested||!this.mainDetails&&i.live||this.setStartPosition(a.details,r),this.tick(),!i.live||this.fragCurrent||!this.media||this.state!==u||Ft(null,i.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),a.details=void 0)}}}_handleFragmentLoadComplete(e){let{frag:i,payload:t}=e,n=i.decryptdata,a=this.hls;if(!this.fragContextChanged(i)&&t&&0<t.byteLength&&n&&n.key&&n.iv&&"AES-128"===n.method){let r=performance.now();this.decrypter.decrypt(new Uint8Array(t),n.key.buffer,n.iv.buffer).catch(e=>{throw a.trigger(R.ERROR,{type:C.MEDIA_ERROR,details:D.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:i}),e}).then(e=>{var t=performance.now();a.trigger(R.FRAG_DECRYPTED,{frag:i,payload:e,stats:{tstart:r,tdecrypt:t}})}).catch(e=>{this.warn(e.name+": "+e.message),this.state=u})}}doTick(){if(this.media){if(this.state===u){var{currentTrackId:t,levels:r}=this,t=r[t];if(r.length&&t&&t.details){var r=this["config"],i=this.getLoadPosition(),{end:i,len:n}=O.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,r.maxBufferHole),a=this.getFwdBufferInfo(this.media,x),s=t.details;if(!(n>this.getMaxBufferLength(null==a?void 0:a.len)+s.levelTargetDuration)){var n=s.fragments,a=n.length,o=s.edge;let e=null;var l=this.fragPrevious;i<o?(r=o-(o=r.maxFragLookUpTolerance)<i?0:o,!(e=Ft(l,n,Math.max(n[0].start,i),r))&&l&&l.start<n[0].start&&(e=n[0])):e=n[a-1],e&&("initSegment"!==(e=this.mapToInitFragWhenRequired(e)).sn&&(o=n[e.sn-s.startSN-1])&&o.cc===e.cc&&this.fragmentTracker.getState(o)===Vt&&(e=o),this.fragmentTracker.getState(e)===Vt)&&this.loadFragment(e,t,i)}}}}else this.state=u}getMaxBufferLength(e){var t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,r){"initSegment"===(this.fragCurrent=e).sn?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,r))}get mediaBufferTimeRanges(){return new Ei(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends Bt{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.trackChangeListener=()=>this.onTextTracksChanged(),this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,-1<this.trackId&&this.toggleTrackModes(this.trackId)}registerListeners(){var e=this["hls"];e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.LEVEL_LOADING,this.onLevelLoading,this),e.on(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(R.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(R.ERROR,this.onError,this)}unregisterListeners(){var e=this["hls"];e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.LEVEL_LOADING,this.onLevelLoading,this),e.off(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(R.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(R.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(-1<this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)}onMediaDetaching(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),-1<this.trackId&&(this.queuedDefaultTrack=this.trackId),Mi(this.media.textTracks).forEach(e=>{dt(e)}),this.subtitleTrack=-1,this.media=null)}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){var r,{id:i,details:n}=t,a=this["trackId"],a=this.tracksInGroup[a];a?(r=a.details,a.details=t.details,this.log(`subtitle track ${i} loaded [${n.startSN}-${n.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,r)):this.warn("Invalid subtitle track id "+i)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){let t=this.hls.levels[e];if(null!=t&&t.textGroupIds){let r=t.textGroupIds[t.urlId],i=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==r){let e=this.tracks.filter(e=>!r||e.groupId===r),t=(this.tracksInGroup=e,this.findTrackId(null==i?void 0:i.name)||this.findTrackId());this.groupId=r||null;var n={subtitleTracks:e};this.log(`Updating subtitle tracks, ${e.length} track(s) found in "${r}" group-id`),this.hls.trigger(R.SUBTITLE_TRACKS_UPDATED,n),-1!==t&&this.setSubtitleTrack(t,i)}else this.shouldReloadPlaylist(i)&&this.setSubtitleTrack(this.trackId,i)}}findTrackId(t){var r=this.tracksInGroup;for(let e=0;e<r.length;e++){var i=r[e];if((!this.selectDefaultTrack||i.default)&&(!t||t===i.name))return i.id}return-1}onError(e,t){!t.fatal&&t.context&&t.context.type===y&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.checkRetry(t)}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1;var t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,t)}loadPlaylist(t){super.loadPlaylist();var r=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(r)){var i=r.id,n=r.groupId;let e=r.url;if(t)try{e=t.addDirectives(e)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("Loading subtitle playlist for id "+i),this.hls.trigger(R.SUBTITLE_TRACK_LOADING,{url:e,id:i,groupId:n,deliveryDirectives:t||null})}}toggleTrackModes(e){var{media:t,trackId:r}=this;if(t){var t=Mi(t.textTracks),i=t.filter(e=>e.groupId===this.groupId);if(-1===e)[].slice.call(t).forEach(e=>{e.mode="disabled"});else{let e=i[r];e&&(e.mode="disabled")}t=i[e];t&&(t.mode=this.subtitleDisplay?"showing":"hidden")}}setSubtitleTrack(e,a){var t;let r=this.tracksInGroup;if(this.media){if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(-1===e||null!=(t=r[e])&&t.details)||e<-1||e>=r.length)){this.clearTimer();var s=r[e];if(this.log("Switching to subtitle-track "+e+(s?` "${s.name}" lang:${s.lang} group:`+s.groupId:"")),this.trackId=e,s){let{id:e,groupId:t="",name:r,type:i,url:n}=s;this.hls.trigger(R.SUBTITLE_TRACK_SWITCH,{id:e,groupId:t,name:r,type:i,url:n});s=this.switchParams(s.url,null==a?void 0:a.details);this.loadPlaylist(s)}else this.hls.trigger(R.SUBTITLE_TRACK_SWITCH,{id:e})}}else this.queuedDefaultTrack=e}onTextTracksChanged(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){let t=-1;var r=Mi(this.media.textTracks);for(let e=0;e<r.length;e++)if("hidden"===r[e].mode)t=e;else if("showing"===r[e].mode){t=e;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}}},timelineController:class{constructor(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){let e=new $i(this,"textTrack1"),t=new $i(this,"textTrack2"),r=new $i(this,"textTrack3"),i=new $i(this,"textTrack4");this.cea608Parser1=new Wi(1,e,t),this.cea608Parser2=new Wi(3,r,i)}e.on(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(R.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(R.FRAG_LOADING,this.onFragLoading,this),e.on(R.FRAG_LOADED,this.onFragLoaded,this),e.on(R.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(R.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(R.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(R.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(R.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){var e=this["hls"];e.off(R.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(R.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(R.FRAG_LOADING,this.onFragLoading,this),e.off(R.FRAG_LOADED,this.onFragLoaded,this),e.off(R.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(R.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(R.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(R.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(R.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}addCues(t,i,n,r,a){let s=!1;for(let r=a.length;r--;){let e=a[r],t=(o=e[0],l=e[1],h=i,Math.min(l,n)-Math.max(o,h));if(0<=t&&(e[0]=Math.min(e[0],i),e[1]=Math.max(e[1],n),s=!0,.5<t/(n-i)))return}var o,l,h;if(s||a.push([i,n]),this.config.renderTextTracksNatively){let e=this.captionsTracks[t];this.Cues.newCue(e,i,n,r)}else{let e=this.Cues.newCue(null,i,n,r);this.hls.trigger(R.CUES_PARSED,{type:"captions",cues:e,track:t})}}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:n}){var a=this["unparsedVttFrags"];"main"===r&&(this.initPTS[t.cc]={baseTime:i,timescale:n}),a.length&&(this.unparsedVttFrags=[],a.forEach(e=>{this.onFragLoaded(R.FRAG_LOADED,e)}))}getExistingTrack(t){var r=this["media"];if(r)for(let e=0;e<r.textTracks.length;e++){var i=r.textTracks[e];if(i[t])return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(s){if(!this.captionsTracks[s]){let{captionsProperties:e,captionsTracks:t,media:r}=this,{label:i,languageCode:n}=e[s],a=this.getExistingTrack(s);if(a)t[s]=a,dt(t[s]),ht(t[s],r);else{let e=this.createTextTrack("captions",i,n);e&&(e[s]=!0,t[s]=e)}}}createNonNativeTrack(e){var t;this.nonNativeCaptionsTracks[e]||(t=this.captionsProperties[e])&&(t={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media},this.nonNativeCaptionsTracks[e]=t,this.hls.trigger(R.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[t]}))}createTextTrack(e,t,r){var i=this.media;if(i)return i.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){let t=this["captionsTracks"];Object.keys(t).forEach(e=>{dt(t[e]),delete t[e]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){var e=this["media"];if(e){var t=e.textTracks;if(t)for(let e=0;e<t.length;e++)dt(t[e])}}onSubtitleTracksUpdated(e,t){var t=t.subtitleTracks||[],r=t.some(e=>"stpp.ttml.im1t"===e.textCodec);if(this.config.enableWebVTT||r&&this.config.enableIMSC1)if(wi(this.tracks,t))this.tracks=t;else if(this.textTracks=[],this.tracks=t,this.config.renderTextTracksNatively){let s=this.media?this.media.textTracks:null;this.tracks.forEach((r,e)=>{let i;if(s&&e<s.length){let t=null;for(let e=0;e<s.length;e++)if(n=s[e],a=r,n&&n.label===a.name&&!n.textTrack1&&!n.textTrack2){t=s[e];break}t&&(i=t)}var n,a;if(i)dt(i);else{let e=this._captionsOrSubtitlesFromCharacteristics(r);(i=this.createTextTrack(e,r.name,r.lang))&&(i.mode="disabled")}i&&(i.groupId=r.groupId,this.textTracks.push(i))})}else if(this.tracks.length){let e=this.tracks.map(e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}));this.hls.trigger(R.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}_captionsOrSubtitlesFromCharacteristics(e){if(e.attrs.CHARACTERISTICS){var t=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),e=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(t&&e)return"captions"}return"subtitles"}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(e=>{var t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);t&&(t="textTrack"+t[1],t=this.captionsProperties[t])&&(t.label=e.name,e.lang&&(t.languageCode=e.lang),t.media=e)})}closedCaptionsForLevel(e){e=this.hls.levels[e.level];return null==e?void 0:e.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,r){var{cea608Parser1:i,cea608Parser2:n,lastSn:a,lastPartIndex:s}=this;if(this.enabled&&i&&n&&r.frag.type===x){let e=r.frag.sn,t=null!=(r=null==r||null==(r=r.part)?void 0:r.index)?r:-1;e===a+1||e===a&&t===s+1||(i.reset(),n.reset()),this.lastSn=e,this.lastPartIndex=t}}onFragLoaded(e,r){var{frag:i,payload:n}=r;if(i.type===at)if(n.byteLength){let e=i.decryptdata,t="stats"in r;if(null==e||!e.encrypted||t){let e=this.tracks[i.level],t=this.vttCCs;t[i.cc]||(t[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),e&&"stpp.ttml.im1t"===e.textCodec?this._parseIMSC1(i,n):this._parseVTTs(r)}}else this.hls.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(t,e){let r=this.hls;dn(e,this.initPTS[t.cc],e=>{this._appendCues(e,t.level),r.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},e=>{I.log("Failed to parse IMSC1: "+e),r.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:e})})}_parseVTTs(u){let d,{frag:c,payload:f}=u,{initPTS:e,unparsedVttFrags:p}=this,m=e.length-1;if(e[c.cc]||-1!=m){let h=this.hls;{var g=null!=(d=c.initSegment)&&d.data?Ie(c.initSegment.data,new Uint8Array(f)):f;var v=this.initPTS[c.cc];var y=this.vttCCs;var x=c.cc;var b=c.start;var _=e=>{this._appendCues(e,c.level),h.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:c})};var T=e=>{var t="Missing initPTS for VTT MPEGTS"===e.message;t?p.push(u):this._fallbackToIMSC1(c,f),I.log("Failed to parse VTT cue: "+e),t&&m>c.cc||h.trigger(R.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:c,error:e})};let t=new rn,e=w(new Uint8Array(g)).trim().replace(sn,"\n").split("\n"),n=[],a=v?([g,S=1]=[v.baseTime,v.timescale],qr(g,9e4,1/S)):0;var S;let s,r="00:00.000",o=0,l=0,i=!0;t.oncue=function(e){var t=y[x];let r=y.ccOffset;var i=(o-a)/9e4;if(null!=t&&t.new&&(void 0!==l?r=y.ccOffset=t.start:function(e,t){let r=e[x],i=e[r.prevCC];if(!i||!i.new&&r.new)return e.ccOffset=e.presentationOffset=r.start,r.new=!1;for(;null!=(n=i)&&n.new;){var n;e.ccOffset+=r.start-i.start,r.new=!1,i=e[(r=i).prevCC]}e.presentationOffset=t}(y,i)),i){if(!v)return void(s=new Error("Missing initPTS for VTT MPEGTS"));r=i-y.presentationOffset}t=e.endTime-e.startTime,i=B(9e4*(e.startTime+r-l),9e4*b)/9e4,e.startTime=Math.max(i,0),e.endTime=Math.max(i+t,0),i=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(i)),e.id||(e.id=on(e.startTime,e.endTime,i)),0<e.endTime&&n.push(e)},t.onparsingerror=function(e){s=e},t.onflush=function(){s?T(s):_(n)},e.forEach(e=>{if(i){if(nn(e,"X-TIMESTAMP-MAP=")){i=!1,e.slice(16).split(",").forEach(e=>{nn(e,"LOCAL:")?r=e.slice(6):nn(e,"MPEGTS:")&&(o=parseInt(e.slice(7)))});try{l=function(e){var t=parseInt(e.slice(-3)),r=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),n=9<e.length?parseInt(e.substring(0,e.indexOf(":"))):0;if(M(t)&&M(r)&&M(i)&&M(n))return(t+=1e3*r)+6e4*i+36e5*n;throw Error("Malformed X-TIMESTAMP-MAP: Local:"+e)}(r)/1e3}catch(e){s=e}return}""===e&&(i=!1)}t.parse(e+"\n")}),t.flush()}}else p.push(u)}_fallbackToIMSC1(e,t){let r=this.tracks[e.level];r.textCodec||dn(t,this.initPTS[e.cc],()=>{r.textCodec="stpp.ttml.im1t",this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,r){let t=this.hls;if(this.config.renderTextTracksNatively){let t=this.textTracks[r];t&&"disabled"!==t.mode&&e.forEach(e=>ut(t,e))}else{var i=this.tracks[r];i&&(i=i.default?"default":"subtitles"+r,t.trigger(R.CUES_PARSED,{type:"subtitles",cues:e,track:i}))}}onFragDecrypted(e,t){var r=t["frag"];r.type===at&&this.onFragLoaded(R.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){var{cea608Parser1:n,cea608Parser2:a}=this;if(this.enabled&&n&&a){let{frag:e,samples:i}=t;if(e.type!==x||"NONE"!==this.closedCaptionsForLevel(e))for(let r=0;r<i.length;r++){let t=i[r].bytes;if(t){let e=this.extractCea608Data(t);n.addData(i[r].pts,e[0]),a.addData(i[r].pts,e[1])}}}}onBufferFlushing(e,{startOffset:r,endOffset:i,endOffsetSubtitles:n,type:t}){var a=this["media"];if(a&&!(a.currentTime<i)){if(!t||"video"===t){let t=this["captionsTracks"];Object.keys(t).forEach(e=>ct(t[e],r,i))}if(this.config.renderTextTracksNatively&&0===r&&void 0!==n){let t=this["textTracks"];Object.keys(t).forEach(e=>ct(t[e],r,n))}}}extractCea608Data(n){let a=[[],[]],t=31&n[0],s=2;for(let e=0;e<t;e++){let t=n[s++],r=127&n[s++],i=127&n[s++];if((0!=r||0!=i)&&0!=(4&t)){let e=3&t;0!=e&&1!=e||(a[e].push(r),a[e].push(i))}}return a}},audioStreamController:class extends yr{constructor(e,t,r){super(e,t,r,"[audio-stream-controller]",_),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){var e=this["hls"];e.on(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.LEVEL_LOADED,this.onLevelLoaded,this),e.on(R.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(R.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(R.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(R.ERROR,this.onError,this),e.on(R.BUFFER_RESET,this.onBufferReset,this),e.on(R.BUFFER_CREATED,this.onBufferCreated,this),e.on(R.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(R.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(R.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){var e=this["hls"];e.off(R.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.LEVEL_LOADED,this.onLevelLoaded,this),e.off(R.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(R.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(R.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(R.ERROR,this.onError,this),e.off(R.BUFFER_RESET,this.onBufferReset,this),e.off(R.BUFFER_CREATED,this.onBufferCreated,this),e.off(R.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(R.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(R.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:n}){if("main"===r){let e=t.cc;this.initPTS[t.cc]={baseTime:i,timescale:n},this.log(`InitPTS for cc: ${e} found from main: `+i),this.videoTrackCC=e,this.state===gr&&this.tick()}}startLoad(e){var t;this.levels?(t=this.lastCurrentTime,this.stopLoad(),this.setInterval(100),0<t&&-1===e?(this.log("Override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t,this.state=u):(this.loadedmetadata=!1,this.state=cr),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()):(this.startPosition=e,this.state=s)}doTick(){switch(this.state){case u:this.doTickIdle();break;case cr:{var i;let{levels:e,trackId:t}=this,r=null==e||null==(i=e[t])?void 0:i.details;if(r){if(this.waitForCdnTuneIn(r))break;this.state=gr}break}case dr:{var r;let e=performance.now(),t=this.retryDate;(!t||e>=t||null!=(r=this.media)&&r.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=u);break}case gr:{let e=this.waitingData;if(e){let{frag:r,part:t,cache:i,complete:n}=e;if(void 0!==this.initPTS[r.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=ur;let e={frag:r,part:t,payload:i.flush(),networkDetails:null};this._handleFragmentLoadProgress(e),n&&super._handleFragmentLoadComplete(e)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${r.cc}) cancelled because video is at cc `+this.videoTrackCC),this.clearWaitingFragment();else{let e=this.getLoadPosition(),t=O.bufferInfo(this.mediaBuffer,e,this.config.maxBufferHole);Nt(t.end,this.config.maxFragLookUpTolerance,r)<0&&(this.log(`Waiting fragment cc (${r.cc}) @ ${r.start} cancelled because another fragment at ${t.end} is needed`),this.clearWaitingFragment())}}else this.state=u}}this.onTickEnd()}clearWaitingFragment(){var e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=u)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){var e=this["media"];null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){let{hls:e,levels:t,media:n,trackId:r}=this,i=e.config;if(null!=t&&t[r]&&(n||!this.startFragRequested&&i.startFragPrefetch)){var a=t[r],s=a.details;if(!s||s.live&&this.levelLastLoaded!==r||this.waitForCdnTuneIn(s))this.state=cr;else{var o=this.mediaBuffer||this.media,o=(this.bufferFlushed&&o&&(this.bufferFlushed=!1,this.afterBufferFlushed(o,T,_)),this.getFwdBufferInfo(o,_));if(null!==o){var{bufferedTrack:l,switchingTrack:h}=this;if(!h&&this._streamEnded(o,s))e.trigger(R.BUFFER_EOS,{type:"audio"}),this.state=pr;else{var u=this.getFwdBufferInfo(this.videoBuffer||this.media,x),d=o.len,c=this.getMaxBufferLength(null==u?void 0:u.len);if(!(c<=d)||h){d=s.fragments[0].start;let t=o.end;if(h&&n){let e=this.getLoadPosition();l&&h.attrs!==l.attrs&&(t=e),s.PTSKnown&&e<d&&(o.end>d||o.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=d+.05)}let r=this.getNextFragment(t,s),i=!1;if(r&&this.isLoopLoading(r,t)&&(i=!!r.gap,r=this.getNextFragmentLoopLoading(r,s,o,x,c)),r){h=u&&r.start>u.end+s.targetduration;if(h||(null==u||!u.len)&&o.len){let e=this.getAppendedFrag(r.start,x);if(null===e)return;if(i=i||!!e.gap||!!h&&0===u.len,h&&!i||i&&o.nextStart&&o.nextStart<e.end)return}this.loadFragment(r,a,t)}else this.bufferFlushed=!0}}}}}}getMaxBufferLength(e){var t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(e=>new Tt(e))}onAudioTrackSwitching(e,t){var r=!!t.url,i=(this.trackId=t.id,this)["fragCurrent"];i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.switchingTrack=t,this.state=u):(this.switchingTrack=null,this.bufferedTrack=t,this.state=s),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(R.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,r){var i;if(null==this.mainDetails)this.cachedTrackLoadedData=r;else{var n=this["levels"],{details:r,id:a}=r;if(n){this.log(`Track ${a} loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:`+r.totalduration);n=n[a];let t=0;if(r.live||null!=(i=n.details)&&i.live){this.checkLiveUpdate(r);let e=this.mainDetails;if(r.deltaUpdateFailed||!e)return;t=!n.details&&r.hasProgramDateTime&&e.hasProgramDateTime?(nr(r,e),r.fragments[0].start):this.alignPlaylists(r,n.details)}n.details=r,this.levelLastLoaded=a,this.startFragRequested||!this.mainDetails&&r.live||this.setStartPosition(n.details,t),this.state!==cr||this.waitForCdnTuneIn(r)||(this.state=u),this.tick()}else this.warn("Audio tracks were reset while loading level "+a)}}_handleFragmentLoadProgress(e){var t;let{frag:n,part:a,payload:s}=e,{config:r,trackId:o,levels:i}=this;if(i){e=i[o];if(e){var l=e.details;if(l){var h=r.defaultAudioCodec||e.audioCodec||"mp4a.40.2";let i=this.transmuxer;i=i||(this.transmuxer=new yi(this.hls,_,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var u=this.initPTS[n.cc],d=null==(t=n.initSegment)?void 0:t.data;if(void 0!==u){let e=a?a.index:-1,t=-1!==e,r=new er(n.level,n.sn,n.stats.chunkCount,s.byteLength,e,t);i.push(s,d,h,"",n,a,l.totalduration,!1,r,u)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${l.startSN} ,${l.endSN}],track `+o);let e=(this.waitingData=this.waitingData||{frag:n,part:a,cache:new Si,complete:!1})["cache"];e.push(new Uint8Array(s)),this.waitingVideoCC=this.videoTrackCC,this.state=gr}}else this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start)}else this.warn("Audio track is undefined on fragment load progress")}else this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`)}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){var r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){var{frag:t,part:r}=t;if(t.type===_)if(this.fragContextChanged(t))this.warn(`Fragment ${t.sn}${r?" p: "+r.index:""} of level ${t.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: `+(this.switchingTrack?this.switchingTrack.name:"false"));else{if("initSegment"!==t.sn){this.fragPrevious=t;let e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(R.AUDIO_TRACK_SWITCHED,m({},e)))}this.fragBufferedComplete(t,r)}else if(!this.loadedmetadata&&t.type===x){let e=this.videoBuffer||this.media;e&&O.getBuffered(e).length&&(this.loadedmetadata=!0)}}onError(e,t){var r;if(t.fatal)this.state=mr;else switch(t.details){case D.FRAG_GAP:case D.FRAG_PARSING_ERROR:case D.FRAG_DECRYPT_ERROR:case D.FRAG_LOAD_ERROR:case D.FRAG_LOAD_TIMEOUT:case D.KEY_LOAD_ERROR:case D.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(_,t);break;case D.AUDIO_TRACK_LOAD_ERROR:case D.AUDIO_TRACK_LOAD_TIMEOUT:case D.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==cr||(null==(r=t.context)?void 0:r.type)!==v||(this.state=u);break;case D.BUFFER_FULL_ERROR:t.parent&&"audio"===t.parent&&this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case D.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushed(e,{type:t}){t===T&&(this.bufferFlushed=!0,this.state===pr)&&(this.state=u)}_handleTransmuxComplete(e){var t;let r="audio",i=this["hls"],{remuxResult:n,chunkMeta:a}=e,s=this.getCurrentContext(a);if(s){var{frag:o,part:l,level:e}=s,h=e["details"],{audio:u,text:d,id3:c,initSegment:f}=n;if(!this.fragContextChanged(o)&&h){if(this.state=F,this.switchingTrack&&u&&this.completeAudioSwitch(this.switchingTrack),null!=f&&f.tracks){let e=o.initSegment||o;this._bufferInitSegment(f.tracks,e,a),i.trigger(R.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:r,tracks:f.tracks})}if(u){let{startPTS:e,endPTS:t,startDTS:r,endDTS:i}=u;l&&(l.elementaryStreams[T]={startPTS:e,endPTS:t,startDTS:r,endDTS:i}),o.setElementaryStreamInfo(T,e,t,r,i),this.bufferFragmentData(u,o,l,a)}if(null!=c&&null!=(t=c.samples)&&t.length){let e=L({id:r,frag:o,details:h},c);i.trigger(R.FRAG_PARSING_METADATA,e)}if(d){let e=L({id:r,frag:o,details:h},d);i.trigger(R.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(o)}else this.resetWhenMissingContext(a)}_bufferInitSegment(e,t,r){if(this.state===F){e.video&&delete e.video;var i=e.audio;if(i){i.levelCodec=i.codec,i.id="audio",this.log(`Init audio buffer, container:${i.container}, codecs[parsed]=[${i.codec}]`),this.hls.trigger(R.BUFFER_CODECS,e);i=i.initSegment;if(null!=i&&i.byteLength){let e={type:"audio",frag:t,part:null,chunkMeta:r,parent:t.type,data:i};this.hls.trigger(R.BUFFER_APPENDING,e)}this.tick()}}}loadFragment(e,t,r){var i=this.fragmentTracker.getState(e);this.fragCurrent=e,this.switchingTrack||i===Vt||i===Wt?"initSegment"===e.sn?this._loadInitSegment(e,t):null!=(i=t.details)&&i.live&&!this.initPTS[e.cc]?(this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level `+this.trackId),this.state=gr):(this.startFragRequested=!0,super.loadFragment(e,t,r)):this.clearTrackerIfNeeded(e)}completeAudioSwitch(e){var{hls:t,media:r,bufferedTrack:i}=this,i=null==i?void 0:i.attrs,n=e.attrs;r&&i&&(i.CHANNELS!==n.CHANNELS||i.NAME!==n.NAME||i.LANGUAGE!==n.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(R.AUDIO_TRACK_SWITCHED,m({},e))}},audioTrackController:class extends Bt{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){var e=this["hls"];e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.LEVEL_LOADING,this.onLevelLoading,this),e.on(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(R.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(R.ERROR,this.onError,this)}unregisterListeners(){var e=this["hls"];e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.LEVEL_LOADING,this.onLevelLoading,this),e.off(R.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(R.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(R.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){var r,{id:i,groupId:n,details:a}=t,s=this.tracksInGroup[i];s&&s.groupId===n?(r=s.details,s.details=t.details,this.log(`audio-track ${i} "${s.name}" lang:${s.lang} group:${n} loaded [${a.startSN}-${a.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,r)):this.warn(`Track with id:${i} and group:${n} not found in active group `+s.groupId)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){let t=this.hls.levels[e];if(null!=t&&t.audioGroupIds){let r=t.audioGroupIds[t.urlId];if(this.groupId!==r){this.groupId=r||null;let e=this.tracks.filter(e=>!r||e.groupId===r),t=(this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),{audioTracks:this.tracksInGroup=e});this.log(`Updating audio tracks, ${e.length} track(s) found in group:`+r),this.hls.trigger(R.AUDIO_TRACKS_UPDATED,t),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}}onError(e,t){!t.fatal&&t.context&&t.context.type===v&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(t))}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioTrack(e){var t,r,i,n=this.tracksInGroup;e<0||e>=n.length?this.warn("Invalid id passed to audio-track controller"):(this.clearTimer(),t=this.currentTrack,n[this.trackId],{groupId:r,name:i}=n=n[e],this.log(`Switching to audio-track ${e} "${i}" lang:${n.lang} group:`+r),this.trackId=e,this.currentTrack=n,this.selectDefaultTrack=!1,this.hls.trigger(R.AUDIO_TRACK_SWITCHING,m({},n)),n.details&&!n.details.live||(i=this.switchParams(n.url,null==t?void 0:t.details),this.loadPlaylist(i)))}selectInitialTrack(){let t=this.tracksInGroup,e=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(-1!==e)this.setAudioTrack(e);else{let e=new Error(`No track found for running audio group-ID: ${this.groupId} track count: `+t.length);this.warn(e.message),this.hls.trigger(R.ERROR,{type:C.MEDIA_ERROR,details:D.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:e})}}findTrackId(t){var r=this.tracksInGroup;for(let e=0;e<r.length;e++){var i=r[e];if(!this.selectDefaultTrack||i.default){if(!t||void 0!==t.attrs["STABLE-RENDITION-ID"]&&t.attrs["STABLE-RENDITION-ID"]===i.attrs["STABLE-RENDITION-ID"])return i.id;if(t.name===i.name&&t.lang===i.lang)return i.id}}return-1}loadPlaylist(t){super.loadPlaylist();var r=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(r)){var i=r.id,n=r.groupId;let e=r.url;if(t)try{e=t.addDirectives(e)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log(`loading audio-track playlist ${i} "${r.name}" lang:${r.lang} group:`+n),this.clearTimer(),this.hls.trigger(R.AUDIO_TRACK_LOADING,{url:e,id:i,groupId:n,deliveryDirectives:t||null})}}},emeController:yn,cmcdController:xn,contentSteeringController:class{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=I.log.bind(I,"[content-steering]:"),this.registerListeners()}registerListeners(){var e=this.hls;e.on(R.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(R.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.ERROR,this.onError,this)}unregisterListeners(){var e=this.hls;e&&(e.off(R.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(R.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.ERROR,this.onError,this))}startLoad(){var e;this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri&&(this.updated?(e=Math.max(1e3*this.timeToLoad-(performance.now()-this.updated),0),this.scheduleRefresh(this.uri,e)):this.loadSteeringManifest(this.uri))}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(t){var e=this.levels;e&&(this.levels=e.filter(e=>e!==t))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){t=t.contentSteering;null!==t&&(this.pathwayId=t.pathwayId,this.uri=t.uri,this.started)&&this.startLoad()}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){var r=t["errorAction"];if(2===(null==r?void 0:r.action)&&1===r.flags){let e=this.pathwayPriority,t=this.pathwayId;this.penalizedPathways[t]||(this.penalizedPathways[t]=performance.now()),(e=!e&&this.levels?this.levels.reduce((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e),[]):e)&&1<e.length&&(this.updatePathwayPriority(e),r.resolved=this.pathwayId!==t)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);var r;return 0===t.length&&(r=e[0].pathwayId,this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r),t.length!==e.length?(this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t):e}getLevelsForPathway(t){return null===this.levels?[]:this.levels.filter(e=>t===e.pathwayId)}updatePathwayPriority(t){this.pathwayPriority=t;let r=this.penalizedPathways,i=performance.now();Object.keys(r).forEach(e=>{3e5<i-r[e]&&delete r[e]});for(let e=0;e<t.length;e++){var n=t[e];if(!r[n]){if(n===this.pathwayId)return;var a,s=this.hls.nextLoadLevel,o=this.hls.levels[s];if(0<(a=this.getLevelsForPathway(n)).length){this.log(`Setting Pathway to "${n}"`),this.pathwayId=n,this.hls.trigger(R.LEVELS_UPDATED,{levels:a});let e=this.hls.levels[s];o&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==o.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==o.bitrate&&this.log(`Unstable Pathways change from bitrate ${o.bitrate} to `+e.bitrate),this.hls.nextLoadLevel=s);break}}}}clonePathways(e){let r=this.levels;if(r){let s={},o={};e.forEach(e=>{let{ID:n,"BASE-ID":t,"URI-REPLACEMENT":a}=e;r.some(e=>e.pathwayId===n)||(e=this.getLevelsForPathway(t).map(e=>{var t=L({},e),e=(t.details=void 0,t.url=_n(e.uri,e.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",a),new A(e.attrs)),r=(e["PATHWAY-ID"]=n,e.AUDIO&&e.AUDIO+"_clone_"+n),i=e.SUBTITLES&&e.SUBTITLES+"_clone_"+n,e=(r&&(s[e.AUDIO]=r,e.AUDIO=r),i&&(o[e.SUBTITLES]=i,e.SUBTITLES=i),t.attrs=e,new Tt(t));return zt(e,"audio",r),zt(e,"text",i),e}),r.push(...e),bn(this.audioTracks,s,a,n),bn(this.subtitleTracks,o,a,n))})}}loadSteeringManifest(e){var t=this.hls.config,r=t.loader;let o;this.loader&&this.loader.destroy(),this.loader=new r(t);try{o=new self.URL(e)}catch(t){return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: "+e)}if("data:"!==o.protocol){let e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);o.searchParams.set("_HLS_pathway",this.pathwayId),o.searchParams.set("_HLS_throughput",""+e)}var r={responseType:"json",url:o.href},e=t.steeringManifestLoadPolicy.default,i=e.errorRetry||e.timeoutRetry||{},e={loadPolicy:e,timeout:e.maxLoadTimeMs,maxRetry:i.maxNumRetry||0,retryDelay:i.retryDelayMs||0,maxRetryDelay:i.maxRetryDelayMs||0},i={onSuccess:(e,t,r,i)=>{this.log(`Loaded steering manifest: "${o}"`);var n=e.data;if(1!==n.VERSION)this.log(`Steering VERSION ${n.VERSION} not supported!`);else{this.updated=performance.now(),this.timeToLoad=n.TTL;var{"RELOAD-URI":n,"PATHWAY-CLONES":a,"PATHWAY-PRIORITY":s}=n;if(n)try{this.uri=new self.URL(n,o).href}catch(e){return this.enabled=!1,void this.log("Failed to parse Steering Manifest RELOAD-URI: "+n)}this.scheduleRefresh(this.uri||r.url),a&&this.clonePathways(a),s&&this.updatePathwayPriority(s)}},onError:(e,r,t,i)=>{if(this.log(`Error loading steering manifest: ${e.code} ${e.text} (${r.url})`),this.stopLoad(),410===e.code)this.enabled=!1,this.log(`Steering manifest ${r.url} no longer available`);else{var n=1e3*this.timeToLoad;if(429!==e.code)this.scheduleRefresh(this.uri||r.url,n);else{let t=this.loader;if("function"==typeof(null==t?void 0:t.getResponseHeader)){let e=t.getResponseHeader("Retry-After");e&&parseFloat(e)}this.log(`Steering manifest ${r.url} rate limited`)}}},onTimeout:(e,t,r)=>{this.log(`Timeout loading steering manifest (${t.url})`),this.scheduleRefresh(this.uri||t.url)}};this.log("Requesting steering manifest: "+o),this.loader.load(r,e,i)}scheduleRefresh(e,t=1e3*this.timeToLoad){self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout(()=>{this.loadSteeringManifest(e)},t)}}});function Dn(r){return r&&"object"==typeof r?Array.isArray(r)?r.map(Dn):Object.keys(r).reduce((e,t)=>(e[t]=Dn(r[t]),e),{}):r}class In{static get version(){return"1.4.12"}static isSupported(){return!!(t=He())&&(e=xr(),t=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),e=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove,!!t)&&!!e;var e,t}static get Events(){return R}static get ErrorTypes(){return C}static get ErrorDetails(){return D}static get DefaultConfig(){return In.defaultConfig||Cn}static set DefaultConfig(e){In.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new gi,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var t=e.debug||!1;if(self.console&&!0===t||"object"==typeof t){Y(t,"debug","log","info","warn","error");try{j.log('Debug logs enabled for "Hls instance" in hls.js version 1.4.12')}catch(t){j=W}}else j=W;var r=this.config=function(e,o){if((o.liveSyncDurationCount||o.liveMaxLatencyDurationCount)&&(o.liveSyncDuration||o.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==o.liveMaxLatencyDurationCount&&(void 0===o.liveSyncDurationCount||o.liveMaxLatencyDurationCount<=o.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==o.liveMaxLatencyDuration&&(void 0===o.liveSyncDuration||o.liveMaxLatencyDuration<=o.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');let l=Dn(e),t=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(e=>{let n=("level"===e?"playlist":e)+"LoadPolicy",a=void 0===o[n],s=[];t.forEach(t=>{var r=e+"Loading"+t,i=o[r];if(void 0!==i&&a){s.push(r);let e=l[n].default;switch(o[n]={default:e},t){case"TimeOut":e.maxLoadTimeMs=i,e.maxTimeToFirstByteMs=i;break;case"MaxRetry":e.errorRetry.maxNumRetry=i,e.timeoutRetry.maxNumRetry=i;break;case"RetryDelay":e.errorRetry.retryDelayMs=i,e.timeoutRetry.retryDelayMs=i;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=i,e.timeoutRetry.maxRetryDelayMs=i}}}),s.length&&I.warn(`hls.js config: "${s.join('", "')}" setting(s) are deprecated, use "${n}": `+JSON.stringify(o[n]))}),m(m({},l),o)}(In.DefaultConfig,e),{abrController:i,bufferController:e,capLevelController:n,errorController:a,fpsController:s}=(this.userConfig=e,this._autoLevelCapping=-1,r.progressive&&((i=(e=r).loader)!==En&&i!==Sn?(I.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),1}catch(e){}}()&&(e.loader=En,e.progressive=!0,e.enableSoftwareAES=!0,I.log("[config]: Progressive streaming enabled, using FetchLoader"))),r),a=new a(this),o=this.abrController=new i(this),e=this.bufferController=new e(this),n=this.capLevelController=new n(this),s=new s(this),l=new lt(this),h=new yt(this),u=r.contentSteeringController,u=u?new u(this):null,d=this.levelController=new Gt(this,u),c=new jt(this),f=new Zt(this.config),p=this.streamController=new bi(this,c,f),l=(n.setStreamController(p),s.setStreamController(p),[l,d,p]),d=(u&&l.splice(1,0,u),this.networkControllers=l,[o,e,n,s,h,c]),p=(this.audioTrackController=this.createController(r.audioTrackController,l),r.audioStreamController),u=(p&&l.push(new p(this,c,f)),this.subtitleTrackController=this.createController(r.subtitleTrackController,l),r.subtitleStreamController),o=(u&&l.push(new u(this,c,f)),this.createController(r.timelineController,d),f.emeController=this.emeController=this.createController(r.emeController,d),this.cmcdController=this.createController(r.cmcdController,d),this.latencyController=this.createController(xt,d),this.coreComponents=d,l.push(a),a.onErrorOut);"function"==typeof o&&this.on(R.ERROR,o,a)}createController(e,t){return e?(e=new e(this),t&&t.push(e),e):null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,i){this._emitter.off(e,t,r,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){I.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.trigger(R.ERROR,{type:C.OTHER_ERROR,details:D.INTERNAL_EXCEPTION,fatal:!1,event:e,error:t})}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){I.log("destroy"),this.trigger(R.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;var e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){I.log("attachMedia"),this._media=e,this.trigger(R.MEDIA_ATTACHING,{media:e})}detachMedia(){I.log("detachMedia"),this.trigger(R.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();var t=this.media,r=this.url,i=this.url=z.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});I.log("loadSource:"+i),t&&r&&(r!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(R.MANIFEST_LOADING,{url:e})}startLoad(t=-1){I.log(`startLoad(${t})`),this.networkControllers.forEach(e=>{e.startLoad(t)})}stopLoad(){I.log("stopLoad"),this.networkControllers.forEach(e=>{e.stopLoad()})}swapAudioCodec(){I.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){I.log("recoverMediaError");var e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e,t=0){this.levelController.removeLevel(e,t)}get levels(){return this.levelController.levels||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){I.log("set currentLevel:"+e),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){I.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){I.log("set loadLevel:"+e),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){I.log("set firstLevel:"+e),this.levelController.firstLevel=e}get startLevel(){return this.levelController.startLevel}set startLevel(e){I.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){e=!!e;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){var e=this.abrController["bwEstimator"];return e?e.getEstimate():NaN}get ttfbEstimate(){var e=this.abrController["bwEstimator"];return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(I.log("set autoLevelCapping:"+e),this._autoLevelCapping=e)}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){-1<bt.indexOf(e)&&(this._maxHdcpLevel=e)}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){var{levels:t,config:{minAutoBitrate:r}}=this;if(t){var i=t.length;for(let e=0;e<i;e++)if(t[e].maxBitrate>=r)return e}return 0}get maxAutoLevel(){var{levels:r,autoLevelCapping:e,maxHdcpLevel:i}=this;let n;if(n=-1===e&&r&&r.length?r.length-1:e,i)for(let t=n;t--;){let e=r[t].attrs["HDCP-LEVEL"];if(e&&e<=i)return t}return n}get nextAutoLevel(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)}set nextAutoLevel(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get audioTracks(){var e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){var e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}get subtitleTracks(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}In.defaultConfig=void 0},662:function(e,t,r){var i,n,a,l=r(1),_=r(27),s=(i=function(e,t){return(i=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(){return(s=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)}),o={width:"100%",height:"10px",top:"0px",left:"0px",cursor:"row-resize"},h={width:"10px",height:"100%",top:"0px",left:"0px",cursor:"col-resize"},u={width:"20px",height:"20px",position:"absolute"},d={top:s(s({},o),{top:"-5px"}),right:s(s({},h),{left:void 0,right:"-5px"}),bottom:s(s({},o),{top:void 0,bottom:"-5px"}),left:s(s({},h),{left:"-5px"}),topRight:s(s({},u),{right:"-10px",top:"-10px",cursor:"ne-resize"}),bottomRight:s(s({},u),{right:"-10px",bottom:"-10px",cursor:"se-resize"}),bottomLeft:s(s({},u),{left:"-10px",bottom:"-10px",cursor:"sw-resize"}),topLeft:s(s({},u),{left:"-10px",top:"-10px",cursor:"nw-resize"})},c=(n=l.PureComponent,i(a=f,o=n),a.prototype=null===o?Object.create(o):(p.prototype=o.prototype,new p),f.prototype.render=function(){return l.createElement("div",{className:this.props.className||"",style:s(s({position:"absolute",userSelect:"none"},d[this.props.direction]),this.props.replaceStyles||{}),onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart},this.props.children)},f);function f(){var t=null!==n&&n.apply(this,arguments)||this;return t.onMouseDown=function(e){t.props.onResizeStart(e,t.props.direction)},t.onTouchStart=function(e){t.props.onResizeStart(e,t.props.direction)},t}function p(){this.constructor=a}r.d(t,"a",function(){return L});function m(e,t,r){return Math.max(Math.min(e,r),t)}function T(e,t){return Math.round(e/t)*t}function g(e,t){return new RegExp(e,"i").test(t)}function S(e){return Boolean(e.touches&&e.touches.length)}function w(i,n,e){void 0===e&&(e=0);var t=n.reduce(function(e,t,r){return Math.abs(t-i)<Math.abs(n[e]-i)?r:e},0),r=Math.abs(n[t]-i);return 0===e||r<e?n[t]:i}function v(e){return"auto"===(e=e.toString())||e.endsWith("px")||e.endsWith("%")||e.endsWith("vh")||e.endsWith("vw")||e.endsWith("vmax")||e.endsWith("vmin")?e:e+"px"}function E(e,t,r,i){if(e&&"string"==typeof e){if(e.endsWith("px"))return Number(e.replace("px",""));if(e.endsWith("%"))return t*(Number(e.replace("%",""))/100);if(e.endsWith("vw"))return r*(Number(e.replace("vw",""))/100);if(e.endsWith("vh"))return i*(Number(e.replace("vh",""))/100)}return e}x=function(e,t){return(x=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)};var y,x,h=function(e,t){function r(){this.constructor=e}x(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},b=function(){return(b=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},M={width:"auto",height:"auto"},A=["as","ref","style","className","grid","snap","bounds","boundsByDirection","size","defaultSize","minWidth","minHeight","maxWidth","maxHeight","lockAspectRatio","lockAspectRatioExtraWidth","lockAspectRatioExtraHeight","enable","handleStyles","handleClasses","handleWrapperStyle","handleWrapperClass","children","onResizeStart","onResize","onResizeStop","handleComponent","scale","resizeRatio","snapGap"],L=(y=l.PureComponent,h(R,y),Object.defineProperty(R.prototype,"parentNode",{get:function(){return this.resizable?this.resizable.parentNode:null},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"window",{get:function(){return this.resizable&&this.resizable.ownerDocument?this.resizable.ownerDocument.defaultView:null},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"propsSize",{get:function(){return this.props.size||this.props.defaultSize||M},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"size",{get:function(){var e,t,r,i=0,n=0;return this.resizable&&this.window&&(e=this.resizable.offsetWidth,t=this.resizable.offsetHeight,"relative"!==(r=this.resizable.style.position)&&(this.resizable.style.position="relative"),i="auto"!==this.resizable.style.width?this.resizable.offsetWidth:e,n="auto"!==this.resizable.style.height?this.resizable.offsetHeight:t,this.resizable.style.position=r),{width:i,height:n}},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"sizeStyle",{get:function(){function e(e){var t;return void 0===r.state[e]||"auto"===r.state[e]?"auto":r.propsSize&&r.propsSize[e]&&null!=(t=r.propsSize[e])&&t.toString().endsWith("%")?r.state[e].toString().endsWith("%")?r.state[e].toString():(t=r.getParentSize(),Number(r.state[e].toString().replace("px",""))/t[e]*100+"%"):v(r.state[e])}var r=this,t=this.props.size;return{width:t&&void 0!==t.width&&!this.state.isResizing?v(t.width):e("width"),height:t&&void 0!==t.height&&!this.state.isResizing?v(t.height):e("height")}},enumerable:!1,configurable:!0}),R.prototype.getParentSize=function(){var e,t,r,i;return this.parentNode?(e=this.appendBase())?(t=!1,"wrap"!==(r=this.parentNode.style.flexWrap)&&(t=!0,this.parentNode.style.flexWrap="wrap"),e.style.position="relative",e.style.minWidth="100%",e.style.minHeight="100%",i={width:e.offsetWidth,height:e.offsetHeight},t&&(this.parentNode.style.flexWrap=r),this.removeBase(e),i):{width:0,height:0}:this.window?{width:this.window.innerWidth,height:this.window.innerHeight}:{width:0,height:0}},R.prototype.bindEvents=function(){this.window&&(this.window.addEventListener("mouseup",this.onMouseUp),this.window.addEventListener("mousemove",this.onMouseMove),this.window.addEventListener("mouseleave",this.onMouseUp),this.window.addEventListener("touchmove",this.onMouseMove,{capture:!0,passive:!1}),this.window.addEventListener("touchend",this.onMouseUp))},R.prototype.unbindEvents=function(){this.window&&(this.window.removeEventListener("mouseup",this.onMouseUp),this.window.removeEventListener("mousemove",this.onMouseMove),this.window.removeEventListener("mouseleave",this.onMouseUp),this.window.removeEventListener("touchmove",this.onMouseMove,!0),this.window.removeEventListener("touchend",this.onMouseUp))},R.prototype.componentDidMount=function(){var e;this.resizable&&this.window&&(e=this.window.getComputedStyle(this.resizable),this.setState({width:this.state.width||this.size.width,height:this.state.height||this.size.height,flexBasis:"auto"!==e.flexBasis?e.flexBasis:void 0}))},R.prototype.componentWillUnmount=function(){this.window&&this.unbindEvents()},R.prototype.createSizeForCssProperty=function(e,t){var r=this.propsSize&&this.propsSize[t];return"auto"!==this.state[t]||this.state.original[t]!==e||void 0!==r&&"auto"!==r?e:"auto"},R.prototype.calculateNewMaxFromBoundary=function(e,t){var r,i,n=this.props.boundsByDirection,a=this.state.direction,s=n&&g("left",a),n=n&&g("top",a);return"parent"===this.props.bounds?(a=this.parentNode)&&(r=s?this.resizableRight-this.parentLeft:a.offsetWidth+(this.parentLeft-this.resizableLeft),i=n?this.resizableBottom-this.parentTop:a.offsetHeight+(this.parentTop-this.resizableTop)):"window"===this.props.bounds?this.window&&(r=s?this.resizableRight:this.window.innerWidth-this.resizableLeft,i=n?this.resizableBottom:this.window.innerHeight-this.resizableTop):this.props.bounds&&(r=s?this.resizableRight-this.targetLeft:this.props.bounds.offsetWidth+(this.targetLeft-this.resizableLeft),i=n?this.resizableBottom-this.targetTop:this.props.bounds.offsetHeight+(this.targetTop-this.resizableTop)),{maxWidth:e=r&&Number.isFinite(r)?e&&e<r?e:r:e,maxHeight:t=i&&Number.isFinite(i)?t&&t<i?t:i:t}},R.prototype.calculateNewSizeFromDirection=function(e,t){var r=this.props.scale||1,i=(i=this.props.resizeRatio||1,Array.isArray(i)?i:[i,i]),n=i[0],i=i[1],a=this.state,s=a.direction,a=a.original,o=this.props,l=o.lockAspectRatio,h=o.lockAspectRatioExtraHeight,o=o.lockAspectRatioExtraWidth,u=a.width,d=a.height,h=h||0,o=o||0;return g("right",s)&&(u=a.width+(e-a.x)*n/r,l)&&(d=(u-o)/this.ratio+h),g("left",s)&&(u=a.width-(e-a.x)*n/r,l)&&(d=(u-o)/this.ratio+h),g("bottom",s)&&(d=a.height+(t-a.y)*i/r,l)&&(u=(d-h)*this.ratio+o),{newWidth:u=g("top",s)&&(d=a.height-(t-a.y)*i/r,l)?(d-h)*this.ratio+o:u,newHeight:d}},R.prototype.calculateNewSizeFromAspectRatio=function(e,t,r,i){var n,a,s=this.props,o=s.lockAspectRatio,l=s.lockAspectRatioExtraHeight,s=s.lockAspectRatioExtraWidth,h=void 0===i.width?10:i.width,u=void 0===r.width||r.width<0?e:r.width,i=void 0===i.height?10:i.height,r=void 0===r.height||r.height<0?t:r.height,l=l||0,s=s||0;return t=o?(o=(i-l)*this.ratio+s,n=(r-l)*this.ratio+s,a=(h-s)/this.ratio+l,s=(u-s)/this.ratio+l,l=Math.max(h,o),o=Math.min(u,n),n=Math.max(i,a),a=Math.min(r,s),e=m(e,l,o),m(t,n,a)):(e=m(e,h,u),m(t,i,r)),{newWidth:e,newHeight:t}},R.prototype.setBoundingClientRect=function(){var e,t,r,i;"parent"===this.props.bounds&&(i=this.parentNode)&&(i=i.getBoundingClientRect(),this.parentLeft=i.left,this.parentTop=i.top),this.props.bounds&&"string"!=typeof this.props.bounds&&(i=this.props.bounds.getBoundingClientRect(),this.targetLeft=i.left,this.targetTop=i.top),this.resizable&&(e=(i=this.resizable.getBoundingClientRect()).left,t=i.top,r=i.right,i=i.bottom,this.resizableLeft=e,this.resizableRight=r,this.resizableTop=t,this.resizableBottom=i)},R.prototype.onResizeStart=function(e,t){var r,i,n,a,s;this.resizable&&this.window&&(n=i=0,e.nativeEvent&&(s=e.nativeEvent,Boolean((s.clientX||0===s.clientX)&&(s.clientY||0===s.clientY)))?(i=e.nativeEvent.clientX,n=e.nativeEvent.clientY):e.nativeEvent&&S(e.nativeEvent)&&(i=e.nativeEvent.touches[0].clientX,n=e.nativeEvent.touches[0].clientY),this.props.onResizeStart&&this.resizable&&!1===this.props.onResizeStart(e,t,this.resizable)||(this.props.size&&(void 0!==this.props.size.height&&this.props.size.height!==this.state.height&&this.setState({height:this.props.size.height}),void 0!==this.props.size.width)&&this.props.size.width!==this.state.width&&this.setState({width:this.props.size.width}),this.ratio="number"==typeof this.props.lockAspectRatio?this.props.lockAspectRatio:this.size.width/this.size.height,"auto"!==(s=this.window.getComputedStyle(this.resizable)).flexBasis&&(a=this.parentNode)&&(a=this.window.getComputedStyle(a).flexDirection,this.flexDir=a.startsWith("row")?"row":"column",r=s.flexBasis),this.setBoundingClientRect(),this.bindEvents(),a={original:{x:i,y:n,width:this.size.width,height:this.size.height},isResizing:!0,backgroundStyle:b(b({},this.state.backgroundStyle),{cursor:this.window.getComputedStyle(e.target).cursor||"auto"}),direction:t,flexBasis:r},this.setState(a)))},R.prototype.onMouseMove=function(e){var t=this;if(this.state.isResizing&&this.resizable&&this.window){if(this.window.TouchEvent&&S(e))try{e.preventDefault(),e.stopPropagation()}catch(e){}var r,i=this.props,n=i.maxWidth,a=i.maxHeight,s=i.minWidth,i=i.minHeight,o=(S(e)?e.touches[0]:e).clientX,l=(S(e)?e.touches[0]:e).clientY,h=this.state,u=h.direction,d=h.original,c=h.width,h=h.height,f=this.getParentSize(),p=(p=f,m=this.window.innerWidth,g=this.window.innerHeight,y=a,x=s,r=i,v=E(n,p.width,m,g),y=E(y,p.height,m,g),x=E(x,p.width,m,g),r=E(r,p.height,m,g),{maxWidth:void 0===v?void 0:Number(v),maxHeight:void 0===y?void 0:Number(y),minWidth:void 0===x?void 0:Number(x),minHeight:void 0===r?void 0:Number(r)}),n=p.maxWidth,a=p.maxHeight,s=p.minWidth,i=p.minHeight,m=this.calculateNewSizeFromDirection(o,l),g=m.newHeight,v=m.newWidth,y=this.calculateNewMaxFromBoundary(n,a),x=(this.props.snap&&this.props.snap.x&&(v=w(v,this.props.snap.x,this.props.snapGap)),this.props.snap&&this.props.snap.y&&(g=w(g,this.props.snap.y,this.props.snapGap)),this.calculateNewSizeFromAspectRatio(v,g,{width:y.maxWidth,height:y.maxHeight},{width:s,height:i})),l=(v=x.newWidth,g=x.newHeight,this.props.grid&&(r=T(v,this.props.grid[0]),p=T(g,this.props.grid[1]),v=0===(o=this.props.snapGap||0)||Math.abs(r-v)<=o?r:v,g=0===o||Math.abs(p-g)<=o?p:g),{width:v-d.width,height:g-d.height}),b=(c&&"string"==typeof c&&(c.endsWith("%")?v=v/f.width*100+"%":c.endsWith("vw")?v=v/this.window.innerWidth*100+"vw":c.endsWith("vh")&&(v=v/this.window.innerHeight*100+"vh")),h&&"string"==typeof h&&(h.endsWith("%")?g=g/f.height*100+"%":h.endsWith("vw")?g=g/this.window.innerWidth*100+"vw":h.endsWith("vh")&&(g=g/this.window.innerHeight*100+"vh")),{width:this.createSizeForCssProperty(v,"width"),height:this.createSizeForCssProperty(g,"height")}),m=("row"===this.flexDir?b.flexBasis=b.width:"column"===this.flexDir&&(b.flexBasis=b.height),this.state.width!==b.width),n=this.state.height!==b.height,a=this.state.flexBasis!==b.flexBasis,y=m||n||a;y&&Object(_.flushSync)(function(){t.setState(b)}),this.props.onResize&&y&&this.props.onResize(e,u,this.resizable,l)}},R.prototype.onMouseUp=function(e){var t=this.state,r=t.isResizing,i=t.direction,t=t.original;r&&this.resizable&&(r={width:this.size.width-t.width,height:this.size.height-t.height},this.props.onResizeStop&&this.props.onResizeStop(e,i,this.resizable,r),this.props.size&&this.setState({width:null!=(t=this.props.size.width)?t:"auto",height:null!=(e=this.props.size.height)?e:"auto"}),this.unbindEvents(),this.setState({isResizing:!1,backgroundStyle:b(b({},this.state.backgroundStyle),{cursor:"auto"})}))},R.prototype.updateSize=function(e){var t;this.setState({width:null!=(t=e.width)?t:"auto",height:null!=(t=e.height)?t:"auto"})},R.prototype.renderResizer=function(){var t=this,e=this.props,r=e.enable,i=e.handleStyles,n=e.handleClasses,a=e.handleWrapperStyle,s=e.handleWrapperClass,o=e.handleComponent;return r?(e=Object.keys(r).map(function(e){return!1!==r[e]?l.createElement(c,{key:e,direction:e,onResizeStart:t.onResizeStart,replaceStyles:i&&i[e],className:n&&n[e]},o&&o[e]?o[e]:null):null}),l.createElement("div",{className:s,style:a},e)):null},R.prototype.render=function(){var r=this,e=Object.keys(this.props).reduce(function(e,t){return-1===A.indexOf(t)&&(e[t]=r.props[t]),e},{}),t=b(b(b({position:"relative",userSelect:this.state.isResizing?"none":"auto"},this.props.style),this.sizeStyle),{maxWidth:this.props.maxWidth,maxHeight:this.props.maxHeight,minWidth:this.props.minWidth,minHeight:this.props.minHeight,boxSizing:"border-box",flexShrink:0}),i=(this.state.flexBasis&&(t.flexBasis=this.state.flexBasis),this.props.as||"div");return l.createElement(i,b({style:t,className:this.props.className},e,{ref:function(e){e&&(r.resizable=e)}}),this.state.isResizing&&l.createElement("div",{style:this.state.backgroundStyle}),this.props.children,this.renderResizer())},R.defaultProps={as:"div",onResizeStart:function(){},onResize:function(){},onResizeStop:function(){},enable:{top:!0,right:!0,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},style:{},grid:[1,1],lockAspectRatio:!1,lockAspectRatioExtraWidth:0,lockAspectRatioExtraHeight:0,scale:1,resizeRatio:1,snapGap:0},R);function R(e){var r=y.call(this,e)||this;return r.ratio=1,r.resizable=null,r.parentLeft=0,r.parentTop=0,r.resizableLeft=0,r.resizableRight=0,r.resizableTop=0,r.resizableBottom=0,r.targetLeft=0,r.targetTop=0,r.appendBase=function(){var e,t;return r.resizable&&r.window&&(e=r.parentNode)?((t=r.window.document.createElement("div")).style.width="100%",t.style.height="100%",t.style.position="absolute",t.style.transform="scale(0, 0)",t.style.left="0",t.style.flex="0 0 100%",t.classList?t.classList.add("__resizable_base__"):t.className+="__resizable_base__",e.appendChild(t),t):null},r.removeBase=function(e){var t=r.parentNode;t&&t.removeChild(e)},r.state={isResizing:!1,width:null!=(e=null==(e=r.propsSize)?void 0:e.width)?e:"auto",height:null!=(e=null==(e=r.propsSize)?void 0:e.height)?e:"auto",direction:"right",original:{x:0,y:0,width:0,height:0},backgroundStyle:{height:"100%",width:"100%",backgroundColor:"rgba(0,0,0,0)",cursor:"auto",opacity:0,position:"fixed",zIndex:9999,top:"0",left:"0",bottom:"0",right:"0"},flexBasis:void 0},r.onResizeStart=r.onResizeStart.bind(r),r.onMouseMove=r.onMouseMove.bind(r),r.onMouseUp=r.onMouseUp.bind(r),r}},666:function(e,t,r){var i="function"==typeof Symbol&&Symbol.for,n=i?Symbol.for("react.element"):60103,a=i?Symbol.for("react.portal"):60106,s=i?Symbol.for("react.fragment"):60107,o=i?Symbol.for("react.strict_mode"):60108,l=i?Symbol.for("react.profiler"):60114,h=i?Symbol.for("react.provider"):60109,u=i?Symbol.for("react.context"):60110,d=i?Symbol.for("react.async_mode"):60111,c=i?Symbol.for("react.concurrent_mode"):60111,f=i?Symbol.for("react.forward_ref"):60112,p=i?Symbol.for("react.suspense"):60113,m=i?Symbol.for("react.suspense_list"):60120,g=i?Symbol.for("react.memo"):60115,v=i?Symbol.for("react.lazy"):60116,y=i?Symbol.for("react.block"):60121,x=i?Symbol.for("react.fundamental"):60117,b=i?Symbol.for("react.responder"):60118,_=i?Symbol.for("react.scope"):60119;function T(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case d:case c:case s:case l:case o:case p:return e;default:switch(e=e&&e.$$typeof){case u:case f:case v:case g:case h:return e;default:return t}}case a:return t}}}function S(e){return T(e)===c}t.AsyncMode=d,t.ConcurrentMode=c,t.ContextConsumer=u,t.ContextProvider=h,t.Element=n,t.ForwardRef=f,t.Fragment=s,t.Lazy=v,t.Memo=g,t.Portal=a,t.Profiler=l,t.StrictMode=o,t.Suspense=p,t.isAsyncMode=function(e){return S(e)||T(e)===d},t.isConcurrentMode=S,t.isContextConsumer=function(e){return T(e)===u},t.isContextProvider=function(e){return T(e)===h},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===n},t.isForwardRef=function(e){return T(e)===f},t.isFragment=function(e){return T(e)===s},t.isLazy=function(e){return T(e)===v},t.isMemo=function(e){return T(e)===g},t.isPortal=function(e){return T(e)===a},t.isProfiler=function(e){return T(e)===l},t.isStrictMode=function(e){return T(e)===o},t.isSuspense=function(e){return T(e)===p},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===s||e===c||e===l||e===o||e===p||e===m||"object"==typeof e&&null!==e&&(e.$$typeof===v||e.$$typeof===g||e.$$typeof===h||e.$$typeof===u||e.$$typeof===f||e.$$typeof===x||e.$$typeof===b||e.$$typeof===_||e.$$typeof===y)},t.typeOf=T},701:function(e,t,r){var i=r(132),n=r(607),a=r(131),s=r(320),r=i?i.prototype:void 0,o=r?r.toString:void 0;e.exports=function e(t){var r;return"string"==typeof t?t:a(t)?n(t,e)+"":s(t)?o?o.call(t):"":"0"==(r=t+"")&&1/t==-1/0?"-0":r}},723:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"DraggableCore",{enumerable:!0,get:function(){return x.default}}),t.default=void 0;var m=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=l(void 0);if(t&&t.has(e))return t.get(e);var r,i,n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((i=a?Object.getOwnPropertyDescriptor(e,r):null)&&(i.get||i.set)?Object.defineProperty(n,r,i):n[r]=e[r]);return n.default=e,t&&t.set(e,n),n}(r(1)),i=o(r(0)),n=o(r(27)),g=o(r(47)),v=r(588),y=r(615),a=r(575),x=o(r(725)),s=o(r(616));function o(e){return e&&e.__esModule?e:{default:e}}function l(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(l=function(e){return e?r:t})(e))}function b(){return(b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function h(e,t,r){var i;i=function(e){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return String(e);t=t.call(e,"string");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(t),(t="symbol"==typeof i?i:String(i))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}class u extends m.Component{static getDerivedStateFromProps(e,t){e=e.position,t=t.prevPropsPosition;return!e||t&&e.x===t.x&&e.y===t.y?null:((0,s.default)("Draggable: getDerivedStateFromProps %j",{position:e,prevPropsPosition:t}),{x:e.x,y:e.y,prevPropsPosition:{...e}})}constructor(e){super(e),h(this,"onDragStart",(e,t)=>{if((0,s.default)("Draggable: onDragStart: %j",t),!1===this.props.onStart(e,(0,y.createDraggableData)(this,t)))return!1;this.setState({dragging:!0,dragged:!0})}),h(this,"onDrag",(e,t)=>{if(!this.state.dragging)return!1;(0,s.default)("Draggable: onDrag: %j",t);var r=(0,y.createDraggableData)(this,t),i={x:r.x,y:r.y,slackX:0,slackY:0};if(this.props.bounds){let{x:e,y:t}=i;i.x+=this.state.slackX,i.y+=this.state.slackY;var[n,a]=(0,y.getBoundPosition)(this,i.x,i.y);i.x=n,i.y=a,i.slackX=this.state.slackX+(e-i.x),i.slackY=this.state.slackY+(t-i.y),r.x=i.x,r.y=i.y,r.deltaX=i.x-this.state.x,r.deltaY=i.y-this.state.y}if(!1===this.props.onDrag(e,r))return!1;this.setState(i)}),h(this,"onDragStop",(e,t)=>{if(!this.state.dragging)return!1;if(!1===this.props.onStop(e,(0,y.createDraggableData)(this,t)))return!1;(0,s.default)("Draggable: onDragStop: %j",t);var r={dragging:!1,slackX:0,slackY:0};if(Boolean(this.props.position)){let{x:e,y:t}=this.props.position;r.x=e,r.y=t}this.setState(r)}),this.state={dragging:!1,dragged:!1,x:(e.position||e.defaultPosition).x,y:(e.position||e.defaultPosition).y,prevPropsPosition:{...e.position},slackX:0,slackY:0,isElementSVG:!1},!e.position||e.onDrag||e.onStop||console.warn("A `position` was applied to this <Draggable>, without drag handlers. This will make this component effectively undraggable. Please attach `onDrag` or `onStop` handlers so you can adjust the `position` of this element.")}componentDidMount(){void 0!==window.SVGElement&&this.findDOMNode()instanceof window.SVGElement&&this.setState({isElementSVG:!0})}componentWillUnmount(){this.setState({dragging:!1})}findDOMNode(){var e;return null!=(e=null==(e=this.props)||null==(e=e.nodeRef)?void 0:e.current)?e:n.default.findDOMNode(this)}render(){let{axis:e,bounds:t,children:r,defaultPosition:i,defaultClassName:n,defaultClassNameDragging:a,defaultClassNameDragged:s,position:o,positionOffset:l,scale:h,...u}=this.props,d={},c=null;var f=!Boolean(o)||this.state.dragging,p=o||i,f={x:((0,y.canDragX)(this)&&f?this.state:p).x,y:((0,y.canDragY)(this)&&f?this.state:p).y},p=(this.state.isElementSVG?c=(0,v.createSVGTransform)(f,l):d=(0,v.createCSSTransform)(f,l),(0,g.default)(r.props.className||"",n,{[a]:this.state.dragging,[s]:this.state.dragged}));return m.createElement(x.default,b({},u,{onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop}),m.cloneElement(m.Children.only(r),{className:p,style:{...r.props.style,...d},transform:c}))}}h(t.default=u,"displayName","Draggable"),h(u,"propTypes",{...x.default.propTypes,axis:i.default.oneOf(["both","x","y","none"]),bounds:i.default.oneOfType([i.default.shape({left:i.default.number,right:i.default.number,top:i.default.number,bottom:i.default.number}),i.default.string,i.default.oneOf([!1])]),defaultClassName:i.default.string,defaultClassNameDragging:i.default.string,defaultClassNameDragged:i.default.string,defaultPosition:i.default.shape({x:i.default.number,y:i.default.number}),positionOffset:i.default.shape({x:i.default.oneOfType([i.default.number,i.default.string]),y:i.default.oneOfType([i.default.number,i.default.string])}),position:i.default.shape({x:i.default.number,y:i.default.number}),className:a.dontSetMe,style:a.dontSetMe,transform:a.dontSetMe}),h(u,"defaultProps",{...x.default.defaultProps,axis:"both",bounds:!1,defaultClassName:"react-draggable",defaultClassNameDragging:"react-draggable-dragging",defaultClassNameDragged:"react-draggable-dragged",defaultPosition:{x:0,y:0},scale:1})},724:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.browserPrefixToKey=a,t.browserPrefixToStyle=function(e,t){return t?"-".concat(t.toLowerCase(),"-").concat(e):e},t.default=void 0,t.getPrefix=n;let i=["Moz","Webkit","O","ms"];function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"transform";if("undefined"!=typeof window){var r=null==(e=window.document)||null==(e=e.documentElement)?void 0:e.style;if(r&&!(t in r))for(let e=0;e<i.length;e++)if(a(t,i[e])in r)return i[e]}return""}function a(e,t){return t?"".concat(t).concat(function(t){let r="",i=!0;for(let e=0;e<t.length;e++)i?(r+=t[e].toUpperCase(),i=!1):"-"===t[e]?i=!0:r+=t[e];return r}(e)):e}t.default=n()},725:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=d(void 0);if(t&&t.has(e))return t.get(e);var r,i,n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((i=a?Object.getOwnPropertyDescriptor(e,r):null)&&(i.get||i.set)?Object.defineProperty(n,r,i):n[r]=e[r]);return n.default=e,t&&t.set(e,n),n}(r(1)),n=u(r(0)),a=u(r(27)),s=r(588),o=r(615),l=r(575),h=u(r(616));function u(e){return e&&e.__esModule?e:{default:e}}function d(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(d=function(e){return e?r:t})(e))}function c(e,t,r){var i;i=function(e){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return String(e);t=t.call(e,"string");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(t),(t="symbol"==typeof i?i:String(i))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}let f={start:"touchstart",move:"touchmove",stop:"touchend"},p={start:"mousedown",move:"mousemove",stop:"mouseup"},m=p;class g extends i.Component{constructor(){super(...arguments),c(this,"dragging",!1),c(this,"lastX",NaN),c(this,"lastY",NaN),c(this,"touchIdentifier",null),c(this,"mounted",!1),c(this,"handleDragStart",e=>{if(this.props.onMouseDown(e),!this.props.allowAnyClick&&"number"==typeof e.button&&0!==e.button)return!1;var t=this.findDOMNode();if(!t||!t.ownerDocument||!t.ownerDocument.body)throw new Error("<DraggableCore> not mounted on DragStart!");var r,i,n=t["ownerDocument"];this.props.disabled||!(e.target instanceof n.defaultView.Node)||this.props.handle&&!(0,s.matchesSelectorAndParentsTo)(e.target,this.props.handle,t)||this.props.cancel&&(0,s.matchesSelectorAndParentsTo)(e.target,this.props.cancel,t)||("touchstart"===e.type&&e.preventDefault(),t=(0,s.getTouchIdentifier)(e),this.touchIdentifier=t,null!=(t=(0,o.getControlPosition)(e,t,this))&&({x:t,y:r}=t,i=(0,o.createCoreData)(this,t,r),(0,h.default)("DraggableCore: handleDragStart: %j",i),(0,h.default)("calling",this.props.onStart),!1!==this.props.onStart(e,i))&&!1!==this.mounted&&(this.props.enableUserSelectHack&&(0,s.addUserSelectStyles)(n),this.dragging=!0,this.lastX=t,this.lastY=r,(0,s.addEvent)(n,m.move,this.handleDrag),(0,s.addEvent)(n,m.stop,this.handleDragStop)))}),c(this,"handleDrag",r=>{let i=(0,o.getControlPosition)(r,this.touchIdentifier,this);if(null!=i){let{x:e,y:t}=i;if(Array.isArray(this.props.grid)){var n=e-this.lastX,a=t-this.lastY;if([n,a]=(0,o.snapToGrid)(this.props.grid,n,a),!n&&!a)return;e=this.lastX+n,t=this.lastY+a}n=(0,o.createCoreData)(this,e,t);if((0,h.default)("DraggableCore: handleDrag: %j",n),!1!==this.props.onDrag(r,n)&&!1!==this.mounted)this.lastX=e,this.lastY=t;else try{this.handleDragStop(new MouseEvent("mouseup"))}catch(r){let e=document.createEvent("MouseEvents");e.initMouseEvent("mouseup",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),this.handleDragStop(e)}}}),c(this,"handleDragStop",r=>{if(this.dragging){var i=(0,o.getControlPosition)(r,this.touchIdentifier,this);if(null!=i){let{x:e,y:t}=i;Array.isArray(this.props.grid)&&(i=e-this.lastX||0,n=t-this.lastY||0,[i,n]=(0,o.snapToGrid)(this.props.grid,i,n),e=this.lastX+i,t=this.lastY+n);i=(0,o.createCoreData)(this,e,t);if(!1===this.props.onStop(r,i)||!1===this.mounted)return!1;var n=this.findDOMNode();n&&this.props.enableUserSelectHack&&(0,s.removeUserSelectStyles)(n.ownerDocument),(0,h.default)("DraggableCore: handleDragStop: %j",i),this.dragging=!1,this.lastX=NaN,this.lastY=NaN,n&&((0,h.default)("DraggableCore: Removing handlers"),(0,s.removeEvent)(n.ownerDocument,m.move,this.handleDrag),(0,s.removeEvent)(n.ownerDocument,m.stop,this.handleDragStop))}}}),c(this,"onMouseDown",e=>(m=p,this.handleDragStart(e))),c(this,"onMouseUp",e=>(m=p,this.handleDragStop(e))),c(this,"onTouchStart",e=>(m=f,this.handleDragStart(e))),c(this,"onTouchEnd",e=>(m=f,this.handleDragStop(e)))}componentDidMount(){this.mounted=!0;var e=this.findDOMNode();e&&(0,s.addEvent)(e,f.start,this.onTouchStart,{passive:!1})}componentWillUnmount(){this.mounted=!1;var e,t=this.findDOMNode();t&&(e=t["ownerDocument"],(0,s.removeEvent)(e,p.move,this.handleDrag),(0,s.removeEvent)(e,f.move,this.handleDrag),(0,s.removeEvent)(e,p.stop,this.handleDragStop),(0,s.removeEvent)(e,f.stop,this.handleDragStop),(0,s.removeEvent)(t,f.start,this.onTouchStart,{passive:!1}),this.props.enableUserSelectHack)&&(0,s.removeUserSelectStyles)(e)}findDOMNode(){var e;return null!=(e=this.props)&&e.nodeRef?null==(e=this.props)||null==(e=e.nodeRef)?void 0:e.current:a.default.findDOMNode(this)}render(){return i.cloneElement(i.Children.only(this.props.children),{onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onTouchEnd:this.onTouchEnd})}}c(t.default=g,"displayName","DraggableCore"),c(g,"propTypes",{allowAnyClick:n.default.bool,children:n.default.node.isRequired,disabled:n.default.bool,enableUserSelectHack:n.default.bool,offsetParent:function(e,t){if(e[t]&&1!==e[t].nodeType)throw new Error("Draggable's offsetParent must be a DOM Node.")},grid:n.default.arrayOf(n.default.number),handle:n.default.string,cancel:n.default.string,nodeRef:n.default.object,onStart:n.default.func,onDrag:n.default.func,onStop:n.default.func,onMouseDown:n.default.func,scale:n.default.number,className:l.dontSetMe,style:l.dontSetMe,transform:l.dontSetMe}),c(g,"defaultProps",{allowAnyClick:!1,disabled:!1,enableUserSelectHack:!0,onStart:function(){},onDrag:function(){},onStop:function(){},onMouseDown:function(){},scale:1})},763:function(e,t,r){!function(e,t){function n(e){delete u[e]}function a(e){if(d)setTimeout(a,0,e);else{var t=u[e];if(t){d=!0;try{var r=t.callback,i=t.args;switch(i.length){case 0:r();break;case 1:r(i[0]);break;case 2:r(i[0],i[1]);break;case 3:r(i[0],i[1],i[2]);break;default:r.apply(void 0,i)}}finally{n(e),d=!1}}}}var r,i,s,o,l,h,u,d,c,f;(r="undefined"==typeof self?void 0===e?this:e:self).setImmediate||(h=1,d=!(u={}),c=r.document,e=(e=Object.getPrototypeOf&&Object.getPrototypeOf(r))&&e.setTimeout?e:r,f="[object process]"==={}.toString.call(r.process)?function(e){t.nextTick(function(){a(e)})}:function(){var e,t;if(r.postMessage&&!r.importScripts)return e=!0,t=r.onmessage,r.onmessage=function(){e=!1},r.postMessage("","*"),r.onmessage=t,e}()?(o="setImmediate$"+Math.random()+"$",l=function(e){e.source===r&&"string"==typeof e.data&&0===e.data.indexOf(o)&&a(+e.data.slice(o.length))},r.addEventListener?r.addEventListener("message",l,!1):r.attachEvent("onmessage",l),function(e){r.postMessage(o+e,"*")}):r.MessageChannel?((s=new MessageChannel).port1.onmessage=function(e){a(e.data)},function(e){s.port2.postMessage(e)}):c&&"onreadystatechange"in c.createElement("script")?(i=c.documentElement,function(e){var t=c.createElement("script");t.onreadystatechange=function(){a(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):function(e){setTimeout(a,0,e)},e.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];return u[h]={callback:e,args:t},f(h),h++},e.clearImmediate=n)}.call(this,r(32),r(319))},766:function(e,t,r){t.byteLength=function(e){var e=u(e),t=e[0],e=e[1];return 3*(t+e)/4-e},t.toByteArray=function(e){for(var t,r=u(e),i=r[0],r=r[1],n=new h(3*(i+r)/4-r),a=0,s=0<r?i-4:i,o=0;o<s;o+=4)t=l[e.charCodeAt(o)]<<18|l[e.charCodeAt(o+1)]<<12|l[e.charCodeAt(o+2)]<<6|l[e.charCodeAt(o+3)],n[a++]=t>>16&255,n[a++]=t>>8&255,n[a++]=255&t;return 2===r&&(t=l[e.charCodeAt(o)]<<2|l[e.charCodeAt(o+1)]>>4,n[a++]=255&t),1===r&&(t=l[e.charCodeAt(o)]<<10|l[e.charCodeAt(o+1)]<<4|l[e.charCodeAt(o+2)]>>2,n[a++]=t>>8&255,n[a++]=255&t),n},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,n=[],a=0,s=r-i;a<s;a+=16383)n.push(function(e,t,r){for(var i,n=[],a=t;a<r;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),n.push(o[(i=i)>>18&63]+o[i>>12&63]+o[i>>6&63]+o[63&i]);return n.join("")}(e,a,s<a+16383?s:a+16383));return 1==i?(t=e[r-1],n.push(o[t>>2]+o[t<<4&63]+"==")):2==i&&(t=(e[r-2]<<8)+e[r-1],n.push(o[t>>10]+o[t>>4&63]+o[t<<2&63]+"=")),n.join("")};for(var o=[],l=[],h="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,a=i.length;n<a;++n)o[n]=i[n],l[i.charCodeAt(n)]=n;function u(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");e=e.indexOf("=");return[e=-1===e?t:e,e===t?0:4-e%4]}l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},767:function(e,t){t.read=function(e,t,r,i,n){var a,s,o=8*n-i-1,l=(1<<o)-1,h=l>>1,u=-7,d=r?n-1:0,c=r?-1:1,n=e[t+d];for(d+=c,a=n&(1<<-u)-1,n>>=-u,u+=o;0<u;a=256*a+e[t+d],d+=c,u-=8);for(s=a&(1<<-u)-1,a>>=-u,u+=i;0<u;s=256*s+e[t+d],d+=c,u-=8);if(0===a)a=1-h;else{if(a===l)return s?NaN:1/0*(n?-1:1);s+=Math.pow(2,i),a-=h}return(n?-1:1)*s*Math.pow(2,a-i)},t.write=function(e,t,r,i,n,a){var s,o,l=8*a-n-1,h=(1<<l)-1,u=h>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,c=i?0:a-1,f=i?1:-1,a=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,s=h):(s=Math.floor(Math.log(t)/Math.LN2),t*(i=Math.pow(2,-s))<1&&(s--,i*=2),2<=(t+=1<=s+u?d/i:d*Math.pow(2,1-u))*i&&(s++,i/=2),h<=s+u?(o=0,s=h):1<=s+u?(o=(t*i-1)*Math.pow(2,n),s+=u):(o=t*Math.pow(2,u-1)*Math.pow(2,n),s=0));8<=n;e[r+c]=255&o,c+=f,o/=256,n-=8);for(s=s<<n|o,l+=n;0<l;e[r+c]=255&s,c+=f,s/=256,l-=8);e[r+c-f]|=128*a}},768:function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},924:function(e,t,r){var i=r(621),n=r(622);function a(t,r){switch(arguments.length){case 0:return a;case 1:return Object(n.a)(t)?a:Object(i.a)(function(e){return s(t,e)});default:return Object(n.a)(t)&&Object(n.a)(r)?a:Object(n.a)(t)?Object(i.a)(function(e){return s(e,r)}):Object(n.a)(r)?Object(i.a)(function(e){return s(t,e)}):s(t,r)}}var s;s=function(e,t){for(var r,i={},n={},a=0,s=e.length;a<s;)a+=n[e[a]]=1;for(r in t)n.hasOwnProperty(r)||(i[r]=t[r]);return i};t.a=a}}]);